#!/usr/bin/env node
'use strict';var _babelCore=require('babel-core'),_babelPresetBabili=require('babel-preset-babili'),_babelPresetBabili2=_interopRequireDefault(_babelPresetBabili),_babelPluginTransformWith=require('babel-plugin-transform-with'),_babelPluginTransformWith2=_interopRequireDefault(_babelPluginTransformWith),_clientnode=require('clientnode'),_clientnode2=_interopRequireDefault(_clientnode),_ejs=require('ejs'),ejs=_interopRequireWildcard(_ejs),_fs=require('fs'),fileSystem=_interopRequireWildcard(_fs),_htmlMinifier=require('html-minifier'),_loaderUtils=require('loader-utils'),loaderUtils=_interopRequireWildcard(_loaderUtils),_path=require('path'),_path2=_interopRequireDefault(_path),_configurator=require('./configurator.compiled'),_configurator2=_interopRequireDefault(_configurator),_helper=require('./helper.compiled'),_helper2=_interopRequireDefault(_helper);function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}try{require('source-map-support/register')}catch(a){}module.exports=function(source){'cachable'in this&&this.cacheable&&this.cacheable();const query=_clientnode2.default.convertSubstringInPlainObject(_clientnode2.default.extendObject(!0,{compress:{html:{},javaScript:{}},context:'./',extensions:{file:{external:['.js'],internal:['.js','.css','.svg','.png','.jpg','.gif','.ico','.html','.json','.eot','.ttf','.woff']},module:[]},module:{aliases:{},replacements:{}},compileSteps:2},this.options||{},'query'in this?loaderUtils.getOptions(this)||{}:{}),/#%%%#/g,'!'),compile=(template,options=query.compiler,compileSteps=2)=>(locals={})=>{options=_clientnode2.default.extendObject(!0,{filename:template},options);const require=(a,b={})=>{const c=a.replace(/^(.+)\?[^?]+$/,'$1'),d=a.match(/^[^?]+\?(.+)$/,'$1');if(d){b=_clientnode2.default.extendObject(!0,b,((h,i,j,k,l)=>new Function('request','template','source','compile','locals',`return ${d[1]}`)(h,i,j,k,l))(a,c,source,compile,locals))}let e=_clientnode2.default.copyLimitedRecursively(options);if(delete e.client,e=_clientnode2.default.extendObject(!0,{encoding:'utf-8'},e,b.options||{}),e.isString)return compile(c,e)(b);const f=_helper2.default.determineModuleFilePath(c,query.module.aliases,query.module.replacements,query.extensions,query.context,_configurator2.default.path.source.asset.base,_configurator2.default.path.ignore,_configurator2.default.module.directoryNames,_configurator2.default.package.main.fileNames,_configurator2.default.package.main.propertyNames,_configurator2.default.package.aliasPropertyNames);if(f)return'query'in this&&this.addDependency(f),d||f.endsWith('.ejs')?compile(f,e)(b):fileSystem.readFileSync(f,e);throw new Error(`Given template file "${c}" couldn't be resolved.`)},compressHTML=(a)=>query.compress.html?(0,_htmlMinifier.minify)(a,_clientnode2.default.extendObject(!0,{caseSensitive:!0,collapseInlineTagWhitespace:!0,collapseWhitespace:!0,conservativeCollapse:!0,minifyCSS:!0,minifyJS:!0,processScripts:['text/ng-template','text/x-handlebars-template'],removeAttributeQuotes:!0,removeComments:!0,removeRedundantAttributes:!0,removeScriptTypeAttributes:!0,removeStyleLinkTypeAttributes:!0,sortAttributes:!0,sortClassName:!0,trimCustomFragments:!1,useShortDoctype:!0})):a;let remainingSteps=compileSteps,result=template,isString=options.isString;for(delete options.isString;0<remainingSteps;){if('string'==typeof result){const filePath=isString&&options.filename||result;if(filePath&&'.js'===_path2.default.extname(filePath))result=eval('require')(filePath);else{if(!isString){let a='utf-8';'encoding'in options&&(a=options.encoding),result=fileSystem.readFileSync(result,{encoding:a})}1===remainingSteps&&(result=compressHTML(result)),result=ejs.compile(result,options)}}else result=compressHTML(result(_clientnode2.default.extendObject(!0,{configuration:_configurator2.default,Helper:_helper2.default,include:require,require,Tools:_clientnode2.default},locals)));remainingSteps-=1}return!(compileSteps%2)?result:`'use strict';\n`+(0,_babelCore.transform)(`module.exports = ${result.toString()};`,{ast:!1,babelrc:!1,comments:!!!query.compress.javaScript,compact:!!query.compress.javaScript,filename:options.filename||'unknown',minified:!!query.compress.javaScript,plugins:[_babelPluginTransformWith2.default],presets:query.compress.javaScript?[[_babelPresetBabili2.default,query.compress.javaScript]]:[],sourceMaps:!1,sourceType:'script'}).code};return compile(source,{client:!!(query.compileSteps%2),compileDebug:this.debug||!1,debug:this.debug||!1,filename:'query'in this?loaderUtils.getRemainingRequest(this).replace(/^!/,''):null,isString:!0},query.compileSteps)(query.locals||{})};

//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FRSixNQUFNLFlBUkYsRUFRZ0IsTUFBTSxNQUFOLElBUmhCLENBU1YsQyIsImZpbGUiOiJlanNMb2FkZXIuY29tcGlsZWQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbi8vIEBmbG93XG4vLyAtKi0gY29kaW5nOiB1dGYtOCAtKi1cbid1c2Ugc3RyaWN0J1xuLyogIVxuICAgIHJlZ2lvbiBoZWFkZXJcbiAgICBDb3B5cmlnaHQgVG9yYmVuIFNpY2tlcnQgKGluZm9bXCJ+YXR+XCJddG9yYmVuLndlYnNpdGUpIDE2LjEyLjIwMTJcblxuICAgIExpY2Vuc2VcbiAgICAtLS0tLS0tXG5cbiAgICBUaGlzIGxpYnJhcnkgd3JpdHRlbiBieSBUb3JiZW4gU2lja2VydCBzdGFuZCB1bmRlciBhIGNyZWF0aXZlIGNvbW1vbnMgbmFtaW5nXG4gICAgMy4wIHVucG9ydGVkIGxpY2Vuc2UuIHNlZSBodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS8zLjAvZGVlZC5kZVxuICAgIGVuZHJlZ2lvblxuKi9cbi8vIHJlZ2lvbiBpbXBvcnRzXG5pbXBvcnQge3RyYW5zZm9ybSBhcyBiYWJlbFRyYW5zZm9ybX0gZnJvbSAnYmFiZWwtY29yZSdcbmltcG9ydCBiYWJpbGlQcmVzZXQgZnJvbSAnYmFiZWwtcHJlc2V0LWJhYmlsaSdcbmltcG9ydCB0cmFuc2Zvcm1XaXRoIGZyb20gJ2JhYmVsLXBsdWdpbi10cmFuc2Zvcm0td2l0aCdcbmltcG9ydCBUb29scyBmcm9tICdjbGllbnRub2RlJ1xuaW1wb3J0ICogYXMgZWpzIGZyb20gJ2VqcydcbmltcG9ydCAqIGFzIGZpbGVTeXN0ZW0gZnJvbSAnZnMnXG5pbXBvcnQge21pbmlmeSBhcyBtaW5pZnlIVE1MfSBmcm9tICdodG1sLW1pbmlmaWVyJ1xuaW1wb3J0ICogYXMgbG9hZGVyVXRpbHMgZnJvbSAnbG9hZGVyLXV0aWxzJ1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCdcbi8vIE5PVEU6IE9ubHkgbmVlZGVkIGZvciBkZWJ1Z2dpbmcgdGhpcyBmaWxlLlxudHJ5IHtcbiAgICByZXF1aXJlKCdzb3VyY2UtbWFwLXN1cHBvcnQvcmVnaXN0ZXInKVxufSBjYXRjaCAoZXJyb3IpIHt9XG5cbmltcG9ydCBjb25maWd1cmF0aW9uIGZyb20gJy4vY29uZmlndXJhdG9yLmNvbXBpbGVkJ1xuaW1wb3J0IEhlbHBlciBmcm9tICcuL2hlbHBlci5jb21waWxlZCdcbi8vIGVuZHJlZ2lvblxuLy8gcmVnaW9uIHR5cGVzXG50eXBlIFRlbXBsYXRlRnVuY3Rpb24gPSAobG9jYWxzOk9iamVjdCkgPT4gc3RyaW5nXG50eXBlIENvbXBpbGVGdW5jdGlvbiA9ICh0ZW1wbGF0ZTpzdHJpbmcsIG9wdGlvbnM6T2JqZWN0KSA9PiBUZW1wbGF0ZUZ1bmN0aW9uXG4vLyBlbmRyZWdpb25cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oc291cmNlOnN0cmluZyk6c3RyaW5nIHtcbiAgICBpZiAoJ2NhY2hhYmxlJyBpbiB0aGlzICYmIHRoaXMuY2FjaGVhYmxlKVxuICAgICAgICB0aGlzLmNhY2hlYWJsZSgpXG4gICAgY29uc3QgcXVlcnk6T2JqZWN0ID0gVG9vbHMuY29udmVydFN1YnN0cmluZ0luUGxhaW5PYmplY3QoXG4gICAgICAgIFRvb2xzLmV4dGVuZE9iamVjdCh0cnVlLCB7XG4gICAgICAgICAgICBjb21wcmVzczoge1xuICAgICAgICAgICAgICAgIGh0bWw6IHt9LFxuICAgICAgICAgICAgICAgIGphdmFTY3JpcHQ6IHt9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29udGV4dDogJy4vJyxcbiAgICAgICAgICAgIGV4dGVuc2lvbnM6IHtcbiAgICAgICAgICAgICAgICBmaWxlOiB7XG4gICAgICAgICAgICAgICAgICAgIGV4dGVybmFsOiBbJy5qcyddLFxuICAgICAgICAgICAgICAgICAgICBpbnRlcm5hbDogW1xuICAgICAgICAgICAgICAgICAgICAgICAgJy5qcycsICcuY3NzJywgJy5zdmcnLCAnLnBuZycsICcuanBnJywgJy5naWYnLCAnLmljbycsXG4gICAgICAgICAgICAgICAgICAgICAgICAnLmh0bWwnLCAnLmpzb24nLCAnLmVvdCcsICcudHRmJywgJy53b2ZmJ1xuICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgfSwgbW9kdWxlOiBbXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1vZHVsZToge1xuICAgICAgICAgICAgICAgIGFsaWFzZXM6IHt9LFxuICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50czoge31cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb21waWxlU3RlcHM6IDJcbiAgICAgICAgfSwgdGhpcy5vcHRpb25zIHx8IHt9LCAncXVlcnknIGluIHRoaXMgPyBsb2FkZXJVdGlscy5nZXRPcHRpb25zKFxuICAgICAgICAgICAgdGhpc1xuICAgICAgICApIHx8IHt9IDoge30pLFxuICAgICAgICAvIyUlJSMvZywgJyEnKVxuICAgIGNvbnN0IGNvbXBpbGU6Q29tcGlsZUZ1bmN0aW9uID0gKFxuICAgICAgICB0ZW1wbGF0ZTpzdHJpbmcsIG9wdGlvbnM6T2JqZWN0ID0gcXVlcnkuY29tcGlsZXIsXG4gICAgICAgIGNvbXBpbGVTdGVwczpudW1iZXIgPSAyXG4gICAgKTpUZW1wbGF0ZUZ1bmN0aW9uID0+IChsb2NhbHM6T2JqZWN0ID0ge30pOnN0cmluZyA9PiB7XG4gICAgICAgIG9wdGlvbnMgPSBUb29scy5leHRlbmRPYmplY3QodHJ1ZSwge2ZpbGVuYW1lOiB0ZW1wbGF0ZX0sIG9wdGlvbnMpXG4gICAgICAgIGNvbnN0IHJlcXVpcmU6RnVuY3Rpb24gPSAoXG4gICAgICAgICAgICByZXF1ZXN0OnN0cmluZywgbmVzdGVkTG9jYWxzOk9iamVjdCA9IHt9XG4gICAgICAgICk6c3RyaW5nID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRlbXBsYXRlOnN0cmluZyA9IHJlcXVlc3QucmVwbGFjZSgvXiguKylcXD9bXj9dKyQvLCAnJDEnKVxuICAgICAgICAgICAgY29uc3QgcXVlcnlNYXRjaDo/QXJyYXk8c3RyaW5nPiA9IHJlcXVlc3QubWF0Y2goXG4gICAgICAgICAgICAgICAgL15bXj9dK1xcPyguKykkLywgJyQxJylcbiAgICAgICAgICAgIGlmIChxdWVyeU1hdGNoKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZXZhbHVhdGlvbkZ1bmN0aW9uID0gKFxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0OnN0cmluZywgdGVtcGxhdGU6c3RyaW5nLCBzb3VyY2U6c3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICBjb21waWxlOkNvbXBpbGVGdW5jdGlvbiwgbG9jYWxzOk9iamVjdFxuICAgICAgICAgICAgICAgIC8vIElnbm9yZVR5cGVDaGVja1xuICAgICAgICAgICAgICAgICk6T2JqZWN0ID0+IG5ldyBGdW5jdGlvbihcbiAgICAgICAgICAgICAgICAgICAgJ3JlcXVlc3QnLCAndGVtcGxhdGUnLCAnc291cmNlJywgJ2NvbXBpbGUnLCAnbG9jYWxzJyxcbiAgICAgICAgICAgICAgICAgICAgYHJldHVybiAke3F1ZXJ5TWF0Y2hbMV19YFxuICAgICAgICAgICAgICAgICkocmVxdWVzdCwgdGVtcGxhdGUsIHNvdXJjZSwgY29tcGlsZSwgbG9jYWxzKVxuICAgICAgICAgICAgICAgIG5lc3RlZExvY2FscyA9IFRvb2xzLmV4dGVuZE9iamVjdChcbiAgICAgICAgICAgICAgICAgICAgdHJ1ZSwgbmVzdGVkTG9jYWxzLCBldmFsdWF0aW9uRnVuY3Rpb24oXG4gICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LCB0ZW1wbGF0ZSwgc291cmNlLCBjb21waWxlLCBsb2NhbHMpKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IG5lc3RlZE9wdGlvbnM6T2JqZWN0ID0gVG9vbHMuY29weUxpbWl0ZWRSZWN1cnNpdmVseShvcHRpb25zKVxuICAgICAgICAgICAgZGVsZXRlIG5lc3RlZE9wdGlvbnMuY2xpZW50XG4gICAgICAgICAgICBuZXN0ZWRPcHRpb25zID0gVG9vbHMuZXh0ZW5kT2JqZWN0KFxuICAgICAgICAgICAgICAgIHRydWUsIHtlbmNvZGluZzogJ3V0Zi04J30sIG5lc3RlZE9wdGlvbnMsXG4gICAgICAgICAgICAgICAgbmVzdGVkTG9jYWxzLm9wdGlvbnMgfHwge30pXG4gICAgICAgICAgICBpZiAobmVzdGVkT3B0aW9ucy5pc1N0cmluZylcbiAgICAgICAgICAgICAgICByZXR1cm4gY29tcGlsZSh0ZW1wbGF0ZSwgbmVzdGVkT3B0aW9ucykobmVzdGVkTG9jYWxzKVxuICAgICAgICAgICAgY29uc3QgdGVtcGxhdGVGaWxlUGF0aDo/c3RyaW5nID1cbiAgICAgICAgICAgICAgICBIZWxwZXIuZGV0ZXJtaW5lTW9kdWxlRmlsZVBhdGgoXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlLCBxdWVyeS5tb2R1bGUuYWxpYXNlcyxcbiAgICAgICAgICAgICAgICAgICAgcXVlcnkubW9kdWxlLnJlcGxhY2VtZW50cywgcXVlcnkuZXh0ZW5zaW9ucyxcbiAgICAgICAgICAgICAgICAgICAgcXVlcnkuY29udGV4dCwgY29uZmlndXJhdGlvbi5wYXRoLnNvdXJjZS5hc3NldC5iYXNlLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguaWdub3JlLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLm1vZHVsZS5kaXJlY3RvcnlOYW1lcyxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYWNrYWdlLm1haW4uZmlsZU5hbWVzLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhY2thZ2UubWFpbi5wcm9wZXJ0eU5hbWVzLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhY2thZ2UuYWxpYXNQcm9wZXJ0eU5hbWVzKVxuICAgICAgICAgICAgaWYgKHRlbXBsYXRlRmlsZVBhdGgpIHtcbiAgICAgICAgICAgICAgICBpZiAoJ3F1ZXJ5JyBpbiB0aGlzKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZERlcGVuZGVuY3kodGVtcGxhdGVGaWxlUGF0aClcbiAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgICBOT1RFOiBJZiB0aGVyZSBhcmVuJ3QgYW55IGxvY2FscyBvcHRpb25zIG9yIHZhcmlhYmxlcyBhbmRcbiAgICAgICAgICAgICAgICAgICAgZmlsZSBkb2Vzbid0IHNlZW0gdG8gYmUgYW4gZWpzIHRlbXBsYXRlIHdlIHNpbXBseSBsb2FkXG4gICAgICAgICAgICAgICAgICAgIGluY2x1ZGVkIGZpbGUgY29udGVudC5cbiAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIGlmIChxdWVyeU1hdGNoIHx8IHRlbXBsYXRlRmlsZVBhdGguZW5kc1dpdGgoJy5lanMnKSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBpbGUodGVtcGxhdGVGaWxlUGF0aCwgbmVzdGVkT3B0aW9ucykoXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXN0ZWRMb2NhbHMpXG4gICAgICAgICAgICAgICAgLy8gSWdub3JlVHlwZUNoZWNrXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbGVTeXN0ZW0ucmVhZEZpbGVTeW5jKHRlbXBsYXRlRmlsZVBhdGgsIG5lc3RlZE9wdGlvbnMpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAgICAgYEdpdmVuIHRlbXBsYXRlIGZpbGUgXCIke3RlbXBsYXRlfVwiIGNvdWxkbid0IGJlIHJlc29sdmVkLmApXG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29tcHJlc3NIVE1MOkZ1bmN0aW9uID0gKGNvbnRlbnQ6c3RyaW5nKTpzdHJpbmcgPT5cbiAgICAgICAgICAgIHF1ZXJ5LmNvbXByZXNzLmh0bWwgPyBtaW5pZnlIVE1MKGNvbnRlbnQsIFRvb2xzLmV4dGVuZE9iamVjdChcbiAgICAgICAgICAgICAgICB0cnVlLCB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2VTZW5zaXRpdmU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNvbGxhcHNlSW5saW5lVGFnV2hpdGVzcGFjZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgY29sbGFwc2VXaGl0ZXNwYWNlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBjb25zZXJ2YXRpdmVDb2xsYXBzZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgbWluaWZ5Q1NTOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBtaW5pZnlKUzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1NjcmlwdHM6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICd0ZXh0L25nLXRlbXBsYXRlJywgJ3RleHQveC1oYW5kbGViYXJzLXRlbXBsYXRlJ1xuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICByZW1vdmVBdHRyaWJ1dGVRdW90ZXM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZUNvbW1lbnRzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICByZW1vdmVSZWR1bmRhbnRBdHRyaWJ1dGVzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICByZW1vdmVTY3JpcHRUeXBlQXR0cmlidXRlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlU3R5bGVMaW5rVHlwZUF0dHJpYnV0ZXM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHNvcnRBdHRyaWJ1dGVzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBzb3J0Q2xhc3NOYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0cmltQ3VzdG9tRnJhZ21lbnRzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgdXNlU2hvcnREb2N0eXBlOiB0cnVlXG4gICAgICAgICAgICAgICAgfSkpIDogY29udGVudFxuICAgICAgICBsZXQgcmVtYWluaW5nU3RlcHM6bnVtYmVyID0gY29tcGlsZVN0ZXBzXG4gICAgICAgIGxldCByZXN1bHQ6VGVtcGxhdGVGdW5jdGlvbnxzdHJpbmcgPSB0ZW1wbGF0ZVxuICAgICAgICBsZXQgaXNTdHJpbmc6Ym9vbGVhbiA9IG9wdGlvbnMuaXNTdHJpbmdcbiAgICAgICAgZGVsZXRlIG9wdGlvbnMuaXNTdHJpbmdcbiAgICAgICAgd2hpbGUgKHJlbWFpbmluZ1N0ZXBzID4gMCkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiByZXN1bHQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZmlsZVBhdGg6P3N0cmluZyA9IGlzU3RyaW5nICYmIG9wdGlvbnMuZmlsZW5hbWUgfHwgcmVzdWx0XG4gICAgICAgICAgICAgICAgaWYgKGZpbGVQYXRoICYmIHBhdGguZXh0bmFtZShmaWxlUGF0aCkgPT09ICcuanMnKVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBldmFsKCdyZXF1aXJlJykoZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNTdHJpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBlbmNvZGluZzpzdHJpbmcgPSAndXRmLTgnXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJ2VuY29kaW5nJyBpbiBvcHRpb25zKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kaW5nID0gb3B0aW9ucy5lbmNvZGluZ1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZmlsZVN5c3RlbS5yZWFkRmlsZVN5bmMocmVzdWx0LCB7ZW5jb2Rpbmd9KVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZW1haW5pbmdTdGVwcyA9PT0gMSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNvbXByZXNzSFRNTChyZXN1bHQpXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGVqcy5jb21waWxlKHJlc3VsdCwgb3B0aW9ucylcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2VcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBjb21wcmVzc0hUTUwocmVzdWx0KFRvb2xzLmV4dGVuZE9iamVjdCh0cnVlLCB7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24sIEhlbHBlciwgaW5jbHVkZTogcmVxdWlyZSwgcmVxdWlyZSwgVG9vbHNcbiAgICAgICAgICAgICAgICB9LCBsb2NhbHMpKSlcbiAgICAgICAgICAgIHJlbWFpbmluZ1N0ZXBzIC09IDFcbiAgICAgICAgfVxuICAgICAgICBpZiAoQm9vbGVhbihjb21waWxlU3RlcHMgJSAyKSlcbiAgICAgICAgICAgIHJldHVybiBgJ3VzZSBzdHJpY3QnO1xcbmAgKyBiYWJlbFRyYW5zZm9ybShcbiAgICAgICAgICAgICAgICBgbW9kdWxlLmV4cG9ydHMgPSAke3Jlc3VsdC50b1N0cmluZygpfTtgLCB7XG4gICAgICAgICAgICAgICAgICAgIGFzdDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGJhYmVscmM6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBjb21tZW50czogIUJvb2xlYW4ocXVlcnkuY29tcHJlc3MuamF2YVNjcmlwdCksXG4gICAgICAgICAgICAgICAgICAgIGNvbXBhY3Q6IEJvb2xlYW4ocXVlcnkuY29tcHJlc3MuamF2YVNjcmlwdCksXG4gICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lOiBvcHRpb25zLmZpbGVuYW1lIHx8ICd1bmtub3duJyxcbiAgICAgICAgICAgICAgICAgICAgbWluaWZpZWQ6IEJvb2xlYW4ocXVlcnkuY29tcHJlc3MuamF2YVNjcmlwdCksXG4gICAgICAgICAgICAgICAgICAgIHBsdWdpbnM6IFt0cmFuc2Zvcm1XaXRoXSxcbiAgICAgICAgICAgICAgICAgICAgcHJlc2V0czogcXVlcnkuY29tcHJlc3MuamF2YVNjcmlwdCA/IFtbXG4gICAgICAgICAgICAgICAgICAgICAgICBiYWJpbGlQcmVzZXQsIHF1ZXJ5LmNvbXByZXNzLmphdmFTY3JpcHRcbiAgICAgICAgICAgICAgICAgICAgXV0gOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgc291cmNlTWFwczogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZVR5cGU6ICdzY3JpcHQnXG4gICAgICAgICAgICAgICAgfSkuY29kZVxuICAgICAgICAvLyBJZ25vcmVUeXBlQ2hlY2tcbiAgICAgICAgcmV0dXJuIHJlc3VsdFxuICAgIH1cbiAgICByZXR1cm4gY29tcGlsZShzb3VyY2UsIHtcbiAgICAgICAgY2xpZW50OiBCb29sZWFuKHF1ZXJ5LmNvbXBpbGVTdGVwcyAlIDIpLFxuICAgICAgICBjb21waWxlRGVidWc6IHRoaXMuZGVidWcgfHwgZmFsc2UsXG4gICAgICAgIGRlYnVnOiB0aGlzLmRlYnVnIHx8IGZhbHNlLFxuICAgICAgICBmaWxlbmFtZTogJ3F1ZXJ5JyBpbiB0aGlzID8gbG9hZGVyVXRpbHMuZ2V0UmVtYWluaW5nUmVxdWVzdChcbiAgICAgICAgICAgIHRoaXNcbiAgICAgICAgKS5yZXBsYWNlKC9eIS8sICcnKSA6IG51bGwsXG4gICAgICAgIGlzU3RyaW5nOiB0cnVlXG4gICAgfSwgcXVlcnkuY29tcGlsZVN0ZXBzKShxdWVyeS5sb2NhbHMgfHwge30pXG59XG4vLyByZWdpb24gdmltIG1vZGxpbmVcbi8vIHZpbTogc2V0IHRhYnN0b3A9NCBzaGlmdHdpZHRoPTQgZXhwYW5kdGFiOlxuLy8gdmltOiBmb2xkbWV0aG9kPW1hcmtlciBmb2xkbWFya2VyPXJlZ2lvbixlbmRyZWdpb246XG4vLyBlbmRyZWdpb25cbiJdfQ==