#!/usr/bin/env node
'use strict';var _babelCore=require('babel-core'),_babelPresetBabili=require('babel-preset-babili'),_babelPresetBabili2=_interopRequireDefault(_babelPresetBabili),_babelPluginTransformWith=require('babel-plugin-transform-with'),_babelPluginTransformWith2=_interopRequireDefault(_babelPluginTransformWith),_clientnode=require('clientnode'),_clientnode2=_interopRequireDefault(_clientnode),_ejs=require('ejs'),ejs=_interopRequireWildcard(_ejs),_fs=require('fs'),fileSystem=_interopRequireWildcard(_fs),_htmlMinifier=require('html-minifier'),_loaderUtils=require('loader-utils'),loaderUtils=_interopRequireWildcard(_loaderUtils),_path=require('path'),_path2=_interopRequireDefault(_path),_configurator=require('./configurator.compiled'),_configurator2=_interopRequireDefault(_configurator),_helper=require('./helper.compiled'),_helper2=_interopRequireDefault(_helper);function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}try{require('source-map-support/register')}catch(a){}module.exports=function(source){'cachable'in this&&this.cacheable&&this.cacheable();const query=_clientnode2.default.convertSubstringInPlainObject(_clientnode2.default.extendObject(!0,{compress:{html:{},javaScript:{}},context:'./',extensions:{file:{external:['.js'],internal:['.js','.css','.svg','.png','.jpg','.gif','.ico','.html','.json','.eot','.ttf','.woff']},module:[]},module:{aliases:{},replacements:{}},compileSteps:2},this.options||{},'query'in this?loaderUtils.getOptions(this)||{}:{}),/#%%%#/g,'!'),compile=(template,options=query.compiler,compileSteps=2)=>(locals={})=>{options=_clientnode2.default.extendObject(!0,{filename:template},options);const require=(a,b={})=>{const c=a.replace(/^(.+)\?[^?]+$/,'$1'),d=a.match(/^[^?]+\?(.+)$/,'$1');if(d){b=_clientnode2.default.extendObject(!0,b,((h,i,j,k,l)=>new Function('request','template','source','compile','locals',`return ${d[1]}`)(h,i,j,k,l))(a,c,source,compile,locals))}let e=_clientnode2.default.copyLimitedRecursively(options);if(delete e.client,e=_clientnode2.default.extendObject(!0,{encoding:_configurator2.default.encoding},e,b.options||{}),e.isString)return compile(c,e)(b);const f=_helper2.default.determineModuleFilePath(c,query.module.aliases,query.module.replacements,query.extensions,query.context,_configurator2.default.path.source.asset.base,_configurator2.default.path.ignore,_configurator2.default.module.directoryNames,_configurator2.default.package.main.fileNames,_configurator2.default.package.main.propertyNames,_configurator2.default.package.aliasPropertyNames,_configurator2.default.encoding);if(f)return'query'in this&&this.addDependency(f),d||f.endsWith('.ejs')?compile(f,e)(b):fileSystem.readFileSync(f,e);throw new Error(`Given template file "${c}" couldn't be resolved.`)},compressHTML=(a)=>query.compress.html?(0,_htmlMinifier.minify)(a,_clientnode2.default.extendObject(!0,{caseSensitive:!0,collapseInlineTagWhitespace:!0,collapseWhitespace:!0,conservativeCollapse:!0,minifyCSS:!0,minifyJS:!0,processScripts:['text/ng-template','text/x-handlebars-template'],removeAttributeQuotes:!0,removeComments:!0,removeRedundantAttributes:!0,removeScriptTypeAttributes:!0,removeStyleLinkTypeAttributes:!0,sortAttributes:!0,sortClassName:!0,trimCustomFragments:!0,useShortDoctype:!0},query.compress.html)):a;let remainingSteps=compileSteps,result=template,isString=options.isString;for(delete options.isString;0<remainingSteps;){if('string'==typeof result){const filePath=isString&&options.filename||result;if(filePath&&'.js'===_path2.default.extname(filePath))result=eval('require')(filePath);else{if(!isString){let a=_configurator2.default.encoding;'encoding'in options&&(a=options.encoding),result=fileSystem.readFileSync(result,{encoding:a})}1===remainingSteps&&(result=compressHTML(result)),result=ejs.compile(result,options)}}else result=compressHTML(result(_clientnode2.default.extendObject(!0,{configuration:_configurator2.default,Helper:_helper2.default,include:require,require,Tools:_clientnode2.default},locals)));remainingSteps-=1}return!(compileSteps%2)?result:`'use strict';\n`+(0,_babelCore.transform)(`module.exports = ${result.toString()};`,{ast:!1,babelrc:!1,comments:!!!query.compress.javaScript,compact:!!query.compress.javaScript,filename:options.filename||'unknown',minified:!!query.compress.javaScript,plugins:[_babelPluginTransformWith2.default],presets:query.compress.javaScript?[[_babelPresetBabili2.default,query.compress.javaScript]]:[],sourceMaps:!1,sourceType:'script'}).code};return compile(source,{client:!!(query.compileSteps%2),compileDebug:this.debug||!1,debug:this.debug||!1,filename:'query'in this?loaderUtils.getRemainingRequest(this).replace(/^!/,''):this.filename||null,isString:!0},query.compileSteps)(query.locals||{})};

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVqc0xvYWRlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFHQSxhQWFBLDJZQUlZLEdBSlosaURBS1ksVUFMWiwwR0FPWSxXQVBaLHNSLHVQQVVBLEdBQUksQ0FDQSxRQUFRLDZCQUFSLENBQ0gsQ0FBQyxRQUFjLENBQUUsQ0FTbEIsT0FBTyxPQUFQLENBQWlCLFNBQVMsTUFBVCxDQUErQixDQUN4QyxZQUFjLEtBQWQsRUFBc0IsS0FBSyxTQURhLEVBRXhDLEtBQUssU0FBTCxFQUZ3QyxDQUc1QyxLQUFNLE9BQWUscUJBQU0sNkJBQU4sQ0FDakIscUJBQU0sWUFBTixJQUF5QixDQUNyQixTQUFVLENBQ04sT0FETSxDQUVOLGFBRk0sQ0FEVyxDQUtyQixRQUFTLElBTFksQ0FNckIsV0FBWSxDQUNSLEtBQU0sQ0FDRixnQkFERSxDQUVGLGdHQUZFLENBREUsQ0FPTCxTQVBLLENBTlMsQ0FlckIsT0FBUSxDQUNKLFVBREksQ0FFSixlQUZJLENBZmEsQ0FtQnJCLGFBQWMsQ0FuQk8sQ0FBekIsQ0FvQkcsS0FBSyxPQUFMLElBcEJILENBb0J1QixTQUFXLEtBQVgsQ0FBa0IsWUFBWSxVQUFaLENBQ3JDLElBRHFDLEtBQWxCLEdBcEJ2QixDQURpQixDQXdCakIsUUF4QmlCLENBd0JQLEdBeEJPLENBQXJCLENBeUJNLFFBQTBCLENBQzVCLFFBRDRCLENBQ1gsUUFBaUIsTUFBTSxRQURaLENBRTVCLGFBQXNCLENBRk0sR0FHVixDQUFDLFNBQUQsR0FBK0IsQ0FDakQsUUFBVSxxQkFBTSxZQUFOLElBQXlCLENBQUMsU0FBVSxRQUFYLENBQXpCLENBQStDLE9BQS9DLENBRHVDLENBRWpELEtBQU0sU0FBbUIsR0FDTCxJQURLLEdBRWIsQ0FDUixLQUFNLEdBQWtCLEVBQVEsT0FBUixDQUFnQixlQUFoQixDQUFpQyxJQUFqQyxDQUF4QixDQUNNLEVBQTRCLEVBQVEsS0FBUixDQUM5QixlQUQ4QixDQUNiLElBRGEsQ0FEbEMsQ0FHQSxHQUFJLENBQUosQ0FBZ0IsQ0FTWixFQUFlLHFCQUFNLFlBQU4sSUFDTCxDQURLLENBQ1MsQ0FURyxhQUlmLEdBQUksU0FBSixDQUNSLFNBRFEsQ0FDRyxVQURILENBQ2UsUUFEZixDQUN5QixTQUR6QixDQUNvQyxRQURwQyxDQUVQLFVBQVMsRUFBVyxDQUFYLENBQWMsRUFGaEIsRUFHVixDQUhVLENBR0QsQ0FIQyxDQUdTLENBSFQsQ0FHaUIsQ0FIakIsQ0FHMEIsQ0FIMUIsQ0FLWSxFQUNoQixDQURnQixDQUNQLENBRE8sQ0FDRyxNQURILENBQ1csT0FEWCxDQUNvQixNQURwQixDQURULENBR2xCLENBQ0QsR0FBSSxHQUF1QixxQkFBTSxzQkFBTixDQUE2QixPQUE3QixDQUEzQixDQUtBLEdBSkEsTUFBTyxHQUFjLE1BSXJCLENBSEEsRUFBZ0IscUJBQU0sWUFBTixJQUNOLENBQUMsU0FBVSx1QkFBYyxRQUF6QixDQURNLENBQzhCLENBRDlCLENBRVosRUFBYSxPQUFiLElBRlksQ0FHaEIsQ0FBSSxFQUFjLFFBQWxCLENBQ0ksTUFBTyxTQUFRLENBQVIsQ0FBa0IsQ0FBbEIsRUFBaUMsQ0FBakMsQ0FBUCxDQUNKLEtBQU0sR0FDRixpQkFBTyx1QkFBUCxDQUNJLENBREosQ0FDYyxNQUFNLE1BQU4sQ0FBYSxPQUQzQixDQUVJLE1BQU0sTUFBTixDQUFhLFlBRmpCLENBRStCLE1BQU0sVUFGckMsQ0FHSSxNQUFNLE9BSFYsQ0FHbUIsdUJBQWMsSUFBZCxDQUFtQixNQUFuQixDQUEwQixLQUExQixDQUFnQyxJQUhuRCxDQUlJLHVCQUFjLElBQWQsQ0FBbUIsTUFKdkIsQ0FLSSx1QkFBYyxNQUFkLENBQXFCLGNBTHpCLENBTUksdUJBQWMsT0FBZCxDQUFzQixJQUF0QixDQUEyQixTQU4vQixDQU9JLHVCQUFjLE9BQWQsQ0FBc0IsSUFBdEIsQ0FBMkIsYUFQL0IsQ0FRSSx1QkFBYyxPQUFkLENBQXNCLGtCQVIxQixDQVNJLHVCQUFjLFFBVGxCLENBREosQ0FXQSxHQUFJLENBQUosT0FDUSxTQUFXLEtBRG5CLEVBRVEsS0FBSyxhQUFMLENBQW1CLENBQW5CLENBRlIsQ0FRUSxHQUFjLEVBQWlCLFFBQWpCLENBQTBCLE1BQTFCLENBUnRCLENBU2UsUUFBUSxDQUFSLENBQTBCLENBQTFCLEVBQ0gsQ0FERyxDQVRmLENBWVcsV0FBVyxZQUFYLENBQXdCLENBQXhCLENBQTBDLENBQTFDLENBWlgsQ0FjQSxLQUFNLElBQUksTUFBSixDQUNELHdCQUF1QixDQUFTLHlCQUQvQixDQUVULENBckRELENBc0RNLGFBQXdCLEtBQzFCLE1BQU0sUUFBTixDQUFlLElBQWYsQ0FBc0IseUJBQVcsQ0FBWCxDQUFvQixxQkFBTSxZQUFOLElBQ2hDLENBQ0YsZ0JBREUsQ0FFRiw4QkFGRSxDQUdGLHFCQUhFLENBSUYsdUJBSkUsQ0FLRixZQUxFLENBTUYsV0FORSxDQU9GLGdFQVBFLENBVUYsd0JBVkUsQ0FXRixpQkFYRSxDQVlGLDRCQVpFLENBYUYsNkJBYkUsQ0FjRixnQ0FkRSxDQWVGLGlCQWZFLENBZ0JGLGdCQWhCRSxDQWtCRixzQkFsQkUsQ0FtQkYsa0JBbkJFLENBRGdDLENBcUJuQyxNQUFNLFFBQU4sQ0FBZSxJQXJCb0IsQ0FBcEIsQ0FBdEIsQ0FxQitCLENBNUVuQyxDQTZFQSxHQUFJLGdCQUF3QixZQUE1QixDQUNJLE9BQWlDLFFBRHJDLENBRUksU0FBbUIsUUFBUSxRQUYvQixDQS9FaUQsSUFrRmpELE1BQU8sU0FBUSxRQWxGa0MsQ0FtRnpCLENBQWpCLGVBbkYwQyxFQW1GdEIsQ0FDdkIsR0FBc0IsUUFBbEIsUUFBTyxPQUFYLENBQWdDLENBQzVCLEtBQU0sVUFBbUIsVUFBWSxRQUFRLFFBQXBCLEVBQWdDLE1BQXpELENBQ0EsR0FBSSxVQUF1QyxLQUEzQixrQkFBSyxPQUFMLENBQWEsUUFBYixDQUFoQixDQUNJLE9BQVMsS0FBSyxTQUFMLEVBQWdCLFFBQWhCLENBQVQsQ0FESixJQUVLLENBQ0QsR0FBSSxDQUFDLFFBQUwsQ0FBZSxDQUNYLEdBQUksR0FBa0IsdUJBQWMsUUFBcEMsQ0FDSSxZQUFjLFFBRlAsR0FHUCxFQUFXLFFBQVEsUUFIWixFQUlYLE9BQVMsV0FBVyxZQUFYLENBQXdCLE1BQXhCLENBQWdDLENBQUMsVUFBRCxDQUFoQyxDQUNaLENBQ3NCLENBQW5CLGlCQVBILEdBUUcsT0FBUyxhQUFhLE1BQWIsQ0FSWixFQVNELE9BQVMsSUFBSSxPQUFKLENBQVksTUFBWixDQUFvQixPQUFwQixDQUNaLENBQ0osQ0FmRCxJQWdCSSxRQUFTLGFBQWEsT0FBTyxxQkFBTSxZQUFOLElBQXlCLENBQ2xELG9DQURrRCxDQUNuQyx1QkFEbUMsQ0FDM0IsUUFBUyxPQURrQixDQUNULE9BRFMsQ0FDQSwwQkFEQSxDQUF6QixDQUUxQixNQUYwQixDQUFQLENBQWIsQ0FBVCxDQUdKLGdCQUFrQixDQUNyQixDQXhHZ0QsUUF5R3JDLGFBQWUsQ0F6R3NCLEVBMEgxQyxNQTFIMEMsQ0EwR3JDLGlCQUFELENBQW9CLHlCQUN0QixvQkFBbUIsT0FBTyxRQUFQLEVBQWtCLEdBRGYsQ0FDbUIsQ0FDdEMsTUFEc0MsQ0FFdEMsVUFGc0MsQ0FHdEMsU0FBVSxHQUFTLE1BQU0sUUFBTixDQUFlLFVBSEksQ0FJdEMsVUFBaUIsTUFBTSxRQUFOLENBQWUsVUFKTSxDQUt0QyxTQUFVLFFBQVEsUUFBUixFQUFvQixTQUxRLENBTXRDLFdBQWtCLE1BQU0sUUFBTixDQUFlLFVBTkssQ0FPdEMsUUFBUyxvQ0FQNkIsQ0FRdEMsUUFBUyxNQUFNLFFBQU4sQ0FBZSxVQUFmLENBQTRCLENBQUMsNkJBQ3BCLE1BQU0sUUFBTixDQUFlLFVBREssQ0FBRCxDQUE1QixHQVI2QixDQVd0QyxhQVhzQyxDQVl0QyxXQUFZLFFBWjBCLENBRG5CLEVBY3BCLElBR2QsQ0F2SkQsQ0F3SkEsTUFBTyxTQUFRLE1BQVIsQ0FBZ0IsQ0FDbkIsVUFBZ0IsTUFBTSxZQUFOLENBQXFCLENBQXJDLENBRG1CLENBRW5CLGFBQWMsS0FBSyxLQUFMLElBRkssQ0FHbkIsTUFBTyxLQUFLLEtBQUwsSUFIWSxDQUluQixTQUFVLFNBQVcsS0FBWCxDQUFrQixZQUFZLG1CQUFaLENBQ3hCLElBRHdCLEVBRTFCLE9BRjBCLENBRWxCLElBRmtCLENBRVosRUFGWSxDQUFsQixDQUVZLEtBQUssUUFBTCxFQUFpQixJQU5wQixDQU9uQixXQVBtQixDQUFoQixDQVFKLE1BQU0sWUFSRixFQVFnQixNQUFNLE1BQU4sSUFSaEIsQ0FTVixDIiwiZmlsZSI6ImVqc0xvYWRlci5jb21waWxlZC5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxuLy8gQGZsb3dcbi8vIC0qLSBjb2Rpbmc6IHV0Zi04IC0qLVxuJ3VzZSBzdHJpY3QnXG4vKiAhXG4gICAgcmVnaW9uIGhlYWRlclxuICAgIENvcHlyaWdodCBUb3JiZW4gU2lja2VydCAoaW5mb1tcIn5hdH5cIl10b3JiZW4ud2Vic2l0ZSkgMTYuMTIuMjAxMlxuXG4gICAgTGljZW5zZVxuICAgIC0tLS0tLS1cblxuICAgIFRoaXMgbGlicmFyeSB3cml0dGVuIGJ5IFRvcmJlbiBTaWNrZXJ0IHN0YW5kIHVuZGVyIGEgY3JlYXRpdmUgY29tbW9ucyBuYW1pbmdcbiAgICAzLjAgdW5wb3J0ZWQgbGljZW5zZS4gc2VlIGh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LzMuMC9kZWVkLmRlXG4gICAgZW5kcmVnaW9uXG4qL1xuLy8gcmVnaW9uIGltcG9ydHNcbmltcG9ydCB7dHJhbnNmb3JtIGFzIGJhYmVsVHJhbnNmb3JtfSBmcm9tICdiYWJlbC1jb3JlJ1xuaW1wb3J0IGJhYmlsaVByZXNldCBmcm9tICdiYWJlbC1wcmVzZXQtYmFiaWxpJ1xuaW1wb3J0IHRyYW5zZm9ybVdpdGggZnJvbSAnYmFiZWwtcGx1Z2luLXRyYW5zZm9ybS13aXRoJ1xuaW1wb3J0IFRvb2xzIGZyb20gJ2NsaWVudG5vZGUnXG5pbXBvcnQgKiBhcyBlanMgZnJvbSAnZWpzJ1xuaW1wb3J0ICogYXMgZmlsZVN5c3RlbSBmcm9tICdmcydcbmltcG9ydCB7bWluaWZ5IGFzIG1pbmlmeUhUTUx9IGZyb20gJ2h0bWwtbWluaWZpZXInXG5pbXBvcnQgKiBhcyBsb2FkZXJVdGlscyBmcm9tICdsb2FkZXItdXRpbHMnXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJ1xuLy8gTk9URTogT25seSBuZWVkZWQgZm9yIGRlYnVnZ2luZyB0aGlzIGZpbGUuXG50cnkge1xuICAgIHJlcXVpcmUoJ3NvdXJjZS1tYXAtc3VwcG9ydC9yZWdpc3RlcicpXG59IGNhdGNoIChlcnJvcikge31cblxuaW1wb3J0IGNvbmZpZ3VyYXRpb24gZnJvbSAnLi9jb25maWd1cmF0b3IuY29tcGlsZWQnXG5pbXBvcnQgSGVscGVyIGZyb20gJy4vaGVscGVyLmNvbXBpbGVkJ1xuLy8gZW5kcmVnaW9uXG4vLyByZWdpb24gdHlwZXNcbnR5cGUgVGVtcGxhdGVGdW5jdGlvbiA9IChsb2NhbHM6T2JqZWN0KSA9PiBzdHJpbmdcbnR5cGUgQ29tcGlsZUZ1bmN0aW9uID0gKHRlbXBsYXRlOnN0cmluZywgb3B0aW9uczpPYmplY3QpID0+IFRlbXBsYXRlRnVuY3Rpb25cbi8vIGVuZHJlZ2lvblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihzb3VyY2U6c3RyaW5nKTpzdHJpbmcge1xuICAgIGlmICgnY2FjaGFibGUnIGluIHRoaXMgJiYgdGhpcy5jYWNoZWFibGUpXG4gICAgICAgIHRoaXMuY2FjaGVhYmxlKClcbiAgICBjb25zdCBxdWVyeTpPYmplY3QgPSBUb29scy5jb252ZXJ0U3Vic3RyaW5nSW5QbGFpbk9iamVjdChcbiAgICAgICAgVG9vbHMuZXh0ZW5kT2JqZWN0KHRydWUsIHtcbiAgICAgICAgICAgIGNvbXByZXNzOiB7XG4gICAgICAgICAgICAgICAgaHRtbDoge30sXG4gICAgICAgICAgICAgICAgamF2YVNjcmlwdDoge31cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZXh0OiAnLi8nLFxuICAgICAgICAgICAgZXh0ZW5zaW9uczoge1xuICAgICAgICAgICAgICAgIGZpbGU6IHtcbiAgICAgICAgICAgICAgICAgICAgZXh0ZXJuYWw6IFsnLmpzJ10sXG4gICAgICAgICAgICAgICAgICAgIGludGVybmFsOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAnLmpzJywgJy5jc3MnLCAnLnN2ZycsICcucG5nJywgJy5qcGcnLCAnLmdpZicsICcuaWNvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICcuaHRtbCcsICcuanNvbicsICcuZW90JywgJy50dGYnLCAnLndvZmYnXG4gICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICB9LCBtb2R1bGU6IFtdXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbW9kdWxlOiB7XG4gICAgICAgICAgICAgICAgYWxpYXNlczoge30sXG4gICAgICAgICAgICAgICAgcmVwbGFjZW1lbnRzOiB7fVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBpbGVTdGVwczogMlxuICAgICAgICB9LCB0aGlzLm9wdGlvbnMgfHwge30sICdxdWVyeScgaW4gdGhpcyA/IGxvYWRlclV0aWxzLmdldE9wdGlvbnMoXG4gICAgICAgICAgICB0aGlzXG4gICAgICAgICkgfHwge30gOiB7fSksXG4gICAgICAgIC8jJSUlIy9nLCAnIScpXG4gICAgY29uc3QgY29tcGlsZTpDb21waWxlRnVuY3Rpb24gPSAoXG4gICAgICAgIHRlbXBsYXRlOnN0cmluZywgb3B0aW9uczpPYmplY3QgPSBxdWVyeS5jb21waWxlcixcbiAgICAgICAgY29tcGlsZVN0ZXBzOm51bWJlciA9IDJcbiAgICApOlRlbXBsYXRlRnVuY3Rpb24gPT4gKGxvY2FsczpPYmplY3QgPSB7fSk6c3RyaW5nID0+IHtcbiAgICAgICAgb3B0aW9ucyA9IFRvb2xzLmV4dGVuZE9iamVjdCh0cnVlLCB7ZmlsZW5hbWU6IHRlbXBsYXRlfSwgb3B0aW9ucylcbiAgICAgICAgY29uc3QgcmVxdWlyZTpGdW5jdGlvbiA9IChcbiAgICAgICAgICAgIHJlcXVlc3Q6c3RyaW5nLCBuZXN0ZWRMb2NhbHM6T2JqZWN0ID0ge31cbiAgICAgICAgKTpzdHJpbmcgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGVtcGxhdGU6c3RyaW5nID0gcmVxdWVzdC5yZXBsYWNlKC9eKC4rKVxcP1teP10rJC8sICckMScpXG4gICAgICAgICAgICBjb25zdCBxdWVyeU1hdGNoOj9BcnJheTxzdHJpbmc+ID0gcmVxdWVzdC5tYXRjaChcbiAgICAgICAgICAgICAgICAvXlteP10rXFw/KC4rKSQvLCAnJDEnKVxuICAgICAgICAgICAgaWYgKHF1ZXJ5TWF0Y2gpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBldmFsdWF0aW9uRnVuY3Rpb24gPSAoXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3Q6c3RyaW5nLCB0ZW1wbGF0ZTpzdHJpbmcsIHNvdXJjZTpzdHJpbmcsXG4gICAgICAgICAgICAgICAgICAgIGNvbXBpbGU6Q29tcGlsZUZ1bmN0aW9uLCBsb2NhbHM6T2JqZWN0XG4gICAgICAgICAgICAgICAgLy8gSWdub3JlVHlwZUNoZWNrXG4gICAgICAgICAgICAgICAgKTpPYmplY3QgPT4gbmV3IEZ1bmN0aW9uKFxuICAgICAgICAgICAgICAgICAgICAncmVxdWVzdCcsICd0ZW1wbGF0ZScsICdzb3VyY2UnLCAnY29tcGlsZScsICdsb2NhbHMnLFxuICAgICAgICAgICAgICAgICAgICBgcmV0dXJuICR7cXVlcnlNYXRjaFsxXX1gXG4gICAgICAgICAgICAgICAgKShyZXF1ZXN0LCB0ZW1wbGF0ZSwgc291cmNlLCBjb21waWxlLCBsb2NhbHMpXG4gICAgICAgICAgICAgICAgbmVzdGVkTG9jYWxzID0gVG9vbHMuZXh0ZW5kT2JqZWN0KFxuICAgICAgICAgICAgICAgICAgICB0cnVlLCBuZXN0ZWRMb2NhbHMsIGV2YWx1YXRpb25GdW5jdGlvbihcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3QsIHRlbXBsYXRlLCBzb3VyY2UsIGNvbXBpbGUsIGxvY2FscykpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgbmVzdGVkT3B0aW9uczpPYmplY3QgPSBUb29scy5jb3B5TGltaXRlZFJlY3Vyc2l2ZWx5KG9wdGlvbnMpXG4gICAgICAgICAgICBkZWxldGUgbmVzdGVkT3B0aW9ucy5jbGllbnRcbiAgICAgICAgICAgIG5lc3RlZE9wdGlvbnMgPSBUb29scy5leHRlbmRPYmplY3QoXG4gICAgICAgICAgICAgICAgdHJ1ZSwge2VuY29kaW5nOiBjb25maWd1cmF0aW9uLmVuY29kaW5nfSwgbmVzdGVkT3B0aW9ucyxcbiAgICAgICAgICAgICAgICBuZXN0ZWRMb2NhbHMub3B0aW9ucyB8fCB7fSlcbiAgICAgICAgICAgIGlmIChuZXN0ZWRPcHRpb25zLmlzU3RyaW5nKVxuICAgICAgICAgICAgICAgIHJldHVybiBjb21waWxlKHRlbXBsYXRlLCBuZXN0ZWRPcHRpb25zKShuZXN0ZWRMb2NhbHMpXG4gICAgICAgICAgICBjb25zdCB0ZW1wbGF0ZUZpbGVQYXRoOj9zdHJpbmcgPVxuICAgICAgICAgICAgICAgIEhlbHBlci5kZXRlcm1pbmVNb2R1bGVGaWxlUGF0aChcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGUsIHF1ZXJ5Lm1vZHVsZS5hbGlhc2VzLFxuICAgICAgICAgICAgICAgICAgICBxdWVyeS5tb2R1bGUucmVwbGFjZW1lbnRzLCBxdWVyeS5leHRlbnNpb25zLFxuICAgICAgICAgICAgICAgICAgICBxdWVyeS5jb250ZXh0LCBjb25maWd1cmF0aW9uLnBhdGguc291cmNlLmFzc2V0LmJhc2UsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC5pZ25vcmUsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ubW9kdWxlLmRpcmVjdG9yeU5hbWVzLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhY2thZ2UubWFpbi5maWxlTmFtZXMsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGFja2FnZS5tYWluLnByb3BlcnR5TmFtZXMsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGFja2FnZS5hbGlhc1Byb3BlcnR5TmFtZXMsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZW5jb2RpbmcpXG4gICAgICAgICAgICBpZiAodGVtcGxhdGVGaWxlUGF0aCkge1xuICAgICAgICAgICAgICAgIGlmICgncXVlcnknIGluIHRoaXMpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkRGVwZW5kZW5jeSh0ZW1wbGF0ZUZpbGVQYXRoKVxuICAgICAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgICAgICAgIE5PVEU6IElmIHRoZXJlIGFyZW4ndCBhbnkgbG9jYWxzIG9wdGlvbnMgb3IgdmFyaWFibGVzIGFuZFxuICAgICAgICAgICAgICAgICAgICBmaWxlIGRvZXNuJ3Qgc2VlbSB0byBiZSBhbiBlanMgdGVtcGxhdGUgd2Ugc2ltcGx5IGxvYWRcbiAgICAgICAgICAgICAgICAgICAgaW5jbHVkZWQgZmlsZSBjb250ZW50LlxuICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgaWYgKHF1ZXJ5TWF0Y2ggfHwgdGVtcGxhdGVGaWxlUGF0aC5lbmRzV2l0aCgnLmVqcycpKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29tcGlsZSh0ZW1wbGF0ZUZpbGVQYXRoLCBuZXN0ZWRPcHRpb25zKShcbiAgICAgICAgICAgICAgICAgICAgICAgIG5lc3RlZExvY2FscylcbiAgICAgICAgICAgICAgICAvLyBJZ25vcmVUeXBlQ2hlY2tcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlsZVN5c3RlbS5yZWFkRmlsZVN5bmModGVtcGxhdGVGaWxlUGF0aCwgbmVzdGVkT3B0aW9ucylcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgICBgR2l2ZW4gdGVtcGxhdGUgZmlsZSBcIiR7dGVtcGxhdGV9XCIgY291bGRuJ3QgYmUgcmVzb2x2ZWQuYClcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb21wcmVzc0hUTUw6RnVuY3Rpb24gPSAoY29udGVudDpzdHJpbmcpOnN0cmluZyA9PlxuICAgICAgICAgICAgcXVlcnkuY29tcHJlc3MuaHRtbCA/IG1pbmlmeUhUTUwoY29udGVudCwgVG9vbHMuZXh0ZW5kT2JqZWN0KFxuICAgICAgICAgICAgICAgIHRydWUsIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZVNlbnNpdGl2ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgY29sbGFwc2VJbmxpbmVUYWdXaGl0ZXNwYWNlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBjb2xsYXBzZVdoaXRlc3BhY2U6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNvbnNlcnZhdGl2ZUNvbGxhcHNlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBtaW5pZnlDU1M6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIG1pbmlmeUpTOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBwcm9jZXNzU2NyaXB0czogW1xuICAgICAgICAgICAgICAgICAgICAgICAgJ3RleHQvbmctdGVtcGxhdGUnLCAndGV4dC94LWhhbmRsZWJhcnMtdGVtcGxhdGUnXG4gICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZUF0dHJpYnV0ZVF1b3RlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQ29tbWVudHM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZVJlZHVuZGFudEF0dHJpYnV0ZXM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZVNjcmlwdFR5cGVBdHRyaWJ1dGVzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICByZW1vdmVTdHlsZUxpbmtUeXBlQXR0cmlidXRlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgc29ydEF0dHJpYnV0ZXM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHNvcnRDbGFzc05hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIC8vIE5PVEU6IEF2b2lkcyB3aGl0ZXNwYWNlIGFyb3VuZCBwbGFjZWhvbGRlciBpbiB0YWdzLlxuICAgICAgICAgICAgICAgICAgICB0cmltQ3VzdG9tRnJhZ21lbnRzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB1c2VTaG9ydERvY3R5cGU6IHRydWVcbiAgICAgICAgICAgICAgICB9LCBxdWVyeS5jb21wcmVzcy5odG1sKSkgOiBjb250ZW50XG4gICAgICAgIGxldCByZW1haW5pbmdTdGVwczpudW1iZXIgPSBjb21waWxlU3RlcHNcbiAgICAgICAgbGV0IHJlc3VsdDpUZW1wbGF0ZUZ1bmN0aW9ufHN0cmluZyA9IHRlbXBsYXRlXG4gICAgICAgIGxldCBpc1N0cmluZzpib29sZWFuID0gb3B0aW9ucy5pc1N0cmluZ1xuICAgICAgICBkZWxldGUgb3B0aW9ucy5pc1N0cmluZ1xuICAgICAgICB3aGlsZSAocmVtYWluaW5nU3RlcHMgPiAwKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHJlc3VsdCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBmaWxlUGF0aDo/c3RyaW5nID0gaXNTdHJpbmcgJiYgb3B0aW9ucy5maWxlbmFtZSB8fCByZXN1bHRcbiAgICAgICAgICAgICAgICBpZiAoZmlsZVBhdGggJiYgcGF0aC5leHRuYW1lKGZpbGVQYXRoKSA9PT0gJy5qcycpXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGV2YWwoJ3JlcXVpcmUnKShmaWxlUGF0aClcbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc1N0cmluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGVuY29kaW5nOnN0cmluZyA9IGNvbmZpZ3VyYXRpb24uZW5jb2RpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgnZW5jb2RpbmcnIGluIG9wdGlvbnMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RpbmcgPSBvcHRpb25zLmVuY29kaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBmaWxlU3lzdGVtLnJlYWRGaWxlU3luYyhyZXN1bHQsIHtlbmNvZGluZ30pXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlbWFpbmluZ1N0ZXBzID09PSAxKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gY29tcHJlc3NIVE1MKHJlc3VsdClcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZWpzLmNvbXBpbGUocmVzdWx0LCBvcHRpb25zKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZVxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNvbXByZXNzSFRNTChyZXN1bHQoVG9vbHMuZXh0ZW5kT2JqZWN0KHRydWUsIHtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbiwgSGVscGVyLCBpbmNsdWRlOiByZXF1aXJlLCByZXF1aXJlLCBUb29sc1xuICAgICAgICAgICAgICAgIH0sIGxvY2FscykpKVxuICAgICAgICAgICAgcmVtYWluaW5nU3RlcHMgLT0gMVxuICAgICAgICB9XG4gICAgICAgIGlmIChCb29sZWFuKGNvbXBpbGVTdGVwcyAlIDIpKVxuICAgICAgICAgICAgcmV0dXJuIGAndXNlIHN0cmljdCc7XFxuYCArIGJhYmVsVHJhbnNmb3JtKFxuICAgICAgICAgICAgICAgIGBtb2R1bGUuZXhwb3J0cyA9ICR7cmVzdWx0LnRvU3RyaW5nKCl9O2AsIHtcbiAgICAgICAgICAgICAgICAgICAgYXN0OiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgYmFiZWxyYzogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGNvbW1lbnRzOiAhQm9vbGVhbihxdWVyeS5jb21wcmVzcy5qYXZhU2NyaXB0KSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFjdDogQm9vbGVhbihxdWVyeS5jb21wcmVzcy5qYXZhU2NyaXB0KSxcbiAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6IG9wdGlvbnMuZmlsZW5hbWUgfHwgJ3Vua25vd24nLFxuICAgICAgICAgICAgICAgICAgICBtaW5pZmllZDogQm9vbGVhbihxdWVyeS5jb21wcmVzcy5qYXZhU2NyaXB0KSxcbiAgICAgICAgICAgICAgICAgICAgcGx1Z2luczogW3RyYW5zZm9ybVdpdGhdLFxuICAgICAgICAgICAgICAgICAgICBwcmVzZXRzOiBxdWVyeS5jb21wcmVzcy5qYXZhU2NyaXB0ID8gW1tcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhYmlsaVByZXNldCwgcXVlcnkuY29tcHJlc3MuamF2YVNjcmlwdFxuICAgICAgICAgICAgICAgICAgICBdXSA6IFtdLFxuICAgICAgICAgICAgICAgICAgICBzb3VyY2VNYXBzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgc291cmNlVHlwZTogJ3NjcmlwdCdcbiAgICAgICAgICAgICAgICB9KS5jb2RlXG4gICAgICAgIC8vIElnbm9yZVR5cGVDaGVja1xuICAgICAgICByZXR1cm4gcmVzdWx0XG4gICAgfVxuICAgIHJldHVybiBjb21waWxlKHNvdXJjZSwge1xuICAgICAgICBjbGllbnQ6IEJvb2xlYW4ocXVlcnkuY29tcGlsZVN0ZXBzICUgMiksXG4gICAgICAgIGNvbXBpbGVEZWJ1ZzogdGhpcy5kZWJ1ZyB8fCBmYWxzZSxcbiAgICAgICAgZGVidWc6IHRoaXMuZGVidWcgfHwgZmFsc2UsXG4gICAgICAgIGZpbGVuYW1lOiAncXVlcnknIGluIHRoaXMgPyBsb2FkZXJVdGlscy5nZXRSZW1haW5pbmdSZXF1ZXN0KFxuICAgICAgICAgICAgdGhpc1xuICAgICAgICApLnJlcGxhY2UoL14hLywgJycpIDogdGhpcy5maWxlbmFtZSB8fCBudWxsLFxuICAgICAgICBpc1N0cmluZzogdHJ1ZVxuICAgIH0sIHF1ZXJ5LmNvbXBpbGVTdGVwcykocXVlcnkubG9jYWxzIHx8IHt9KVxufVxuLy8gcmVnaW9uIHZpbSBtb2RsaW5lXG4vLyB2aW06IHNldCB0YWJzdG9wPTQgc2hpZnR3aWR0aD00IGV4cGFuZHRhYjpcbi8vIHZpbTogZm9sZG1ldGhvZD1tYXJrZXIgZm9sZG1hcmtlcj1yZWdpb24sZW5kcmVnaW9uOlxuLy8gZW5kcmVnaW9uXG4iXX0=