#!/usr/bin/env node


// -*- coding: utf-8 -*-
'use strict';
/* !
    region header
    Copyright Torben Sickert (info["~at~"]torben.website) 16.12.2012

    License
    -------

    This library written by Torben Sickert stand under a creative commons naming
    3.0 unported license. see http://creativecommons.org/licenses/by/3.0/deed.de
    endregion
*/
// region imports

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _fs = require('fs');

var fileSystem = _interopRequireWildcard(_fs);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _helper = require('./helper.compiled');

var _helper2 = _interopRequireDefault(_helper);

var _package = require('./package');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

// NOTE: Only needed for debugging this file.
try {
    require('source-map-support/register');
} catch (error) {}
// NOTE: "{configuration as metaConfiguration}" would result in a read only
// variable named "metaConfiguration".

/* eslint-enable no-unused-vars */

/* eslint-disable no-unused-vars */
let metaConfiguration = _package.configuration;
/*
    To assume two folder up from this file is usually resilient again dealing
    with projects where current working directory isn't the projects directory.
*/
metaConfiguration.default.path.context = _path2.default.resolve(__dirname, '../../');
metaConfiguration.default.contextType = 'main';
if (_path2.default.basename(_path2.default.dirname(process.cwd())) === 'node_modules' || _path2.default.basename(_path2.default.dirname(process.cwd())) === '.staging' && _path2.default.basename(_path2.default.dirname(_path2.default.dirname(process.cwd()))) === 'node_modules') {
    /*
        NOTE: If we are dealing was a dependency project use current directory
        as context.
    */
    metaConfiguration.default.path.context = process.cwd();
    metaConfiguration.default.contextType = 'dependency';
} else
    /*
        NOTE: If the current working directory references this file via a
        linked "node_modules" folder using current working directory as context
        is a better assumption than two folders up the hierarchy.
    */
    try {
        if (fileSystem.lstatSync(_path2.default.join(process.cwd(), 'node_modules')).isSymbolicLink()) metaConfiguration.default.path.context = process.cwd();
    } catch (error) {}
let specificConfiguration;
try {
    // IgnoreTypeCheck
    specificConfiguration = require(_path2.default.join(metaConfiguration.default.path.context, 'package'));
} catch (error) {
    specificConfiguration = { name: 'mockup' };
    metaConfiguration.default.path.context = process.cwd();
}
const name = specificConfiguration.name;
specificConfiguration = specificConfiguration.webOptimizer || {};
specificConfiguration.name = name;
// endregion
// region loading default configuration
// NOTE: Given node command line arguments results in "npm_config_*"
// environment variables.
let debug = metaConfiguration.default.debug;
if (specificConfiguration.debug !== undefined) debug = specificConfiguration.debug;
if (process.env.npm_config_production) debug = false;else if (process.env.npm_config_debug) debug = true;
metaConfiguration.default.path.context += '/';
// Merges final default configuration object depending on given target
// environment.
const libraryConfiguration = metaConfiguration.library;
let configuration;
if (debug) configuration = _helper2.default.extendObject(true, metaConfiguration.default, metaConfiguration.debug);else configuration = metaConfiguration.default;
configuration.debug = debug;
if (typeof configuration.library === 'object') _helper2.default.extendObject(true, libraryConfiguration, configuration.library);
if (specificConfiguration.library === true || specificConfiguration.library === undefined && configuration.library) configuration = _helper2.default.extendObject(true, configuration, libraryConfiguration);
// endregion
// region merging and evaluating default, test, specific and dynamic settings
// / region load additional dynamically given configuration
let count = 0;
let filePath = null;
while (true) {
    const newFilePath = configuration.path.context + `.dynamicConfiguration-${ count }.json`;
    if (!_helper2.default.isFileSync(newFilePath)) break;
    filePath = newFilePath;
    count += 1;
}
let runtimeInformation = {
    givenCommandLineArguments: process.argv
};
if (filePath) {
    runtimeInformation = JSON.parse(fileSystem.readFileSync(filePath, {
        encoding: 'utf-8' }));
    fileSystem.unlink(filePath, error => {
        if (error) throw error;
    });
}
if (runtimeInformation.givenCommandLineArguments.length > 2)
    // region apply documentation configuration
    if (runtimeInformation.givenCommandLineArguments[2] === 'document') _helper2.default.extendObject(true, configuration, configuration.document);
    // endregion
    // region apply test configuration
    else if (runtimeInformation.givenCommandLineArguments[2] === 'testInBrowser') _helper2.default.extendObject(true, configuration, configuration.testInBrowser);else if (runtimeInformation.givenCommandLineArguments[2] === 'test') _helper2.default.extendObject(true, configuration, configuration.test);
// endregion
// / endregion
_helper2.default.extendObject(true, configuration, specificConfiguration, runtimeInformation);
let result = null;
if (runtimeInformation.givenCommandLineArguments.length > 3) result = _helper2.default.parseEncodedObject(runtimeInformation.givenCommandLineArguments[runtimeInformation.givenCommandLineArguments.length - 1], configuration, 'configuration');
if (_helper2.default.isPlainObject(result)) _helper2.default.extendObject(true, configuration, result);
// / region determine existing pre compiled dll manifests file paths
configuration.dllManifestFilePaths = [];
let targetDirectory = null;
try {
    targetDirectory = fileSystem.statSync(configuration.path.target);
} catch (error) {}
if (targetDirectory && targetDirectory.isDirectory()) fileSystem.readdirSync(configuration.path.target).forEach(fileName => {
    if (fileName.match(/^.*\.dll-manifest\.json$/)) configuration.dllManifestFilePaths.push(_path2.default.resolve(configuration.path.target, fileName));
});
// / endregion
// / region build absolute paths
for (const pathConfiguration of [configuration.path, configuration.path.asset]) for (const key of ['source', 'target']) if (pathConfiguration[key]) pathConfiguration[key] = _path2.default.resolve(configuration.path.context, _helper2.default.resolveDynamicDataStructure(pathConfiguration[key], configuration)) + '/';
// / endregion
const resolvedConfiguration = _helper2.default.unwrapProxy(_helper2.default.resolveDynamicDataStructure(_helper2.default.resolveDynamicDataStructure(configuration), null, true, '__postEvaluate__', '__postExecute__'));
// endregion
// region consolidate file specific build configuration
// Apply default file level build configurations to all file type specific
// ones.
const defaultConfiguration = resolvedConfiguration.build.default;
delete resolvedConfiguration.build.default;
for (const type in resolvedConfiguration.build) if (resolvedConfiguration.build.hasOwnProperty(type)) resolvedConfiguration.build[type] = _helper2.default.extendObject(true, {}, defaultConfiguration, _helper2.default.extendObject(true, { extension: type }, resolvedConfiguration.build[type], { type }));
// endregion
// region adding special aliases
// NOTE: This alias couldn't be set in the "package.json" file since this would
// result in an endless loop.
const delimiterPosition = resolvedConfiguration.files.defaultHTML.template.lastIndexOf('!');
resolvedConfiguration.loader.aliases.webOptimizerDefaultTemplateFileLoader = resolvedConfiguration.files.defaultHTML.template.substring(0, delimiterPosition);
resolvedConfiguration.module.aliases.webOptimizerDefaultTemplateFilePath$ = resolvedConfiguration.files.defaultHTML.template.substring(delimiterPosition + 1);
// endregion
// region apply webpack html plugin workaround
/*
    NOTE: Provides a workaround to handle a bug with chained loader
    configurations.
*/
for (let htmlConfiguration of resolvedConfiguration.files.html) {
    _helper2.default.extendObject(true, htmlConfiguration, resolvedConfiguration.files.defaultHTML);
    if (typeof htmlConfiguration.template === 'string' && htmlConfiguration.template.includes('!') && htmlConfiguration.template !== resolvedConfiguration.files.defaultHTML.template) {
        const newTemplateString = new String(htmlConfiguration.template);
        newTemplateString.replace = (string => (_search, _replacement) => string)(htmlConfiguration.template);
        htmlConfiguration.template = newTemplateString;
    }
}
// endregion
exports.default = resolvedConfiguration;
// region vim modline
// vim: set tabstop=4 shiftwidth=4 expandtab:
// vim: foldmethod=marker foldmarker=region,endregion:
// endregion

//# sourceMappingURL=data:application/json;base64,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NUIsQ0FBd0MsUUFBeEMsQ0FBaUQsV0FBakQsQ0FBNkQsR0FBN0QsQ0FESjtBQUVBLHNCQUFzQixNQUF0QixDQUE2QixPQUE3QixDQUFxQyxxQ0FBckMsR0FDSSxzQkFBc0IsS0FBdEIsQ0FBNEIsV0FBNUIsQ0FBd0MsUUFBeEMsQ0FBaUQsU0FBakQsQ0FDSSxDQURKLEVBQ08saUJBRFAsQ0FESjtBQUdBLHNCQUFzQixNQUF0QixDQUE2QixPQUE3QixDQUFxQyxvQ0FBckMsR0FDSSxzQkFBc0IsS0FBdEIsQ0FBNEIsV0FBNUIsQ0FBd0MsUUFBeEMsQ0FBaUQsU0FBakQsQ0FDSSxvQkFBb0IsQ0FEeEIsQ0FESjtBQUdBO0FBQ0E7QUFDQTs7OztBQUlBLEtBQ0ksSUFBSSxpQkFEUixJQUMrQyxzQkFBc0IsS0FBdEIsQ0FBNEIsSUFEM0UsRUFFRTtBQUNFLHFCQUFPLFlBQVAsQ0FDSSxJQURKLEVBQ1UsaUJBRFYsRUFDNkIsc0JBQXNCLEtBQXRCLENBQTRCLFdBRHpEO0FBRUEsUUFDSSxPQUFPLGtCQUFrQixRQUF6QixLQUFzQyxRQUF0QyxJQUNBLGtCQUFrQixRQUFsQixDQUEyQixRQUEzQixDQUFvQyxHQUFwQyxDQURBLElBRUEsa0JBQWtCLFFBQWxCLEtBQ0ksc0JBQXNCLEtBQXRCLENBQTRCLFdBQTVCLENBQXdDLFFBSmhELEVBS0U7QUFDRSxjQUFNLG9CQUEyQixJQUFJLE1BQUosQ0FBVyxrQkFBa0IsUUFBN0IsQ0FBakM7QUFDQSwwQkFBa0IsT0FBbEIsR0FBNEIsQ0FBRSxNQUFELElBQTRCLENBQ3JELE9BRHFELEVBQzlCLFlBRDhCLEtBSTdDLE1BSmdCLEVBSVIsa0JBQWtCLFFBSlYsQ0FBNUI7QUFLQSwwQkFBa0IsUUFBbEIsR0FBNkIsaUJBQTdCO0FBQ0g7QUFDSjtBQUNEO2tCQUNlLHFCO0FBQ2Y7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiY29uZmlndXJhdG9yLmNvbXBpbGVkLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIyEvdXNyL2Jpbi9lbnYgbm9kZVxuLy8gQGZsb3dcbi8vIC0qLSBjb2Rpbmc6IHV0Zi04IC0qLVxuJ3VzZSBzdHJpY3QnXG4vKiAhXG4gICAgcmVnaW9uIGhlYWRlclxuICAgIENvcHlyaWdodCBUb3JiZW4gU2lja2VydCAoaW5mb1tcIn5hdH5cIl10b3JiZW4ud2Vic2l0ZSkgMTYuMTIuMjAxMlxuXG4gICAgTGljZW5zZVxuICAgIC0tLS0tLS1cblxuICAgIFRoaXMgbGlicmFyeSB3cml0dGVuIGJ5IFRvcmJlbiBTaWNrZXJ0IHN0YW5kIHVuZGVyIGEgY3JlYXRpdmUgY29tbW9ucyBuYW1pbmdcbiAgICAzLjAgdW5wb3J0ZWQgbGljZW5zZS4gc2VlIGh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LzMuMC9kZWVkLmRlXG4gICAgZW5kcmVnaW9uXG4qL1xuLy8gcmVnaW9uIGltcG9ydHNcbmltcG9ydCAqIGFzIGZpbGVTeXN0ZW0gZnJvbSAnZnMnXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJ1xuLy8gTk9URTogT25seSBuZWVkZWQgZm9yIGRlYnVnZ2luZyB0aGlzIGZpbGUuXG50cnkge1xuICAgIHJlcXVpcmUoJ3NvdXJjZS1tYXAtc3VwcG9ydC9yZWdpc3RlcicpXG59IGNhdGNoIChlcnJvcikge31cblxuaW1wb3J0IEhlbHBlciBmcm9tICcuL2hlbHBlci5jb21waWxlZCdcbi8vIE5PVEU6IFwie2NvbmZpZ3VyYXRpb24gYXMgbWV0YUNvbmZpZ3VyYXRpb259XCIgd291bGQgcmVzdWx0IGluIGEgcmVhZCBvbmx5XG4vLyB2YXJpYWJsZSBuYW1lZCBcIm1ldGFDb25maWd1cmF0aW9uXCIuXG5pbXBvcnQge2NvbmZpZ3VyYXRpb24gYXMgZ2l2ZW5NZXRhQ29uZmlndXJhdGlvbn0gZnJvbSAnLi9wYWNrYWdlJ1xuLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMgKi9cbmltcG9ydCB0eXBlIHtcbiAgICBEZWZhdWx0Q29uZmlndXJhdGlvbiwgSFRNTENvbmZpZ3VyYXRpb24sIE1ldGFDb25maWd1cmF0aW9uLCBQbGFpbk9iamVjdCxcbiAgICBSZXNvbHZlZENvbmZpZ3VyYXRpb25cbn0gZnJvbSAnLi90eXBlJ1xuLyogZXNsaW50LWVuYWJsZSBuby11bnVzZWQtdmFycyAqL1xubGV0IG1ldGFDb25maWd1cmF0aW9uOk1ldGFDb25maWd1cmF0aW9uID0gZ2l2ZW5NZXRhQ29uZmlndXJhdGlvblxuLypcbiAgICBUbyBhc3N1bWUgdHdvIGZvbGRlciB1cCBmcm9tIHRoaXMgZmlsZSBpcyB1c3VhbGx5IHJlc2lsaWVudCBhZ2FpbiBkZWFsaW5nXG4gICAgd2l0aCBwcm9qZWN0cyB3aGVyZSBjdXJyZW50IHdvcmtpbmcgZGlyZWN0b3J5IGlzbid0IHRoZSBwcm9qZWN0cyBkaXJlY3RvcnkuXG4qL1xubWV0YUNvbmZpZ3VyYXRpb24uZGVmYXVsdC5wYXRoLmNvbnRleHQgPSBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnLi4vLi4vJylcbm1ldGFDb25maWd1cmF0aW9uLmRlZmF1bHQuY29udGV4dFR5cGUgPSAnbWFpbidcbmlmIChcbiAgICBwYXRoLmJhc2VuYW1lKHBhdGguZGlybmFtZShwcm9jZXNzLmN3ZCgpKSkgPT09ICdub2RlX21vZHVsZXMnIHx8XG4gICAgcGF0aC5iYXNlbmFtZShwYXRoLmRpcm5hbWUocHJvY2Vzcy5jd2QoKSkpID09PSAnLnN0YWdpbmcnICYmXG4gICAgcGF0aC5iYXNlbmFtZShwYXRoLmRpcm5hbWUocGF0aC5kaXJuYW1lKHByb2Nlc3MuY3dkKCkpKSkgPT09ICdub2RlX21vZHVsZXMnXG4pIHtcbiAgICAvKlxuICAgICAgICBOT1RFOiBJZiB3ZSBhcmUgZGVhbGluZyB3YXMgYSBkZXBlbmRlbmN5IHByb2plY3QgdXNlIGN1cnJlbnQgZGlyZWN0b3J5XG4gICAgICAgIGFzIGNvbnRleHQuXG4gICAgKi9cbiAgICBtZXRhQ29uZmlndXJhdGlvbi5kZWZhdWx0LnBhdGguY29udGV4dCA9IHByb2Nlc3MuY3dkKClcbiAgICBtZXRhQ29uZmlndXJhdGlvbi5kZWZhdWx0LmNvbnRleHRUeXBlID0gJ2RlcGVuZGVuY3knXG59IGVsc2VcbiAgICAvKlxuICAgICAgICBOT1RFOiBJZiB0aGUgY3VycmVudCB3b3JraW5nIGRpcmVjdG9yeSByZWZlcmVuY2VzIHRoaXMgZmlsZSB2aWEgYVxuICAgICAgICBsaW5rZWQgXCJub2RlX21vZHVsZXNcIiBmb2xkZXIgdXNpbmcgY3VycmVudCB3b3JraW5nIGRpcmVjdG9yeSBhcyBjb250ZXh0XG4gICAgICAgIGlzIGEgYmV0dGVyIGFzc3VtcHRpb24gdGhhbiB0d28gZm9sZGVycyB1cCB0aGUgaGllcmFyY2h5LlxuICAgICovXG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKGZpbGVTeXN0ZW0ubHN0YXRTeW5jKHBhdGguam9pbihwcm9jZXNzLmN3ZChcbiAgICAgICAgKSwgJ25vZGVfbW9kdWxlcycpKS5pc1N5bWJvbGljTGluaygpKVxuICAgICAgICAgICAgbWV0YUNvbmZpZ3VyYXRpb24uZGVmYXVsdC5wYXRoLmNvbnRleHQgPSBwcm9jZXNzLmN3ZCgpXG4gICAgfSBjYXRjaCAoZXJyb3IpIHt9XG5sZXQgc3BlY2lmaWNDb25maWd1cmF0aW9uOlBsYWluT2JqZWN0XG50cnkge1xuICAgIC8vIElnbm9yZVR5cGVDaGVja1xuICAgIHNwZWNpZmljQ29uZmlndXJhdGlvbiA9IHJlcXVpcmUocGF0aC5qb2luKFxuICAgICAgICBtZXRhQ29uZmlndXJhdGlvbi5kZWZhdWx0LnBhdGguY29udGV4dCwgJ3BhY2thZ2UnKSlcbn0gY2F0Y2ggKGVycm9yKSB7XG4gICAgc3BlY2lmaWNDb25maWd1cmF0aW9uID0ge25hbWU6ICdtb2NrdXAnfVxuICAgIG1ldGFDb25maWd1cmF0aW9uLmRlZmF1bHQucGF0aC5jb250ZXh0ID0gcHJvY2Vzcy5jd2QoKVxufVxuY29uc3QgbmFtZTpzdHJpbmcgPSBzcGVjaWZpY0NvbmZpZ3VyYXRpb24ubmFtZVxuc3BlY2lmaWNDb25maWd1cmF0aW9uID0gc3BlY2lmaWNDb25maWd1cmF0aW9uLndlYk9wdGltaXplciB8fCB7fVxuc3BlY2lmaWNDb25maWd1cmF0aW9uLm5hbWUgPSBuYW1lXG4vLyBlbmRyZWdpb25cbi8vIHJlZ2lvbiBsb2FkaW5nIGRlZmF1bHQgY29uZmlndXJhdGlvblxuLy8gTk9URTogR2l2ZW4gbm9kZSBjb21tYW5kIGxpbmUgYXJndW1lbnRzIHJlc3VsdHMgaW4gXCJucG1fY29uZmlnXypcIlxuLy8gZW52aXJvbm1lbnQgdmFyaWFibGVzLlxubGV0IGRlYnVnOmJvb2xlYW4gPSBtZXRhQ29uZmlndXJhdGlvbi5kZWZhdWx0LmRlYnVnXG5pZiAoc3BlY2lmaWNDb25maWd1cmF0aW9uLmRlYnVnICE9PSB1bmRlZmluZWQpXG4gICAgZGVidWcgPSBzcGVjaWZpY0NvbmZpZ3VyYXRpb24uZGVidWdcbmlmIChwcm9jZXNzLmVudi5ucG1fY29uZmlnX3Byb2R1Y3Rpb24pXG4gICAgZGVidWcgPSBmYWxzZVxuZWxzZSBpZiAocHJvY2Vzcy5lbnYubnBtX2NvbmZpZ19kZWJ1ZylcbiAgICBkZWJ1ZyA9IHRydWVcbm1ldGFDb25maWd1cmF0aW9uLmRlZmF1bHQucGF0aC5jb250ZXh0ICs9ICcvJ1xuLy8gTWVyZ2VzIGZpbmFsIGRlZmF1bHQgY29uZmlndXJhdGlvbiBvYmplY3QgZGVwZW5kaW5nIG9uIGdpdmVuIHRhcmdldFxuLy8gZW52aXJvbm1lbnQuXG5jb25zdCBsaWJyYXJ5Q29uZmlndXJhdGlvbjpQbGFpbk9iamVjdCA9IG1ldGFDb25maWd1cmF0aW9uLmxpYnJhcnlcbmxldCBjb25maWd1cmF0aW9uOkRlZmF1bHRDb25maWd1cmF0aW9uXG5pZiAoZGVidWcpXG4gICAgY29uZmlndXJhdGlvbiA9IEhlbHBlci5leHRlbmRPYmplY3QoXG4gICAgICAgIHRydWUsIG1ldGFDb25maWd1cmF0aW9uLmRlZmF1bHQsIG1ldGFDb25maWd1cmF0aW9uLmRlYnVnKVxuZWxzZVxuICAgIGNvbmZpZ3VyYXRpb24gPSBtZXRhQ29uZmlndXJhdGlvbi5kZWZhdWx0XG5jb25maWd1cmF0aW9uLmRlYnVnID0gZGVidWdcbmlmICh0eXBlb2YgY29uZmlndXJhdGlvbi5saWJyYXJ5ID09PSAnb2JqZWN0JylcbiAgICBIZWxwZXIuZXh0ZW5kT2JqZWN0KHRydWUsIGxpYnJhcnlDb25maWd1cmF0aW9uLCBjb25maWd1cmF0aW9uLmxpYnJhcnkpXG5pZiAoXG4gICAgc3BlY2lmaWNDb25maWd1cmF0aW9uLmxpYnJhcnkgPT09IHRydWUgfHxcbiAgICBzcGVjaWZpY0NvbmZpZ3VyYXRpb24ubGlicmFyeSA9PT0gdW5kZWZpbmVkICYmIGNvbmZpZ3VyYXRpb24ubGlicmFyeVxuKVxuICAgIGNvbmZpZ3VyYXRpb24gPSBIZWxwZXIuZXh0ZW5kT2JqZWN0KFxuICAgICAgICB0cnVlLCBjb25maWd1cmF0aW9uLCBsaWJyYXJ5Q29uZmlndXJhdGlvbilcbi8vIGVuZHJlZ2lvblxuLy8gcmVnaW9uIG1lcmdpbmcgYW5kIGV2YWx1YXRpbmcgZGVmYXVsdCwgdGVzdCwgc3BlY2lmaWMgYW5kIGR5bmFtaWMgc2V0dGluZ3Ncbi8vIC8gcmVnaW9uIGxvYWQgYWRkaXRpb25hbCBkeW5hbWljYWxseSBnaXZlbiBjb25maWd1cmF0aW9uXG5sZXQgY291bnQ6bnVtYmVyID0gMFxubGV0IGZpbGVQYXRoOj9zdHJpbmcgPSBudWxsXG53aGlsZSAodHJ1ZSkge1xuICAgIGNvbnN0IG5ld0ZpbGVQYXRoOnN0cmluZyA9IGNvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0ICtcbiAgICAgICAgYC5keW5hbWljQ29uZmlndXJhdGlvbi0ke2NvdW50fS5qc29uYFxuICAgIGlmICghSGVscGVyLmlzRmlsZVN5bmMobmV3RmlsZVBhdGgpKVxuICAgICAgICBicmVha1xuICAgIGZpbGVQYXRoID0gbmV3RmlsZVBhdGhcbiAgICBjb3VudCArPSAxXG59XG5sZXQgcnVudGltZUluZm9ybWF0aW9uOlBsYWluT2JqZWN0ID0ge1xuICAgIGdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHM6IHByb2Nlc3MuYXJndlxufVxuaWYgKGZpbGVQYXRoKSB7XG4gICAgcnVudGltZUluZm9ybWF0aW9uID0gSlNPTi5wYXJzZShmaWxlU3lzdGVtLnJlYWRGaWxlU3luYyhmaWxlUGF0aCwge1xuICAgICAgICBlbmNvZGluZzogJ3V0Zi04J30pKVxuICAgIGZpbGVTeXN0ZW0udW5saW5rKGZpbGVQYXRoLCAoZXJyb3I6P0Vycm9yKTp2b2lkID0+IHtcbiAgICAgICAgaWYgKGVycm9yKVxuICAgICAgICAgICAgdGhyb3cgZXJyb3JcbiAgICB9KVxufVxuaWYgKHJ1bnRpbWVJbmZvcm1hdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzLmxlbmd0aCA+IDIpXG4gICAgLy8gcmVnaW9uIGFwcGx5IGRvY3VtZW50YXRpb24gY29uZmlndXJhdGlvblxuICAgIGlmIChydW50aW1lSW5mb3JtYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXSA9PT0gJ2RvY3VtZW50JylcbiAgICAgICAgSGVscGVyLmV4dGVuZE9iamVjdCh0cnVlLCBjb25maWd1cmF0aW9uLCBjb25maWd1cmF0aW9uLmRvY3VtZW50KVxuICAgIC8vIGVuZHJlZ2lvblxuICAgIC8vIHJlZ2lvbiBhcHBseSB0ZXN0IGNvbmZpZ3VyYXRpb25cbiAgICBlbHNlIGlmIChcbiAgICAgICAgcnVudGltZUluZm9ybWF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHNbMl0gPT09ICd0ZXN0SW5Ccm93c2VyJ1xuICAgIClcbiAgICAgICAgSGVscGVyLmV4dGVuZE9iamVjdCh0cnVlLCBjb25maWd1cmF0aW9uLCBjb25maWd1cmF0aW9uLnRlc3RJbkJyb3dzZXIpXG4gICAgZWxzZSBpZiAocnVudGltZUluZm9ybWF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHNbMl0gPT09ICd0ZXN0JylcbiAgICAgICAgSGVscGVyLmV4dGVuZE9iamVjdCh0cnVlLCBjb25maWd1cmF0aW9uLCBjb25maWd1cmF0aW9uLnRlc3QpXG4gICAgLy8gZW5kcmVnaW9uXG4vLyAvIGVuZHJlZ2lvblxuSGVscGVyLmV4dGVuZE9iamVjdChcbiAgICB0cnVlLCBjb25maWd1cmF0aW9uLCBzcGVjaWZpY0NvbmZpZ3VyYXRpb24sIHJ1bnRpbWVJbmZvcm1hdGlvbilcbmxldCByZXN1bHQ6P1BsYWluT2JqZWN0ID0gbnVsbFxuaWYgKHJ1bnRpbWVJbmZvcm1hdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzLmxlbmd0aCA+IDMpXG4gICAgcmVzdWx0ID0gSGVscGVyLnBhcnNlRW5jb2RlZE9iamVjdChcbiAgICAgICAgcnVudGltZUluZm9ybWF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHNbcnVudGltZUluZm9ybWF0aW9uXG4gICAgICAgICAgICAuZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50cy5sZW5ndGggLSAxXSxcbiAgICAgICAgY29uZmlndXJhdGlvbiwgJ2NvbmZpZ3VyYXRpb24nKVxuaWYgKEhlbHBlci5pc1BsYWluT2JqZWN0KHJlc3VsdCkpXG4gICAgSGVscGVyLmV4dGVuZE9iamVjdCh0cnVlLCBjb25maWd1cmF0aW9uLCByZXN1bHQpXG4vLyAvIHJlZ2lvbiBkZXRlcm1pbmUgZXhpc3RpbmcgcHJlIGNvbXBpbGVkIGRsbCBtYW5pZmVzdHMgZmlsZSBwYXRoc1xuY29uZmlndXJhdGlvbi5kbGxNYW5pZmVzdEZpbGVQYXRocyA9IFtdXG5sZXQgdGFyZ2V0RGlyZWN0b3J5Oj9PYmplY3QgPSBudWxsXG50cnkge1xuICAgIHRhcmdldERpcmVjdG9yeSA9IGZpbGVTeXN0ZW0uc3RhdFN5bmMoY29uZmlndXJhdGlvbi5wYXRoLnRhcmdldClcbn0gY2F0Y2ggKGVycm9yKSB7fVxuaWYgKHRhcmdldERpcmVjdG9yeSAmJiB0YXJnZXREaXJlY3RvcnkuaXNEaXJlY3RvcnkoKSlcbiAgICBmaWxlU3lzdGVtLnJlYWRkaXJTeW5jKGNvbmZpZ3VyYXRpb24ucGF0aC50YXJnZXQpLmZvckVhY2goKFxuICAgICAgICBmaWxlTmFtZTpzdHJpbmdcbiAgICApOnZvaWQgPT4ge1xuICAgICAgICBpZiAoZmlsZU5hbWUubWF0Y2goL14uKlxcLmRsbC1tYW5pZmVzdFxcLmpzb24kLykpXG4gICAgICAgICAgICBjb25maWd1cmF0aW9uLmRsbE1hbmlmZXN0RmlsZVBhdGhzLnB1c2gocGF0aC5yZXNvbHZlKFxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC50YXJnZXQsIGZpbGVOYW1lKSlcbiAgICB9KVxuLy8gLyBlbmRyZWdpb25cbi8vIC8gcmVnaW9uIGJ1aWxkIGFic29sdXRlIHBhdGhzXG5mb3IgKGNvbnN0IHBhdGhDb25maWd1cmF0aW9uOntba2V5OnN0cmluZ106YW55fSBvZiBbXG4gICAgY29uZmlndXJhdGlvbi5wYXRoLCBjb25maWd1cmF0aW9uLnBhdGguYXNzZXRcbl0pXG4gICAgZm9yIChjb25zdCBrZXk6c3RyaW5nIG9mIFsnc291cmNlJywgJ3RhcmdldCddKVxuICAgICAgICBpZiAocGF0aENvbmZpZ3VyYXRpb25ba2V5XSlcbiAgICAgICAgICAgIHBhdGhDb25maWd1cmF0aW9uW2tleV0gPSBwYXRoLnJlc29sdmUoXG4gICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQsIEhlbHBlci5yZXNvbHZlRHluYW1pY0RhdGFTdHJ1Y3R1cmUoXG4gICAgICAgICAgICAgICAgICAgIHBhdGhDb25maWd1cmF0aW9uW2tleV0sIGNvbmZpZ3VyYXRpb24pXG4gICAgICAgICAgICApICsgJy8nXG4vLyAvIGVuZHJlZ2lvblxuY29uc3QgcmVzb2x2ZWRDb25maWd1cmF0aW9uOlJlc29sdmVkQ29uZmlndXJhdGlvbiA9IEhlbHBlci51bndyYXBQcm94eShcbiAgICBIZWxwZXIucmVzb2x2ZUR5bmFtaWNEYXRhU3RydWN0dXJlKEhlbHBlci5yZXNvbHZlRHluYW1pY0RhdGFTdHJ1Y3R1cmUoXG4gICAgICAgIGNvbmZpZ3VyYXRpb25cbiAgICApLCBudWxsLCB0cnVlLCAnX19wb3N0RXZhbHVhdGVfXycsICdfX3Bvc3RFeGVjdXRlX18nKSlcbi8vIGVuZHJlZ2lvblxuLy8gcmVnaW9uIGNvbnNvbGlkYXRlIGZpbGUgc3BlY2lmaWMgYnVpbGQgY29uZmlndXJhdGlvblxuLy8gQXBwbHkgZGVmYXVsdCBmaWxlIGxldmVsIGJ1aWxkIGNvbmZpZ3VyYXRpb25zIHRvIGFsbCBmaWxlIHR5cGUgc3BlY2lmaWNcbi8vIG9uZXMuXG5jb25zdCBkZWZhdWx0Q29uZmlndXJhdGlvbjpQbGFpbk9iamVjdCA9IHJlc29sdmVkQ29uZmlndXJhdGlvbi5idWlsZC5kZWZhdWx0XG5kZWxldGUgcmVzb2x2ZWRDb25maWd1cmF0aW9uLmJ1aWxkLmRlZmF1bHRcbmZvciAoY29uc3QgdHlwZTpzdHJpbmcgaW4gcmVzb2x2ZWRDb25maWd1cmF0aW9uLmJ1aWxkKVxuICAgIGlmIChyZXNvbHZlZENvbmZpZ3VyYXRpb24uYnVpbGQuaGFzT3duUHJvcGVydHkodHlwZSkpXG4gICAgICAgIHJlc29sdmVkQ29uZmlndXJhdGlvbi5idWlsZFt0eXBlXSA9IEhlbHBlci5leHRlbmRPYmplY3QodHJ1ZSwge1xuICAgICAgICB9LCBkZWZhdWx0Q29uZmlndXJhdGlvbiwgSGVscGVyLmV4dGVuZE9iamVjdChcbiAgICAgICAgICAgIHRydWUsIHtleHRlbnNpb246IHR5cGV9LCByZXNvbHZlZENvbmZpZ3VyYXRpb24uYnVpbGRbdHlwZV0sIHt0eXBlfSlcbiAgICAgICAgKVxuLy8gZW5kcmVnaW9uXG4vLyByZWdpb24gYWRkaW5nIHNwZWNpYWwgYWxpYXNlc1xuLy8gTk9URTogVGhpcyBhbGlhcyBjb3VsZG4ndCBiZSBzZXQgaW4gdGhlIFwicGFja2FnZS5qc29uXCIgZmlsZSBzaW5jZSB0aGlzIHdvdWxkXG4vLyByZXN1bHQgaW4gYW4gZW5kbGVzcyBsb29wLlxuY29uc3QgZGVsaW1pdGVyUG9zaXRpb246bnVtYmVyID1cbiAgICByZXNvbHZlZENvbmZpZ3VyYXRpb24uZmlsZXMuZGVmYXVsdEhUTUwudGVtcGxhdGUubGFzdEluZGV4T2YoJyEnKVxucmVzb2x2ZWRDb25maWd1cmF0aW9uLmxvYWRlci5hbGlhc2VzLndlYk9wdGltaXplckRlZmF1bHRUZW1wbGF0ZUZpbGVMb2FkZXIgPVxuICAgIHJlc29sdmVkQ29uZmlndXJhdGlvbi5maWxlcy5kZWZhdWx0SFRNTC50ZW1wbGF0ZS5zdWJzdHJpbmcoXG4gICAgICAgIDAsIGRlbGltaXRlclBvc2l0aW9uKVxucmVzb2x2ZWRDb25maWd1cmF0aW9uLm1vZHVsZS5hbGlhc2VzLndlYk9wdGltaXplckRlZmF1bHRUZW1wbGF0ZUZpbGVQYXRoJCA9XG4gICAgcmVzb2x2ZWRDb25maWd1cmF0aW9uLmZpbGVzLmRlZmF1bHRIVE1MLnRlbXBsYXRlLnN1YnN0cmluZyhcbiAgICAgICAgZGVsaW1pdGVyUG9zaXRpb24gKyAxKVxuLy8gZW5kcmVnaW9uXG4vLyByZWdpb24gYXBwbHkgd2VicGFjayBodG1sIHBsdWdpbiB3b3JrYXJvdW5kXG4vKlxuICAgIE5PVEU6IFByb3ZpZGVzIGEgd29ya2Fyb3VuZCB0byBoYW5kbGUgYSBidWcgd2l0aCBjaGFpbmVkIGxvYWRlclxuICAgIGNvbmZpZ3VyYXRpb25zLlxuKi9cbmZvciAoXG4gICAgbGV0IGh0bWxDb25maWd1cmF0aW9uOkhUTUxDb25maWd1cmF0aW9uIG9mIHJlc29sdmVkQ29uZmlndXJhdGlvbi5maWxlcy5odG1sXG4pIHtcbiAgICBIZWxwZXIuZXh0ZW5kT2JqZWN0KFxuICAgICAgICB0cnVlLCBodG1sQ29uZmlndXJhdGlvbiwgcmVzb2x2ZWRDb25maWd1cmF0aW9uLmZpbGVzLmRlZmF1bHRIVE1MKVxuICAgIGlmIChcbiAgICAgICAgdHlwZW9mIGh0bWxDb25maWd1cmF0aW9uLnRlbXBsYXRlID09PSAnc3RyaW5nJyAmJlxuICAgICAgICBodG1sQ29uZmlndXJhdGlvbi50ZW1wbGF0ZS5pbmNsdWRlcygnIScpICYmXG4gICAgICAgIGh0bWxDb25maWd1cmF0aW9uLnRlbXBsYXRlICE9PVxuICAgICAgICAgICAgcmVzb2x2ZWRDb25maWd1cmF0aW9uLmZpbGVzLmRlZmF1bHRIVE1MLnRlbXBsYXRlXG4gICAgKSB7XG4gICAgICAgIGNvbnN0IG5ld1RlbXBsYXRlU3RyaW5nOk9iamVjdCA9IG5ldyBTdHJpbmcoaHRtbENvbmZpZ3VyYXRpb24udGVtcGxhdGUpXG4gICAgICAgIG5ld1RlbXBsYXRlU3RyaW5nLnJlcGxhY2UgPSAoKHN0cmluZzpzdHJpbmcpOkZ1bmN0aW9uID0+IChcbiAgICAgICAgICAgIF9zZWFyY2g6UmVnRXhwfHN0cmluZywgX3JlcGxhY2VtZW50OnN0cmluZ3woXG4gICAgICAgICAgICAgICAgLi4ubWF0Y2hlczpBcnJheTxzdHJpbmc+XG4gICAgICAgICAgICApID0+IHN0cmluZ1xuICAgICAgICApOnN0cmluZyA9PiBzdHJpbmcpKGh0bWxDb25maWd1cmF0aW9uLnRlbXBsYXRlKVxuICAgICAgICBodG1sQ29uZmlndXJhdGlvbi50ZW1wbGF0ZSA9IG5ld1RlbXBsYXRlU3RyaW5nXG4gICAgfVxufVxuLy8gZW5kcmVnaW9uXG5leHBvcnQgZGVmYXVsdCByZXNvbHZlZENvbmZpZ3VyYXRpb25cbi8vIHJlZ2lvbiB2aW0gbW9kbGluZVxuLy8gdmltOiBzZXQgdGFic3RvcD00IHNoaWZ0d2lkdGg9NCBleHBhbmR0YWI6XG4vLyB2aW06IGZvbGRtZXRob2Q9bWFya2VyIGZvbGRtYXJrZXI9cmVnaW9uLGVuZHJlZ2lvbjpcbi8vIGVuZHJlZ2lvblxuIl19