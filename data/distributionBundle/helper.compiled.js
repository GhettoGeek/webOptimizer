#!/usr/bin/env node
'use strict';var _set=require('babel-runtime/core-js/set'),_set2=_interopRequireDefault(_set),_from=require('babel-runtime/core-js/array/from'),_from2=_interopRequireDefault(_from),_promise=require('babel-runtime/core-js/promise'),_promise2=_interopRequireDefault(_promise),_clientnode=require('clientnode'),_clientnode2=_interopRequireDefault(_clientnode),_jsdom=require('jsdom'),dom=_interopRequireWildcard(_jsdom),_fs=require('fs'),fileSystem=_interopRequireWildcard(_fs),_path=require('path'),_path2=_interopRequireDefault(_path);Object.defineProperty(exports,'__esModule',{value:!0});function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}try{require('source-map-support/register')}catch(a){}class Helper{static isFilePathInLocation(a,b){for(const c of b)if(_path2.default.resolve(a).startsWith(_path2.default.resolve(c)))return!0;return!1}static inPlaceCSSAndJavaScriptAssetReferences(a,b,c,d,e,f,g){return new _promise2.default((h,i)=>dom.env(a.replace(/<%/g,'##+#+#+##').replace(/%>/g,'##-#-#-##'),(j,k)=>{if(j)return i(j);const l=[];if(b)for(const m in b){if(!b.hasOwnProperty(m))continue;let n='[href*=".css"]';'*'!=m&&(n='[href="'+_path2.default.relative(d,Helper.renderFilePathTemplate(e,{'[contenthash]':'','[id]':m,'[name]':m}))+'"]');const o=k.document.querySelectorAll(`link${n}`);if(o.length)for(const p of o){const q=k.document.createElement('style'),r=p.attributes.href.value.replace(/&.*/g,'');q.textContent=g[r].source(),'body'===b[m]?k.document.body.appendChild(q):'in'===b[m]?p.parentNode.insertBefore(q,p):'head'===b[m]&&k.document.head.appendChild(q),p.parentNode.removeChild(p),l.push(Helper.stripLoader(r)),delete g[r]}else console.warn('No referenced cascading style sheet file in resulting markup found with selector: link'+n)}if(c)for(const m in c){if(!c.hasOwnProperty(m))continue;let n='[href*=".js"]';'*'!=m&&(n='[src^="'+_path2.default.relative(d,Helper.renderFilePathTemplate(f,{'[hash]':'','[id]':m,'[name]':m})+'"]'));const o=k.document.querySelectorAll(`script${n}`);if(o.length)for(const p of o){const q=k.document.createElement('script'),r=p.attributes.src.value.replace(/&.*/g,'');q.textContent=g[r].source(),'body'===c[m]?k.document.body.appendChild(q):'in'===c[m]?p.parentNode.insertBefore(q,p):'head'===c[m]&&k.document.head.appendChild(q),p.parentNode.removeChild(p),l.push(Helper.stripLoader(r)),delete g[r]}else console.warn('No referenced javaScript file in resulting '+`markup found with selector: script${n}`)}h({content:a.replace(/^(\s*<!doctype [^>]+?>\s*)[\s\S]*$/i,'$1')+k.document.documentElement.outerHTML.replace(/##\+#\+#\+##/g,'<%').replace(/##-#-#-##/g,'%>'),filePathsToRemove:l})}))}static stripLoader(a){a=a.toString();const b=a.substring(a.lastIndexOf('!')+1);return b.includes('?')?b.substring(0,b.indexOf('?')):b}static normalizePaths(a){return(0,_from2.default)(new _set2.default(a.map((b)=>{return b=_path2.default.normalize(b),b.endsWith('/')?b.substring(0,b.length-1):b})))}static renderFilePathTemplate(a,b={'[name]':'.__dummy__','[id]':'.__dummy__','[hash]':'.__dummy__'}){let c=a;for(const d in b)b.hasOwnProperty(d)&&(c=c.replace(new RegExp(_clientnode2.default.stringEscapeRegularExpressions(d),'g'),b[d]));return c}static applyContext(a,b='./',c='./',d={},e={},f=['node_modules']){if(c=_path2.default.resolve(c),a.startsWith('./')&&_path2.default.resolve(b)!==c){a=_path2.default.resolve(b,a);for(const g of f){const h=_path2.default.resolve(c,g);if(a.startsWith(h))return a=a.substring(h.length),a.startsWith('/')&&(a=a.substring(1)),Helper.applyModuleReplacements(Helper.applyAliases(a.substring(a.lastIndexOf('!')+1),d),e)}if(a.startsWith(c))return a=a.substring(c.length),a.startsWith('/')&&(a=a.substring(1)),Helper.applyModuleReplacements(Helper.applyAliases(a.substring(a.lastIndexOf('!')+1),d),e)}return a}static determineExternalRequest(a,b='./',c='./',d={},e=['node_modules'],f={},g={},h={file:{external:['.js'],internal:['.js','.json','.css','.eot','.gif','.html','.ico','.jpg','.png','.ejs','.svg','.ttf','.woff','.woff2']},module:[]},i='./',j=['.git'],k=['node_modules'],l=['index','main'],m=['main','module'],n=[],o=[],p=[],q=!1,r=!0,s='utf-8'){b=_path2.default.resolve(b),c=_path2.default.resolve(c),i=_path2.default.resolve(i);let t=Helper.applyModuleReplacements(Helper.applyAliases(a.substring(a.lastIndexOf('!')+1),f),g),u=Helper.determineModuleFilePath(t,{},{},h,b,c,j,k,l,m,n,s);if(!(u||q)||_clientnode2.default.isAnyMatching(t,o))return Helper.applyContext(t,c,i,f,g,k);if(_clientnode2.default.isAnyMatching(t,p))return null;for(const v in d)if(d.hasOwnProperty(v))for(const w of d[v])if(Helper.determineModuleFilePath(w,f,g,h,b,c,j,k,l,m,n,s)===u)return null;return!q&&(0===h.file.external.length||u&&h.file.external.includes(_path2.default.extname(u))||!u&&h.file.external.includes(''))&&!(r&&a.includes('!'))&&(!u&&r||u&&(!u.startsWith(b)||Helper.isFilePathInLocation(u,e)))?Helper.applyContext(t,c,i,f,g,k):null}static determineAssetType(a,b,c){let d=null;for(const e in b)if(`.${b[e].extension}`===_path2.default.extname(a)){d=e;break}if(!d)for(const e of['source','target'])for(const f in c[e].asset)if(c[e].asset.hasOwnProperty(f)&&'base'!==f&&c[e].asset[f]&&a.startsWith(c[e].asset[f]))return f;return d}static resolveBuildConfigurationFilePaths(a,b='./',c=['.git'],d=['index','main']){const e=[];for(const f in a)if(a.hasOwnProperty(f)){const g=_clientnode2.default.extendObject(!0,{filePaths:[]},a[f]);for(const h of _clientnode2.default.walkDirectoryRecursivelySync(b,(i)=>{if(Helper.isFilePathInLocation(i.path,c))return!1}))h.stat.isFile()&&_path2.default.extname(h.path).substring(1)===g.extension&&!new RegExp(g.filePathPattern).test(h.path)&&g.filePaths.push(h.path);g.filePaths.sort((h,i)=>{if(d.includes(_path2.default.basename(h,_path2.default.extname(h)))){if(d.includes(_path2.default.basename(i,_path2.default.extname(i))))return 0;}else if(d.includes(_path2.default.basename(i,_path2.default.extname(i))))return 1;return 0}),e.push(g)}return e.sort((f,g)=>{return f.outputExtension===g.outputExtension?0:'js'===f.outputExtension?-1:'js'===g.outputExtension?1:f.outputExtension<g.outputExtension?-1:1})}static determineModuleLocations(a,b={},c={},d={file:{external:['.js'],internal:['.js','.json','.css','.eot','.gif','.html','.ico','.jpg','.png','.ejs','.svg','.ttf','.woff','.woff2']},module:[]},e='./',f='',g=['.git'],h=['','node_modules','../'],i=['__package__','','index','main'],j=['main','module'],k=[],l='utf-8'){const m=[],n=[],o=Helper.resolveModulesInFolders(Helper.normalizeInternalInjection(a),b,c,d,e,f,g,h,i,j,k);for(const p in o)if(o.hasOwnProperty(p))for(const q of o[p]){const r=Helper.determineModuleFilePath(q,b,c,d,e,f,g,h,i,j,k,l);if(r){m.push(r);const s=_path2.default.dirname(r);n.includes(s)||n.push(s)}}return{filePaths:m,directoryPaths:n}}static resolveModulesInFolders(a,b={},c={},d={file:{external:['.js'],internal:['.js','.json','.css','.eot','.gif','.html','.ico','.jpg','.png','.ejs','.svg','.ttf','.woff','.woff2']},module:[]},e='./',f='',g=['.git']){for(const h in f.startsWith('/')&&(f=_path2.default.relative(e,f)),a)if(a.hasOwnProperty(h)){let i=0;for(let j of a[h]){j=Helper.applyModuleReplacements(Helper.applyAliases(Helper.stripLoader(j),b),c);const k=_path2.default.resolve(f,j);if(_clientnode2.default.isDirectorySync(k)){a[h].splice(i,1);for(const l of _clientnode2.default.walkDirectoryRecursivelySync(k,(m)=>{if(Helper.isFilePathInLocation(m.path,g))return!1}))l.stat.isFile()&&a[h].push('./'+_path2.default.relative(f,_path2.default.resolve(k,l.path)))}else j.startsWith('./')&&!j.startsWith('./'+_path2.default.relative(e,f))&&(a[h][i]=`./${_path2.default.relative(e,k)}`);i+=1}}return a}static normalizeInternalInjection(a){let b={};if(a instanceof Object&&_clientnode2.default.isPlainObject(a)){let c=!1;const d=[];for(const e in a)a.hasOwnProperty(e)&&(Array.isArray(a[e])?0<a[e].length?(c=!0,b[e]=a[e]):d.push(e):(c=!0,b[e]=[a[e]]));if(c)for(const e of d)delete b[e];else b={index:[]}}else'string'==typeof a?b={index:[a]}:Array.isArray(a)&&(b={index:a});return b}static resolveInjection(a,b,c,d={},e={},f={file:{external:['.js'],internal:['.js','.json','.css','.eot','.gif','.html','.ico','.jpg','.png','.ejs','.svg','.ttf','.woff','.woff2']},module:[]},g='./',h='',i=['.git']){const j=_clientnode2.default.extendObject(!0,{},a),k=Helper.determineModuleLocations(c,d,e,f,g,h,i).filePaths;for(const l of['internal','external'])if('object'==typeof j[l]){for(const m in j[l])if('__auto__'===j[l][m]){j[l][m]=[];const n=Helper.getAutoChunk(b,k,h);for(const o in n)n.hasOwnProperty(o)&&j[l][m].push(n[o]);j[l][m].reverse()}}else'__auto__'===j[l]&&(j[l]=Helper.getAutoChunk(b,k,g));return j}static getAutoChunk(a,b,c){const d={},e={};for(const f of a){e[f.outputExtension]||(e[f.outputExtension]=[]);for(const g of f.filePaths)if(!b.includes(g)){const h='./'+_path2.default.relative(c,g),i=_path2.default.dirname(h),j=_path2.default.basename(h,`.${f.extension}`);let k=j;'.'!==i&&(k=_path2.default.join(i,j)),e[f.outputExtension].includes(k)||(d.hasOwnProperty(k)?d[h]=h:d[k]=h,e[f.outputExtension].push(k))}}return d}static determineModuleFilePath(a,b={},c={},d={file:{external:['.js'],internal:['.js','.json','.css','.eot','.gif','.html','.ico','.jpg','.png','.ejs','.svg','.ttf','.woff','.woff2']},module:[]},e='./',f='',g=['.git'],h=['node_modules'],i=['index'],j=['main'],k=[],l='utf-8'){if(a=Helper.applyModuleReplacements(Helper.applyAliases(Helper.stripLoader(a),b),c),!a)return null;let m=a;m.startsWith('./')&&(m=_path2.default.join(f,m));for(const n of[f].concat(h.map((o)=>_path2.default.resolve(e,o))))for(let o of['','__package__'].concat(i))for(const p of d.module.concat(['']))for(const q of[''].concat(d.file.internal)){let r=m.startsWith('/')?_path2.default.resolve(m):_path2.default.resolve(n,m);let s={};if('__package__'===o){if(_clientnode2.default.isDirectorySync(r)){const t=_path2.default.resolve(r,'package.json');if(_clientnode2.default.isFileSync(t)){let u={};try{u=JSON.parse(fileSystem.readFileSync(t,{encoding:l}))}catch(v){}for(const v of j)if(u.hasOwnProperty(v)&&'string'==typeof u[v]&&u[v]){o=u[v];break}for(const v of k)if(u.hasOwnProperty(v)&&'object'==typeof u[v]){s=u[v];break}}}if('__package__'===o)continue}if(o=Helper.applyModuleReplacements(Helper.applyAliases(o,s),c),o?r=_path2.default.resolve(r,`${o}${p}${q}`):r+=`${o}${p}${q}`,!Helper.isFilePathInLocation(r,g)&&_clientnode2.default.isFileSync(r))return r}return null}static applyAliases(a,b){for(const c in b)c.endsWith('$')?a===c.substring(0,c.length-1)&&(a=b[c]):a=a.replace(c,b[c]);return a}static applyModuleReplacements(a,b){for(const c in b)b.hasOwnProperty(c)&&(a=a.replace(new RegExp(c),b[c]));return a}}exports.default=Helper;

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhlbHBlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFHQSxhLGdYQWdCWSxHLG1EQUNBLFUsdVlBR1osR0FBSSxDQUNBLFFBQVEsNkJBQVIsQ0FDSCxDQUFDLFFBQWMsQ0FBRSxDQVlILEtBQU0sT0FBTyxDQVV4QixNQUFPLHFCQUFQLEtBRVUsQ0FDTixJQUFLLEtBQU0sRUFBWCxHQUFpQyxFQUFqQyxDQUNJLEdBQUksZUFBSyxPQUFMLENBQWEsQ0FBYixFQUF1QixVQUF2QixDQUFrQyxlQUFLLE9BQUwsQ0FBYSxDQUFiLENBQWxDLENBQUosQ0FDSSxTQUNSLFFBQ0gsQ0FtQkQsTUFBTyx1Q0FBUCxlQU02RCxDQU16RCxNQUFPLHVCQUFZLE9BRVQsSUFBSSxHQUFKLENBQVEsRUFBUSxPQUFSLENBQWdCLEtBQWhCLENBQXVCLFdBQXZCLEVBQW9DLE9BQXBDLENBQ2QsS0FEYyxDQUNQLFdBRE8sQ0FBUixDQUVQLE9BQXNDLENBQ3JDLEdBQUksQ0FBSixDQUNJLE1BQU8sR0FBTyxDQUFQLENBQVAsQ0FDSixLQUFNLEtBQU4sQ0FDQSxHQUFJLENBQUosQ0FDSSxJQUFLLEtBQU0sRUFBWCxHQUE2QixFQUE3QixDQUF5RCxDQUNyRCxHQUFJLENBQUMsRUFBMkIsY0FBM0IsQ0FBMEMsQ0FBMUMsQ0FBTCxDQUNJLFNBQ0osR0FBSSxHQUFrQixnQkFBdEIsQ0FDZ0IsR0FBWixHQUppRCxHQUtqRCxFQUFXLFVBQVksZUFBSyxRQUFMLENBQ25CLENBRG1CLENBQ1QsT0FBTyxzQkFBUCxDQUNOLENBRE0sQ0FDZ0MsQ0FDbEMsZ0JBQWlCLEVBRGlCLENBRWxDLE9BQVEsQ0FGMEIsQ0FHbEMsU0FBVSxDQUh3QixDQURoQyxDQURTLENBQVosQ0FPRixJQVp3QyxFQWFyRCxLQUFNLEdBQ0YsRUFBTyxRQUFQLENBQWdCLGdCQUFoQixDQUFrQyxPQUFNLENBQVMsRUFBakQsQ0FESixDQUVBLEdBQUksRUFBUyxNQUFiLENBQ0ksSUFBSyxLQUFNLEVBQVgsR0FBOEIsRUFBOUIsQ0FBd0MsQ0FDcEMsS0FBTSxHQUNGLEVBQU8sUUFBUCxDQUFnQixhQUFoQixDQUE4QixPQUE5QixDQURKLENBRU0sRUFBYyxFQUFRLFVBQVIsQ0FBbUIsSUFBbkIsQ0FBd0IsS0FBeEIsQ0FDZixPQURlLENBQ1AsTUFETyxDQUNDLEVBREQsQ0FGcEIsQ0FJQSxFQUFlLFdBQWYsQ0FBNkIsRUFBTyxDQUFQLEVBQWEsTUFBYixFQUxPLENBTVEsTUFBeEMsS0FBMkIsQ0FBM0IsQ0FOZ0MsQ0FPaEMsRUFBTyxRQUFQLENBQWdCLElBQWhCLENBQXFCLFdBQXJCLENBQ0ksQ0FESixDQVBnQyxDQVc5QixJQUZHLEtBQ0wsQ0FESyxDQVQyQixDQVloQyxFQUFRLFVBQVIsQ0FBbUIsWUFBbkIsQ0FDSSxDQURKLENBQ29CLENBRHBCLENBWmdDLENBZ0I5QixNQUZHLEtBQ0wsQ0FESyxDQWQyQixFQWlCaEMsRUFBTyxRQUFQLENBQWdCLElBQWhCLENBQXFCLFdBQXJCLENBQ0ksQ0FESixDQWpCZ0MsQ0FtQnBDLEVBQVEsVUFBUixDQUFtQixXQUFuQixDQUErQixDQUEvQixDQW5Cb0MsQ0EwQnBDLEVBQWtCLElBQWxCLENBQXVCLE9BQU8sV0FBUCxDQUFtQixDQUFuQixDQUF2QixDQTFCb0MsQ0EyQnBDLE1BQU8sR0FBTyxDQUFQLENBQ1YsQ0E3QkwsSUErQkksU0FBUSxJQUFSLENBQ0kseUZBRUEsQ0FISixDQUlQLENBQ0wsR0FBSSxDQUFKLENBQ0ksSUFBSyxLQUFNLEVBQVgsR0FBNkIsRUFBN0IsQ0FBZ0QsQ0FDNUMsR0FBSSxDQUFDLEVBQWtCLGNBQWxCLENBQWlDLENBQWpDLENBQUwsQ0FDSSxTQUNKLEdBQUksR0FBa0IsZUFBdEIsQ0FDZ0IsR0FBWixHQUp3QyxHQUt4QyxFQUFXLFVBQVksZUFBSyxRQUFMLENBQ25CLENBRG1CLENBQ1QsT0FBTyxzQkFBUCxDQUNOLENBRE0sQ0FDdUIsQ0FDekIsU0FBVSxFQURlLENBRXpCLE9BQVEsQ0FGaUIsQ0FHekIsU0FBVSxDQUhlLENBRHZCLEVBTU4sSUFQZSxDQUxpQixFQWE1QyxLQUFNLEdBQ0YsRUFBTyxRQUFQLENBQWdCLGdCQUFoQixDQUFrQyxTQUFRLENBQVMsRUFBbkQsQ0FESixDQUVBLEdBQUksRUFBUyxNQUFiLENBQ0ksSUFBSyxLQUFNLEVBQVgsR0FBOEIsRUFBOUIsQ0FBd0MsQ0FDcEMsS0FBTSxHQUNGLEVBQU8sUUFBUCxDQUFnQixhQUFoQixDQUE4QixRQUE5QixDQURKLENBRU0sRUFBYyxFQUFRLFVBQVIsQ0FBbUIsR0FBbkIsQ0FBdUIsS0FBdkIsQ0FDZixPQURlLENBQ1AsTUFETyxDQUNDLEVBREQsQ0FGcEIsQ0FJQSxFQUFlLFdBQWYsQ0FBNkIsRUFBTyxDQUFQLEVBQWEsTUFBYixFQUxPLENBTUQsTUFBL0IsS0FBa0IsQ0FBbEIsQ0FOZ0MsQ0FPaEMsRUFBTyxRQUFQLENBQWdCLElBQWhCLENBQXFCLFdBQXJCLENBQ0ksQ0FESixDQVBnQyxDQVNJLElBQS9CLEtBQWtCLENBQWxCLENBVDJCLENBVWhDLEVBQVEsVUFBUixDQUFtQixZQUFuQixDQUNJLENBREosQ0FDb0IsQ0FEcEIsQ0FWZ0MsQ0FZSSxNQUEvQixLQUFrQixDQUFsQixDQVoyQixFQWFoQyxFQUFPLFFBQVAsQ0FBZ0IsSUFBaEIsQ0FBcUIsV0FBckIsQ0FDSSxDQURKLENBYmdDLENBZXBDLEVBQVEsVUFBUixDQUFtQixXQUFuQixDQUErQixDQUEvQixDQWZvQyxDQXNCcEMsRUFBa0IsSUFBbEIsQ0FBdUIsT0FBTyxXQUFQLENBQW1CLENBQW5CLENBQXZCLENBdEJvQyxDQXVCcEMsTUFBTyxHQUFPLENBQVAsQ0FDVixDQXpCTCxJQTJCSSxTQUFRLElBQVIsQ0FDSSw4Q0FDQyxxQ0FBb0MsQ0FBUyxFQUZsRCxDQUdQLENBQ0wsRUFBUSxDQUNKLFFBQVMsRUFBUSxPQUFSLENBQ0wscUNBREssQ0FDa0MsSUFEbEMsRUFFTCxFQUFPLFFBQVAsQ0FBZ0IsZUFBaEIsQ0FBZ0MsU0FBaEMsQ0FBMEMsT0FBMUMsQ0FDQSxlQURBLENBQ2lCLElBRGpCLEVBRUYsT0FGRSxDQUVNLFlBRk4sQ0FFb0IsSUFGcEIsQ0FIQSxDQU1KLG1CQU5JLENBQVIsQ0FRSCxDQWpIUyxDQUZILENBb0hWLENBT0QsTUFBTyxZQUFQLEdBQWtELENBQzlDLEVBQVcsRUFBUyxRQUFULEVBRG1DLENBRTlDLEtBQU0sR0FBK0IsRUFBUyxTQUFULENBQ2pDLEVBQVMsV0FBVCxDQUFxQixHQUFyQixFQUE0QixDQURLLENBQXJDLENBRUEsTUFBTyxHQUFzQixRQUF0QixDQUNILEdBREcsRUFFSCxFQUFzQixTQUF0QixDQUFnQyxDQUFoQyxDQUFtQyxFQUFzQixPQUF0QixDQUNuQyxHQURtQyxDQUFuQyxDQUZHLENBSUYsQ0FDUixDQVFELE1BQU8sZUFBUCxHQUF5RCxDQUNyRCxNQUFPLG1CQUFXLGtCQUFRLEVBQU0sR0FBTixDQUFVLEtBQTZCLE9BQzdELEdBQVksZUFBSyxTQUFMLENBQWUsQ0FBZixDQURpRCxDQUV6RCxFQUFVLFFBQVYsQ0FBbUIsR0FBbkIsQ0FGeUQsQ0FHbEQsRUFBVSxTQUFWLENBQW9CLENBQXBCLENBQXVCLEVBQVUsTUFBVixDQUFtQixDQUExQyxDQUhrRCxDQUl0RCxDQUNWLENBTHlCLENBQVIsQ0FBWCxDQU1WLENBVUQsTUFBTyx1QkFBUCxHQUM2QixtRUFEN0IsQ0FLUyxDQUNMLEdBQUksR0FBa0IsQ0FBdEIsQ0FDQSxJQUFLLEtBQU0sRUFBWCxHQUFxQyxFQUFyQyxDQUNRLEVBQWEsY0FBYixDQUE0QixDQUE1QixDQURSLEdBRVEsRUFBVyxFQUFTLE9BQVQsQ0FBaUIsR0FBSSxPQUFKLENBQ3hCLHFCQUFNLDhCQUFOLENBQXFDLENBQXJDLENBRHdCLENBQytCLEdBRC9CLENBQWpCLENBRVIsRUFBYSxDQUFiLENBRlEsQ0FGbkIsRUFLQSxNQUFPLEVBQ1YsQ0FjRCxNQUFPLGFBQVAsR0FDb0IsRUFBaUIsSUFEckMsQ0FDMkMsRUFBdUIsSUFEbEUsQ0FFSSxJQUZKLENBRThCLElBRjlCLENBR0ksa0JBSEosQ0FJUyxDQUVMLEdBREEsRUFBZ0IsZUFBSyxPQUFMLENBQWEsQ0FBYixDQUNoQixDQUFJLEVBQVEsVUFBUixDQUFtQixJQUFuQixHQUE0QixlQUFLLE9BQUwsQ0FDNUIsQ0FENEIsSUFFMUIsQ0FGTixDQUVxQixDQUNqQixFQUFVLGVBQUssT0FBTCxDQUFhLENBQWIsQ0FBc0IsQ0FBdEIsQ0FETyxDQUVqQixJQUFLLEtBQU0sRUFBWCxHQUFnQyxFQUFoQyxDQUF5RCxDQUNyRCxLQUFNLEdBQW9CLGVBQUssT0FBTCxDQUN0QixDQURzQixDQUNQLENBRE8sQ0FBMUIsQ0FFQSxHQUFJLEVBQVEsVUFBUixDQUFtQixDQUFuQixDQUFKLENBSUksTUFIQSxHQUFVLEVBQVEsU0FBUixDQUFrQixFQUFXLE1BQTdCLENBR1YsQ0FGSSxFQUFRLFVBQVIsQ0FBbUIsR0FBbkIsQ0FFSixHQURJLEVBQVUsRUFBUSxTQUFSLENBQWtCLENBQWxCLENBQ2QsRUFBTyxPQUFPLHVCQUFQLENBQStCLE9BQU8sWUFBUCxDQUNsQyxFQUFRLFNBQVIsQ0FBa0IsRUFBUSxXQUFSLENBQW9CLEdBQXBCLEVBQTJCLENBQTdDLENBRGtDLENBRWxDLENBRmtDLENBQS9CLENBR0osQ0FISSxDQUtkLENBQ0QsR0FBSSxFQUFRLFVBQVIsQ0FBbUIsQ0FBbkIsQ0FBSixDQUlJLE1BSEEsR0FBVSxFQUFRLFNBQVIsQ0FBa0IsRUFBYyxNQUFoQyxDQUdWLENBRkksRUFBUSxVQUFSLENBQW1CLEdBQW5CLENBRUosR0FESSxFQUFVLEVBQVEsU0FBUixDQUFrQixDQUFsQixDQUNkLEVBQU8sT0FBTyx1QkFBUCxDQUErQixPQUFPLFlBQVAsQ0FDbEMsRUFBUSxTQUFSLENBQWtCLEVBQVEsV0FBUixDQUFvQixHQUFwQixFQUEyQixDQUE3QyxDQURrQyxDQUNlLENBRGYsQ0FBL0IsQ0FFSixDQUZJLENBSWQsQ0FDRCxNQUFPLEVBQ1YsQ0F1Q0QsTUFBTyx5QkFBUCxHQUNvQixFQUFpQixJQURyQyxDQUMyQyxFQUF3QixJQURuRSxDQUVJLElBRkosQ0FHSSxrQkFISixDQUlJLElBSkosQ0FJOEIsSUFKOUIsQ0FLSSxFQUF3QixDQUNwQixLQUFNLENBQ0YsZ0JBREUsQ0FFRixnSEFGRSxDQURjLENBT2pCLFNBUGlCLENBTDVCLENBYU8sRUFBdUIsSUFiOUIsQ0Fhb0MsVUFicEMsQ0FjSSxrQkFkSixDQWVJLGtCQWZKLENBZ0JJLG1CQWhCSixDQWlCSSxJQWpCSixDQWtCSSxJQWxCSixDQW1CSSxJQW5CSixDQW9CSSxJQXBCSixDQXFCSSxJQXJCSixDQXNCSSxFQUFrQixPQXRCdEIsQ0F1QlUsQ0FDTixFQUFVLGVBQUssT0FBTCxDQUFhLENBQWIsQ0FESixDQUVOLEVBQWlCLGVBQUssT0FBTCxDQUFhLENBQWIsQ0FGWCxDQUdOLEVBQWdCLGVBQUssT0FBTCxDQUFhLENBQWIsQ0FIVixDQUtOLEdBQUksR0FBeUIsT0FBTyx1QkFBUCxDQUN6QixPQUFPLFlBQVAsQ0FBb0IsRUFBUSxTQUFSLENBQ2hCLEVBQVEsV0FBUixDQUFvQixHQUFwQixFQUEyQixDQURYLENBQXBCLENBRUcsQ0FGSCxDQUR5QixDQUdaLENBSFksQ0FBN0IsQ0FRSSxFQUFtQixPQUFPLHVCQUFQLENBQ25CLENBRG1CLE9BQ00sQ0FETixDQUNrQixDQURsQixDQUMyQixDQUQzQixDQUVuQixDQUZtQixDQUVKLENBRkksQ0FFcUIsQ0FGckIsQ0FHbkIsQ0FIbUIsQ0FHTyxDQUhQLENBR2tDLENBSGxDLENBUnZCLENBZ0JBLEdBQUksRUFBRSxHQUFZLENBQWQsR0FBdUMscUJBQU0sYUFBTixDQUN2QyxDQUR1QyxDQUN0QixDQURzQixDQUEzQyxDQUdJLE1BQU8sUUFBTyxZQUFQLENBQ0gsQ0FERyxDQUNjLENBRGQsQ0FDOEIsQ0FEOUIsQ0FFSCxDQUZHLENBRU0sQ0FGTixDQUUwQixDQUYxQixDQUFQLENBR0osR0FBSSxxQkFBTSxhQUFOLENBQW9CLENBQXBCLENBQXFDLENBQXJDLENBQUosQ0FDSSxNQUFPLEtBQVAsQ0FDSixJQUFLLEtBQU0sRUFBWCxHQUErQixFQUEvQixDQUNJLEdBQUksRUFBNEIsY0FBNUIsQ0FBMkMsQ0FBM0MsQ0FBSixDQUNJLElBQUssS0FBTSxFQUFYLEdBQThCLEdBQzFCLENBRDBCLENBQTlCLENBR0ksR0FBSSxPQUFPLHVCQUFQLENBQ0EsQ0FEQSxDQUNVLENBRFYsQ0FDbUIsQ0FEbkIsQ0FDdUMsQ0FEdkMsQ0FFQSxDQUZBLENBRVMsQ0FGVCxDQUV5QixDQUZ6QixDQUdBLENBSEEsQ0FHeUIsQ0FIekIsQ0FJQSxDQUpBLENBSTBCLENBSjFCLENBS0EsQ0FMQSxJQU1FLENBTk4sQ0FPSSxNQUFPLEtBQVAsQ0F6Q1YsTUErQ0YsQ0FBQyxDQUFELEdBQ29DLENBQXBDLEtBQVcsSUFBWCxDQUFnQixRQUFoQixDQUF5QixNQUF6QixFQUF5QyxHQUN6QyxFQUFXLElBQVgsQ0FBZ0IsUUFBaEIsQ0FBeUIsUUFBekIsQ0FBa0MsZUFBSyxPQUFMLENBQWEsQ0FBYixDQUFsQyxDQURBLEVBRUEsQ0FBQyxDQUFELEVBQWEsRUFBVyxJQUFYLENBQWdCLFFBQWhCLENBQXlCLFFBQXpCLENBQWtDLEVBQWxDLENBSGIsR0FJQyxFQUFFLEdBQXlCLEVBQVEsUUFBUixDQUFpQixHQUFqQixDQUEzQixDQUpELEdBS0EsQ0FBQyxDQUFELEVBQWEsQ0FBYixFQUFzQyxJQUN0QyxDQUFDLEVBQVMsVUFBVCxDQUFvQixDQUFwQixDQUFELEVBQWlDLE9BQU8sb0JBQVAsQ0FDN0IsQ0FENkIsQ0FDbkIsQ0FEbUIsQ0FESyxDQUx0QyxDQS9DRSxDQXdESyxPQUFPLFlBQVAsQ0FDSCxDQURHLENBQ2MsQ0FEZCxDQUM4QixDQUQ5QixDQUM2QyxDQUQ3QyxDQUVILENBRkcsQ0FFaUIsQ0FGakIsQ0F4REwsQ0EyREMsSUFDVixDQVdELE1BQU8sbUJBQVAsT0FFVSxDQUNOLEdBQUksR0FBaUIsSUFBckIsQ0FDQSxJQUFLLEtBQU0sRUFBWCxHQUEwQixFQUExQixDQUNJLEdBRU8sSUFBRyxFQUFtQixDQUFuQixFQUF5QixTQUFVLEVBRnpDLGtCQUFLLE9BQUwsQ0FDQSxDQURBLENBQUosQ0FFZ0QsQ0FDNUMsRUFBUyxDQURtQyxDQUU1QyxLQUNILENBQ0wsR0FBSSxDQUFDLENBQUwsQ0FDSSxJQUFLLEtBQU0sRUFBWCx1QkFDSSxJQUFLLEtBQU0sRUFBWCxHQUErQixHQUFNLENBQU4sRUFBWSxLQUEzQyxDQUNJLEdBQUksRUFBTSxDQUFOLEVBQVksS0FBWixDQUFrQixjQUFsQixDQUNBLENBREEsR0FFZSxNQUFkLElBRkQsRUFHSixFQUFNLENBQU4sRUFBWSxLQUFaLENBQWtCLENBQWxCLENBSEksRUFHNEIsRUFBUyxVQUFULENBQzVCLEVBQU0sQ0FBTixFQUFZLEtBQVosQ0FBa0IsQ0FBbEIsQ0FENEIsQ0FIaEMsQ0FNSSxNQUFPLEVBQVAsQ0FDaEIsTUFBTyxFQUNWLENBWUQsTUFBTyxtQ0FBUCxHQUNzQyxFQUFtQixJQUR6RCxDQUVJLFVBRkosQ0FHSSxrQkFISixDQUk2QixDQUN6QixLQUFNLEtBQU4sQ0FDQSxJQUFLLEtBQU0sRUFBWCxHQUEwQixFQUExQixDQUNJLEdBQUksRUFBYyxjQUFkLENBQTZCLENBQTdCLENBQUosQ0FBd0MsQ0FDcEMsS0FBTSxHQUNGLHFCQUFNLFlBQU4sSUFBeUIsQ0FBQyxZQUFELENBQXpCLENBQTBDLEVBQ3RDLENBRHNDLENBQTFDLENBREosQ0FHQSxJQUFLLEtBQU0sRUFBWCxHQUF3QixzQkFBTSw0QkFBTixDQUNwQixDQURvQixDQUNULEtBQXNCLENBQzdCLEdBQUksT0FBTyxvQkFBUCxDQUNBLEVBQUssSUFETCxDQUNXLENBRFgsQ0FBSixDQUdJLFFBQ1AsQ0FObUIsQ0FBeEIsQ0FRUSxFQUFLLElBQUwsQ0FBVSxNQUFWLElBQXNCLGVBQUssT0FBTCxDQUN0QixFQUFLLElBRGlCLEVBRXhCLFNBRndCLENBRWQsQ0FGYyxJQUVQLEVBQVEsU0FGdkIsRUFFb0MsQ0FDcEMsR0FBSSxPQUFKLENBQVcsRUFBUSxlQUFuQixDQURxQyxDQUV2QyxJQUZ1QyxDQUVsQyxFQUFLLElBRjZCLENBVjdDLEVBYVEsRUFBUSxTQUFSLENBQWtCLElBQWxCLENBQXVCLEVBQUssSUFBNUIsQ0FiUixDQWNBLEVBQVEsU0FBUixDQUFrQixJQUFsQixDQUF1QixPQUVYLENBQ1IsR0FBSSxFQUFrQixRQUFsQixDQUEyQixlQUFLLFFBQUwsQ0FDM0IsQ0FEMkIsQ0FDWixlQUFLLE9BQUwsQ0FBYSxDQUFiLENBRFksQ0FBM0IsQ0FBSixFQUdJLEdBQUksRUFBa0IsUUFBbEIsQ0FBMkIsZUFBSyxRQUFMLENBQzNCLENBRDJCLENBQ1gsZUFBSyxPQUFMLENBQWEsQ0FBYixDQURXLENBQTNCLENBQUosQ0FHSSxNQUFPLEVBQVAsQ0FOUixLQU9PLElBQUksRUFBa0IsUUFBbEIsQ0FBMkIsZUFBSyxRQUFMLENBQ2xDLENBRGtDLENBQ2xCLGVBQUssT0FBTCxDQUFhLENBQWIsQ0FEa0IsQ0FBM0IsQ0FBSixDQUdILE1BQU8sRUFBUCxDQUNKLE1BQU8sRUFDVixDQWZELENBbEJvQyxDQWtDcEMsRUFBbUIsSUFBbkIsQ0FBd0IsQ0FBeEIsQ0FDSCxDQUNMLE1BQU8sR0FBbUIsSUFBbkIsQ0FBd0IsT0FHbkIsT0FDSixHQUFNLGVBQU4sR0FBMEIsRUFBTyxlQUQ3QixDQVFELENBUkMsQ0FFMEIsSUFBMUIsS0FBTSxlQUZOLENBR08sQ0FBQyxDQUhSLENBSTJCLElBQTNCLEtBQU8sZUFKUCxDQUtPLENBTFAsQ0FNRyxFQUFNLGVBQU4sQ0FBd0IsRUFBTyxlQUEvQixDQUFpRCxDQUFDLENBQWxELENBQXNELENBR3BFLENBWk0sQ0FhVixDQTBCRCxNQUFPLHlCQUFQLEdBQ3lDLElBRHpDLENBRUksSUFGSixDQUV5QyxFQUF3QixDQUN6RCxLQUFNLENBQ0YsZ0JBREUsQ0FFRixnSEFGRSxDQURtRCxDQU90RCxTQVBzRCxDQUZqRSxDQVVPLEVBQWlCLElBVnhCLENBVThCLEVBQXVCLEVBVnJELENBV0ksVUFYSixDQVlJLDJCQVpKLENBYUksbUNBYkosQ0FlSSxtQkFmSixDQWdCSSxJQWhCSixDQWlCSSxFQUFrQixPQWpCdEIsQ0FrQnlELENBQ3JELEtBQU0sS0FBTixDQUNNLElBRE4sQ0FFTSxFQUNGLE9BQU8sdUJBQVAsQ0FDSSxPQUFPLDBCQUFQLENBQWtDLENBQWxDLENBREosQ0FFSSxDQUZKLENBRWEsQ0FGYixDQUVpQyxDQUZqQyxDQUU2QyxDQUY3QyxDQUdJLENBSEosQ0FHbUIsQ0FIbkIsQ0FHa0MsQ0FIbEMsQ0FJSSxDQUpKLENBSTJCLENBSjNCLENBS0ksQ0FMSixDQUhKLENBU0EsSUFBSyxLQUFNLEVBQVgsR0FBK0IsRUFBL0IsQ0FDSSxHQUFJLEVBQTRCLGNBQTVCLENBQTJDLENBQTNDLENBQUosQ0FDSSxJQUFLLEtBQU0sRUFBWCxHQUE4QixHQUMxQixDQUQwQixDQUE5QixDQUVHLENBQ0MsS0FBTSxHQUFtQixPQUFPLHVCQUFQLENBQ3JCLENBRHFCLENBQ1gsQ0FEVyxDQUNGLENBREUsQ0FDa0IsQ0FEbEIsQ0FFckIsQ0FGcUIsQ0FFWixDQUZZLENBRUcsQ0FGSCxDQUdyQixDQUhxQixDQUdJLENBSEosQ0FJckIsQ0FKcUIsQ0FJSyxDQUpMLENBS3JCLENBTHFCLENBQXpCLENBTUEsR0FBSSxDQUFKLENBQWMsQ0FDVixFQUFVLElBQVYsQ0FBZSxDQUFmLENBRFUsQ0FFVixLQUFNLEdBQXVCLGVBQUssT0FBTCxDQUFhLENBQWIsQ0FBN0IsQ0FDSyxFQUFlLFFBQWYsQ0FBd0IsQ0FBeEIsQ0FISyxFQUlOLEVBQWUsSUFBZixDQUFvQixDQUFwQixDQUNQLENBQ0osQ0FDVCxNQUFPLENBQUMsV0FBRCxDQUFZLGdCQUFaLENBQ1YsQ0FlRCxNQUFPLHdCQUFQLEdBRUksSUFGSixDQUU4QixJQUY5QixDQUdJLEVBQXdCLENBQ3BCLEtBQU0sQ0FDRixnQkFERSxDQUVGLGdIQUZFLENBRGMsQ0FPakIsU0FQaUIsQ0FINUIsQ0FXTyxFQUFpQixJQVh4QixDQVc4QixFQUF1QixFQVhyRCxDQVlJLFVBWkosQ0FhOEIsQ0FHMUIsSUFBSyxLQUFNLEVBQVgsR0FGSSxHQUFjLFVBQWQsQ0FBeUIsR0FBekIsQ0FFSixHQURJLEVBQWdCLGVBQUssUUFBTCxDQUFjLENBQWQsQ0FBdUIsQ0FBdkIsQ0FDcEIsRUFBK0IsQ0FBL0IsQ0FDSSxHQUFJLEVBQTRCLGNBQTVCLENBQTJDLENBQTNDLENBQUosQ0FBMkQsQ0FDdkQsR0FBSSxHQUFlLENBQW5CLENBQ0EsSUFBSyxHQUFJLEVBQVQsR0FBNEIsR0FDeEIsQ0FEd0IsQ0FBNUIsQ0FFRyxDQUNDLEVBQVcsT0FBTyx1QkFBUCxDQUNQLE9BQU8sWUFBUCxDQUFvQixPQUFPLFdBQVAsQ0FDaEIsQ0FEZ0IsQ0FBcEIsQ0FFRyxDQUZILENBRE8sQ0FHTSxDQUhOLENBRFosQ0FLQyxLQUFNLEdBQXNCLGVBQUssT0FBTCxDQUN4QixDQUR3QixDQUNULENBRFMsQ0FBNUIsQ0FFQSxHQUFJLHFCQUFNLGVBQU4sQ0FBc0IsQ0FBdEIsQ0FBSixDQUF5QyxDQUNyQyxFQUE0QixDQUE1QixFQUF1QyxNQUF2QyxDQUE4QyxDQUE5QyxDQUFxRCxDQUFyRCxDQURxQyxDQUVyQyxJQUNJLEtBQU0sRUFEVixHQUVJLHNCQUFNLDRCQUFOLENBQW1DLENBQW5DLENBQWlELEtBRXJDLENBQ1IsR0FBSSxPQUFPLG9CQUFQLENBQ0EsRUFBSyxJQURMLENBQ1csQ0FEWCxDQUFKLENBR0ksUUFDUCxDQVBELENBRkosQ0FXUSxFQUFLLElBQUwsQ0FBVSxNQUFWLEVBWFIsRUFZUSxFQUE0QixDQUE1QixFQUF1QyxJQUF2QyxDQUNJLEtBQU8sZUFBSyxRQUFMLENBQ0gsQ0FERyxDQUNZLGVBQUssT0FBTCxDQUNYLENBRFcsQ0FDRyxFQUFLLElBRFIsQ0FEWixDQURYLENBSVgsQ0FsQkQsSUFrQlcsR0FBUyxVQUFULENBQ1AsSUFETyxHQUVOLENBQUMsRUFBUyxVQUFULENBQW9CLEtBQU8sZUFBSyxRQUFMLENBQzdCLENBRDZCLENBQ3BCLENBRG9CLENBQTNCLENBcEJOLEdBdUJJLEVBQTRCLENBQTVCLEVBQXVDLENBQXZDLEVBQ0ssS0FBSSxlQUFLLFFBQUwsQ0FBYyxDQUFkLENBQXVCLENBQXZCLENBQXFDLEVBeEJsRCxFQXlCQSxHQUFTLENBQ1osQ0FDSixDQUNMLE1BQU8sRUFDVixDQVFELE1BQU8sMkJBQVAsR0FFOEIsQ0FDMUIsR0FBSSxLQUFKLENBQ0EsR0FBSSxZQUE2QixPQUE3QixFQUF1QyxxQkFBTSxhQUFOLENBQ3ZDLENBRHVDLENBQTNDLENBRUcsQ0FDQyxHQUFJLEtBQUosQ0FDQSxLQUFNLEtBQU4sQ0FDQSxJQUFLLEtBQU0sRUFBWCxHQUErQixFQUEvQixDQUNRLEVBQWtCLGNBQWxCLENBQWlDLENBQWpDLENBRFIsR0FFWSxNQUFNLE9BQU4sQ0FBYyxFQUFrQixDQUFsQixDQUFkLENBRlosQ0FHc0QsQ0FBdEMsR0FBa0IsQ0FBbEIsRUFBNkIsTUFIN0MsRUFJZ0IsSUFKaEIsQ0FLZ0IsRUFBTyxDQUFQLEVBQW9CLEVBQWtCLENBQWxCLENBTHBDLEVBT2dCLEVBQW1CLElBQW5CLENBQXdCLENBQXhCLENBUGhCLEVBU1ksSUFUWixDQVVZLEVBQU8sQ0FBUCxFQUFvQixDQUFDLEVBQWtCLENBQWxCLENBQUQsQ0FWaEMsR0FZQSxHQUFJLENBQUosQ0FDSSxJQUFLLEtBQU0sRUFBWCxHQUErQixFQUEvQixDQUNJLE1BQU8sR0FBTyxDQUFQLENBQVAsQ0FGUixJQUlJLEdBQVMsQ0FBQyxRQUFELENBQ2hCLENBdEJELElBc0J3QyxRQUE3QixRQUFPLEVBdEJsQixDQXVCSSxFQUFTLENBQUMsTUFBTyxDQUFDLENBQUQsQ0FBUixDQXZCYixDQXdCUyxNQUFNLE9BQU4sQ0FBYyxDQUFkLENBeEJULEdBeUJJLEVBQVMsQ0FBQyxNQUFPLENBQVIsQ0F6QmIsRUEwQkEsTUFBTyxFQUNWLENBb0JELE1BQU8saUJBQVAsT0FJSSxJQUpKLENBSThCLElBSjlCLENBS0ksRUFBd0IsQ0FDcEIsS0FBTSxDQUNGLGdCQURFLENBRUYsZ0hBRkUsQ0FEYyxDQU9qQixTQVBpQixDQUw1QixDQWFPLEVBQWlCLElBYnhCLENBYThCLEVBQXVCLEVBYnJELENBY0ksVUFkSixDQWVZLENBQ1IsS0FBTSxHQUFzQixxQkFBTSxZQUFOLE9BQ2QsQ0FEYyxDQUE1QixDQUVNLEVBQ0YsT0FBTyx3QkFBUCxDQUNJLENBREosQ0FDc0IsQ0FEdEIsQ0FDK0IsQ0FEL0IsQ0FDbUQsQ0FEbkQsQ0FFSSxDQUZKLENBRWEsQ0FGYixDQUU0QixDQUY1QixFQUdFLFNBTk4sQ0FPQSxJQUFLLEtBQU0sRUFBWCwyQkFFSSxHQUErQixRQUEzQixRQUFPLEdBQVUsQ0FBVixDQUFYLEVBQ0ksSUFBSyxLQUFNLEVBQVgsR0FBK0IsR0FBVSxDQUFWLENBQS9CLENBQ0ksR0FBbUMsVUFBL0IsS0FBVSxDQUFWLEVBQWdCLENBQWhCLENBQUosQ0FBK0MsQ0FDM0MsRUFBVSxDQUFWLEVBQWdCLENBQWhCLElBRDJDLENBRTNDLEtBQU0sR0FFRixPQUFPLFlBQVAsQ0FDQSxDQURBLENBQ3FCLENBRHJCLENBRUEsQ0FGQSxDQUZKLENBS0EsSUFBSyxLQUFNLEVBQVgsR0FBa0MsRUFBbEMsQ0FDUSxFQUFRLGNBQVIsQ0FBdUIsQ0FBdkIsQ0FEUixFQUVRLEVBQVUsQ0FBVixFQUFnQixDQUFoQixFQUEyQixJQUEzQixDQUNJLEVBQVEsQ0FBUixDQURKLENBRlIsQ0FRQSxFQUFVLENBQVYsRUFBZ0IsQ0FBaEIsRUFBMkIsT0FBM0IsRUFDSCxDQWxCVCxLQW1CK0IsVUFBcEIsS0FBVSxDQUFWLENBbkJYLEdBcUJJLEVBQVUsQ0FBVixFQUFrQixPQUFPLFlBQVAsQ0FDZCxDQURjLENBQ08sQ0FEUCxDQUNpQyxDQURqQyxDQXJCdEIsRUF1QkosTUFBTyxFQUNWLENBVUQsTUFBTyxhQUFQLE9BR3dCLENBQ3BCLEtBQU0sS0FBTixDQUNNLElBRE4sQ0FFQSxJQUNJLEtBQU0sRUFEVixHQUVJLEVBRkosQ0FHRSxDQUNPLEVBQWtCLEVBQW1CLGVBQXJDLENBRFAsR0FFTSxFQUFrQixFQUFtQixlQUFyQyxJQUZOLEVBR0UsSUFBSyxLQUFNLEVBQVgsR0FBb0MsR0FBbUIsU0FBdkQsQ0FDSSxHQUFJLENBQUMsRUFBeUIsUUFBekIsQ0FBa0MsQ0FBbEMsQ0FBTCxDQUF3RCxDQUNwRCxLQUFNLEdBQWdDLEtBQU8sZUFBSyxRQUFMLENBQ3pDLENBRHlDLENBQ2hDLENBRGdDLENBQTdDLENBRU0sRUFBdUIsZUFBSyxPQUFMLENBQ3pCLENBRHlCLENBRjdCLENBSU0sRUFBa0IsZUFBSyxRQUFMLENBQ3BCLENBRG9CLENBRW5CLElBQUcsRUFBbUIsU0FBVSxFQUZiLENBSnhCLENBT0EsR0FBSSxHQUFrQixDQUF0QixDQUNzQixHQUFsQixJQVRnRCxHQVVoRCxFQUFXLGVBQUssSUFBTCxDQUFVLENBQVYsQ0FBeUIsQ0FBekIsQ0FWcUMsRUFlL0MsRUFDRCxFQUFtQixlQURsQixFQUVILFFBRkcsQ0FFTSxDQUZOLENBZitDLEdBMEI1QyxFQUFPLGNBQVAsQ0FBc0IsQ0FBdEIsQ0ExQjRDLENBMkI1QyxFQUFPLENBQVAsRUFDSSxDQTVCd0MsQ0E4QjVDLEVBQU8sQ0FBUCxFQUFtQixDQTlCeUIsQ0ErQmhELEVBQ0ksRUFBbUIsZUFEdkIsRUFFRSxJQUZGLENBRU8sQ0FGUCxDQS9CZ0QsQ0FtQ3ZELENBQ1IsQ0FDRCxNQUFPLEVBQ1YsQ0F5QkQsTUFBTyx3QkFBUCxHQUNxQixJQURyQixDQUVJLElBRkosQ0FFeUMsRUFBd0IsQ0FDekQsS0FBTSxDQUNGLGdCQURFLENBRUYsZ0hBRkUsQ0FEbUQsQ0FPdEQsU0FQc0QsQ0FGakUsQ0FVTyxFQUFpQixJQVZ4QixDQVU4QixFQUF1QixFQVZyRCxDQVdJLFVBWEosQ0FZSSxrQkFaSixDQWFJLFdBYkosQ0FjSSxVQWRKLENBZUksSUFmSixDQWdCSSxFQUFrQixPQWhCdEIsQ0FpQlUsQ0FJTixHQUhBLEVBQVcsT0FBTyx1QkFBUCxDQUErQixPQUFPLFlBQVAsQ0FDdEMsT0FBTyxXQUFQLENBQW1CLENBQW5CLENBRHNDLENBQ1IsQ0FEUSxDQUEvQixDQUVSLENBRlEsQ0FHWCxDQUFJLENBQUMsQ0FBTCxDQUNJLE1BQU8sS0FBUCxDQUNKLEdBQUksR0FBd0IsQ0FBNUIsQ0FDSSxFQUFlLFVBQWYsQ0FBMEIsSUFBMUIsQ0FQRSxHQVFGLEVBQWlCLGVBQUssSUFBTCxDQUFVLENBQVYsQ0FBeUIsQ0FBekIsQ0FSZixFQVNOLElBQUssS0FBTSxFQUFYLEdBQW9DLENBQUMsQ0FBRCxFQUFnQixNQUFoQixDQUNoQyxFQUF3QixHQUF4QixDQUE0QixLQUN4QixlQUFLLE9BQUwsQ0FBYSxDQUFiLENBQXNCLENBQXRCLENBREosQ0FEZ0MsQ0FBcEMsQ0FJSSxJQUFLLEdBQUksRUFBVCxHQUE0QixtQkFBb0IsTUFBcEIsQ0FDeEIsQ0FEd0IsQ0FBNUIsQ0FHSSxJQUFLLEtBQU0sRUFBWCxHQUFxQyxHQUFXLE1BQVgsQ0FBa0IsTUFBbEIsTUFBckMsQ0FHSSxJQUFLLEtBQU0sRUFBWCxHQUFtQyxLQUFLLE1BQUwsQ0FDL0IsRUFBVyxJQUFYLENBQWdCLFFBRGUsQ0FBbkMsQ0FFRyxDQUNDLEdBQUksR0FDQSxFQUFlLFVBQWYsQ0FBMEIsR0FBMUIsQ0FEQSxDQUV3QixlQUFLLE9BQUwsQ0FDcEIsQ0FEb0IsQ0FGeEIsQ0FLd0IsZUFBSyxPQUFMLENBQ3BCLENBRG9CLENBQ0osQ0FESSxDQUw1QixDQU9BLEdBQUksS0FBSixDQUNBLEdBQWlCLGFBQWIsSUFBSixDQUFnQyxDQUM1QixHQUFJLHFCQUFNLGVBQU4sQ0FDQSxDQURBLENBQUosQ0FFRyxDQUNDLEtBQU0sR0FBMkIsZUFBSyxPQUFMLENBQzdCLENBRDZCLENBQ04sY0FETSxDQUFqQyxDQUVBLEdBQUkscUJBQU0sVUFBTixDQUFpQixDQUFqQixDQUFKLENBQXlDLENBQ3JDLEdBQUksS0FBSixDQUNBLEdBQUksQ0FDQSxFQUFxQixLQUFLLEtBQUwsQ0FDakIsV0FBVyxZQUFYLENBQ0ksQ0FESixDQUN1QixDQUFDLFVBQUQsQ0FEdkIsQ0FEaUIsQ0FHeEIsQ0FBQyxRQUFjLENBQUUsQ0FDbEIsSUFDSSxLQUFNLEVBRFYsR0FFSSxFQUZKLENBSUksR0FBSSxFQUFtQixjQUFuQixDQUNBLENBREEsR0FJRSxRQUZELFFBQU8sR0FDUixDQURRLENBRlIsRUFJYyxFQUNkLENBRGMsQ0FKbEIsQ0FNRyxDQUNDLEVBQVcsRUFDUCxDQURPLENBRFosQ0FHQyxLQUNILENBQ0wsSUFDSSxLQUFNLEVBRFYsR0FFSSxFQUZKLENBSUksR0FBSSxFQUFtQixjQUFuQixDQUNBLENBREEsR0FJRSxRQUZELFFBQU8sR0FDUixDQURRLENBRlosQ0FJZ0IsQ0FDWixFQUNJLEVBQ0ksQ0FESixDQUZRLENBSVosS0FDSCxDQUNSLENBQ0osQ0FDRCxHQUFpQixhQUFiLElBQUosQ0FDSSxRQUNQLENBWUQsR0FYQSxFQUFXLE9BQU8sdUJBQVAsQ0FDUCxPQUFPLFlBQVAsQ0FBb0IsQ0FBcEIsQ0FBOEIsQ0FBOUIsQ0FETyxDQUVQLENBRk8sQ0FXWCxDQVJJLENBUUosQ0FQSSxFQUF3QixlQUFLLE9BQUwsQ0FDcEIsQ0FEb0IsQ0FFbkIsR0FBRSxDQUFTLEdBQUUsQ0FBZ0IsR0FBRSxDQUFjLEVBRjFCLENBTzVCLENBRkksR0FDSyxHQUFFLENBQVMsR0FBRSxDQUFnQixHQUFFLENBQWMsRUFDdEQsRUFBSSxPQUFPLG9CQUFQLENBQ0EsQ0FEQSxDQUN1QixDQUR2QixDQUFKLEVBSUkscUJBQU0sVUFBTixDQUFpQixDQUFqQixDQUpKLENBS0ksTUFBTyxFQUNkLENBQ2IsTUFBTyxLQUNWLENBUUQsTUFBTyxhQUFQLEtBQWlFLENBQzdELElBQUssS0FBTSxFQUFYLEdBQTJCLEVBQTNCLENBQ1EsRUFBTSxRQUFOLENBQWUsR0FBZixDQURSLENBRVksSUFBYSxFQUFNLFNBQU4sQ0FBZ0IsQ0FBaEIsQ0FBbUIsRUFBTSxNQUFOLENBQWUsQ0FBbEMsQ0FGekIsR0FHWSxFQUFXLEVBQVEsQ0FBUixDQUh2QixFQUtRLEVBQVcsRUFBUyxPQUFULENBQWlCLENBQWpCLENBQXdCLEVBQVEsQ0FBUixDQUF4QixDQUxuQixDQU1BLE1BQU8sRUFDVixDQVFELE1BQU8sd0JBQVAsS0FFUyxDQUNMLElBQUssS0FBTSxFQUFYLEdBQWlDLEVBQWpDLENBQ1EsRUFBYSxjQUFiLENBQTRCLENBQTVCLENBRFIsR0FFUSxFQUFXLEVBQVMsT0FBVCxDQUNQLEdBQUksT0FBSixDQUFXLENBQVgsQ0FETyxDQUNrQixFQUFhLENBQWIsQ0FEbEIsQ0FGbkIsRUFJQSxNQUFPLEVBQ1YsQ0E1OEJ1QixDLGdCQUFQLE0iLCJmaWxlIjoiaGVscGVyLmNvbXBpbGVkLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXG4vLyBAZmxvd1xuLy8gLSotIGNvZGluZzogdXRmLTggLSotXG4ndXNlIHN0cmljdCdcbi8qICFcbiAgICByZWdpb24gaGVhZGVyXG4gICAgQ29weXJpZ2h0IFRvcmJlbiBTaWNrZXJ0IChpbmZvW1wifmF0flwiXXRvcmJlbi53ZWJzaXRlKSAxNi4xMi4yMDEyXG5cbiAgICBMaWNlbnNlXG4gICAgLS0tLS0tLVxuXG4gICAgVGhpcyBsaWJyYXJ5IHdyaXR0ZW4gYnkgVG9yYmVuIFNpY2tlcnQgc3RhbmQgdW5kZXIgYSBjcmVhdGl2ZSBjb21tb25zIG5hbWluZ1xuICAgIDMuMCB1bnBvcnRlZCBsaWNlbnNlLiBzZWUgaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnkvMy4wL2RlZWQuZGVcbiAgICBlbmRyZWdpb25cbiovXG4vLyByZWdpb24gaW1wb3J0c1xuaW1wb3J0IHR5cGUge0RvbU5vZGV9IGZyb20gJ2NsaWVudG5vZGUnXG5pbXBvcnQgVG9vbHMgZnJvbSAnY2xpZW50bm9kZSdcbmltcG9ydCB0eXBlIHtGaWxlLCBQbGFpbk9iamVjdH0gZnJvbSAnY2xpZW50bm9kZSdcbmltcG9ydCAqIGFzIGRvbSBmcm9tICdqc2RvbSdcbmltcG9ydCAqIGFzIGZpbGVTeXN0ZW0gZnJvbSAnZnMnXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJ1xuLy8gTk9URTogT25seSBuZWVkZWQgZm9yIGRlYnVnZ2luZyB0aGlzIGZpbGUuXG50cnkge1xuICAgIHJlcXVpcmUoJ3NvdXJjZS1tYXAtc3VwcG9ydC9yZWdpc3RlcicpXG59IGNhdGNoIChlcnJvcikge31cblxuaW1wb3J0IHR5cGUge1xuICAgIEJ1aWxkQ29uZmlndXJhdGlvbiwgRXh0ZW5zaW9ucywgSW5qZWN0aW9uLCBJbnRlcm5hbEluamVjdGlvbixcbiAgICBOb3JtYWxpemVkSW50ZXJuYWxJbmplY3Rpb24sIFBhdGgsIFJlc29sdmVkQnVpbGRDb25maWd1cmF0aW9uLFxuICAgIFJlc29sdmVkQnVpbGRDb25maWd1cmF0aW9uSXRlbVxufSBmcm9tICcuL3R5cGUnXG4vLyBlbmRyZWdpb25cbi8vIHJlZ2lvbiBtZXRob2RzXG4vKipcbiAqIFByb3ZpZGVzIGEgY2xhc3Mgb2Ygc3RhdGljIG1ldGhvZHMgd2l0aCBnZW5lcmljIHVzZSBjYXNlcy5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSGVscGVyIHtcbiAgICAvLyByZWdpb24gYm9vbGVhblxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgd2hldGhlciBnaXZlbiBmaWxlIHBhdGggaXMgd2l0aGluIGdpdmVuIGxpc3Qgb2YgZmlsZVxuICAgICAqIGxvY2F0aW9ucy5cbiAgICAgKiBAcGFyYW0gZmlsZVBhdGggLSBQYXRoIHRvIGZpbGUgdG8gY2hlY2suXG4gICAgICogQHBhcmFtIGxvY2F0aW9uc1RvQ2hlY2sgLSBMb2NhdGlvbnMgdG8gdGFrZSBpbnRvIGFjY291bnQuXG4gICAgICogQHJldHVybnMgVmFsdWUgXCJ0cnVlXCIgaWYgZ2l2ZW4gZmlsZSBwYXRoIGlzIHdpdGhpbiBvbmUgb2YgZ2l2ZW5cbiAgICAgKiBsb2NhdGlvbnMgb3IgXCJmYWxzZVwiIG90aGVyd2lzZS5cbiAgICAgKi9cbiAgICBzdGF0aWMgaXNGaWxlUGF0aEluTG9jYXRpb24oXG4gICAgICAgIGZpbGVQYXRoOnN0cmluZywgbG9jYXRpb25zVG9DaGVjazpBcnJheTxzdHJpbmc+XG4gICAgKTpib29sZWFuIHtcbiAgICAgICAgZm9yIChjb25zdCBwYXRoVG9DaGVjazpzdHJpbmcgb2YgbG9jYXRpb25zVG9DaGVjaylcbiAgICAgICAgICAgIGlmIChwYXRoLnJlc29sdmUoZmlsZVBhdGgpLnN0YXJ0c1dpdGgocGF0aC5yZXNvbHZlKHBhdGhUb0NoZWNrKSkpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuICAgIC8vIGVuZHJlZ2lvblxuICAgIC8vIHJlZ2lvbiBzdHJpbmdcbiAgICAvKipcbiAgICAgKiBJbiBwbGFjZXMgZWFjaCBtYXRjaGluZyBjYXNjYWRpbmcgc3R5bGUgc2hlZXQgb3IgamF2YVNjcmlwdCBmaWxlXG4gICAgICogcmVmZXJlbmNlLlxuICAgICAqIEBwYXJhbSBjb250ZW50IC0gTWFya3VwIGNvbnRlbnQgdG8gcHJvY2Vzcy5cbiAgICAgKiBAcGFyYW0gY2FzY2FkaW5nU3R5bGVTaGVldFBhdHRlcm4gLSBQYXR0ZXJuIHRvIG1hdGNoIGNhc2NhZGluZyBzdHlsZVxuICAgICAqIHNoZWV0IGFzc2V0IHJlZmVyZW5jZXMgYWdhaW4uXG4gICAgICogQHBhcmFtIGphdmFTY3JpcHRQYXR0ZXJuIC0gUGF0dGVybiB0byBtYXRjaCBqYXZhU2NyaXB0IGFzc2V0IHJlZmVyZW5jZXNcbiAgICAgKiBhZ2Fpbi5cbiAgICAgKiBAcGFyYW0gYmFzZVBhdGggLSBCYXNlIHBhdGggdG8gdXNlIGFzIHByZWZpeCBmb3IgZmlsZSByZWZlcmVuY2VzLlxuICAgICAqIEBwYXJhbSBjYXNjYWRpbmdTdHlsZVNoZWV0Q2h1bmtOYW1lVGVtcGxhdGUgLSBDYXNjYWRpbmcgc3R5bGUgc2hlZXRcbiAgICAgKiBjaHVuayBuYW1lIHRlbXBsYXRlIHRvIHVzZSBmb3IgYXNzZXQgbWF0Y2hpbmcuXG4gICAgICogQHBhcmFtIGphdmFTY3JpcHRDaHVua05hbWVUZW1wbGF0ZSAtIEphdmFTY3JpcHQgY2h1bmsgbmFtZSB0ZW1wbGF0ZSB0b1xuICAgICAqIHVzZSBmb3IgYXNzZXQgbWF0Y2hpbmcuXG4gICAgICogQHBhcmFtIGFzc2V0cyAtIE1hcHBpbmcgb2YgYXNzZXQgZmlsZSBwYXRocyB0byB0aGVpciBjb250ZW50LlxuICAgICAqIEByZXR1cm5zIEdpdmVuIGFuIHRyYW5zZm9ybWVkIG1hcmt1cC5cbiAgICAgKi9cbiAgICBzdGF0aWMgaW5QbGFjZUNTU0FuZEphdmFTY3JpcHRBc3NldFJlZmVyZW5jZXMoXG4gICAgICAgIGNvbnRlbnQ6c3RyaW5nLFxuICAgICAgICBjYXNjYWRpbmdTdHlsZVNoZWV0UGF0dGVybjo/e1trZXk6c3RyaW5nXTonYm9keSd8J2hlYWQnfCdpbid9LFxuICAgICAgICBqYXZhU2NyaXB0UGF0dGVybjo/e1trZXk6c3RyaW5nXTonYm9keSd8J2hlYWQnfCdpbid9LCBiYXNlUGF0aDpzdHJpbmcsXG4gICAgICAgIGNhc2NhZGluZ1N0eWxlU2hlZXRDaHVua05hbWVUZW1wbGF0ZTpzdHJpbmcsXG4gICAgICAgIGphdmFTY3JpcHRDaHVua05hbWVUZW1wbGF0ZTpzdHJpbmcsIGFzc2V0czp7W2tleTpzdHJpbmddOk9iamVjdH1cbiAgICApOlByb21pc2U8e2NvbnRlbnQ6c3RyaW5nO2ZpbGVQYXRoc1RvUmVtb3ZlOkFycmF5PHN0cmluZz47fT4ge1xuICAgICAgICAvKlxuICAgICAgICAgICAgTk9URTogV2UgaGF2ZSB0byB0cmFuc2xhdGUgdGVtcGxhdGUgZGVsaW1pdGVyIHRvIGh0bWwgY29tcGF0aWJsZVxuICAgICAgICAgICAgc2VxdWVuY2VzIGFuZCB0cmFuc2xhdGUgaXQgYmFjayBsYXRlciB0byBhdm9pZCB1bmV4cGVjdGVkIGVzY2FwZVxuICAgICAgICAgICAgc2VxdWVuY2VzIGluIHJlc3VsdGluZyBodG1sLlxuICAgICAgICAqL1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKFxuICAgICAgICAgICAgcmVzb2x2ZTpGdW5jdGlvbiwgcmVqZWN0OkZ1bmN0aW9uXG4gICAgICAgICk6dm9pZCA9PiBkb20uZW52KGNvbnRlbnQucmVwbGFjZSgvPCUvZywgJyMjKyMrIysjIycpLnJlcGxhY2UoXG4gICAgICAgICAgICAvJT4vZywgJyMjLSMtIy0jIydcbiAgICAgICAgKSwgKGVycm9yOj9FcnJvciwgd2luZG93Ok9iamVjdCk6dm9pZCA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyb3IpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdChlcnJvcilcbiAgICAgICAgICAgIGNvbnN0IGZpbGVQYXRoc1RvUmVtb3ZlOkFycmF5PHN0cmluZz4gPSBbXVxuICAgICAgICAgICAgaWYgKGNhc2NhZGluZ1N0eWxlU2hlZXRQYXR0ZXJuKVxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcGF0dGVybjpzdHJpbmcgaW4gY2FzY2FkaW5nU3R5bGVTaGVldFBhdHRlcm4pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjYXNjYWRpbmdTdHlsZVNoZWV0UGF0dGVybi5oYXNPd25Qcm9wZXJ0eShwYXR0ZXJuKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgICAgICAgICAgICAgIGxldCBzZWxlY3RvcjpzdHJpbmcgPSAnW2hyZWYqPVwiLmNzc1wiXSdcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhdHRlcm4gIT09ICcqJylcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yID0gJ1tocmVmPVwiJyArIHBhdGgucmVsYXRpdmUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZVBhdGgsIEhlbHBlci5yZW5kZXJGaWxlUGF0aFRlbXBsYXRlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNjYWRpbmdTdHlsZVNoZWV0Q2h1bmtOYW1lVGVtcGxhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdbY29udGVudGhhc2hdJzogJycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnW2lkXSc6IHBhdHRlcm4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnW25hbWVdJzogcGF0dGVyblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKSkgKyAnXCJdJ1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkb21Ob2RlczpBcnJheTxEb21Ob2RlPiA9XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgbGluayR7c2VsZWN0b3J9YClcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRvbU5vZGVzLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZG9tTm9kZTpEb21Ob2RlIG9mIGRvbU5vZGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5QbGFjZURvbU5vZGU6RG9tTm9kZSA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGF0aDpzdHJpbmcgPSBkb21Ob2RlLmF0dHJpYnV0ZXMuaHJlZi52YWx1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvJi4qL2csICcnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluUGxhY2VEb21Ob2RlLnRleHRDb250ZW50ID0gYXNzZXRzW3BhdGhdLnNvdXJjZSgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhc2NhZGluZ1N0eWxlU2hlZXRQYXR0ZXJuW3BhdHRlcm5dID09PSAnYm9keScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5QbGFjZURvbU5vZGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoY2FzY2FkaW5nU3R5bGVTaGVldFBhdHRlcm5bXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdHRlcm5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdID09PSAnaW4nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb21Ob2RlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5QbGFjZURvbU5vZGUsIGRvbU5vZGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoY2FzY2FkaW5nU3R5bGVTaGVldFBhdHRlcm5bXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdHRlcm5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdID09PSAnaGVhZCcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5kb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5QbGFjZURvbU5vZGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9tTm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGRvbU5vZGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTk9URTogVGhpcyBkb2Vzbid0IHByZXZlbnQgd2VicGFjayBmcm9tXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0aW5nIHRoaXMgZmlsZSBpZiBwcmVzZW50IGluIGFub3RoZXIgY2h1bmtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc28gcmVtb3ZpbmcgaXQgKGFuZCBhIHBvdGVudGlhbCBzb3VyY2UgbWFwXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUpIGxhdGVyIGluIHRoZSBcImRvbmVcIiBob29rLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVBhdGhzVG9SZW1vdmUucHVzaChIZWxwZXIuc3RyaXBMb2FkZXIocGF0aCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGFzc2V0c1twYXRoXVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ05vIHJlZmVyZW5jZWQgY2FzY2FkaW5nIHN0eWxlIHNoZWV0IGZpbGUgaW4gJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Jlc3VsdGluZyBtYXJrdXAgZm91bmQgd2l0aCBzZWxlY3RvcjogbGluaycgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChqYXZhU2NyaXB0UGF0dGVybilcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHBhdHRlcm46c3RyaW5nIGluIGphdmFTY3JpcHRQYXR0ZXJuKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghamF2YVNjcmlwdFBhdHRlcm4uaGFzT3duUHJvcGVydHkocGF0dGVybikpXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZVxuICAgICAgICAgICAgICAgICAgICBsZXQgc2VsZWN0b3I6c3RyaW5nID0gJ1tocmVmKj1cIi5qc1wiXSdcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhdHRlcm4gIT09ICcqJylcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yID0gJ1tzcmNePVwiJyArIHBhdGgucmVsYXRpdmUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZVBhdGgsIEhlbHBlci5yZW5kZXJGaWxlUGF0aFRlbXBsYXRlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqYXZhU2NyaXB0Q2h1bmtOYW1lVGVtcGxhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdbaGFzaF0nOiAnJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdbaWRdJzogcGF0dGVybixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdbbmFtZV0nOiBwYXR0ZXJuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApICsgJ1wiXScpXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRvbU5vZGVzOkFycmF5PERvbU5vZGU+ID1cbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGBzY3JpcHQke3NlbGVjdG9yfWApXG4gICAgICAgICAgICAgICAgICAgIGlmIChkb21Ob2Rlcy5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGRvbU5vZGU6RG9tTm9kZSBvZiBkb21Ob2Rlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluUGxhY2VEb21Ob2RlOkRvbU5vZGUgPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0JylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXRoOnN0cmluZyA9IGRvbU5vZGUuYXR0cmlidXRlcy5zcmMudmFsdWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLyYuKi9nLCAnJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpblBsYWNlRG9tTm9kZS50ZXh0Q29udGVudCA9IGFzc2V0c1twYXRoXS5zb3VyY2UoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqYXZhU2NyaXB0UGF0dGVybltwYXR0ZXJuXSA9PT0gJ2JvZHknKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluUGxhY2VEb21Ob2RlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGphdmFTY3JpcHRQYXR0ZXJuW3BhdHRlcm5dID09PSAnaW4nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb21Ob2RlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5QbGFjZURvbU5vZGUsIGRvbU5vZGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoamF2YVNjcmlwdFBhdHRlcm5bcGF0dGVybl0gPT09ICdoZWFkJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpblBsYWNlRG9tTm9kZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb21Ob2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZG9tTm9kZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOT1RFOiBUaGlzIGRvZXNuJ3QgcHJldmVudCB3ZWJwYWNrIGZyb21cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRpbmcgdGhpcyBmaWxlIGlmIHByZXNlbnQgaW4gYW5vdGhlciBjaHVua1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbyByZW1vdmluZyBpdCAoYW5kIGEgcG90ZW50aWFsIHNvdXJjZSBtYXBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZSkgbGF0ZXIgaW4gdGhlIFwiZG9uZVwiIGhvb2suXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlUGF0aHNUb1JlbW92ZS5wdXNoKEhlbHBlci5zdHJpcExvYWRlcihwYXRoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgYXNzZXRzW3BhdGhdXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnTm8gcmVmZXJlbmNlZCBqYXZhU2NyaXB0IGZpbGUgaW4gcmVzdWx0aW5nICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBtYXJrdXAgZm91bmQgd2l0aCBzZWxlY3Rvcjogc2NyaXB0JHtzZWxlY3Rvcn1gKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc29sdmUoe1xuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGNvbnRlbnQucmVwbGFjZShcbiAgICAgICAgICAgICAgICAgICAgL14oXFxzKjwhZG9jdHlwZSBbXj5dKz8+XFxzKilbXFxzXFxTXSokL2ksICckMSdcbiAgICAgICAgICAgICAgICApICsgd2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vdXRlckhUTUwucmVwbGFjZShcbiAgICAgICAgICAgICAgICAgICAgLyMjXFwrI1xcKyNcXCsjIy9nLCAnPCUnXG4gICAgICAgICAgICAgICAgKS5yZXBsYWNlKC8jIy0jLSMtIyMvZywgJyU+JyksXG4gICAgICAgICAgICAgICAgZmlsZVBhdGhzVG9SZW1vdmVcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pKVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBTdHJpcHMgbG9hZGVyIGluZm9ybWF0aW9ucyBmb3JtIGdpdmVuIG1vZHVsZSByZXF1ZXN0IGluY2x1ZGluZyBsb2FkZXJcbiAgICAgKiBwcmVmaXggYW5kIHF1ZXJ5IHBhcmFtZXRlci5cbiAgICAgKiBAcGFyYW0gbW9kdWxlSUQgLSBNb2R1bGUgcmVxdWVzdCB0byBzdHJpcC5cbiAgICAgKiBAcmV0dXJucyBHaXZlbiBtb2R1bGUgaWQgc3RyaXBwZWQuXG4gICAgICovXG4gICAgc3RhdGljIHN0cmlwTG9hZGVyKG1vZHVsZUlEOnN0cmluZ3xTdHJpbmcpOnN0cmluZyB7XG4gICAgICAgIG1vZHVsZUlEID0gbW9kdWxlSUQudG9TdHJpbmcoKVxuICAgICAgICBjb25zdCBtb2R1bGVJRFdpdGhvdXRMb2FkZXI6c3RyaW5nID0gbW9kdWxlSUQuc3Vic3RyaW5nKFxuICAgICAgICAgICAgbW9kdWxlSUQubGFzdEluZGV4T2YoJyEnKSArIDEpXG4gICAgICAgIHJldHVybiBtb2R1bGVJRFdpdGhvdXRMb2FkZXIuaW5jbHVkZXMoXG4gICAgICAgICAgICAnPydcbiAgICAgICAgKSA/IG1vZHVsZUlEV2l0aG91dExvYWRlci5zdWJzdHJpbmcoMCwgbW9kdWxlSURXaXRob3V0TG9hZGVyLmluZGV4T2YoXG4gICAgICAgICAgICAnPydcbiAgICAgICAgKSkgOiBtb2R1bGVJRFdpdGhvdXRMb2FkZXJcbiAgICB9XG4gICAgLy8gZW5kcmVnaW9uXG4gICAgLy8gcmVnaW9uIGFycmF5XG4gICAgLyoqXG4gICAgICogQ29udmVydHMgZ2l2ZW4gbGlzdCBvZiBwYXRoIHRvIGEgbm9ybWFsaXplZCBsaXN0IHdpdGggdW5pcXVlIHZhbHVlcy5cbiAgICAgKiBAcGFyYW0gcGF0aHMgLSBGaWxlIHBhdGhzLlxuICAgICAqIEByZXR1cm5zIFRoZSBnaXZlbiBmaWxlIHBhdGggbGlzdCB3aXRoIG5vcm1hbGl6ZWQgdW5pcXVlIHZhbHVlcy5cbiAgICAgKi9cbiAgICBzdGF0aWMgbm9ybWFsaXplUGF0aHMocGF0aHM6QXJyYXk8c3RyaW5nPik6QXJyYXk8c3RyaW5nPiB7XG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKG5ldyBTZXQocGF0aHMubWFwKChnaXZlblBhdGg6c3RyaW5nKTpzdHJpbmcgPT4ge1xuICAgICAgICAgICAgZ2l2ZW5QYXRoID0gcGF0aC5ub3JtYWxpemUoZ2l2ZW5QYXRoKVxuICAgICAgICAgICAgaWYgKGdpdmVuUGF0aC5lbmRzV2l0aCgnLycpKVxuICAgICAgICAgICAgICAgIHJldHVybiBnaXZlblBhdGguc3Vic3RyaW5nKDAsIGdpdmVuUGF0aC5sZW5ndGggLSAxKVxuICAgICAgICAgICAgcmV0dXJuIGdpdmVuUGF0aFxuICAgICAgICB9KSkpXG4gICAgfVxuICAgIC8vIGVuZHJlZ2lvblxuICAgIC8vIHJlZ2lvbiBmaWxlIGhhbmRsZXJcbiAgICAvKipcbiAgICAgKiBBcHBsaWVzIGZpbGUgcGF0aC9uYW1lIHBsYWNlaG9sZGVyIHJlcGxhY2VtZW50cyB3aXRoIGdpdmVuIGJ1bmRsZVxuICAgICAqIGFzc29jaWF0ZWQgaW5mb3JtYXRpb25zLlxuICAgICAqIEBwYXJhbSBmaWxlUGF0aFRlbXBsYXRlIC0gRmlsZSBwYXRoIHRvIHByb2Nlc3MgcGxhY2Vob2xkZXIgaW4uXG4gICAgICogQHBhcmFtIGluZm9ybWF0aW9ucyAtIFNjb3BlIHRvIHVzZSBmb3IgcHJvY2Vzc2luZy5cbiAgICAgKiBAcmV0dXJucyBQcm9jZXNzZWQgZmlsZSBwYXRoLlxuICAgICAqL1xuICAgIHN0YXRpYyByZW5kZXJGaWxlUGF0aFRlbXBsYXRlKFxuICAgICAgICBmaWxlUGF0aFRlbXBsYXRlOnN0cmluZywgaW5mb3JtYXRpb25zOntba2V5OnN0cmluZ106c3RyaW5nfSA9IHtcbiAgICAgICAgICAgICdbbmFtZV0nOiAnLl9fZHVtbXlfXycsICdbaWRdJzogJy5fX2R1bW15X18nLFxuICAgICAgICAgICAgJ1toYXNoXSc6ICcuX19kdW1teV9fJ1xuICAgICAgICB9XG4gICAgKTpzdHJpbmcge1xuICAgICAgICBsZXQgZmlsZVBhdGg6c3RyaW5nID0gZmlsZVBhdGhUZW1wbGF0ZVxuICAgICAgICBmb3IgKGNvbnN0IHBsYWNlaG9sZGVyTmFtZTpzdHJpbmcgaW4gaW5mb3JtYXRpb25zKVxuICAgICAgICAgICAgaWYgKGluZm9ybWF0aW9ucy5oYXNPd25Qcm9wZXJ0eShwbGFjZWhvbGRlck5hbWUpKVxuICAgICAgICAgICAgICAgIGZpbGVQYXRoID0gZmlsZVBhdGgucmVwbGFjZShuZXcgUmVnRXhwKFxuICAgICAgICAgICAgICAgICAgICBUb29scy5zdHJpbmdFc2NhcGVSZWd1bGFyRXhwcmVzc2lvbnMocGxhY2Vob2xkZXJOYW1lKSwgJ2cnXG4gICAgICAgICAgICAgICAgKSwgaW5mb3JtYXRpb25zW3BsYWNlaG9sZGVyTmFtZV0pXG4gICAgICAgIHJldHVybiBmaWxlUGF0aFxuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyBnaXZlbiByZXF1ZXN0IHRvIGEgcmVzb2x2ZWQgcmVxdWVzdCB3aXRoIGdpdmVuIGNvbnRleHRcbiAgICAgKiBlbWJlZGRlZC5cbiAgICAgKiBAcGFyYW0gcmVxdWVzdCAtIFJlcXVlc3QgdG8gZGV0ZXJtaW5lLlxuICAgICAqIEBwYXJhbSBjb250ZXh0IC0gQ29udGV4dCBvZiBnaXZlbiByZXF1ZXN0IHRvIHJlc29sdmUgcmVsYXRpdmUgdG8uXG4gICAgICogQHBhcmFtIHJlZmVyZW5jZVBhdGggLSBQYXRoIHRvIHJlc29sdmUgbG9jYWwgbW9kdWxlcyByZWxhdGl2ZSB0by5cbiAgICAgKiBAcGFyYW0gYWxpYXNlcyAtIE1hcHBpbmcgb2YgYWxpYXNlcyB0byB0YWtlIGludG8gYWNjb3VudC5cbiAgICAgKiBAcGFyYW0gbW9kdWxlUmVwbGFjZW1lbnRzIC0gTWFwcGluZyBvZiByZXBsYWNlbWVudHMgdG8gdGFrZSBpbnRvXG4gICAgICogYWNjb3VudC5cbiAgICAgKiBAcGFyYW0gcmVsYXRpdmVNb2R1bGVGaWxlUGF0aHMgLSBMaXN0IG9mIHJlbGF0aXZlIGZpbGUgcGF0aCB0byBzZWFyY2hcbiAgICAgKiBmb3IgbW9kdWxlcyBpbi5cbiAgICAgKiBAcmV0dXJucyBBIG5ldyByZXNvbHZlZCByZXF1ZXN0LlxuICAgICAqL1xuICAgIHN0YXRpYyBhcHBseUNvbnRleHQoXG4gICAgICAgIHJlcXVlc3Q6c3RyaW5nLCBjb250ZXh0OnN0cmluZyA9ICcuLycsIHJlZmVyZW5jZVBhdGg6c3RyaW5nID0gJy4vJyxcbiAgICAgICAgYWxpYXNlczpQbGFpbk9iamVjdCA9IHt9LCBtb2R1bGVSZXBsYWNlbWVudHM6UGxhaW5PYmplY3QgPSB7fSxcbiAgICAgICAgcmVsYXRpdmVNb2R1bGVGaWxlUGF0aHM6QXJyYXk8c3RyaW5nPiA9IFsnbm9kZV9tb2R1bGVzJ11cbiAgICApOnN0cmluZyB7XG4gICAgICAgIHJlZmVyZW5jZVBhdGggPSBwYXRoLnJlc29sdmUocmVmZXJlbmNlUGF0aClcbiAgICAgICAgaWYgKHJlcXVlc3Quc3RhcnRzV2l0aCgnLi8nKSAmJiBwYXRoLnJlc29sdmUoXG4gICAgICAgICAgICBjb250ZXh0XG4gICAgICAgICkgIT09IHJlZmVyZW5jZVBhdGgpIHtcbiAgICAgICAgICAgIHJlcXVlc3QgPSBwYXRoLnJlc29sdmUoY29udGV4dCwgcmVxdWVzdClcbiAgICAgICAgICAgIGZvciAoY29uc3QgbW9kdWxlUGF0aDpzdHJpbmcgb2YgcmVsYXRpdmVNb2R1bGVGaWxlUGF0aHMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwYXRoUHJlZml4OnN0cmluZyA9IHBhdGgucmVzb2x2ZShcbiAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlUGF0aCwgbW9kdWxlUGF0aClcbiAgICAgICAgICAgICAgICBpZiAocmVxdWVzdC5zdGFydHNXaXRoKHBhdGhQcmVmaXgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3QgPSByZXF1ZXN0LnN1YnN0cmluZyhwYXRoUHJlZml4Lmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcXVlc3Quc3RhcnRzV2l0aCgnLycpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdCA9IHJlcXVlc3Quc3Vic3RyaW5nKDEpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBIZWxwZXIuYXBwbHlNb2R1bGVSZXBsYWNlbWVudHMoSGVscGVyLmFwcGx5QWxpYXNlcyhcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc3Vic3RyaW5nKHJlcXVlc3QubGFzdEluZGV4T2YoJyEnKSArIDEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWxpYXNlc1xuICAgICAgICAgICAgICAgICAgICApLCBtb2R1bGVSZXBsYWNlbWVudHMpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJlcXVlc3Quc3RhcnRzV2l0aChyZWZlcmVuY2VQYXRoKSkge1xuICAgICAgICAgICAgICAgIHJlcXVlc3QgPSByZXF1ZXN0LnN1YnN0cmluZyhyZWZlcmVuY2VQYXRoLmxlbmd0aClcbiAgICAgICAgICAgICAgICBpZiAocmVxdWVzdC5zdGFydHNXaXRoKCcvJykpXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3QgPSByZXF1ZXN0LnN1YnN0cmluZygxKVxuICAgICAgICAgICAgICAgIHJldHVybiBIZWxwZXIuYXBwbHlNb2R1bGVSZXBsYWNlbWVudHMoSGVscGVyLmFwcGx5QWxpYXNlcyhcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zdWJzdHJpbmcocmVxdWVzdC5sYXN0SW5kZXhPZignIScpICsgMSksIGFsaWFzZXNcbiAgICAgICAgICAgICAgICApLCBtb2R1bGVSZXBsYWNlbWVudHMpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlcXVlc3RcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2hlY2sgaWYgZ2l2ZW4gcmVxdWVzdCBwb2ludHMgdG8gYW4gZXh0ZXJuYWwgZGVwZW5kZW5jeSBub3QgbWFpbnRhaW5lZFxuICAgICAqIGJ5IGN1cnJlbnQgcGFja2FnZSBjb250ZXh0LlxuICAgICAqIEBwYXJhbSByZXF1ZXN0IC0gUmVxdWVzdCB0byBkZXRlcm1pbmUuXG4gICAgICogQHBhcmFtIGNvbnRleHQgLSBDb250ZXh0IG9mIGN1cnJlbnQgcHJvamVjdC5cbiAgICAgKiBAcGFyYW0gcmVxdWVzdENvbnRleHQgLSBDb250ZXh0IG9mIGdpdmVuIHJlcXVlc3QgdG8gcmVzb2x2ZSByZWxhdGl2ZSB0by5cbiAgICAgKiBAcGFyYW0gbm9ybWFsaXplZEludGVybmFsSW5qZWN0aW9uIC0gTWFwcGluZyBvZiBjaHVuayBuYW1lcyB0byBtb2R1bGVzXG4gICAgICogd2hpY2ggc2hvdWxkIGJlIGluamVjdGVkLlxuICAgICAqIEBwYXJhbSBleHRlcm5hbE1vZHVsZUxvY2F0aW9ucyAtIEFycmF5IGlmIHBhdGhzIHdoZXJlIGV4dGVybmFsIG1vZHVsZXNcbiAgICAgKiB0YWtlIHBsYWNlLlxuICAgICAqIEBwYXJhbSBhbGlhc2VzIC0gTWFwcGluZyBvZiBhbGlhc2VzIHRvIHRha2UgaW50byBhY2NvdW50LlxuICAgICAqIEBwYXJhbSBtb2R1bGVSZXBsYWNlbWVudHMgLSBNYXBwaW5nIG9mIHJlcGxhY2VtZW50cyB0byB0YWtlIGludG9cbiAgICAgKiBhY2NvdW50LlxuICAgICAqIEBwYXJhbSBleHRlbnNpb25zIC0gTGlzdCBvZiBmaWxlIGFuZCBtb2R1bGUgZXh0ZW5zaW9ucyB0byB0YWtlIGludG9cbiAgICAgKiBhY2NvdW50LlxuICAgICAqIEBwYXJhbSByZWZlcmVuY2VQYXRoIC0gUGF0aCB0byByZXNvbHZlIGxvY2FsIG1vZHVsZXMgcmVsYXRpdmUgdG8uXG4gICAgICogQHBhcmFtIHBhdGhzVG9JZ25vcmUgLSBQYXRocyB3aGljaCBtYXJrcyBsb2NhdGlvbiB0byBpZ25vcmUuXG4gICAgICogQHBhcmFtIHJlbGF0aXZlTW9kdWxlRmlsZVBhdGhzIC0gTGlzdCBvZiByZWxhdGl2ZSBmaWxlIHBhdGggdG8gc2VhcmNoXG4gICAgICogZm9yIG1vZHVsZXMgaW4uXG4gICAgICogQHBhcmFtIHBhY2thZ2VFbnRyeUZpbGVOYW1lcyAtIExpc3Qgb2YgcGFja2FnZSBlbnRyeSBmaWxlIG5hbWVzIHRvXG4gICAgICogc2VhcmNoIGZvci4gVGhlIG1hZ2ljIG5hbWUgXCJfX3BhY2thZ2VfX1wiIHdpbGwgc2VhcmNoIGZvciBhbiBhcHByZWNpYXRlXG4gICAgICogZW50cnkgaW4gYSBcInBhY2thZ2UuanNvblwiIGZpbGUuXG4gICAgICogQHBhcmFtIHBhY2thZ2VNYWluUHJvcGVydHlOYW1lcyAtIExpc3Qgb2YgcGFja2FnZSBmaWxlIG1haW4gcHJvcGVydHlcbiAgICAgKiBuYW1lcyB0byBzZWFyY2ggZm9yIHBhY2thZ2UgcmVwcmVzZW50aW5nIGVudHJ5IG1vZHVsZSBkZWZpbml0aW9ucy5cbiAgICAgKiBAcGFyYW0gcGFja2FnZUFsaWFzUHJvcGVydHlOYW1lcyAtIExpc3Qgb2YgcGFja2FnZSBmaWxlIGFsaWFzIHByb3BlcnR5XG4gICAgICogbmFtZXMgdG8gc2VhcmNoIGZvciBwYWNrYWdlIHNwZWNpZmljIG1vZHVsZSBhbGlhc2VzLlxuICAgICAqIEBwYXJhbSBpbmNsdWRlUGF0dGVybiAtIEFycmF5IG9mIHJlZ3VsYXIgZXhwcmVzc2lvbnMgdG8gZXhwbGljaXRseSBtYXJrXG4gICAgICogYXMgZXh0ZXJuYWwgZGVwZW5kZW5jeS5cbiAgICAgKiBAcGFyYW0gZXhjbHVkZVBhdHRlcm4gLSBBcnJheSBvZiByZWd1bGFyIGV4cHJlc3Npb25zIHRvIGV4cGxpY2l0bHkgbWFya1xuICAgICAqIGFzIGludGVybmFsIGRlcGVuZGVuY3kuXG4gICAgICogQHBhcmFtIGluUGxhY2VOb3JtYWxMaWJyYXJ5IC0gSW5kaWNhdGVzIHdoZXRoZXIgbm9ybWFsIGxpYnJhcmllcyBzaG91bGRcbiAgICAgKiBiZSBleHRlcm5hbCBvciBub3QuXG4gICAgICogQHBhcmFtIGluUGxhY2VEeW5hbWljTGlicmFyeSAtIEluZGljYXRlcyB3aGV0aGVyIHJlcXVlc3RzIHdpdGhcbiAgICAgKiBpbnRlZ3JhdGVkIGxvYWRlciBjb25maWd1cmF0aW9ucyBzaG91bGQgYmUgbWFya2VkIGFzIGV4dGVybmFsIG9yIG5vdC5cbiAgICAgKiBAcGFyYW0gZW5jb2RpbmcgLSBFbmNvZGluZyBmb3IgZmlsZSBuYW1lcyB0byB1c2UgZHVyaW5nIGZpbGUgdHJhdmVyc2luZy5cbiAgICAgKiBAcmV0dXJucyBBIG5ldyByZXNvbHZlZCByZXF1ZXN0IGluZGljYXRpbmcgd2hldGhlciBnaXZlbiByZXF1ZXN0IGlzIGFuXG4gICAgICogZXh0ZXJuYWwgb25lLlxuICAgICAqL1xuICAgIHN0YXRpYyBkZXRlcm1pbmVFeHRlcm5hbFJlcXVlc3QoXG4gICAgICAgIHJlcXVlc3Q6c3RyaW5nLCBjb250ZXh0OnN0cmluZyA9ICcuLycsIHJlcXVlc3RDb250ZXh0OnN0cmluZyA9ICcuLycsXG4gICAgICAgIG5vcm1hbGl6ZWRJbnRlcm5hbEluamVjdGlvbjpOb3JtYWxpemVkSW50ZXJuYWxJbmplY3Rpb24gPSB7fSxcbiAgICAgICAgZXh0ZXJuYWxNb2R1bGVMb2NhdGlvbnM6QXJyYXk8c3RyaW5nPiA9IFsnbm9kZV9tb2R1bGVzJ10sXG4gICAgICAgIGFsaWFzZXM6UGxhaW5PYmplY3QgPSB7fSwgbW9kdWxlUmVwbGFjZW1lbnRzOlBsYWluT2JqZWN0ID0ge30sXG4gICAgICAgIGV4dGVuc2lvbnM6RXh0ZW5zaW9ucyA9IHtcbiAgICAgICAgICAgIGZpbGU6IHtcbiAgICAgICAgICAgICAgICBleHRlcm5hbDogWycuanMnXSxcbiAgICAgICAgICAgICAgICBpbnRlcm5hbDogW1xuICAgICAgICAgICAgICAgICAgICAnLmpzJywgJy5qc29uJywgJy5jc3MnLCAnLmVvdCcsICcuZ2lmJywgJy5odG1sJywgJy5pY28nLFxuICAgICAgICAgICAgICAgICAgICAnLmpwZycsICcucG5nJywgJy5lanMnLCAnLnN2ZycsICcudHRmJywgJy53b2ZmJywgJy53b2ZmMidcbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9LCBtb2R1bGU6IFtdXG4gICAgICAgIH0sIHJlZmVyZW5jZVBhdGg6c3RyaW5nID0gJy4vJywgcGF0aHNUb0lnbm9yZTpBcnJheTxzdHJpbmc+ID0gWycuZ2l0J10sXG4gICAgICAgIHJlbGF0aXZlTW9kdWxlRmlsZVBhdGhzOkFycmF5PHN0cmluZz4gPSBbJ25vZGVfbW9kdWxlcyddLFxuICAgICAgICBwYWNrYWdlRW50cnlGaWxlTmFtZXM6QXJyYXk8c3RyaW5nPiA9IFsnaW5kZXgnLCAnbWFpbiddLFxuICAgICAgICBwYWNrYWdlTWFpblByb3BlcnR5TmFtZXM6QXJyYXk8c3RyaW5nPiA9IFsnbWFpbicsICdtb2R1bGUnXSxcbiAgICAgICAgcGFja2FnZUFsaWFzUHJvcGVydHlOYW1lczpBcnJheTxzdHJpbmc+ID0gW10sXG4gICAgICAgIGluY2x1ZGVQYXR0ZXJuOkFycmF5PHN0cmluZ3xSZWdFeHA+ID0gW10sXG4gICAgICAgIGV4Y2x1ZGVQYXR0ZXJuOkFycmF5PHN0cmluZ3xSZWdFeHA+ID0gW10sXG4gICAgICAgIGluUGxhY2VOb3JtYWxMaWJyYXJ5OmJvb2xlYW4gPSBmYWxzZSxcbiAgICAgICAgaW5QbGFjZUR5bmFtaWNMaWJyYXJ5OmJvb2xlYW4gPSB0cnVlLFxuICAgICAgICBlbmNvZGluZzpzdHJpbmcgPSAndXRmLTgnXG4gICAgKTo/c3RyaW5nIHtcbiAgICAgICAgY29udGV4dCA9IHBhdGgucmVzb2x2ZShjb250ZXh0KVxuICAgICAgICByZXF1ZXN0Q29udGV4dCA9IHBhdGgucmVzb2x2ZShyZXF1ZXN0Q29udGV4dClcbiAgICAgICAgcmVmZXJlbmNlUGF0aCA9IHBhdGgucmVzb2x2ZShyZWZlcmVuY2VQYXRoKVxuICAgICAgICAvLyBOT1RFOiBXZSBhcHBseSBhbGlhcyBvbiBleHRlcm5hbHMgYWRkaXRpb25hbGx5LlxuICAgICAgICBsZXQgcmVzb2x2ZWRSZXF1ZXN0OnN0cmluZyA9IEhlbHBlci5hcHBseU1vZHVsZVJlcGxhY2VtZW50cyhcbiAgICAgICAgICAgIEhlbHBlci5hcHBseUFsaWFzZXMocmVxdWVzdC5zdWJzdHJpbmcoXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5sYXN0SW5kZXhPZignIScpICsgMVxuICAgICAgICAgICAgKSwgYWxpYXNlcyksIG1vZHVsZVJlcGxhY2VtZW50cylcbiAgICAgICAgLypcbiAgICAgICAgICAgIE5PVEU6IEFsaWFzZXMgYW5kIG1vZHVsZSByZXBsYWNlbWVudHMgZG9lc24ndCBoYXZlIHRvIGJlIGZvcndhcmRlZFxuICAgICAgICAgICAgc2luY2Ugd2UgcGFzcyBhbiBhbHJlYWR5IHJlc29sdmVkIHJlcXVlc3QuXG4gICAgICAgICovXG4gICAgICAgIGxldCBmaWxlUGF0aDo/c3RyaW5nID0gSGVscGVyLmRldGVybWluZU1vZHVsZUZpbGVQYXRoKFxuICAgICAgICAgICAgcmVzb2x2ZWRSZXF1ZXN0LCB7fSwge30sIGV4dGVuc2lvbnMsIGNvbnRleHQsIHJlcXVlc3RDb250ZXh0LFxuICAgICAgICAgICAgcGF0aHNUb0lnbm9yZSwgcmVsYXRpdmVNb2R1bGVGaWxlUGF0aHMsIHBhY2thZ2VFbnRyeUZpbGVOYW1lcyxcbiAgICAgICAgICAgIHBhY2thZ2VNYWluUHJvcGVydHlOYW1lcywgcGFja2FnZUFsaWFzUHJvcGVydHlOYW1lcywgZW5jb2RpbmcpXG4gICAgICAgIC8qXG4gICAgICAgICAgICBOT1RFOiBXZSBtYXJrIGRlcGVuZGVuY2llcyBhcyBleHRlcm5hbCBpZiB0aGVyZSBmaWxlIGNvdWxkbid0IGJlXG4gICAgICAgICAgICByZXNvbHZlZCBvciBhcmUgc3BlY2lmaWVkIHRvIGJlIGV4dGVybmFsIGV4cGxpY2l0bHkuXG4gICAgICAgICovXG4gICAgICAgIGlmICghKGZpbGVQYXRoIHx8IGluUGxhY2VOb3JtYWxMaWJyYXJ5KSB8fCBUb29scy5pc0FueU1hdGNoaW5nKFxuICAgICAgICAgICAgcmVzb2x2ZWRSZXF1ZXN0LCBpbmNsdWRlUGF0dGVyblxuICAgICAgICApKVxuICAgICAgICAgICAgcmV0dXJuIEhlbHBlci5hcHBseUNvbnRleHQoXG4gICAgICAgICAgICAgICAgcmVzb2x2ZWRSZXF1ZXN0LCByZXF1ZXN0Q29udGV4dCwgcmVmZXJlbmNlUGF0aCxcbiAgICAgICAgICAgICAgICBhbGlhc2VzLCBtb2R1bGVSZXBsYWNlbWVudHMsIHJlbGF0aXZlTW9kdWxlRmlsZVBhdGhzKVxuICAgICAgICBpZiAoVG9vbHMuaXNBbnlNYXRjaGluZyhyZXNvbHZlZFJlcXVlc3QsIGV4Y2x1ZGVQYXR0ZXJuKSlcbiAgICAgICAgICAgIHJldHVybiBudWxsXG4gICAgICAgIGZvciAoY29uc3QgY2h1bmtOYW1lOnN0cmluZyBpbiBub3JtYWxpemVkSW50ZXJuYWxJbmplY3Rpb24pXG4gICAgICAgICAgICBpZiAobm9ybWFsaXplZEludGVybmFsSW5qZWN0aW9uLmhhc093blByb3BlcnR5KGNodW5rTmFtZSkpXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBtb2R1bGVJRDpzdHJpbmcgb2Ygbm9ybWFsaXplZEludGVybmFsSW5qZWN0aW9uW1xuICAgICAgICAgICAgICAgICAgICBjaHVua05hbWVcbiAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgICAgICBpZiAoSGVscGVyLmRldGVybWluZU1vZHVsZUZpbGVQYXRoKFxuICAgICAgICAgICAgICAgICAgICAgICAgbW9kdWxlSUQsIGFsaWFzZXMsIG1vZHVsZVJlcGxhY2VtZW50cywgZXh0ZW5zaW9ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQsIHJlcXVlc3RDb250ZXh0LCBwYXRoc1RvSWdub3JlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRpdmVNb2R1bGVGaWxlUGF0aHMsIHBhY2thZ2VFbnRyeUZpbGVOYW1lcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhY2thZ2VNYWluUHJvcGVydHlOYW1lcywgcGFja2FnZUFsaWFzUHJvcGVydHlOYW1lcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kaW5nXG4gICAgICAgICAgICAgICAgICAgICkgPT09IGZpbGVQYXRoKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgICAgLypcbiAgICAgICAgICAgIE5PVEU6IFdlIG1hcmsgZGVwZW5kZW5jaWVzIGFzIGV4dGVybmFsIGlmIHRoZXkgZG9lcyBub3QgY29udGFpbiBhXG4gICAgICAgICAgICBsb2FkZXIgaW4gdGhlaXIgcmVxdWVzdCBhbmQgYXJlbid0IHBhcnQgb2YgdGhlIGN1cnJlbnQgbWFpbiBwYWNrYWdlXG4gICAgICAgICAgICBvciBoYXZlIGEgZmlsZSBleHRlbnNpb24gb3RoZXIgdGhhbiBqYXZhU2NyaXB0IGF3YXJlLlxuICAgICAgICAqL1xuICAgICAgICBpZiAoIWluUGxhY2VOb3JtYWxMaWJyYXJ5ICYmIChcbiAgICAgICAgICAgIGV4dGVuc2lvbnMuZmlsZS5leHRlcm5hbC5sZW5ndGggPT09IDAgfHwgZmlsZVBhdGggJiZcbiAgICAgICAgICAgIGV4dGVuc2lvbnMuZmlsZS5leHRlcm5hbC5pbmNsdWRlcyhwYXRoLmV4dG5hbWUoZmlsZVBhdGgpKSB8fFxuICAgICAgICAgICAgIWZpbGVQYXRoICYmIGV4dGVuc2lvbnMuZmlsZS5leHRlcm5hbC5pbmNsdWRlcygnJylcbiAgICAgICAgKSAmJiAhKGluUGxhY2VEeW5hbWljTGlicmFyeSAmJiByZXF1ZXN0LmluY2x1ZGVzKCchJykpICYmIChcbiAgICAgICAgICAgICFmaWxlUGF0aCAmJiBpblBsYWNlRHluYW1pY0xpYnJhcnkgfHwgZmlsZVBhdGggJiYgKFxuICAgICAgICAgICAgIWZpbGVQYXRoLnN0YXJ0c1dpdGgoY29udGV4dCkgfHwgSGVscGVyLmlzRmlsZVBhdGhJbkxvY2F0aW9uKFxuICAgICAgICAgICAgICAgIGZpbGVQYXRoLCBleHRlcm5hbE1vZHVsZUxvY2F0aW9ucykpXG4gICAgICAgICkpXG4gICAgICAgICAgICByZXR1cm4gSGVscGVyLmFwcGx5Q29udGV4dChcbiAgICAgICAgICAgICAgICByZXNvbHZlZFJlcXVlc3QsIHJlcXVlc3RDb250ZXh0LCByZWZlcmVuY2VQYXRoLCBhbGlhc2VzLFxuICAgICAgICAgICAgICAgIG1vZHVsZVJlcGxhY2VtZW50cywgcmVsYXRpdmVNb2R1bGVGaWxlUGF0aHMpXG4gICAgICAgIHJldHVybiBudWxsXG4gICAgfVxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgYXNzZXQgdHlwZSBvZiBnaXZlbiBmaWxlLlxuICAgICAqIEBwYXJhbSBmaWxlUGF0aCAtIFBhdGggdG8gZmlsZSB0byBhbmFseXNlLlxuICAgICAqIEBwYXJhbSBidWlsZENvbmZpZ3VyYXRpb24gLSBNZXRhIGluZm9ybWF0aW9ucyBmb3IgYXZhaWxhYmxlIGFzc2V0XG4gICAgICogdHlwZXMuXG4gICAgICogQHBhcmFtIHBhdGhzIC0gTGlzdCBvZiBwYXRocyB0byBzZWFyY2ggaWYgZ2l2ZW4gcGF0aCBkb2Vzbid0IHJlZmVyZW5jZVxuICAgICAqIGEgZmlsZSBkaXJlY3RseS5cbiAgICAgKiBAcmV0dXJucyBEZXRlcm1pbmVkIGZpbGUgdHlwZSBvciBcIm51bGxcIiBvZiBnaXZlbiBmaWxlIGNvdWxkbid0IGJlXG4gICAgICogZGV0ZXJtaW5lZC5cbiAgICAgKi9cbiAgICBzdGF0aWMgZGV0ZXJtaW5lQXNzZXRUeXBlKFxuICAgICAgICBmaWxlUGF0aDpzdHJpbmcsIGJ1aWxkQ29uZmlndXJhdGlvbjpCdWlsZENvbmZpZ3VyYXRpb24sIHBhdGhzOlBhdGhcbiAgICApOj9zdHJpbmcge1xuICAgICAgICBsZXQgcmVzdWx0Oj9zdHJpbmcgPSBudWxsXG4gICAgICAgIGZvciAoY29uc3QgdHlwZTpzdHJpbmcgaW4gYnVpbGRDb25maWd1cmF0aW9uKVxuICAgICAgICAgICAgaWYgKHBhdGguZXh0bmFtZShcbiAgICAgICAgICAgICAgICBmaWxlUGF0aFxuICAgICAgICAgICAgKSA9PT0gYC4ke2J1aWxkQ29uZmlndXJhdGlvblt0eXBlXS5leHRlbnNpb259YCkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHR5cGVcbiAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgfVxuICAgICAgICBpZiAoIXJlc3VsdClcbiAgICAgICAgICAgIGZvciAoY29uc3QgdHlwZTpzdHJpbmcgb2YgWydzb3VyY2UnLCAndGFyZ2V0J10pXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBhc3NldFR5cGU6c3RyaW5nIGluIHBhdGhzW3R5cGVdLmFzc2V0KVxuICAgICAgICAgICAgICAgICAgICBpZiAocGF0aHNbdHlwZV0uYXNzZXQuaGFzT3duUHJvcGVydHkoXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NldFR5cGVcbiAgICAgICAgICAgICAgICAgICAgKSAmJiBhc3NldFR5cGUgIT09ICdiYXNlJyAmJlxuICAgICAgICAgICAgICAgICAgICBwYXRoc1t0eXBlXS5hc3NldFthc3NldFR5cGVdICYmIGZpbGVQYXRoLnN0YXJ0c1dpdGgoXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXRoc1t0eXBlXS5hc3NldFthc3NldFR5cGVdXG4gICAgICAgICAgICAgICAgICAgICkpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXNzZXRUeXBlXG4gICAgICAgIHJldHVybiByZXN1bHRcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyBhIHByb3BlcnR5IHdpdGggYSBzdG9yZWQgYXJyYXkgb2YgYWxsIG1hdGNoaW5nIGZpbGUgcGF0aHMsIHdoaWNoXG4gICAgICogbWF0Y2hlcyBlYWNoIGJ1aWxkIGNvbmZpZ3VyYXRpb24gaW4gZ2l2ZW4gZW50cnkgcGF0aCBhbmQgY29udmVydHMgZ2l2ZW5cbiAgICAgKiBidWlsZCBjb25maWd1cmF0aW9uIGludG8gYSBzb3J0ZWQgYXJyYXkgd2VyZSBqYXZhU2NyaXB0IGZpbGVzIHRha2VzXG4gICAgICogcHJlY2VkZW5jZS5cbiAgICAgKiBAcGFyYW0gY29uZmlndXJhdGlvbiAtIEdpdmVuIGJ1aWxkIGNvbmZpZ3VyYXRpb25zLlxuICAgICAqIEBwYXJhbSBlbnRyeVBhdGggLSBQYXRoIHRvIGFuYWx5c2UgbmVzdGVkIHN0cnVjdHVyZS5cbiAgICAgKiBAcGFyYW0gcGF0aHNUb0lnbm9yZSAtIFBhdGhzIHdoaWNoIG1hcmtzIGxvY2F0aW9uIHRvIGlnbm9yZS5cbiAgICAgKiBAcGFyYW0gbWFpbkZpbGVCYXNlbmFtZXMgLSBGaWxlIGJhc2VuYW1lcyB0byBzb3J0IGludG8gdGhlIGZyb250LlxuICAgICAqIEByZXR1cm5zIENvbnZlcnRlZCBidWlsZCBjb25maWd1cmF0aW9uLlxuICAgICAqL1xuICAgIHN0YXRpYyByZXNvbHZlQnVpbGRDb25maWd1cmF0aW9uRmlsZVBhdGhzKFxuICAgICAgICBjb25maWd1cmF0aW9uOkJ1aWxkQ29uZmlndXJhdGlvbiwgZW50cnlQYXRoOnN0cmluZyA9ICcuLycsXG4gICAgICAgIHBhdGhzVG9JZ25vcmU6QXJyYXk8c3RyaW5nPiA9IFsnLmdpdCddLFxuICAgICAgICBtYWluRmlsZUJhc2VuYW1lczpBcnJheTxzdHJpbmc+ID0gWydpbmRleCcsICdtYWluJ11cbiAgICApOlJlc29sdmVkQnVpbGRDb25maWd1cmF0aW9uIHtcbiAgICAgICAgY29uc3QgYnVpbGRDb25maWd1cmF0aW9uOlJlc29sdmVkQnVpbGRDb25maWd1cmF0aW9uID0gW11cbiAgICAgICAgZm9yIChjb25zdCB0eXBlOnN0cmluZyBpbiBjb25maWd1cmF0aW9uKVxuICAgICAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb24uaGFzT3duUHJvcGVydHkodHlwZSkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdJdGVtOlJlc29sdmVkQnVpbGRDb25maWd1cmF0aW9uSXRlbSA9XG4gICAgICAgICAgICAgICAgICAgIFRvb2xzLmV4dGVuZE9iamVjdCh0cnVlLCB7ZmlsZVBhdGhzOiBbXX0sIGNvbmZpZ3VyYXRpb25bXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlXSlcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGZpbGU6RmlsZSBvZiBUb29scy53YWxrRGlyZWN0b3J5UmVjdXJzaXZlbHlTeW5jKFxuICAgICAgICAgICAgICAgICAgICBlbnRyeVBhdGgsIChmaWxlOkZpbGUpOj9mYWxzZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoSGVscGVyLmlzRmlsZVBhdGhJbkxvY2F0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUucGF0aCwgcGF0aHNUb0lnbm9yZVxuICAgICAgICAgICAgICAgICAgICAgICAgKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICkpXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlLnN0YXQuaXNGaWxlKCkgJiYgcGF0aC5leHRuYW1lKFxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5wYXRoXG4gICAgICAgICAgICAgICAgICAgICkuc3Vic3RyaW5nKDEpID09PSBuZXdJdGVtLmV4dGVuc2lvbiAmJiAhKFxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFJlZ0V4cChuZXdJdGVtLmZpbGVQYXRoUGF0dGVybilcbiAgICAgICAgICAgICAgICAgICAgKS50ZXN0KGZpbGUucGF0aCkpXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdJdGVtLmZpbGVQYXRocy5wdXNoKGZpbGUucGF0aClcbiAgICAgICAgICAgICAgICBuZXdJdGVtLmZpbGVQYXRocy5zb3J0KChcbiAgICAgICAgICAgICAgICAgICAgZmlyc3RGaWxlUGF0aDpzdHJpbmcsIHNlY29uZEZpbGVQYXRoOnN0cmluZ1xuICAgICAgICAgICAgICAgICk6bnVtYmVyID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1haW5GaWxlQmFzZW5hbWVzLmluY2x1ZGVzKHBhdGguYmFzZW5hbWUoXG4gICAgICAgICAgICAgICAgICAgICAgICBmaXJzdEZpbGVQYXRoLCBwYXRoLmV4dG5hbWUoZmlyc3RGaWxlUGF0aClcbiAgICAgICAgICAgICAgICAgICAgKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYWluRmlsZUJhc2VuYW1lcy5pbmNsdWRlcyhwYXRoLmJhc2VuYW1lKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZEZpbGVQYXRoLCBwYXRoLmV4dG5hbWUoc2Vjb25kRmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICApKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMFxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1haW5GaWxlQmFzZW5hbWVzLmluY2x1ZGVzKHBhdGguYmFzZW5hbWUoXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWNvbmRGaWxlUGF0aCwgcGF0aC5leHRuYW1lKHNlY29uZEZpbGVQYXRoKVxuICAgICAgICAgICAgICAgICAgICApKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICBidWlsZENvbmZpZ3VyYXRpb24ucHVzaChuZXdJdGVtKVxuICAgICAgICAgICAgfVxuICAgICAgICByZXR1cm4gYnVpbGRDb25maWd1cmF0aW9uLnNvcnQoKFxuICAgICAgICAgICAgZmlyc3Q6UmVzb2x2ZWRCdWlsZENvbmZpZ3VyYXRpb25JdGVtLFxuICAgICAgICAgICAgc2Vjb25kOlJlc29sdmVkQnVpbGRDb25maWd1cmF0aW9uSXRlbVxuICAgICAgICApOm51bWJlciA9PiB7XG4gICAgICAgICAgICBpZiAoZmlyc3Qub3V0cHV0RXh0ZW5zaW9uICE9PSBzZWNvbmQub3V0cHV0RXh0ZW5zaW9uKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZpcnN0Lm91dHB1dEV4dGVuc2lvbiA9PT0gJ2pzJylcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xXG4gICAgICAgICAgICAgICAgaWYgKHNlY29uZC5vdXRwdXRFeHRlbnNpb24gPT09ICdqcycpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAxXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpcnN0Lm91dHB1dEV4dGVuc2lvbiA8IHNlY29uZC5vdXRwdXRFeHRlbnNpb24gPyAtMSA6IDFcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAwXG4gICAgICAgIH0pXG4gICAgfVxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgYWxsIGZpbGUgYW5kIGRpcmVjdG9yeSBwYXRocyByZWxhdGVkIHRvIGdpdmVuIGludGVybmFsXG4gICAgICogbW9kdWxlcyBhcyBhcnJheS5cbiAgICAgKiBAcGFyYW0gaW50ZXJuYWxJbmplY3Rpb24gLSBMaXN0IG9mIG1vZHVsZSBpZHMgb3IgbW9kdWxlIGZpbGUgcGF0aHMuXG4gICAgICogQHBhcmFtIGFsaWFzZXMgLSBNYXBwaW5nIG9mIGFsaWFzZXMgdG8gdGFrZSBpbnRvIGFjY291bnQuXG4gICAgICogQHBhcmFtIG1vZHVsZVJlcGxhY2VtZW50cyAtIE1hcHBpbmcgb2YgbW9kdWxlIHJlcGxhY2VtZW50cyB0byB0YWtlIGludG9cbiAgICAgKiBhY2NvdW50LlxuICAgICAqIEBwYXJhbSBleHRlbnNpb25zIC0gTGlzdCBvZiBmaWxlIGFuZCBtb2R1bGUgZXh0ZW5zaW9ucyB0byB0YWtlIGludG9cbiAgICAgKiBhY2NvdW50LlxuICAgICAqIEBwYXJhbSBjb250ZXh0IC0gRmlsZSBwYXRoIHRvIHJlc29sdmUgcmVsYXRpdmUgdG8uXG4gICAgICogQHBhcmFtIHJlZmVyZW5jZVBhdGggLSBQYXRoIHRvIHNlYXJjaCBmb3IgbG9jYWwgbW9kdWxlcy5cbiAgICAgKiBAcGFyYW0gcGF0aHNUb0lnbm9yZSAtIFBhdGhzIHdoaWNoIG1hcmtzIGxvY2F0aW9uIHRvIGlnbm9yZS5cbiAgICAgKiBAcGFyYW0gcmVsYXRpdmVNb2R1bGVGaWxlUGF0aHMgLSBMaXN0IG9mIHJlbGF0aXZlIGZpbGUgcGF0aCB0byBzZWFyY2hcbiAgICAgKiBmb3IgbW9kdWxlcyBpbi5cbiAgICAgKiBAcGFyYW0gcGFja2FnZUVudHJ5RmlsZU5hbWVzIC0gTGlzdCBvZiBwYWNrYWdlIGVudHJ5IGZpbGUgbmFtZXMgdG9cbiAgICAgKiBzZWFyY2ggZm9yLiBUaGUgbWFnaWMgbmFtZSBcIl9fcGFja2FnZV9fXCIgd2lsbCBzZWFyY2ggZm9yIGFuIGFwcHJlY2lhdGVcbiAgICAgKiBlbnRyeSBpbiBhIFwicGFja2FnZS5qc29uXCIgZmlsZS5cbiAgICAgKiBAcGFyYW0gcGFja2FnZU1haW5Qcm9wZXJ0eU5hbWVzIC0gTGlzdCBvZiBwYWNrYWdlIGZpbGUgbWFpbiBwcm9wZXJ0eVxuICAgICAqIG5hbWVzIHRvIHNlYXJjaCBmb3IgcGFja2FnZSByZXByZXNlbnRpbmcgZW50cnkgbW9kdWxlIGRlZmluaXRpb25zLlxuICAgICAqIEBwYXJhbSBwYWNrYWdlQWxpYXNQcm9wZXJ0eU5hbWVzIC0gTGlzdCBvZiBwYWNrYWdlIGZpbGUgYWxpYXMgcHJvcGVydHlcbiAgICAgKiBuYW1lcyB0byBzZWFyY2ggZm9yIHBhY2thZ2Ugc3BlY2lmaWMgbW9kdWxlIGFsaWFzZXMuXG4gICAgICogQHBhcmFtIGVuY29kaW5nIC0gRmlsZSBuYW1lIGVuY29kaW5nIHRvIHVzZSBkdXJpbmcgZmlsZSB0cmF2ZXJzaW5nLlxuICAgICAqIEByZXR1cm5zIE9iamVjdCB3aXRoIGEgZmlsZSBwYXRoIGFuZCBkaXJlY3RvcnkgcGF0aCBrZXkgbWFwcGluZyB0b1xuICAgICAqIGNvcnJlc3BvbmRpbmcgbGlzdCBvZiBwYXRocy5cbiAgICAgKi9cbiAgICBzdGF0aWMgZGV0ZXJtaW5lTW9kdWxlTG9jYXRpb25zKFxuICAgICAgICBpbnRlcm5hbEluamVjdGlvbjpJbnRlcm5hbEluamVjdGlvbiwgYWxpYXNlczpQbGFpbk9iamVjdCA9IHt9LFxuICAgICAgICBtb2R1bGVSZXBsYWNlbWVudHM6UGxhaW5PYmplY3QgPSB7fSwgZXh0ZW5zaW9uczpFeHRlbnNpb25zID0ge1xuICAgICAgICAgICAgZmlsZToge1xuICAgICAgICAgICAgICAgIGV4dGVybmFsOiBbJy5qcyddLFxuICAgICAgICAgICAgICAgIGludGVybmFsOiBbXG4gICAgICAgICAgICAgICAgICAgICcuanMnLCAnLmpzb24nLCAnLmNzcycsICcuZW90JywgJy5naWYnLCAnLmh0bWwnLCAnLmljbycsXG4gICAgICAgICAgICAgICAgICAgICcuanBnJywgJy5wbmcnLCAnLmVqcycsICcuc3ZnJywgJy50dGYnLCAnLndvZmYnLCAnLndvZmYyJ1xuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH0sIG1vZHVsZTogW11cbiAgICAgICAgfSwgY29udGV4dDpzdHJpbmcgPSAnLi8nLCByZWZlcmVuY2VQYXRoOnN0cmluZyA9ICcnLFxuICAgICAgICBwYXRoc1RvSWdub3JlOkFycmF5PHN0cmluZz4gPSBbJy5naXQnXSxcbiAgICAgICAgcmVsYXRpdmVNb2R1bGVGaWxlUGF0aHM6QXJyYXk8c3RyaW5nPiA9IFsnJywgJ25vZGVfbW9kdWxlcycsICcuLi8nXSxcbiAgICAgICAgcGFja2FnZUVudHJ5RmlsZU5hbWVzOkFycmF5PHN0cmluZz4gPSBbXG4gICAgICAgICAgICAnX19wYWNrYWdlX18nLCAnJywgJ2luZGV4JywgJ21haW4nXSxcbiAgICAgICAgcGFja2FnZU1haW5Qcm9wZXJ0eU5hbWVzOkFycmF5PHN0cmluZz4gPSBbJ21haW4nLCAnbW9kdWxlJ10sXG4gICAgICAgIHBhY2thZ2VBbGlhc1Byb3BlcnR5TmFtZXM6QXJyYXk8c3RyaW5nPiA9IFtdLFxuICAgICAgICBlbmNvZGluZzpzdHJpbmcgPSAndXRmLTgnXG4gICAgKTp7ZmlsZVBhdGhzOkFycmF5PHN0cmluZz47ZGlyZWN0b3J5UGF0aHM6QXJyYXk8c3RyaW5nPn0ge1xuICAgICAgICBjb25zdCBmaWxlUGF0aHM6QXJyYXk8c3RyaW5nPiA9IFtdXG4gICAgICAgIGNvbnN0IGRpcmVjdG9yeVBhdGhzOkFycmF5PHN0cmluZz4gPSBbXVxuICAgICAgICBjb25zdCBub3JtYWxpemVkSW50ZXJuYWxJbmplY3Rpb246Tm9ybWFsaXplZEludGVybmFsSW5qZWN0aW9uID1cbiAgICAgICAgICAgIEhlbHBlci5yZXNvbHZlTW9kdWxlc0luRm9sZGVycyhcbiAgICAgICAgICAgICAgICBIZWxwZXIubm9ybWFsaXplSW50ZXJuYWxJbmplY3Rpb24oaW50ZXJuYWxJbmplY3Rpb24pLFxuICAgICAgICAgICAgICAgIGFsaWFzZXMsIG1vZHVsZVJlcGxhY2VtZW50cywgZXh0ZW5zaW9ucywgY29udGV4dCxcbiAgICAgICAgICAgICAgICByZWZlcmVuY2VQYXRoLCBwYXRoc1RvSWdub3JlLCByZWxhdGl2ZU1vZHVsZUZpbGVQYXRocyxcbiAgICAgICAgICAgICAgICBwYWNrYWdlRW50cnlGaWxlTmFtZXMsIHBhY2thZ2VNYWluUHJvcGVydHlOYW1lcyxcbiAgICAgICAgICAgICAgICBwYWNrYWdlQWxpYXNQcm9wZXJ0eU5hbWVzKVxuICAgICAgICBmb3IgKGNvbnN0IGNodW5rTmFtZTpzdHJpbmcgaW4gbm9ybWFsaXplZEludGVybmFsSW5qZWN0aW9uKVxuICAgICAgICAgICAgaWYgKG5vcm1hbGl6ZWRJbnRlcm5hbEluamVjdGlvbi5oYXNPd25Qcm9wZXJ0eShjaHVua05hbWUpKVxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbW9kdWxlSUQ6c3RyaW5nIG9mIG5vcm1hbGl6ZWRJbnRlcm5hbEluamVjdGlvbltcbiAgICAgICAgICAgICAgICAgICAgY2h1bmtOYW1lXG4gICAgICAgICAgICAgICAgXSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlUGF0aDo/c3RyaW5nID0gSGVscGVyLmRldGVybWluZU1vZHVsZUZpbGVQYXRoKFxuICAgICAgICAgICAgICAgICAgICAgICAgbW9kdWxlSUQsIGFsaWFzZXMsIG1vZHVsZVJlcGxhY2VtZW50cywgZXh0ZW5zaW9ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQsIHJlZmVyZW5jZVBhdGgsIHBhdGhzVG9JZ25vcmUsXG4gICAgICAgICAgICAgICAgICAgICAgICByZWxhdGl2ZU1vZHVsZUZpbGVQYXRocywgcGFja2FnZUVudHJ5RmlsZU5hbWVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGFja2FnZU1haW5Qcm9wZXJ0eU5hbWVzLCBwYWNrYWdlQWxpYXNQcm9wZXJ0eU5hbWVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RpbmcpXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlUGF0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVBhdGhzLnB1c2goZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXJlY3RvcnlQYXRoOnN0cmluZyA9IHBhdGguZGlybmFtZShmaWxlUGF0aClcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZGlyZWN0b3J5UGF0aHMuaW5jbHVkZXMoZGlyZWN0b3J5UGF0aCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0b3J5UGF0aHMucHVzaChkaXJlY3RvcnlQYXRoKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICByZXR1cm4ge2ZpbGVQYXRocywgZGlyZWN0b3J5UGF0aHN9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgYSBsaXN0IG9mIGNvbmNyZXRlIGZpbGUgcGF0aHMgZm9yIGdpdmVuIG1vZHVsZSBpZCBwb2ludGluZyB0b1xuICAgICAqIGEgZm9sZGVyIHdoaWNoIGlzbid0IGEgcGFja2FnZS5cbiAgICAgKiBAcGFyYW0gbm9ybWFsaXplZEludGVybmFsSW5qZWN0aW9uIC0gSW5qZWN0aW9uIGRhdGEgc3RydWN0dXJlIG9mXG4gICAgICogbW9kdWxlcyB3aXRoIGZvbGRlciByZWZlcmVuY2VzIHRvIHJlc29sdmUuXG4gICAgICogQHBhcmFtIGFsaWFzZXMgLSBNYXBwaW5nIG9mIGFsaWFzZXMgdG8gdGFrZSBpbnRvIGFjY291bnQuXG4gICAgICogQHBhcmFtIG1vZHVsZVJlcGxhY2VtZW50cyAtIE1hcHBpbmcgb2YgcmVwbGFjZW1lbnRzIHRvIHRha2UgaW50b1xuICAgICAqIGFjY291bnQuXG4gICAgICogQHBhcmFtIGV4dGVuc2lvbnMgLSBMaXN0IG9mIGZpbGUgYW5kIG1vZHVsZSBleHRlbnNpb25zLlxuICAgICAqIEBwYXJhbSBjb250ZXh0IC0gRmlsZSBwYXRoIHRvIGRldGVybWluZSByZWxhdGl2ZSB0by5cbiAgICAgKiBAcGFyYW0gcmVmZXJlbmNlUGF0aCAtIFBhdGggdG8gcmVzb2x2ZSBsb2NhbCBtb2R1bGVzIHJlbGF0aXZlIHRvLlxuICAgICAqIEBwYXJhbSBwYXRoc1RvSWdub3JlIC0gUGF0aHMgd2hpY2ggbWFya3MgbG9jYXRpb24gdG8gaWdub3JlLlxuICAgICAqIEByZXR1cm5zIEdpdmVuIGluamVjdGlvbnMgd2l0aCByZXNvbHZlZCBmb2xkZXIgcG9pbnRpbmcgbW9kdWxlcy5cbiAgICAgKi9cbiAgICBzdGF0aWMgcmVzb2x2ZU1vZHVsZXNJbkZvbGRlcnMoXG4gICAgICAgIG5vcm1hbGl6ZWRJbnRlcm5hbEluamVjdGlvbjpOb3JtYWxpemVkSW50ZXJuYWxJbmplY3Rpb24sXG4gICAgICAgIGFsaWFzZXM6UGxhaW5PYmplY3QgPSB7fSwgbW9kdWxlUmVwbGFjZW1lbnRzOlBsYWluT2JqZWN0ID0ge30sXG4gICAgICAgIGV4dGVuc2lvbnM6RXh0ZW5zaW9ucyA9IHtcbiAgICAgICAgICAgIGZpbGU6IHtcbiAgICAgICAgICAgICAgICBleHRlcm5hbDogWycuanMnXSxcbiAgICAgICAgICAgICAgICBpbnRlcm5hbDogW1xuICAgICAgICAgICAgICAgICAgICAnLmpzJywgJy5qc29uJywgJy5jc3MnLCAnLmVvdCcsICcuZ2lmJywgJy5odG1sJywgJy5pY28nLFxuICAgICAgICAgICAgICAgICAgICAnLmpwZycsICcucG5nJywgJy5lanMnLCAnLnN2ZycsICcudHRmJywgJy53b2ZmJywgJy53b2ZmMidcbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9LCBtb2R1bGU6IFtdXG4gICAgICAgIH0sIGNvbnRleHQ6c3RyaW5nID0gJy4vJywgcmVmZXJlbmNlUGF0aDpzdHJpbmcgPSAnJyxcbiAgICAgICAgcGF0aHNUb0lnbm9yZTpBcnJheTxzdHJpbmc+ID0gWycuZ2l0J11cbiAgICApOk5vcm1hbGl6ZWRJbnRlcm5hbEluamVjdGlvbiB7XG4gICAgICAgIGlmIChyZWZlcmVuY2VQYXRoLnN0YXJ0c1dpdGgoJy8nKSlcbiAgICAgICAgICAgIHJlZmVyZW5jZVBhdGggPSBwYXRoLnJlbGF0aXZlKGNvbnRleHQsIHJlZmVyZW5jZVBhdGgpXG4gICAgICAgIGZvciAoY29uc3QgY2h1bmtOYW1lOnN0cmluZyBpbiBub3JtYWxpemVkSW50ZXJuYWxJbmplY3Rpb24pXG4gICAgICAgICAgICBpZiAobm9ybWFsaXplZEludGVybmFsSW5qZWN0aW9uLmhhc093blByb3BlcnR5KGNodW5rTmFtZSkpIHtcbiAgICAgICAgICAgICAgICBsZXQgaW5kZXg6bnVtYmVyID0gMFxuICAgICAgICAgICAgICAgIGZvciAobGV0IG1vZHVsZUlEOnN0cmluZyBvZiBub3JtYWxpemVkSW50ZXJuYWxJbmplY3Rpb25bXG4gICAgICAgICAgICAgICAgICAgIGNodW5rTmFtZVxuICAgICAgICAgICAgICAgIF0pIHtcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlSUQgPSBIZWxwZXIuYXBwbHlNb2R1bGVSZXBsYWNlbWVudHMoXG4gICAgICAgICAgICAgICAgICAgICAgICBIZWxwZXIuYXBwbHlBbGlhc2VzKEhlbHBlci5zdHJpcExvYWRlcihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGVJRFxuICAgICAgICAgICAgICAgICAgICAgICAgKSwgYWxpYXNlcyksIG1vZHVsZVJlcGxhY2VtZW50cylcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzb2x2ZWRQYXRoOnN0cmluZyA9IHBhdGgucmVzb2x2ZShcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZVBhdGgsIG1vZHVsZUlEKVxuICAgICAgICAgICAgICAgICAgICBpZiAoVG9vbHMuaXNEaXJlY3RvcnlTeW5jKHJlc29sdmVkUGF0aCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vcm1hbGl6ZWRJbnRlcm5hbEluamVjdGlvbltjaHVua05hbWVdLnNwbGljZShpbmRleCwgMSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZTpGaWxlIG9mXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVG9vbHMud2Fsa0RpcmVjdG9yeVJlY3Vyc2l2ZWx5U3luYyhyZXNvbHZlZFBhdGgsIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZTpGaWxlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTo/ZmFsc2UgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSGVscGVyLmlzRmlsZVBhdGhJbkxvY2F0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5wYXRoLCBwYXRoc1RvSWdub3JlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWxlLnN0YXQuaXNGaWxlKCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vcm1hbGl6ZWRJbnRlcm5hbEluamVjdGlvbltjaHVua05hbWVdLnB1c2goXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnLi8nICsgcGF0aC5yZWxhdGl2ZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VQYXRoLCBwYXRoLnJlc29sdmUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmVkUGF0aCwgZmlsZS5wYXRoKSkpXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobW9kdWxlSUQuc3RhcnRzV2l0aChcbiAgICAgICAgICAgICAgICAgICAgICAgICcuLydcbiAgICAgICAgICAgICAgICAgICAgKSAmJiAhbW9kdWxlSUQuc3RhcnRzV2l0aCgnLi8nICsgcGF0aC5yZWxhdGl2ZShcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQsIHJlZmVyZW5jZVBhdGhcbiAgICAgICAgICAgICAgICAgICAgKSkpXG4gICAgICAgICAgICAgICAgICAgICAgICBub3JtYWxpemVkSW50ZXJuYWxJbmplY3Rpb25bY2h1bmtOYW1lXVtpbmRleF0gPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAuLyR7cGF0aC5yZWxhdGl2ZShjb250ZXh0LCByZXNvbHZlZFBhdGgpfWBcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggKz0gMVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZWRJbnRlcm5hbEluamVjdGlvblxuICAgIH1cbiAgICAvKipcbiAgICAgKiBFdmVyeSBpbmplY3Rpb24gZGVmaW5pdGlvbiB0eXBlIGNhbiBiZSByZXByZXNlbnRlZCBhcyBwbGFpbiBvYmplY3RcbiAgICAgKiAobWFwcGluZyBmcm9tIGNodW5rIG5hbWUgdG8gYXJyYXkgb2YgbW9kdWxlIGlkcykuIFRoaXMgbWV0aG9kIGNvbnZlcnRzXG4gICAgICogZWFjaCByZXByZXNlbnRhdGlvbiBpbnRvIHRoZSBub3JtYWxpemVkIHBsYWluIG9iamVjdCBub3RhdGlvbi5cbiAgICAgKiBAcGFyYW0gaW50ZXJuYWxJbmplY3Rpb24gLSBHaXZlbiBpbnRlcm5hbCBpbmplY3Rpb24gdG8gbm9ybWFsaXplLlxuICAgICAqIEByZXR1cm5zIE5vcm1hbGl6ZWQgcmVwcmVzZW50YXRpb24gb2YgZ2l2ZW4gaW50ZXJuYWwgaW5qZWN0aW9uLlxuICAgICAqL1xuICAgIHN0YXRpYyBub3JtYWxpemVJbnRlcm5hbEluamVjdGlvbihcbiAgICAgICAgaW50ZXJuYWxJbmplY3Rpb246SW50ZXJuYWxJbmplY3Rpb25cbiAgICApOk5vcm1hbGl6ZWRJbnRlcm5hbEluamVjdGlvbiB7XG4gICAgICAgIGxldCByZXN1bHQ6Tm9ybWFsaXplZEludGVybmFsSW5qZWN0aW9uID0ge31cbiAgICAgICAgaWYgKGludGVybmFsSW5qZWN0aW9uIGluc3RhbmNlb2YgT2JqZWN0ICYmIFRvb2xzLmlzUGxhaW5PYmplY3QoXG4gICAgICAgICAgICBpbnRlcm5hbEluamVjdGlvblxuICAgICAgICApKSB7XG4gICAgICAgICAgICBsZXQgaGFzQ29udGVudDpib29sZWFuID0gZmFsc2VcbiAgICAgICAgICAgIGNvbnN0IGNodW5rTmFtZXNUb0RlbGV0ZTpBcnJheTxzdHJpbmc+ID0gW11cbiAgICAgICAgICAgIGZvciAoY29uc3QgY2h1bmtOYW1lOnN0cmluZyBpbiBpbnRlcm5hbEluamVjdGlvbilcbiAgICAgICAgICAgICAgICBpZiAoaW50ZXJuYWxJbmplY3Rpb24uaGFzT3duUHJvcGVydHkoY2h1bmtOYW1lKSlcbiAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaW50ZXJuYWxJbmplY3Rpb25bY2h1bmtOYW1lXSkpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW50ZXJuYWxJbmplY3Rpb25bY2h1bmtOYW1lXS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzQ29udGVudCA9IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRbY2h1bmtOYW1lXSA9IGludGVybmFsSW5qZWN0aW9uW2NodW5rTmFtZV1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rTmFtZXNUb0RlbGV0ZS5wdXNoKGNodW5rTmFtZSlcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYXNDb250ZW50ID0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2NodW5rTmFtZV0gPSBbaW50ZXJuYWxJbmplY3Rpb25bY2h1bmtOYW1lXV1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGhhc0NvbnRlbnQpXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBjaHVua05hbWU6c3RyaW5nIG9mIGNodW5rTmFtZXNUb0RlbGV0ZSlcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHJlc3VsdFtjaHVua05hbWVdXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0ge2luZGV4OiBbXX1cbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgaW50ZXJuYWxJbmplY3Rpb24gPT09ICdzdHJpbmcnKVxuICAgICAgICAgICAgcmVzdWx0ID0ge2luZGV4OiBbaW50ZXJuYWxJbmplY3Rpb25dfVxuICAgICAgICBlbHNlIGlmIChBcnJheS5pc0FycmF5KGludGVybmFsSW5qZWN0aW9uKSlcbiAgICAgICAgICAgIHJlc3VsdCA9IHtpbmRleDogaW50ZXJuYWxJbmplY3Rpb259XG4gICAgICAgIHJldHVybiByZXN1bHRcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lcyBhbGwgY29uY3JldGUgZmlsZSBwYXRocyBmb3IgZ2l2ZW4gaW5qZWN0aW9uIHdoaWNoIGFyZSBtYXJrZWRcbiAgICAgKiB3aXRoIHRoZSBcIl9fYXV0b19fXCIgaW5kaWNhdG9yLlxuICAgICAqIEBwYXJhbSBnaXZlbkluamVjdGlvbiAtIEdpdmVuIGludGVybmFsIGFuZCBleHRlcm5hbCBpbmplY3Rpb24gdG8gdGFrZVxuICAgICAqIGludG8gYWNjb3VudC5cbiAgICAgKiBAcGFyYW0gYnVpbGRDb25maWd1cmF0aW9ucyAtIFJlc29sdmVkIGJ1aWxkIGNvbmZpZ3VyYXRpb24uXG4gICAgICogQHBhcmFtIG1vZHVsZXNUb0V4Y2x1ZGUgLSBBIGxpc3Qgb2YgbW9kdWxlcyB0byBleGNsdWRlIChzcGVjaWZpZWQgYnlcbiAgICAgKiBwYXRoIG9yIGlkKSBvciBhIG1hcHBpbmcgZnJvbSBjaHVuayBuYW1lcyB0byBtb2R1bGUgaWRzLlxuICAgICAqIEBwYXJhbSBhbGlhc2VzIC0gTWFwcGluZyBvZiBhbGlhc2VzIHRvIHRha2UgaW50byBhY2NvdW50LlxuICAgICAqIEBwYXJhbSBtb2R1bGVSZXBsYWNlbWVudHMgLSBNYXBwaW5nIG9mIHJlcGxhY2VtZW50cyB0byB0YWtlIGludG9cbiAgICAgKiBhY2NvdW50LlxuICAgICAqIEBwYXJhbSBleHRlbnNpb25zIC0gTGlzdCBvZiBmaWxlIGFuZCBtb2R1bGUgZXh0ZW5zaW9ucyB0byB0YWtlIGludG9cbiAgICAgKiBhY2NvdW50LlxuICAgICAqIEBwYXJhbSBjb250ZXh0IC0gRmlsZSBwYXRoIHRvIHVzZSBhcyBzdGFydGluZyBwb2ludC5cbiAgICAgKiBAcGFyYW0gcmVmZXJlbmNlUGF0aCAtIFJlZmVyZW5jZSBwYXRoIGZyb20gd2hlcmUgbG9jYWwgZmlsZXMgc2hvdWxkIGJlXG4gICAgICogcmVzb2x2ZWQuXG4gICAgICogQHBhcmFtIHBhdGhzVG9JZ25vcmUgLSBQYXRocyB3aGljaCBtYXJrcyBsb2NhdGlvbiB0byBpZ25vcmUuXG4gICAgICogQHJldHVybnMgR2l2ZW4gaW5qZWN0aW9uIHdpdGggcmVzb2x2ZWQgbWFya2VkIGluZGljYXRvcnMuXG4gICAgICovXG4gICAgc3RhdGljIHJlc29sdmVJbmplY3Rpb24oXG4gICAgICAgIGdpdmVuSW5qZWN0aW9uOkluamVjdGlvbixcbiAgICAgICAgYnVpbGRDb25maWd1cmF0aW9uczpSZXNvbHZlZEJ1aWxkQ29uZmlndXJhdGlvbixcbiAgICAgICAgbW9kdWxlc1RvRXhjbHVkZTpJbnRlcm5hbEluamVjdGlvbixcbiAgICAgICAgYWxpYXNlczpQbGFpbk9iamVjdCA9IHt9LCBtb2R1bGVSZXBsYWNlbWVudHM6UGxhaW5PYmplY3QgPSB7fSxcbiAgICAgICAgZXh0ZW5zaW9uczpFeHRlbnNpb25zID0ge1xuICAgICAgICAgICAgZmlsZToge1xuICAgICAgICAgICAgICAgIGV4dGVybmFsOiBbJy5qcyddLFxuICAgICAgICAgICAgICAgIGludGVybmFsOiBbXG4gICAgICAgICAgICAgICAgICAgICcuanMnLCAnLmpzb24nLCAnLmNzcycsICcuZW90JywgJy5naWYnLCAnLmh0bWwnLCAnLmljbycsXG4gICAgICAgICAgICAgICAgICAgICcuanBnJywgJy5wbmcnLCAnLmVqcycsICcuc3ZnJywgJy50dGYnLCAnLndvZmYnLCAnLndvZmYyJ1xuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH0sIG1vZHVsZTogW11cbiAgICAgICAgfSwgY29udGV4dDpzdHJpbmcgPSAnLi8nLCByZWZlcmVuY2VQYXRoOnN0cmluZyA9ICcnLFxuICAgICAgICBwYXRoc1RvSWdub3JlOkFycmF5PHN0cmluZz4gPSBbJy5naXQnXVxuICAgICk6SW5qZWN0aW9uIHtcbiAgICAgICAgY29uc3QgaW5qZWN0aW9uOkluamVjdGlvbiA9IFRvb2xzLmV4dGVuZE9iamVjdChcbiAgICAgICAgICAgIHRydWUsIHt9LCBnaXZlbkluamVjdGlvbilcbiAgICAgICAgY29uc3QgbW9kdWxlRmlsZVBhdGhzVG9FeGNsdWRlOkFycmF5PHN0cmluZz4gPVxuICAgICAgICAgICAgSGVscGVyLmRldGVybWluZU1vZHVsZUxvY2F0aW9ucyhcbiAgICAgICAgICAgICAgICBtb2R1bGVzVG9FeGNsdWRlLCBhbGlhc2VzLCBtb2R1bGVSZXBsYWNlbWVudHMsIGV4dGVuc2lvbnMsXG4gICAgICAgICAgICAgICAgY29udGV4dCwgcmVmZXJlbmNlUGF0aCwgcGF0aHNUb0lnbm9yZVxuICAgICAgICAgICAgKS5maWxlUGF0aHNcbiAgICAgICAgZm9yIChjb25zdCB0eXBlOnN0cmluZyBvZiBbJ2ludGVybmFsJywgJ2V4dGVybmFsJ10pXG4gICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBjdXJseSAqL1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBpbmplY3Rpb25bdHlwZV0gPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBjaHVua05hbWU6c3RyaW5nIGluIGluamVjdGlvblt0eXBlXSlcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluamVjdGlvblt0eXBlXVtjaHVua05hbWVdID09PSAnX19hdXRvX18nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmplY3Rpb25bdHlwZV1bY2h1bmtOYW1lXSA9IFtdXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtb2R1bGVzOntcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBba2V5OnN0cmluZ106c3RyaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICB9ID0gSGVscGVyLmdldEF1dG9DaHVuayhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidWlsZENvbmZpZ3VyYXRpb25zLCBtb2R1bGVGaWxlUGF0aHNUb0V4Y2x1ZGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlUGF0aClcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgc3ViQ2h1bmtOYW1lOnN0cmluZyBpbiBtb2R1bGVzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb2R1bGVzLmhhc093blByb3BlcnR5KHN1YkNodW5rTmFtZSkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluamVjdGlvblt0eXBlXVtjaHVua05hbWVdLnB1c2goXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGVzW3N1YkNodW5rTmFtZV0pXG4gICAgICAgICAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJldmVyc2UgYXJyYXkgdG8gbGV0IGphdmFTY3JpcHQgYW5kIG1haW4gZmlsZXMgYmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgbGFzdCBvbmVzIHRvIGV4cG9ydCB0aGVtIHJhdGhlci5cbiAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmplY3Rpb25bdHlwZV1bY2h1bmtOYW1lXS5yZXZlcnNlKClcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChpbmplY3Rpb25bdHlwZV0gPT09ICdfX2F1dG9fXycpXG4gICAgICAgICAgICAvKiBlc2xpbnQtZW5hYmxlIGN1cmx5ICovXG4gICAgICAgICAgICAgICAgaW5qZWN0aW9uW3R5cGVdID0gSGVscGVyLmdldEF1dG9DaHVuayhcbiAgICAgICAgICAgICAgICAgICAgYnVpbGRDb25maWd1cmF0aW9ucywgbW9kdWxlRmlsZVBhdGhzVG9FeGNsdWRlLCBjb250ZXh0KVxuICAgICAgICByZXR1cm4gaW5qZWN0aW9uXG4gICAgfVxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgYWxsIG1vZHVsZSBmaWxlIHBhdGhzLlxuICAgICAqIEBwYXJhbSBidWlsZENvbmZpZ3VyYXRpb25zIC0gUmVzb2x2ZWQgYnVpbGQgY29uZmlndXJhdGlvbi5cbiAgICAgKiBAcGFyYW0gbW9kdWxlRmlsZVBhdGhzVG9FeGNsdWRlIC0gQSBsaXN0IG9mIG1vZHVsZXMgZmlsZSBwYXRocyB0b1xuICAgICAqIGV4Y2x1ZGUgKHNwZWNpZmllZCBieSBwYXRoIG9yIGlkKSBvciBhIG1hcHBpbmcgZnJvbSBjaHVuayBuYW1lcyB0b1xuICAgICAqIG1vZHVsZSBpZHMuXG4gICAgICogQHBhcmFtIGNvbnRleHQgLSBGaWxlIHBhdGggdG8gdXNlIGFzIHN0YXJ0aW5nIHBvaW50LlxuICAgICAqIEByZXR1cm5zIEFsbCBkZXRlcm1pbmVkIG1vZHVsZSBmaWxlIHBhdGhzLlxuICAgICAqL1xuICAgIHN0YXRpYyBnZXRBdXRvQ2h1bmsoXG4gICAgICAgIGJ1aWxkQ29uZmlndXJhdGlvbnM6UmVzb2x2ZWRCdWlsZENvbmZpZ3VyYXRpb24sXG4gICAgICAgIG1vZHVsZUZpbGVQYXRoc1RvRXhjbHVkZTpBcnJheTxzdHJpbmc+LCBjb250ZXh0OnN0cmluZ1xuICAgICk6e1trZXk6c3RyaW5nXTpzdHJpbmd9IHtcbiAgICAgICAgY29uc3QgcmVzdWx0Ontba2V5OnN0cmluZ106c3RyaW5nfSA9IHt9XG4gICAgICAgIGNvbnN0IGluamVjdGVkTW9kdWxlSURzOntba2V5OnN0cmluZ106QXJyYXk8c3RyaW5nPn0gPSB7fVxuICAgICAgICBmb3IgKFxuICAgICAgICAgICAgY29uc3QgYnVpbGRDb25maWd1cmF0aW9uOlJlc29sdmVkQnVpbGRDb25maWd1cmF0aW9uSXRlbSBvZlxuICAgICAgICAgICAgYnVpbGRDb25maWd1cmF0aW9uc1xuICAgICAgICApIHtcbiAgICAgICAgICAgIGlmICghaW5qZWN0ZWRNb2R1bGVJRHNbYnVpbGRDb25maWd1cmF0aW9uLm91dHB1dEV4dGVuc2lvbl0pXG4gICAgICAgICAgICAgICAgaW5qZWN0ZWRNb2R1bGVJRHNbYnVpbGRDb25maWd1cmF0aW9uLm91dHB1dEV4dGVuc2lvbl0gPSBbXVxuICAgICAgICAgICAgZm9yIChjb25zdCBtb2R1bGVGaWxlUGF0aDpzdHJpbmcgb2YgYnVpbGRDb25maWd1cmF0aW9uLmZpbGVQYXRocylcbiAgICAgICAgICAgICAgICBpZiAoIW1vZHVsZUZpbGVQYXRoc1RvRXhjbHVkZS5pbmNsdWRlcyhtb2R1bGVGaWxlUGF0aCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVsYXRpdmVNb2R1bGVGaWxlUGF0aDpzdHJpbmcgPSAnLi8nICsgcGF0aC5yZWxhdGl2ZShcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQsIG1vZHVsZUZpbGVQYXRoKVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXJlY3RvcnlQYXRoOnN0cmluZyA9IHBhdGguZGlybmFtZShcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbGF0aXZlTW9kdWxlRmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhc2VOYW1lOnN0cmluZyA9IHBhdGguYmFzZW5hbWUoXG4gICAgICAgICAgICAgICAgICAgICAgICByZWxhdGl2ZU1vZHVsZUZpbGVQYXRoLFxuICAgICAgICAgICAgICAgICAgICAgICAgYC4ke2J1aWxkQ29uZmlndXJhdGlvbi5leHRlbnNpb259YClcbiAgICAgICAgICAgICAgICAgICAgbGV0IG1vZHVsZUlEOnN0cmluZyA9IGJhc2VOYW1lXG4gICAgICAgICAgICAgICAgICAgIGlmIChkaXJlY3RvcnlQYXRoICE9PSAnLicpXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGVJRCA9IHBhdGguam9pbihkaXJlY3RvcnlQYXRoLCBiYXNlTmFtZSlcbiAgICAgICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgICAgICAgIEVuc3VyZSB0aGF0IGVhY2ggb3V0cHV0IHR5cGUgaGFzIG9ubHkgb25lIHNvdXJjZVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVwcmVzZW50YXRpb24uXG4gICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIGlmICghaW5qZWN0ZWRNb2R1bGVJRHNbXG4gICAgICAgICAgICAgICAgICAgICAgICBidWlsZENvbmZpZ3VyYXRpb24ub3V0cHV0RXh0ZW5zaW9uXG4gICAgICAgICAgICAgICAgICAgIF0uaW5jbHVkZXMobW9kdWxlSUQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVuc3VyZSB0aGF0IHNhbWUgbW9kdWxlIGlkcyBhbmQgZGlmZmVyZW50IG91dHB1dFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVzIGNhbiBiZSBkaXN0aW5ndWlzaGVkIGJ5IHRoZWlyIGV4dGVuc2lvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChKYXZhU2NyaXB0LU1vZHVsZXMgcmVtYWlucyB3aXRob3V0IGV4dGVuc2lvbiBzaW5jZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZXkgd2lsbCBiZSBoYW5kbGVkIGZpcnN0IGJlY2F1c2UgdGhlIGJ1aWxkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbnMgYXJlIGV4cGVjdGVkIHRvIGJlIHNvcnRlZCBpbiB0aGlzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dCkuXG4gICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5oYXNPd25Qcm9wZXJ0eShtb2R1bGVJRCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3JlbGF0aXZlTW9kdWxlRmlsZVBhdGhdID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRpdmVNb2R1bGVGaWxlUGF0aFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFttb2R1bGVJRF0gPSByZWxhdGl2ZU1vZHVsZUZpbGVQYXRoXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmplY3RlZE1vZHVsZUlEc1tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidWlsZENvbmZpZ3VyYXRpb24ub3V0cHV0RXh0ZW5zaW9uXG4gICAgICAgICAgICAgICAgICAgICAgICBdLnB1c2gobW9kdWxlSUQpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdFxuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmVzIGEgY29uY3JldGUgZmlsZSBwYXRoIGZvciBnaXZlbiBtb2R1bGUgaWQuXG4gICAgICogQHBhcmFtIG1vZHVsZUlEIC0gTW9kdWxlIGlkIHRvIGRldGVybWluZS5cbiAgICAgKiBAcGFyYW0gYWxpYXNlcyAtIE1hcHBpbmcgb2YgYWxpYXNlcyB0byB0YWtlIGludG8gYWNjb3VudC5cbiAgICAgKiBAcGFyYW0gbW9kdWxlUmVwbGFjZW1lbnRzIC0gTWFwcGluZyBvZiByZXBsYWNlbWVudHMgdG8gdGFrZSBpbnRvXG4gICAgICogYWNjb3VudC5cbiAgICAgKiBAcGFyYW0gZXh0ZW5zaW9ucyAtIExpc3Qgb2YgZmlsZSBhbmQgbW9kdWxlIGV4dGVuc2lvbnMgdG8gdGFrZSBpbnRvXG4gICAgICogYWNjb3VudC5cbiAgICAgKiBAcGFyYW0gY29udGV4dCAtIEZpbGUgcGF0aCB0byBkZXRlcm1pbmUgcmVsYXRpdmUgdG8uXG4gICAgICogQHBhcmFtIHJlZmVyZW5jZVBhdGggLSBQYXRoIHRvIHJlc29sdmUgbG9jYWwgbW9kdWxlcyByZWxhdGl2ZSB0by5cbiAgICAgKiBAcGFyYW0gcGF0aHNUb0lnbm9yZSAtIFBhdGhzIHdoaWNoIG1hcmtzIGxvY2F0aW9uIHRvIGlnbm9yZS5cbiAgICAgKiBAcGFyYW0gcmVsYXRpdmVNb2R1bGVGaWxlUGF0aHMgLSBMaXN0IG9mIHJlbGF0aXZlIGZpbGUgcGF0aCB0byBzZWFyY2hcbiAgICAgKiBmb3IgbW9kdWxlcyBpbi5cbiAgICAgKiBAcGFyYW0gcGFja2FnZUVudHJ5RmlsZU5hbWVzIC0gTGlzdCBvZiBwYWNrYWdlIGVudHJ5IGZpbGUgbmFtZXMgdG9cbiAgICAgKiBzZWFyY2ggZm9yLiBUaGUgbWFnaWMgbmFtZSBcIl9fcGFja2FnZV9fXCIgd2lsbCBzZWFyY2ggZm9yIGFuIGFwcHJlY2lhdGVcbiAgICAgKiBlbnRyeSBpbiBhIFwicGFja2FnZS5qc29uXCIgZmlsZS5cbiAgICAgKiBAcGFyYW0gcGFja2FnZU1haW5Qcm9wZXJ0eU5hbWVzIC0gTGlzdCBvZiBwYWNrYWdlIGZpbGUgbWFpbiBwcm9wZXJ0eVxuICAgICAqIG5hbWVzIHRvIHNlYXJjaCBmb3IgcGFja2FnZSByZXByZXNlbnRpbmcgZW50cnkgbW9kdWxlIGRlZmluaXRpb25zLlxuICAgICAqIEBwYXJhbSBwYWNrYWdlQWxpYXNQcm9wZXJ0eU5hbWVzIC0gTGlzdCBvZiBwYWNrYWdlIGZpbGUgYWxpYXMgcHJvcGVydHlcbiAgICAgKiBuYW1lcyB0byBzZWFyY2ggZm9yIHBhY2thZ2Ugc3BlY2lmaWMgbW9kdWxlIGFsaWFzZXMuXG4gICAgICogQHBhcmFtIGVuY29kaW5nIC0gRW5jb2RpbmcgdG8gdXNlIGZvciBmaWxlIG5hbWVzIGR1cmluZyBmaWxlIHRyYXZlcnNpbmcuXG4gICAgICogQHJldHVybnMgRmlsZSBwYXRoIG9yIGdpdmVuIG1vZHVsZSBpZCBpZiBkZXRlcm1pbmF0aW9ucyBoYXMgZmFpbGVkIG9yXG4gICAgICogd2Fzbid0IG5lY2Vzc2FyeS5cbiAgICAgKi9cbiAgICBzdGF0aWMgZGV0ZXJtaW5lTW9kdWxlRmlsZVBhdGgoXG4gICAgICAgIG1vZHVsZUlEOnN0cmluZywgYWxpYXNlczpQbGFpbk9iamVjdCA9IHt9LFxuICAgICAgICBtb2R1bGVSZXBsYWNlbWVudHM6UGxhaW5PYmplY3QgPSB7fSwgZXh0ZW5zaW9uczpFeHRlbnNpb25zID0ge1xuICAgICAgICAgICAgZmlsZToge1xuICAgICAgICAgICAgICAgIGV4dGVybmFsOiBbJy5qcyddLFxuICAgICAgICAgICAgICAgIGludGVybmFsOiBbXG4gICAgICAgICAgICAgICAgICAgICcuanMnLCAnLmpzb24nLCAnLmNzcycsICcuZW90JywgJy5naWYnLCAnLmh0bWwnLCAnLmljbycsXG4gICAgICAgICAgICAgICAgICAgICcuanBnJywgJy5wbmcnLCAnLmVqcycsICcuc3ZnJywgJy50dGYnLCAnLndvZmYnLCAnLndvZmYyJ1xuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH0sIG1vZHVsZTogW11cbiAgICAgICAgfSwgY29udGV4dDpzdHJpbmcgPSAnLi8nLCByZWZlcmVuY2VQYXRoOnN0cmluZyA9ICcnLFxuICAgICAgICBwYXRoc1RvSWdub3JlOkFycmF5PHN0cmluZz4gPSBbJy5naXQnXSxcbiAgICAgICAgcmVsYXRpdmVNb2R1bGVGaWxlUGF0aHM6QXJyYXk8c3RyaW5nPiA9IFsnbm9kZV9tb2R1bGVzJ10sXG4gICAgICAgIHBhY2thZ2VFbnRyeUZpbGVOYW1lczpBcnJheTxzdHJpbmc+ID0gWydpbmRleCddLFxuICAgICAgICBwYWNrYWdlTWFpblByb3BlcnR5TmFtZXM6QXJyYXk8c3RyaW5nPiA9IFsnbWFpbiddLFxuICAgICAgICBwYWNrYWdlQWxpYXNQcm9wZXJ0eU5hbWVzOkFycmF5PHN0cmluZz4gPSBbXSxcbiAgICAgICAgZW5jb2Rpbmc6c3RyaW5nID0gJ3V0Zi04J1xuICAgICk6P3N0cmluZyB7XG4gICAgICAgIG1vZHVsZUlEID0gSGVscGVyLmFwcGx5TW9kdWxlUmVwbGFjZW1lbnRzKEhlbHBlci5hcHBseUFsaWFzZXMoXG4gICAgICAgICAgICBIZWxwZXIuc3RyaXBMb2FkZXIobW9kdWxlSUQpLCBhbGlhc2VzXG4gICAgICAgICksIG1vZHVsZVJlcGxhY2VtZW50cylcbiAgICAgICAgaWYgKCFtb2R1bGVJRClcbiAgICAgICAgICAgIHJldHVybiBudWxsXG4gICAgICAgIGxldCBtb2R1bGVGaWxlUGF0aDpzdHJpbmcgPSBtb2R1bGVJRFxuICAgICAgICBpZiAobW9kdWxlRmlsZVBhdGguc3RhcnRzV2l0aCgnLi8nKSlcbiAgICAgICAgICAgIG1vZHVsZUZpbGVQYXRoID0gcGF0aC5qb2luKHJlZmVyZW5jZVBhdGgsIG1vZHVsZUZpbGVQYXRoKVxuICAgICAgICBmb3IgKGNvbnN0IG1vZHVsZUxvY2F0aW9uOnN0cmluZyBvZiBbcmVmZXJlbmNlUGF0aF0uY29uY2F0KFxuICAgICAgICAgICAgcmVsYXRpdmVNb2R1bGVGaWxlUGF0aHMubWFwKChmaWxlUGF0aDpzdHJpbmcpOnN0cmluZyA9PlxuICAgICAgICAgICAgICAgIHBhdGgucmVzb2x2ZShjb250ZXh0LCBmaWxlUGF0aCkpXG4gICAgICAgICkpXG4gICAgICAgICAgICBmb3IgKGxldCBmaWxlTmFtZTpzdHJpbmcgb2YgWycnLCAnX19wYWNrYWdlX18nXS5jb25jYXQoXG4gICAgICAgICAgICAgICAgcGFja2FnZUVudHJ5RmlsZU5hbWVzXG4gICAgICAgICAgICApKVxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbW9kdWxlRXh0ZW5zaW9uOnN0cmluZyBvZiBleHRlbnNpb25zLm1vZHVsZS5jb25jYXQoW1xuICAgICAgICAgICAgICAgICAgICAnJ1xuICAgICAgICAgICAgICAgIF0pKVxuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGZpbGVFeHRlbnNpb246c3RyaW5nIG9mIFsnJ10uY29uY2F0KFxuICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9ucy5maWxlLmludGVybmFsXG4gICAgICAgICAgICAgICAgICAgICkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjdXJyZW50TW9kdWxlRmlsZVBhdGg6c3RyaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobW9kdWxlRmlsZVBhdGguc3RhcnRzV2l0aCgnLycpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRNb2R1bGVGaWxlUGF0aCA9IHBhdGgucmVzb2x2ZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kdWxlRmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE1vZHVsZUZpbGVQYXRoID0gcGF0aC5yZXNvbHZlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGVMb2NhdGlvbiwgbW9kdWxlRmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGFja2FnZUFsaWFzZXM6UGxhaW5PYmplY3QgPSB7fVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVOYW1lID09PSAnX19wYWNrYWdlX18nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFRvb2xzLmlzRGlyZWN0b3J5U3luYyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE1vZHVsZUZpbGVQYXRoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXRoVG9QYWNrYWdlSlNPTjpzdHJpbmcgPSBwYXRoLnJlc29sdmUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TW9kdWxlRmlsZVBhdGgsICdwYWNrYWdlLmpzb24nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoVG9vbHMuaXNGaWxlU3luYyhwYXRoVG9QYWNrYWdlSlNPTikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBsb2NhbENvbmZpZ3VyYXRpb246UGxhaW5PYmplY3QgPSB7fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbENvbmZpZ3VyYXRpb24gPSBKU09OLnBhcnNlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlU3lzdGVtLnJlYWRGaWxlU3luYyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhUb1BhY2thZ2VKU09OLCB7ZW5jb2Rpbmd9KSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eU5hbWU6c3RyaW5nIG9mXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFja2FnZU1haW5Qcm9wZXJ0eU5hbWVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvY2FsQ29uZmlndXJhdGlvbi5oYXNPd25Qcm9wZXJ0eShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlOYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSAmJiB0eXBlb2YgbG9jYWxDb25maWd1cmF0aW9uW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eU5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdID09PSAnc3RyaW5nJyAmJiBsb2NhbENvbmZpZ3VyYXRpb25bXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5TmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZU5hbWUgPSBsb2NhbENvbmZpZ3VyYXRpb25bXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eU5hbWVdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eU5hbWU6c3RyaW5nIG9mXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFja2FnZUFsaWFzUHJvcGVydHlOYW1lc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2NhbENvbmZpZ3VyYXRpb24uaGFzT3duUHJvcGVydHkoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5TmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkgJiYgdHlwZW9mIGxvY2FsQ29uZmlndXJhdGlvbltcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlOYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFja2FnZUFsaWFzZXMgPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxDb25maWd1cmF0aW9uW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5TmFtZV1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVOYW1lID09PSAnX19wYWNrYWdlX18nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZU5hbWUgPSBIZWxwZXIuYXBwbHlNb2R1bGVSZXBsYWNlbWVudHMoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVscGVyLmFwcGx5QWxpYXNlcyhmaWxlTmFtZSwgcGFja2FnZUFsaWFzZXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZVJlcGxhY2VtZW50cylcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWxlTmFtZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TW9kdWxlRmlsZVBhdGggPSBwYXRoLnJlc29sdmUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRNb2R1bGVGaWxlUGF0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYCR7ZmlsZU5hbWV9JHttb2R1bGVFeHRlbnNpb259JHtmaWxlRXh0ZW5zaW9ufWBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE1vZHVsZUZpbGVQYXRoICs9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAke2ZpbGVOYW1lfSR7bW9kdWxlRXh0ZW5zaW9ufSR7ZmlsZUV4dGVuc2lvbn1gXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoSGVscGVyLmlzRmlsZVBhdGhJbkxvY2F0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRNb2R1bGVGaWxlUGF0aCwgcGF0aHNUb0lnbm9yZVxuICAgICAgICAgICAgICAgICAgICAgICAgKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFRvb2xzLmlzRmlsZVN5bmMoY3VycmVudE1vZHVsZUZpbGVQYXRoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudE1vZHVsZUZpbGVQYXRoXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG4gICAgLy8gZW5kcmVnaW9uXG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lcyBhIGNvbmNyZXRlIGZpbGUgcGF0aCBmb3IgZ2l2ZW4gbW9kdWxlIGlkLlxuICAgICAqIEBwYXJhbSBtb2R1bGVJRCAtIE1vZHVsZSBpZCB0byBkZXRlcm1pbmUuXG4gICAgICogQHBhcmFtIGFsaWFzZXMgLSBNYXBwaW5nIG9mIGFsaWFzZXMgdG8gdGFrZSBpbnRvIGFjY291bnQuXG4gICAgICogQHJldHVybnMgVGhlIGFsaWFzIGFwcGxpZWQgZ2l2ZW4gbW9kdWxlIGlkLlxuICAgICAqL1xuICAgIHN0YXRpYyBhcHBseUFsaWFzZXMobW9kdWxlSUQ6c3RyaW5nLCBhbGlhc2VzOlBsYWluT2JqZWN0KTpzdHJpbmcge1xuICAgICAgICBmb3IgKGNvbnN0IGFsaWFzOnN0cmluZyBpbiBhbGlhc2VzKVxuICAgICAgICAgICAgaWYgKGFsaWFzLmVuZHNXaXRoKCckJykpIHtcbiAgICAgICAgICAgICAgICBpZiAobW9kdWxlSUQgPT09IGFsaWFzLnN1YnN0cmluZygwLCBhbGlhcy5sZW5ndGggLSAxKSlcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlSUQgPSBhbGlhc2VzW2FsaWFzXVxuICAgICAgICAgICAgfSBlbHNlXG4gICAgICAgICAgICAgICAgbW9kdWxlSUQgPSBtb2R1bGVJRC5yZXBsYWNlKGFsaWFzLCBhbGlhc2VzW2FsaWFzXSlcbiAgICAgICAgcmV0dXJuIG1vZHVsZUlEXG4gICAgfVxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgYSBjb25jcmV0ZSBmaWxlIHBhdGggZm9yIGdpdmVuIG1vZHVsZSBpZC5cbiAgICAgKiBAcGFyYW0gbW9kdWxlSUQgLSBNb2R1bGUgaWQgdG8gZGV0ZXJtaW5lLlxuICAgICAqIEBwYXJhbSByZXBsYWNlbWVudHMgLSBNYXBwaW5nIG9mIHJlZ3VsYXIgZXhwcmVzc2lvbnMgdG8gdGhlaXJcbiAgICAgKiBjb3JyZXNwb25kaW5nIHJlcGxhY2VtZW50cy5cbiAgICAgKiBAcmV0dXJucyBUaGUgcmVwbGFjZW1lbnQgYXBwbGllZCBnaXZlbiBtb2R1bGUgaWQuXG4gICAgICovXG4gICAgc3RhdGljIGFwcGx5TW9kdWxlUmVwbGFjZW1lbnRzKFxuICAgICAgICBtb2R1bGVJRDpzdHJpbmcsIHJlcGxhY2VtZW50czpQbGFpbk9iamVjdFxuICAgICk6c3RyaW5nIHtcbiAgICAgICAgZm9yIChjb25zdCByZXBsYWNlbWVudDpzdHJpbmcgaW4gcmVwbGFjZW1lbnRzKVxuICAgICAgICAgICAgaWYgKHJlcGxhY2VtZW50cy5oYXNPd25Qcm9wZXJ0eShyZXBsYWNlbWVudCkpXG4gICAgICAgICAgICAgICAgbW9kdWxlSUQgPSBtb2R1bGVJRC5yZXBsYWNlKFxuICAgICAgICAgICAgICAgICAgICBuZXcgUmVnRXhwKHJlcGxhY2VtZW50KSwgcmVwbGFjZW1lbnRzW3JlcGxhY2VtZW50XSlcbiAgICAgICAgcmV0dXJuIG1vZHVsZUlEXG4gICAgfVxufVxuLy8gZW5kcmVnaW9uXG4vLyByZWdpb24gdmltIG1vZGxpbmVcbi8vIHZpbTogc2V0IHRhYnN0b3A9NCBzaGlmdHdpZHRoPTQgZXhwYW5kdGFiOlxuLy8gdmltOiBmb2xkbWV0aG9kPW1hcmtlciBmb2xkbWFya2VyPXJlZ2lvbixlbmRyZWdpb246XG4vLyBlbmRyZWdpb25cbiJdfQ==