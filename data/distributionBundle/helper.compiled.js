#!/usr/bin/env node
'use strict';var _set=require('babel-runtime/core-js/set'),_set2=_interopRequireDefault(_set),_from=require('babel-runtime/core-js/array/from'),_from2=_interopRequireDefault(_from),_clientnode=require('clientnode'),_clientnode2=_interopRequireDefault(_clientnode),_fs=require('fs'),fileSystem=_interopRequireWildcard(_fs),_path=require('path'),_path2=_interopRequireDefault(_path);Object.defineProperty(exports,'__esModule',{value:!0});function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}try{require('source-map-support/register')}catch(a){}class Helper{static isFilePathInLocation(a,b){for(const c of b)if(_path2.default.resolve(a).startsWith(_path2.default.resolve(c)))return!0;return!1}static stripLoader(a){a=a.toString();const b=a.substring(a.lastIndexOf('!')+1);return b.includes('?')?b.substring(0,b.indexOf('?')):b}static normalizePaths(a){return(0,_from2.default)(new _set2.default(a.map(b=>{return b=_path2.default.normalize(b),b.endsWith('/')?b.substring(0,b.length-1):b})))}static renderFilePathTemplate(a,b={'[name]':'.__dummy__','[id]':'.__dummy__','[hash]':'.__dummy__'}){let c=a;for(const d in b)b.hasOwnProperty(d)&&(c=c.replace(new RegExp(_clientnode2.default.stringEscapeRegularExpressions(d),'g'),b[d]));return c}static applyContext(a,b='./',c='./',d={},e={},f=['node_modules']){if(c=_path2.default.resolve(c),a.startsWith('./')&&_path2.default.resolve(b)!==c){a=_path2.default.resolve(b,a);for(const g of f){const h=_path2.default.resolve(c,g);if(a.startsWith(h))return a=a.substring(h.length),a.startsWith('/')&&(a=a.substring(1)),Helper.applyModuleReplacements(Helper.applyAliases(a.substring(a.lastIndexOf('!')+1),d),e)}if(a.startsWith(c))return a=a.substring(c.length),a.startsWith('/')&&(a=a.substring(1)),Helper.applyModuleReplacements(Helper.applyAliases(a.substring(a.lastIndexOf('!')+1),d),e)}return a}static determineExternalRequest(a,b='./',c='./',d={},e=['node_modules'],f={},g={},h={file:{external:['.js'],internal:['.js','.json','.css','.eot','.gif','.html','.ico','.jpg','.png','.pug','.svg','.ttf','.woff','.woff2']},module:[]},i='./',j=['.git'],k=['node_modules'],l=['index','main'],m=['main','module'],n=[],o=[],p=[],q=!1,r=!0){b=_path2.default.resolve(b),c=_path2.default.resolve(c),i=_path2.default.resolve(i);let s=Helper.applyModuleReplacements(Helper.applyAliases(a.substring(a.lastIndexOf('!')+1),f),g),t=Helper.determineModuleFilePath(s,{},{},h,b,c,j,k,l,m,n);if(!(t||q)||_clientnode2.default.isAnyMatching(s,o))return Helper.applyContext(s,c,i,f,g,k);if(_clientnode2.default.isAnyMatching(s,p))return null;for(const u in d)if(d.hasOwnProperty(u))for(const v of d[u])if(Helper.determineModuleFilePath(v,f,g,h,b,c,j,k,l,m,n)===t)return null;return!q&&(0===h.file.external.length||t&&h.file.external.includes(_path2.default.extname(t))||!t&&h.file.external.includes(''))&&!(r&&a.includes('!'))&&(!t&&r||t&&(!t.startsWith(b)||Helper.isFilePathInLocation(t,e)))?Helper.applyContext(s,c,i,f,g,k):null}static determineAssetType(a,b,c){let d=null;for(const e in b)if(`.${b[e].extension}`===_path2.default.extname(a)){d=e;break}if(!d)for(const e of['source','target'])for(const f in c[e].asset)if(c[e].asset.hasOwnProperty(f)&&'base'!==f&&c[e].asset[f]&&a.startsWith(c[e].asset[f]))return f;return d}static resolveBuildConfigurationFilePaths(a,b='./',c=['.git'],d=['index','main']){const e=[];for(const f in a)if(a.hasOwnProperty(f)){const g=_clientnode2.default.extendObject(!0,{filePaths:[]},a[f]);for(const h of _clientnode2.default.walkDirectoryRecursivelySync(b,i=>{if(Helper.isFilePathInLocation(i.path,c))return!1}))h.stat.isFile()&&_path2.default.extname(h.path).substring(1)===g.extension&&!new RegExp(g.filePathPattern).test(h.path)&&g.filePaths.push(h.path);g.filePaths.sort((h,i)=>{if(d.includes(_path2.default.basename(h,_path2.default.extname(h)))){if(d.includes(_path2.default.basename(i,_path2.default.extname(i))))return 0;}else if(d.includes(_path2.default.basename(i,_path2.default.extname(i))))return 1;return 0}),e.push(g)}return e.sort((f,g)=>{return f.outputExtension===g.outputExtension?0:'js'===f.outputExtension?-1:'js'===g.outputExtension?1:f.outputExtension<g.outputExtension?-1:1})}static determineModuleLocations(a,b={},c={},d={file:{external:['.js'],internal:['.js','.json','.css','.eot','.gif','.html','.ico','.jpg','.png','.pug','.svg','.ttf','.woff','.woff2']},module:[]},e='./',f='',g=['.git'],h=['','node_modules','../'],i=['__package__','','index','main'],j=['main','module'],k=[]){const l=[],m=[],n=Helper.resolveModulesInFolders(Helper.normalizeInternalInjection(a),b,c,d,e,f,g,h,i,j,k);for(const o in n)if(n.hasOwnProperty(o))for(const p of n[o]){const q=Helper.determineModuleFilePath(p,b,c,d,e,f,g,h,i,j,k);if(q){l.push(q);const r=_path2.default.dirname(q);m.includes(r)||m.push(r)}}return{filePaths:l,directoryPaths:m}}static resolveModulesInFolders(a,b={},c={},d={file:{external:['.js'],internal:['.js','.json','.css','.eot','.gif','.html','.ico','.jpg','.png','.pug','.svg','.ttf','.woff','.woff2']},module:[]},e='./',f='',g=['.git']){for(const h in f.startsWith('/')&&(f=_path2.default.relative(e,f)),a)if(a.hasOwnProperty(h)){let i=0;for(let j of a[h]){j=Helper.applyModuleReplacements(Helper.applyAliases(Helper.stripLoader(j),b),c);const k=_path2.default.resolve(f,j);if(_clientnode2.default.isDirectorySync(k)){a[h].splice(i,1);for(const l of _clientnode2.default.walkDirectoryRecursivelySync(k,m=>{if(Helper.isFilePathInLocation(m.path,g))return!1}))l.stat.isFile()&&a[h].push('./'+_path2.default.relative(f,_path2.default.resolve(k,l.path)))}else j.startsWith('./')&&!j.startsWith('./'+_path2.default.relative(e,f))&&(a[h][i]=`./${_path2.default.relative(e,k)}`);i+=1}}return a}static normalizeInternalInjection(a){let b={};if(a instanceof Object&&_clientnode2.default.isPlainObject(a)){let c=!1;const d=[];for(const e in a)a.hasOwnProperty(e)&&(Array.isArray(a[e])?0<a[e].length?(c=!0,b[e]=a[e]):d.push(e):(c=!0,b[e]=[a[e]]));if(c)for(const e of d)delete b[e];else b={index:[]}}else'string'==typeof a?b={index:[a]}:Array.isArray(a)&&(b={index:a});return b}static resolveInjection(a,b,c,d={},e={},f={file:{external:['.js'],internal:['.js','.json','.css','.eot','.gif','.html','.ico','.jpg','.png','.pug','.svg','.ttf','.woff','.woff2']},module:[]},g='./',h='',i=['.git']){const j=_clientnode2.default.extendObject(!0,{},a),k=Helper.determineModuleLocations(c,d,e,f,g,h,i).filePaths;for(const l of['internal','external'])if('object'==typeof j[l]){for(const m in j[l])if('__auto__'===j[l][m]){j[l][m]=[];const n=Helper.getAutoChunk(b,k,h);for(const o in n)n.hasOwnProperty(o)&&j[l][m].push(n[o]);j[l][m].reverse()}}else'__auto__'===j[l]&&(j[l]=Helper.getAutoChunk(b,k,g));return j}static getAutoChunk(a,b,c){const d={},e={};for(const f of a){e[f.outputExtension]||(e[f.outputExtension]=[]);for(const g of f.filePaths)if(!b.includes(g)){const h='./'+_path2.default.relative(c,g),i=_path2.default.dirname(h),j=_path2.default.basename(h,`.${f.extension}`);let k=j;'.'!==i&&(k=_path2.default.join(i,j)),e[f.outputExtension].includes(k)||(d.hasOwnProperty(k)?d[h]=h:d[k]=h,e[f.outputExtension].push(k))}}return d}static determineModuleFilePath(a,b={},c={},d={file:{external:['.js'],internal:['.js','.json','.css','.eot','.gif','.html','.ico','.jpg','.png','.pug','.svg','.ttf','.woff','.woff2']},module:[]},e='./',f='',g=['.git'],h=['node_modules'],i=['index'],j=['main'],k=[]){if(a=Helper.applyModuleReplacements(Helper.applyAliases(Helper.stripLoader(a),b),c),!a)return null;let l=a;l.startsWith('./')&&(l=_path2.default.join(f,l));for(const m of[f].concat(h.map(n=>_path2.default.resolve(e,n))))for(let n of['','__package__'].concat(i))for(const o of d.module.concat(['']))for(const p of[''].concat(d.file.internal)){let q=l.startsWith('/')?_path2.default.resolve(l):_path2.default.resolve(m,l);let r={};if('__package__'===n){if(_clientnode2.default.isDirectorySync(q)){const s=_path2.default.resolve(q,'package.json');if(_clientnode2.default.isFileSync(s)){let t={};try{t=JSON.parse(fileSystem.readFileSync(s,{encoding:'utf-8'}))}catch(u){}for(const u of j)if(t.hasOwnProperty(u)&&'string'==typeof t[u]&&t[u]){n=t[u];break}for(const u of k)if(t.hasOwnProperty(u)&&'object'==typeof t[u]){r=t[u];break}}}if('__package__'===n)continue}if(n=Helper.applyModuleReplacements(Helper.applyAliases(n,r),c),n?q=_path2.default.resolve(q,`${n}${o}${p}`):q+=`${n}${o}${p}`,!Helper.isFilePathInLocation(q,g)&&_clientnode2.default.isFileSync(q))return q}return null}static applyAliases(a,b){for(const c in b)c.endsWith('$')?a===c.substring(0,c.length-1)&&(a=b[c]):a=a.replace(c,b[c]);return a}static applyModuleReplacements(a,b){for(const c in b)b.hasOwnProperty(c)&&(a=a.replace(new RegExp(c),b[c]));return a}}exports.default=Helper;

//# sourceMappingURL=data:application/json;base64,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Q0FBcUMsQ0FBckMsQ0FBaUUsQ0FDN0QsSUFBSyxLQUFNLEVBQVgsR0FBMkIsRUFBM0IsQ0FDUSxFQUFNLFFBQU4sQ0FBZSxHQUFmLENBRFIsQ0FFWSxJQUFhLEVBQU0sU0FBTixDQUFnQixDQUFoQixDQUFtQixFQUFNLE1BQU4sQ0FBZSxDQUFsQyxDQUZ6QixHQUdZLEVBQVcsRUFBUSxDQUFSLENBSHZCLEVBS1EsRUFBVyxFQUFTLE9BQVQsQ0FBaUIsQ0FBakIsQ0FBd0IsRUFBUSxDQUFSLENBQXhCLENBTG5CLENBTUEsTUFBTyxFQUNWLENBUUQsTUFBTyx3QkFBUCxDQUNJLENBREosQ0FDcUIsQ0FEckIsQ0FFUyxDQUNMLElBQUssS0FBTSxFQUFYLEdBQWlDLEVBQWpDLENBQ1EsRUFBYSxjQUFiLENBQTRCLENBQTVCLENBRFIsR0FFUSxFQUFXLEVBQVMsT0FBVCxDQUNQLEdBQUksT0FBSixDQUFXLENBQVgsQ0FETyxDQUNrQixFQUFhLENBQWIsQ0FEbEIsQ0FGbkIsRUFJQSxNQUFPLEVBQ1YsQ0FwekJ1QixDLGdCQUFQLE0iLCJmaWxlIjoiaGVscGVyLmNvbXBpbGVkLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXG4vLyBAZmxvd1xuLy8gLSotIGNvZGluZzogdXRmLTggLSotXG4ndXNlIHN0cmljdCdcbi8qICFcbiAgICByZWdpb24gaGVhZGVyXG4gICAgQ29weXJpZ2h0IFRvcmJlbiBTaWNrZXJ0IChpbmZvW1wifmF0flwiXXRvcmJlbi53ZWJzaXRlKSAxNi4xMi4yMDEyXG5cbiAgICBMaWNlbnNlXG4gICAgLS0tLS0tLVxuXG4gICAgVGhpcyBsaWJyYXJ5IHdyaXR0ZW4gYnkgVG9yYmVuIFNpY2tlcnQgc3RhbmQgdW5kZXIgYSBjcmVhdGl2ZSBjb21tb25zIG5hbWluZ1xuICAgIDMuMCB1bnBvcnRlZCBsaWNlbnNlLiBzZWUgaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnkvMy4wL2RlZWQuZGVcbiAgICBlbmRyZWdpb25cbiovXG4vLyByZWdpb24gaW1wb3J0c1xuaW1wb3J0IFRvb2xzIGZyb20gJ2NsaWVudG5vZGUnXG5pbXBvcnQgdHlwZSB7RmlsZSwgUGxhaW5PYmplY3R9IGZyb20gJ2NsaWVudG5vZGUnXG5pbXBvcnQgKiBhcyBmaWxlU3lzdGVtIGZyb20gJ2ZzJ1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCdcbi8vIE5PVEU6IE9ubHkgbmVlZGVkIGZvciBkZWJ1Z2dpbmcgdGhpcyBmaWxlLlxudHJ5IHtcbiAgICByZXF1aXJlKCdzb3VyY2UtbWFwLXN1cHBvcnQvcmVnaXN0ZXInKVxufSBjYXRjaCAoZXJyb3IpIHt9XG5cbmltcG9ydCB0eXBlIHtcbiAgICBCdWlsZENvbmZpZ3VyYXRpb24sIEV4dGVuc2lvbnMsIEluamVjdGlvbiwgSW50ZXJuYWxJbmplY3Rpb24sXG4gICAgTm9ybWFsaXplZEludGVybmFsSW5qZWN0aW9uLCBQYXRoLCBSZXNvbHZlZEJ1aWxkQ29uZmlndXJhdGlvbixcbiAgICBSZXNvbHZlZEJ1aWxkQ29uZmlndXJhdGlvbkl0ZW1cbn0gZnJvbSAnLi90eXBlJ1xuLy8gZW5kcmVnaW9uXG4vLyByZWdpb24gbWV0aG9kc1xuLyoqXG4gKiBQcm92aWRlcyBhIGNsYXNzIG9mIHN0YXRpYyBtZXRob2RzIHdpdGggZ2VuZXJpYyB1c2UgY2FzZXMuXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEhlbHBlciB7XG4gICAgLy8gcmVnaW9uIGJvb2xlYW5cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmVzIHdoZXRoZXIgZ2l2ZW4gZmlsZSBwYXRoIGlzIHdpdGhpbiBnaXZlbiBsaXN0IG9mIGZpbGVcbiAgICAgKiBsb2NhdGlvbnMuXG4gICAgICogQHBhcmFtIGZpbGVQYXRoIC0gUGF0aCB0byBmaWxlIHRvIGNoZWNrLlxuICAgICAqIEBwYXJhbSBsb2NhdGlvbnNUb0NoZWNrIC0gTG9jYXRpb25zIHRvIHRha2UgaW50byBhY2NvdW50LlxuICAgICAqIEByZXR1cm5zIFZhbHVlIFwidHJ1ZVwiIGlmIGdpdmVuIGZpbGUgcGF0aCBpcyB3aXRoaW4gb25lIG9mIGdpdmVuXG4gICAgICogbG9jYXRpb25zIG9yIFwiZmFsc2VcIiBvdGhlcndpc2UuXG4gICAgICovXG4gICAgc3RhdGljIGlzRmlsZVBhdGhJbkxvY2F0aW9uKFxuICAgICAgICBmaWxlUGF0aDpzdHJpbmcsIGxvY2F0aW9uc1RvQ2hlY2s6QXJyYXk8c3RyaW5nPlxuICAgICk6Ym9vbGVhbiB7XG4gICAgICAgIGZvciAoY29uc3QgcGF0aFRvQ2hlY2s6c3RyaW5nIG9mIGxvY2F0aW9uc1RvQ2hlY2spXG4gICAgICAgICAgICBpZiAocGF0aC5yZXNvbHZlKGZpbGVQYXRoKS5zdGFydHNXaXRoKHBhdGgucmVzb2x2ZShwYXRoVG9DaGVjaykpKVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgICAvLyBlbmRyZWdpb25cbiAgICAvLyByZWdpb24gc3RyaW5nXG4gICAgLyoqXG4gICAgICogU3RyaXBzIGxvYWRlciBpbmZvcm1hdGlvbnMgZm9ybSBnaXZlbiBtb2R1bGUgcmVxdWVzdCBpbmNsdWRpbmcgbG9hZGVyXG4gICAgICogcHJlZml4IGFuZCBxdWVyeSBwYXJhbWV0ZXIuXG4gICAgICogQHBhcmFtIG1vZHVsZUlEIC0gTW9kdWxlIHJlcXVlc3QgdG8gc3RyaXAuXG4gICAgICogQHJldHVybnMgR2l2ZW4gbW9kdWxlIGlkIHN0cmlwcGVkLlxuICAgICAqL1xuICAgIHN0YXRpYyBzdHJpcExvYWRlcihtb2R1bGVJRDpzdHJpbmd8U3RyaW5nKTpzdHJpbmcge1xuICAgICAgICBtb2R1bGVJRCA9IG1vZHVsZUlELnRvU3RyaW5nKClcbiAgICAgICAgY29uc3QgbW9kdWxlSURXaXRob3V0TG9hZGVyOnN0cmluZyA9IG1vZHVsZUlELnN1YnN0cmluZyhcbiAgICAgICAgICAgIG1vZHVsZUlELmxhc3RJbmRleE9mKCchJykgKyAxKVxuICAgICAgICByZXR1cm4gbW9kdWxlSURXaXRob3V0TG9hZGVyLmluY2x1ZGVzKFxuICAgICAgICAgICAgJz8nXG4gICAgICAgICkgPyBtb2R1bGVJRFdpdGhvdXRMb2FkZXIuc3Vic3RyaW5nKDAsIG1vZHVsZUlEV2l0aG91dExvYWRlci5pbmRleE9mKFxuICAgICAgICAgICAgJz8nXG4gICAgICAgICkpIDogbW9kdWxlSURXaXRob3V0TG9hZGVyXG4gICAgfVxuICAgIC8vIGVuZHJlZ2lvblxuICAgIC8vIHJlZ2lvbiBhcnJheVxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGdpdmVuIGxpc3Qgb2YgcGF0aCB0byBhIG5vcm1hbGl6ZWQgbGlzdCB3aXRoIHVuaXF1ZSB2YWx1ZXMuXG4gICAgICogQHBhcmFtIHBhdGhzIC0gRmlsZSBwYXRocy5cbiAgICAgKiBAcmV0dXJucyBUaGUgZ2l2ZW4gZmlsZSBwYXRoIGxpc3Qgd2l0aCBub3JtYWxpemVkIHVuaXF1ZSB2YWx1ZXMuXG4gICAgICovXG4gICAgc3RhdGljIG5vcm1hbGl6ZVBhdGhzKHBhdGhzOkFycmF5PHN0cmluZz4pOkFycmF5PHN0cmluZz4ge1xuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbShuZXcgU2V0KHBhdGhzLm1hcCgoZ2l2ZW5QYXRoOnN0cmluZyk6c3RyaW5nID0+IHtcbiAgICAgICAgICAgIGdpdmVuUGF0aCA9IHBhdGgubm9ybWFsaXplKGdpdmVuUGF0aClcbiAgICAgICAgICAgIGlmIChnaXZlblBhdGguZW5kc1dpdGgoJy8nKSlcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2l2ZW5QYXRoLnN1YnN0cmluZygwLCBnaXZlblBhdGgubGVuZ3RoIC0gMSlcbiAgICAgICAgICAgIHJldHVybiBnaXZlblBhdGhcbiAgICAgICAgfSkpKVxuICAgIH1cbiAgICAvLyBlbmRyZWdpb25cbiAgICAvLyByZWdpb24gZmlsZSBoYW5kbGVyXG4gICAgLyoqXG4gICAgICogQXBwbGllcyBmaWxlIHBhdGgvbmFtZSBwbGFjZWhvbGRlciByZXBsYWNlbWVudHMgd2l0aCBnaXZlbiBidW5kbGVcbiAgICAgKiBhc3NvY2lhdGVkIGluZm9ybWF0aW9ucy5cbiAgICAgKiBAcGFyYW0gZmlsZVBhdGhUZW1wbGF0ZSAtIEZpbGUgcGF0aCB0byBwcm9jZXNzIHBsYWNlaG9sZGVyIGluLlxuICAgICAqIEBwYXJhbSBpbmZvcm1hdGlvbnMgLSBTY29wZSB0byB1c2UgZm9yIHByb2Nlc3NpbmcuXG4gICAgICogQHJldHVybnMgUHJvY2Vzc2VkIGZpbGUgcGF0aC5cbiAgICAgKi9cbiAgICBzdGF0aWMgcmVuZGVyRmlsZVBhdGhUZW1wbGF0ZShcbiAgICAgICAgZmlsZVBhdGhUZW1wbGF0ZTpzdHJpbmcsIGluZm9ybWF0aW9uczp7W2tleTpzdHJpbmddOnN0cmluZ30gPSB7XG4gICAgICAgICAgICAnW25hbWVdJzogJy5fX2R1bW15X18nLCAnW2lkXSc6ICcuX19kdW1teV9fJyxcbiAgICAgICAgICAgICdbaGFzaF0nOiAnLl9fZHVtbXlfXydcbiAgICAgICAgfVxuICAgICk6c3RyaW5nIHtcbiAgICAgICAgbGV0IGZpbGVQYXRoOnN0cmluZyA9IGZpbGVQYXRoVGVtcGxhdGVcbiAgICAgICAgZm9yIChjb25zdCBwbGFjZWhvbGRlck5hbWU6c3RyaW5nIGluIGluZm9ybWF0aW9ucylcbiAgICAgICAgICAgIGlmIChpbmZvcm1hdGlvbnMuaGFzT3duUHJvcGVydHkocGxhY2Vob2xkZXJOYW1lKSlcbiAgICAgICAgICAgICAgICBmaWxlUGF0aCA9IGZpbGVQYXRoLnJlcGxhY2UobmV3IFJlZ0V4cChcbiAgICAgICAgICAgICAgICAgICAgVG9vbHMuc3RyaW5nRXNjYXBlUmVndWxhckV4cHJlc3Npb25zKHBsYWNlaG9sZGVyTmFtZSksICdnJ1xuICAgICAgICAgICAgICAgICksIGluZm9ybWF0aW9uc1twbGFjZWhvbGRlck5hbWVdKVxuICAgICAgICByZXR1cm4gZmlsZVBhdGhcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29udmVydHMgZ2l2ZW4gcmVxdWVzdCB0byBhIHJlc29sdmVkIHJlcXVlc3Qgd2l0aCBnaXZlbiBjb250ZXh0XG4gICAgICogZW1iZWRkZWQuXG4gICAgICogQHBhcmFtIHJlcXVlc3QgLSBSZXF1ZXN0IHRvIGRldGVybWluZS5cbiAgICAgKiBAcGFyYW0gY29udGV4dCAtIENvbnRleHQgb2YgZ2l2ZW4gcmVxdWVzdCB0byByZXNvbHZlIHJlbGF0aXZlIHRvLlxuICAgICAqIEBwYXJhbSByZWZlcmVuY2VQYXRoIC0gUGF0aCB0byByZXNvbHZlIGxvY2FsIG1vZHVsZXMgcmVsYXRpdmUgdG8uXG4gICAgICogQHBhcmFtIGFsaWFzZXMgLSBNYXBwaW5nIG9mIGFsaWFzZXMgdG8gdGFrZSBpbnRvIGFjY291bnQuXG4gICAgICogQHBhcmFtIG1vZHVsZVJlcGxhY2VtZW50cyAtIE1hcHBpbmcgb2YgcmVwbGFjZW1lbnRzIHRvIHRha2UgaW50b1xuICAgICAqIGFjY291bnQuXG4gICAgICogQHBhcmFtIHJlbGF0aXZlTW9kdWxlRmlsZVBhdGhzIC0gTGlzdCBvZiByZWxhdGl2ZSBmaWxlIHBhdGggdG8gc2VhcmNoXG4gICAgICogZm9yIG1vZHVsZXMgaW4uXG4gICAgICogQHJldHVybnMgQSBuZXcgcmVzb2x2ZWQgcmVxdWVzdC5cbiAgICAgKi9cbiAgICBzdGF0aWMgYXBwbHlDb250ZXh0KFxuICAgICAgICByZXF1ZXN0OnN0cmluZywgY29udGV4dDpzdHJpbmcgPSAnLi8nLCByZWZlcmVuY2VQYXRoOnN0cmluZyA9ICcuLycsXG4gICAgICAgIGFsaWFzZXM6UGxhaW5PYmplY3QgPSB7fSwgbW9kdWxlUmVwbGFjZW1lbnRzOlBsYWluT2JqZWN0ID0ge30sXG4gICAgICAgIHJlbGF0aXZlTW9kdWxlRmlsZVBhdGhzOkFycmF5PHN0cmluZz4gPSBbJ25vZGVfbW9kdWxlcyddXG4gICAgKTpzdHJpbmcge1xuICAgICAgICByZWZlcmVuY2VQYXRoID0gcGF0aC5yZXNvbHZlKHJlZmVyZW5jZVBhdGgpXG4gICAgICAgIGlmIChyZXF1ZXN0LnN0YXJ0c1dpdGgoJy4vJykgJiYgcGF0aC5yZXNvbHZlKFxuICAgICAgICAgICAgY29udGV4dFxuICAgICAgICApICE9PSByZWZlcmVuY2VQYXRoKSB7XG4gICAgICAgICAgICByZXF1ZXN0ID0gcGF0aC5yZXNvbHZlKGNvbnRleHQsIHJlcXVlc3QpXG4gICAgICAgICAgICBmb3IgKGNvbnN0IG1vZHVsZVBhdGg6c3RyaW5nIG9mIHJlbGF0aXZlTW9kdWxlRmlsZVBhdGhzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcGF0aFByZWZpeDpzdHJpbmcgPSBwYXRoLnJlc29sdmUoXG4gICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZVBhdGgsIG1vZHVsZVBhdGgpXG4gICAgICAgICAgICAgICAgaWYgKHJlcXVlc3Quc3RhcnRzV2l0aChwYXRoUHJlZml4KSkge1xuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0ID0gcmVxdWVzdC5zdWJzdHJpbmcocGF0aFByZWZpeC5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXF1ZXN0LnN0YXJ0c1dpdGgoJy8nKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3QgPSByZXF1ZXN0LnN1YnN0cmluZygxKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gSGVscGVyLmFwcGx5TW9kdWxlUmVwbGFjZW1lbnRzKEhlbHBlci5hcHBseUFsaWFzZXMoXG4gICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnN1YnN0cmluZyhyZXF1ZXN0Lmxhc3RJbmRleE9mKCchJykgKyAxKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsaWFzZXNcbiAgICAgICAgICAgICAgICAgICAgKSwgbW9kdWxlUmVwbGFjZW1lbnRzKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZXF1ZXN0LnN0YXJ0c1dpdGgocmVmZXJlbmNlUGF0aCkpIHtcbiAgICAgICAgICAgICAgICByZXF1ZXN0ID0gcmVxdWVzdC5zdWJzdHJpbmcocmVmZXJlbmNlUGF0aC5sZW5ndGgpXG4gICAgICAgICAgICAgICAgaWYgKHJlcXVlc3Quc3RhcnRzV2l0aCgnLycpKVxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0ID0gcmVxdWVzdC5zdWJzdHJpbmcoMSlcbiAgICAgICAgICAgICAgICByZXR1cm4gSGVscGVyLmFwcGx5TW9kdWxlUmVwbGFjZW1lbnRzKEhlbHBlci5hcHBseUFsaWFzZXMoXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc3Vic3RyaW5nKHJlcXVlc3QubGFzdEluZGV4T2YoJyEnKSArIDEpLCBhbGlhc2VzXG4gICAgICAgICAgICAgICAgKSwgbW9kdWxlUmVwbGFjZW1lbnRzKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXF1ZXN0XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENoZWNrIGlmIGdpdmVuIHJlcXVlc3QgcG9pbnRzIHRvIGFuIGV4dGVybmFsIGRlcGVuZGVuY3kgbm90IG1haW50YWluZWRcbiAgICAgKiBieSBjdXJyZW50IHBhY2thZ2UgY29udGV4dC5cbiAgICAgKiBAcGFyYW0gcmVxdWVzdCAtIFJlcXVlc3QgdG8gZGV0ZXJtaW5lLlxuICAgICAqIEBwYXJhbSBjb250ZXh0IC0gQ29udGV4dCBvZiBjdXJyZW50IHByb2plY3QuXG4gICAgICogQHBhcmFtIHJlcXVlc3RDb250ZXh0IC0gQ29udGV4dCBvZiBnaXZlbiByZXF1ZXN0IHRvIHJlc29sdmUgcmVsYXRpdmUgdG8uXG4gICAgICogQHBhcmFtIG5vcm1hbGl6ZWRJbnRlcm5hbEluamVjdGlvbiAtIE1hcHBpbmcgb2YgY2h1bmsgbmFtZXMgdG8gbW9kdWxlc1xuICAgICAqIHdoaWNoIHNob3VsZCBiZSBpbmplY3RlZC5cbiAgICAgKiBAcGFyYW0gZXh0ZXJuYWxNb2R1bGVMb2NhdGlvbnMgLSBBcnJheSBpZiBwYXRocyB3aGVyZSBleHRlcm5hbCBtb2R1bGVzXG4gICAgICogdGFrZSBwbGFjZS5cbiAgICAgKiBAcGFyYW0gYWxpYXNlcyAtIE1hcHBpbmcgb2YgYWxpYXNlcyB0byB0YWtlIGludG8gYWNjb3VudC5cbiAgICAgKiBAcGFyYW0gbW9kdWxlUmVwbGFjZW1lbnRzIC0gTWFwcGluZyBvZiByZXBsYWNlbWVudHMgdG8gdGFrZSBpbnRvXG4gICAgICogYWNjb3VudC5cbiAgICAgKiBAcGFyYW0gZXh0ZW5zaW9ucyAtIExpc3Qgb2YgZmlsZSBhbmQgbW9kdWxlIGV4dGVuc2lvbnMgdG8gdGFrZSBpbnRvXG4gICAgICogYWNjb3VudC5cbiAgICAgKiBAcGFyYW0gcmVmZXJlbmNlUGF0aCAtIFBhdGggdG8gcmVzb2x2ZSBsb2NhbCBtb2R1bGVzIHJlbGF0aXZlIHRvLlxuICAgICAqIEBwYXJhbSBwYXRoc1RvSWdub3JlIC0gUGF0aHMgd2hpY2ggbWFya3MgbG9jYXRpb24gdG8gaWdub3JlLlxuICAgICAqIEBwYXJhbSByZWxhdGl2ZU1vZHVsZUZpbGVQYXRocyAtIExpc3Qgb2YgcmVsYXRpdmUgZmlsZSBwYXRoIHRvIHNlYXJjaFxuICAgICAqIGZvciBtb2R1bGVzIGluLlxuICAgICAqIEBwYXJhbSBwYWNrYWdlRW50cnlGaWxlTmFtZXMgLSBMaXN0IG9mIHBhY2thZ2UgZW50cnkgZmlsZSBuYW1lcyB0b1xuICAgICAqIHNlYXJjaCBmb3IuIFRoZSBtYWdpYyBuYW1lIFwiX19wYWNrYWdlX19cIiB3aWxsIHNlYXJjaCBmb3IgYW4gYXBwcmVjaWF0ZVxuICAgICAqIGVudHJ5IGluIGEgXCJwYWNrYWdlLmpzb25cIiBmaWxlLlxuICAgICAqIEBwYXJhbSBwYWNrYWdlTWFpblByb3BlcnR5TmFtZXMgLSBMaXN0IG9mIHBhY2thZ2UgZmlsZSBtYWluIHByb3BlcnR5XG4gICAgICogbmFtZXMgdG8gc2VhcmNoIGZvciBwYWNrYWdlIHJlcHJlc2VudGluZyBlbnRyeSBtb2R1bGUgZGVmaW5pdGlvbnMuXG4gICAgICogQHBhcmFtIHBhY2thZ2VBbGlhc1Byb3BlcnR5TmFtZXMgLSBMaXN0IG9mIHBhY2thZ2UgZmlsZSBhbGlhcyBwcm9wZXJ0eVxuICAgICAqIG5hbWVzIHRvIHNlYXJjaCBmb3IgcGFja2FnZSBzcGVjaWZpYyBtb2R1bGUgYWxpYXNlcy5cbiAgICAgKiBAcGFyYW0gaW5jbHVkZVBhdHRlcm4gLSBBcnJheSBvZiByZWd1bGFyIGV4cHJlc3Npb25zIHRvIGV4cGxpY2l0bHkgbWFya1xuICAgICAqIGFzIGV4dGVybmFsIGRlcGVuZGVuY3kuXG4gICAgICogQHBhcmFtIGV4Y2x1ZGVQYXR0ZXJuIC0gQXJyYXkgb2YgcmVndWxhciBleHByZXNzaW9ucyB0byBleHBsaWNpdGx5IG1hcmtcbiAgICAgKiBhcyBpbnRlcm5hbCBkZXBlbmRlbmN5LlxuICAgICAqIEBwYXJhbSBpblBsYWNlTm9ybWFsTGlicmFyeSAtIEluZGljYXRlcyB3aGV0aGVyIG5vcm1hbCBsaWJyYXJpZXMgc2hvdWxkXG4gICAgICogYmUgZXh0ZXJuYWwgb3Igbm90LlxuICAgICAqIEBwYXJhbSBpblBsYWNlRHluYW1pY0xpYnJhcnkgLSBJbmRpY2F0ZXMgd2hldGhlciByZXF1ZXN0cyB3aXRoXG4gICAgICogaW50ZWdyYXRlZCBsb2FkZXIgY29uZmlndXJhdGlvbnMgc2hvdWxkIGJlIG1hcmtlZCBhcyBleHRlcm5hbCBvciBub3QuXG4gICAgICogQHJldHVybnMgQSBuZXcgcmVzb2x2ZWQgcmVxdWVzdCBpbmRpY2F0aW5nIHdoZXRoZXIgZ2l2ZW4gcmVxdWVzdCBpcyBhblxuICAgICAqIGV4dGVybmFsIG9uZS5cbiAgICAgKi9cbiAgICBzdGF0aWMgZGV0ZXJtaW5lRXh0ZXJuYWxSZXF1ZXN0KFxuICAgICAgICByZXF1ZXN0OnN0cmluZywgY29udGV4dDpzdHJpbmcgPSAnLi8nLCByZXF1ZXN0Q29udGV4dDpzdHJpbmcgPSAnLi8nLFxuICAgICAgICBub3JtYWxpemVkSW50ZXJuYWxJbmplY3Rpb246Tm9ybWFsaXplZEludGVybmFsSW5qZWN0aW9uID0ge30sXG4gICAgICAgIGV4dGVybmFsTW9kdWxlTG9jYXRpb25zOkFycmF5PHN0cmluZz4gPSBbJ25vZGVfbW9kdWxlcyddLFxuICAgICAgICBhbGlhc2VzOlBsYWluT2JqZWN0ID0ge30sIG1vZHVsZVJlcGxhY2VtZW50czpQbGFpbk9iamVjdCA9IHt9LFxuICAgICAgICBleHRlbnNpb25zOkV4dGVuc2lvbnMgPSB7XG4gICAgICAgICAgICBmaWxlOiB7XG4gICAgICAgICAgICAgICAgZXh0ZXJuYWw6IFsnLmpzJ10sXG4gICAgICAgICAgICAgICAgaW50ZXJuYWw6IFtcbiAgICAgICAgICAgICAgICAgICAgJy5qcycsICcuanNvbicsICcuY3NzJywgJy5lb3QnLCAnLmdpZicsICcuaHRtbCcsICcuaWNvJyxcbiAgICAgICAgICAgICAgICAgICAgJy5qcGcnLCAnLnBuZycsICcucHVnJywgJy5zdmcnLCAnLnR0ZicsICcud29mZicsICcud29mZjInXG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfSwgbW9kdWxlOiBbXVxuICAgICAgICB9LCByZWZlcmVuY2VQYXRoOnN0cmluZyA9ICcuLycsIHBhdGhzVG9JZ25vcmU6QXJyYXk8c3RyaW5nPiA9IFsnLmdpdCddLFxuICAgICAgICByZWxhdGl2ZU1vZHVsZUZpbGVQYXRoczpBcnJheTxzdHJpbmc+ID0gWydub2RlX21vZHVsZXMnXSxcbiAgICAgICAgcGFja2FnZUVudHJ5RmlsZU5hbWVzOkFycmF5PHN0cmluZz4gPSBbJ2luZGV4JywgJ21haW4nXSxcbiAgICAgICAgcGFja2FnZU1haW5Qcm9wZXJ0eU5hbWVzOkFycmF5PHN0cmluZz4gPSBbJ21haW4nLCAnbW9kdWxlJ10sXG4gICAgICAgIHBhY2thZ2VBbGlhc1Byb3BlcnR5TmFtZXM6QXJyYXk8c3RyaW5nPiA9IFtdLFxuICAgICAgICBpbmNsdWRlUGF0dGVybjpBcnJheTxzdHJpbmd8UmVnRXhwPiA9IFtdLFxuICAgICAgICBleGNsdWRlUGF0dGVybjpBcnJheTxzdHJpbmd8UmVnRXhwPiA9IFtdLFxuICAgICAgICBpblBsYWNlTm9ybWFsTGlicmFyeTpib29sZWFuID0gZmFsc2UsXG4gICAgICAgIGluUGxhY2VEeW5hbWljTGlicmFyeTpib29sZWFuID0gdHJ1ZVxuICAgICk6P3N0cmluZyB7XG4gICAgICAgIGNvbnRleHQgPSBwYXRoLnJlc29sdmUoY29udGV4dClcbiAgICAgICAgcmVxdWVzdENvbnRleHQgPSBwYXRoLnJlc29sdmUocmVxdWVzdENvbnRleHQpXG4gICAgICAgIHJlZmVyZW5jZVBhdGggPSBwYXRoLnJlc29sdmUocmVmZXJlbmNlUGF0aClcbiAgICAgICAgLy8gTk9URTogV2UgYXBwbHkgYWxpYXMgb24gZXh0ZXJuYWxzIGFkZGl0aW9uYWxseS5cbiAgICAgICAgbGV0IHJlc29sdmVkUmVxdWVzdDpzdHJpbmcgPSBIZWxwZXIuYXBwbHlNb2R1bGVSZXBsYWNlbWVudHMoXG4gICAgICAgICAgICBIZWxwZXIuYXBwbHlBbGlhc2VzKHJlcXVlc3Quc3Vic3RyaW5nKFxuICAgICAgICAgICAgICAgIHJlcXVlc3QubGFzdEluZGV4T2YoJyEnKSArIDFcbiAgICAgICAgICAgICksIGFsaWFzZXMpLCBtb2R1bGVSZXBsYWNlbWVudHMpXG4gICAgICAgIC8qXG4gICAgICAgICAgICBOT1RFOiBBbGlhc2VzIGFuZCBtb2R1bGUgcmVwbGFjZW1lbnRzIGRvZXNuJ3QgaGF2ZSB0byBiZSBmb3J3YXJkZWRcbiAgICAgICAgICAgIHNpbmNlIHdlIHBhc3MgYW4gYWxyZWFkeSByZXNvbHZlZCByZXF1ZXN0LlxuICAgICAgICAqL1xuICAgICAgICBsZXQgZmlsZVBhdGg6P3N0cmluZyA9IEhlbHBlci5kZXRlcm1pbmVNb2R1bGVGaWxlUGF0aChcbiAgICAgICAgICAgIHJlc29sdmVkUmVxdWVzdCwge30sIHt9LCBleHRlbnNpb25zLCBjb250ZXh0LCByZXF1ZXN0Q29udGV4dCxcbiAgICAgICAgICAgIHBhdGhzVG9JZ25vcmUsIHJlbGF0aXZlTW9kdWxlRmlsZVBhdGhzLCBwYWNrYWdlRW50cnlGaWxlTmFtZXMsXG4gICAgICAgICAgICBwYWNrYWdlTWFpblByb3BlcnR5TmFtZXMsIHBhY2thZ2VBbGlhc1Byb3BlcnR5TmFtZXMpXG4gICAgICAgIC8qXG4gICAgICAgICAgICBOT1RFOiBXZSBtYXJrIGRlcGVuZGVuY2llcyBhcyBleHRlcm5hbCBpZiB0aGVyZSBmaWxlIGNvdWxkbid0IGJlXG4gICAgICAgICAgICByZXNvbHZlZCBvciBhcmUgc3BlY2lmaWVkIHRvIGJlIGV4dGVybmFsIGV4cGxpY2l0bHkuXG4gICAgICAgICovXG4gICAgICAgIGlmICghKGZpbGVQYXRoIHx8IGluUGxhY2VOb3JtYWxMaWJyYXJ5KSB8fCBUb29scy5pc0FueU1hdGNoaW5nKFxuICAgICAgICAgICAgcmVzb2x2ZWRSZXF1ZXN0LCBpbmNsdWRlUGF0dGVyblxuICAgICAgICApKVxuICAgICAgICAgICAgcmV0dXJuIEhlbHBlci5hcHBseUNvbnRleHQoXG4gICAgICAgICAgICAgICAgcmVzb2x2ZWRSZXF1ZXN0LCByZXF1ZXN0Q29udGV4dCwgcmVmZXJlbmNlUGF0aCxcbiAgICAgICAgICAgICAgICBhbGlhc2VzLCBtb2R1bGVSZXBsYWNlbWVudHMsIHJlbGF0aXZlTW9kdWxlRmlsZVBhdGhzKVxuICAgICAgICBpZiAoVG9vbHMuaXNBbnlNYXRjaGluZyhyZXNvbHZlZFJlcXVlc3QsIGV4Y2x1ZGVQYXR0ZXJuKSlcbiAgICAgICAgICAgIHJldHVybiBudWxsXG4gICAgICAgIGZvciAoY29uc3QgY2h1bmtOYW1lOnN0cmluZyBpbiBub3JtYWxpemVkSW50ZXJuYWxJbmplY3Rpb24pXG4gICAgICAgICAgICBpZiAobm9ybWFsaXplZEludGVybmFsSW5qZWN0aW9uLmhhc093blByb3BlcnR5KGNodW5rTmFtZSkpXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBtb2R1bGVJRDpzdHJpbmcgb2Ygbm9ybWFsaXplZEludGVybmFsSW5qZWN0aW9uW1xuICAgICAgICAgICAgICAgICAgICBjaHVua05hbWVcbiAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgICAgICBpZiAoSGVscGVyLmRldGVybWluZU1vZHVsZUZpbGVQYXRoKFxuICAgICAgICAgICAgICAgICAgICAgICAgbW9kdWxlSUQsIGFsaWFzZXMsIG1vZHVsZVJlcGxhY2VtZW50cywgZXh0ZW5zaW9ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQsIHJlcXVlc3RDb250ZXh0LCBwYXRoc1RvSWdub3JlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRpdmVNb2R1bGVGaWxlUGF0aHMsIHBhY2thZ2VFbnRyeUZpbGVOYW1lcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhY2thZ2VNYWluUHJvcGVydHlOYW1lcywgcGFja2FnZUFsaWFzUHJvcGVydHlOYW1lc1xuICAgICAgICAgICAgICAgICAgICApID09PSBmaWxlUGF0aClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsXG4gICAgICAgIC8qXG4gICAgICAgICAgICBOT1RFOiBXZSBtYXJrIGRlcGVuZGVuY2llcyBhcyBleHRlcm5hbCBpZiB0aGV5IGRvZXMgbm90IGNvbnRhaW4gYVxuICAgICAgICAgICAgbG9hZGVyIGluIHRoZWlyIHJlcXVlc3QgYW5kIGFyZW4ndCBwYXJ0IG9mIHRoZSBjdXJyZW50IG1haW4gcGFja2FnZVxuICAgICAgICAgICAgb3IgaGF2ZSBhIGZpbGUgZXh0ZW5zaW9uIG90aGVyIHRoYW4gamF2YVNjcmlwdCBhd2FyZS5cbiAgICAgICAgKi9cbiAgICAgICAgaWYgKCFpblBsYWNlTm9ybWFsTGlicmFyeSAmJiAoXG4gICAgICAgICAgICBleHRlbnNpb25zLmZpbGUuZXh0ZXJuYWwubGVuZ3RoID09PSAwIHx8IGZpbGVQYXRoICYmXG4gICAgICAgICAgICBleHRlbnNpb25zLmZpbGUuZXh0ZXJuYWwuaW5jbHVkZXMocGF0aC5leHRuYW1lKGZpbGVQYXRoKSkgfHxcbiAgICAgICAgICAgICFmaWxlUGF0aCAmJiBleHRlbnNpb25zLmZpbGUuZXh0ZXJuYWwuaW5jbHVkZXMoJycpXG4gICAgICAgICkgJiYgIShpblBsYWNlRHluYW1pY0xpYnJhcnkgJiYgcmVxdWVzdC5pbmNsdWRlcygnIScpKSAmJiAoXG4gICAgICAgICAgICAhZmlsZVBhdGggJiYgaW5QbGFjZUR5bmFtaWNMaWJyYXJ5IHx8IGZpbGVQYXRoICYmIChcbiAgICAgICAgICAgICFmaWxlUGF0aC5zdGFydHNXaXRoKGNvbnRleHQpIHx8IEhlbHBlci5pc0ZpbGVQYXRoSW5Mb2NhdGlvbihcbiAgICAgICAgICAgICAgICBmaWxlUGF0aCwgZXh0ZXJuYWxNb2R1bGVMb2NhdGlvbnMpKVxuICAgICAgICApKVxuICAgICAgICAgICAgcmV0dXJuIEhlbHBlci5hcHBseUNvbnRleHQoXG4gICAgICAgICAgICAgICAgcmVzb2x2ZWRSZXF1ZXN0LCByZXF1ZXN0Q29udGV4dCwgcmVmZXJlbmNlUGF0aCwgYWxpYXNlcyxcbiAgICAgICAgICAgICAgICBtb2R1bGVSZXBsYWNlbWVudHMsIHJlbGF0aXZlTW9kdWxlRmlsZVBhdGhzKVxuICAgICAgICByZXR1cm4gbnVsbFxuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmVzIGEgYXNzZXQgdHlwZSBpZiBnaXZlbiBmaWxlLlxuICAgICAqIEBwYXJhbSBmaWxlUGF0aCAtIFBhdGggdG8gZmlsZSB0byBhbmFseXNlLlxuICAgICAqIEBwYXJhbSBidWlsZENvbmZpZ3VyYXRpb24gLSBNZXRhIGluZm9ybWF0aW9ucyBmb3IgYXZhaWxhYmxlIGFzc2V0XG4gICAgICogdHlwZXMuXG4gICAgICogQHBhcmFtIHBhdGhzIC0gTGlzdCBvZiBwYXRocyB0byBzZWFyY2ggaWYgZ2l2ZW4gcGF0aCBkb2Vzbid0IHJlZmVyZW5jZVxuICAgICAqIGEgZmlsZSBkaXJlY3RseS5cbiAgICAgKiBAcmV0dXJucyBEZXRlcm1pbmVkIGZpbGUgdHlwZSBvciBcIm51bGxcIiBvZiBnaXZlbiBmaWxlIGNvdWxkbid0IGJlXG4gICAgICogZGV0ZXJtaW5lZC5cbiAgICAgKi9cbiAgICBzdGF0aWMgZGV0ZXJtaW5lQXNzZXRUeXBlKFxuICAgICAgICBmaWxlUGF0aDpzdHJpbmcsIGJ1aWxkQ29uZmlndXJhdGlvbjpCdWlsZENvbmZpZ3VyYXRpb24sIHBhdGhzOlBhdGhcbiAgICApOj9zdHJpbmcge1xuICAgICAgICBsZXQgcmVzdWx0Oj9zdHJpbmcgPSBudWxsXG4gICAgICAgIGZvciAoY29uc3QgdHlwZTpzdHJpbmcgaW4gYnVpbGRDb25maWd1cmF0aW9uKVxuICAgICAgICAgICAgaWYgKHBhdGguZXh0bmFtZShcbiAgICAgICAgICAgICAgICBmaWxlUGF0aFxuICAgICAgICAgICAgKSA9PT0gYC4ke2J1aWxkQ29uZmlndXJhdGlvblt0eXBlXS5leHRlbnNpb259YCkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHR5cGVcbiAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgfVxuICAgICAgICBpZiAoIXJlc3VsdClcbiAgICAgICAgICAgIGZvciAoY29uc3QgdHlwZTpzdHJpbmcgb2YgWydzb3VyY2UnLCAndGFyZ2V0J10pXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBhc3NldFR5cGU6c3RyaW5nIGluIHBhdGhzW3R5cGVdLmFzc2V0KVxuICAgICAgICAgICAgICAgICAgICBpZiAocGF0aHNbdHlwZV0uYXNzZXQuaGFzT3duUHJvcGVydHkoXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NldFR5cGVcbiAgICAgICAgICAgICAgICAgICAgKSAmJiBhc3NldFR5cGUgIT09ICdiYXNlJyAmJlxuICAgICAgICAgICAgICAgICAgICBwYXRoc1t0eXBlXS5hc3NldFthc3NldFR5cGVdICYmIGZpbGVQYXRoLnN0YXJ0c1dpdGgoXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXRoc1t0eXBlXS5hc3NldFthc3NldFR5cGVdXG4gICAgICAgICAgICAgICAgICAgICkpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXNzZXRUeXBlXG4gICAgICAgIHJldHVybiByZXN1bHRcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyBhIHByb3BlcnR5IHdpdGggYSBzdG9yZWQgYXJyYXkgb2YgYWxsIG1hdGNoaW5nIGZpbGUgcGF0aHMsIHdoaWNoXG4gICAgICogbWF0Y2hlcyBlYWNoIGJ1aWxkIGNvbmZpZ3VyYXRpb24gaW4gZ2l2ZW4gZW50cnkgcGF0aCBhbmQgY29udmVydHMgZ2l2ZW5cbiAgICAgKiBidWlsZCBjb25maWd1cmF0aW9uIGludG8gYSBzb3J0ZWQgYXJyYXkgd2VyZSBqYXZhU2NyaXB0IGZpbGVzIHRha2VzXG4gICAgICogcHJlY2VkZW5jZS5cbiAgICAgKiBAcGFyYW0gY29uZmlndXJhdGlvbiAtIEdpdmVuIGJ1aWxkIGNvbmZpZ3VyYXRpb25zLlxuICAgICAqIEBwYXJhbSBlbnRyeVBhdGggLSBQYXRoIHRvIGFuYWx5c2UgbmVzdGVkIHN0cnVjdHVyZS5cbiAgICAgKiBAcGFyYW0gcGF0aHNUb0lnbm9yZSAtIFBhdGhzIHdoaWNoIG1hcmtzIGxvY2F0aW9uIHRvIGlnbm9yZS5cbiAgICAgKiBAcGFyYW0gbWFpbkZpbGVCYXNlbmFtZXMgLSBGaWxlIGJhc2VuYW1lcyB0byBzb3J0IGludG8gdGhlIGZyb250LlxuICAgICAqIEByZXR1cm5zIENvbnZlcnRlZCBidWlsZCBjb25maWd1cmF0aW9uLlxuICAgICAqL1xuICAgIHN0YXRpYyByZXNvbHZlQnVpbGRDb25maWd1cmF0aW9uRmlsZVBhdGhzKFxuICAgICAgICBjb25maWd1cmF0aW9uOkJ1aWxkQ29uZmlndXJhdGlvbiwgZW50cnlQYXRoOnN0cmluZyA9ICcuLycsXG4gICAgICAgIHBhdGhzVG9JZ25vcmU6QXJyYXk8c3RyaW5nPiA9IFsnLmdpdCddLFxuICAgICAgICBtYWluRmlsZUJhc2VuYW1lczpBcnJheTxzdHJpbmc+ID0gWydpbmRleCcsICdtYWluJ11cbiAgICApOlJlc29sdmVkQnVpbGRDb25maWd1cmF0aW9uIHtcbiAgICAgICAgY29uc3QgYnVpbGRDb25maWd1cmF0aW9uOlJlc29sdmVkQnVpbGRDb25maWd1cmF0aW9uID0gW11cbiAgICAgICAgZm9yIChjb25zdCB0eXBlOnN0cmluZyBpbiBjb25maWd1cmF0aW9uKVxuICAgICAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb24uaGFzT3duUHJvcGVydHkodHlwZSkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdJdGVtOlJlc29sdmVkQnVpbGRDb25maWd1cmF0aW9uSXRlbSA9XG4gICAgICAgICAgICAgICAgICAgIFRvb2xzLmV4dGVuZE9iamVjdCh0cnVlLCB7ZmlsZVBhdGhzOiBbXX0sIGNvbmZpZ3VyYXRpb25bXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlXSlcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGZpbGU6RmlsZSBvZiBUb29scy53YWxrRGlyZWN0b3J5UmVjdXJzaXZlbHlTeW5jKFxuICAgICAgICAgICAgICAgICAgICBlbnRyeVBhdGgsIChmaWxlOkZpbGUpOj9mYWxzZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoSGVscGVyLmlzRmlsZVBhdGhJbkxvY2F0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUucGF0aCwgcGF0aHNUb0lnbm9yZVxuICAgICAgICAgICAgICAgICAgICAgICAgKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICkpXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlLnN0YXQuaXNGaWxlKCkgJiYgcGF0aC5leHRuYW1lKFxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5wYXRoXG4gICAgICAgICAgICAgICAgICAgICkuc3Vic3RyaW5nKDEpID09PSBuZXdJdGVtLmV4dGVuc2lvbiAmJiAhKFxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFJlZ0V4cChuZXdJdGVtLmZpbGVQYXRoUGF0dGVybilcbiAgICAgICAgICAgICAgICAgICAgKS50ZXN0KGZpbGUucGF0aCkpXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdJdGVtLmZpbGVQYXRocy5wdXNoKGZpbGUucGF0aClcbiAgICAgICAgICAgICAgICBuZXdJdGVtLmZpbGVQYXRocy5zb3J0KChcbiAgICAgICAgICAgICAgICAgICAgZmlyc3RGaWxlUGF0aDpzdHJpbmcsIHNlY29uZEZpbGVQYXRoOnN0cmluZ1xuICAgICAgICAgICAgICAgICk6bnVtYmVyID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1haW5GaWxlQmFzZW5hbWVzLmluY2x1ZGVzKHBhdGguYmFzZW5hbWUoXG4gICAgICAgICAgICAgICAgICAgICAgICBmaXJzdEZpbGVQYXRoLCBwYXRoLmV4dG5hbWUoZmlyc3RGaWxlUGF0aClcbiAgICAgICAgICAgICAgICAgICAgKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYWluRmlsZUJhc2VuYW1lcy5pbmNsdWRlcyhwYXRoLmJhc2VuYW1lKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZEZpbGVQYXRoLCBwYXRoLmV4dG5hbWUoc2Vjb25kRmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICApKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMFxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1haW5GaWxlQmFzZW5hbWVzLmluY2x1ZGVzKHBhdGguYmFzZW5hbWUoXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWNvbmRGaWxlUGF0aCwgcGF0aC5leHRuYW1lKHNlY29uZEZpbGVQYXRoKVxuICAgICAgICAgICAgICAgICAgICApKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICBidWlsZENvbmZpZ3VyYXRpb24ucHVzaChuZXdJdGVtKVxuICAgICAgICAgICAgfVxuICAgICAgICByZXR1cm4gYnVpbGRDb25maWd1cmF0aW9uLnNvcnQoKFxuICAgICAgICAgICAgZmlyc3Q6UmVzb2x2ZWRCdWlsZENvbmZpZ3VyYXRpb25JdGVtLFxuICAgICAgICAgICAgc2Vjb25kOlJlc29sdmVkQnVpbGRDb25maWd1cmF0aW9uSXRlbVxuICAgICAgICApOm51bWJlciA9PiB7XG4gICAgICAgICAgICBpZiAoZmlyc3Qub3V0cHV0RXh0ZW5zaW9uICE9PSBzZWNvbmQub3V0cHV0RXh0ZW5zaW9uKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZpcnN0Lm91dHB1dEV4dGVuc2lvbiA9PT0gJ2pzJylcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xXG4gICAgICAgICAgICAgICAgaWYgKHNlY29uZC5vdXRwdXRFeHRlbnNpb24gPT09ICdqcycpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAxXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpcnN0Lm91dHB1dEV4dGVuc2lvbiA8IHNlY29uZC5vdXRwdXRFeHRlbnNpb24gPyAtMSA6IDFcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAwXG4gICAgICAgIH0pXG4gICAgfVxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgYWxsIGZpbGUgYW5kIGRpcmVjdG9yeSBwYXRocyByZWxhdGVkIHRvIGdpdmVuIGludGVybmFsXG4gICAgICogbW9kdWxlcyBhcyBhcnJheS5cbiAgICAgKiBAcGFyYW0gaW50ZXJuYWxJbmplY3Rpb24gLSBMaXN0IG9mIG1vZHVsZSBpZHMgb3IgbW9kdWxlIGZpbGUgcGF0aHMuXG4gICAgICogQHBhcmFtIGFsaWFzZXMgLSBNYXBwaW5nIG9mIGFsaWFzZXMgdG8gdGFrZSBpbnRvIGFjY291bnQuXG4gICAgICogQHBhcmFtIG1vZHVsZVJlcGxhY2VtZW50cyAtIE1hcHBpbmcgb2YgbW9kdWxlIHJlcGxhY2VtZW50cyB0byB0YWtlIGludG9cbiAgICAgKiBhY2NvdW50LlxuICAgICAqIEBwYXJhbSBleHRlbnNpb25zIC0gTGlzdCBvZiBmaWxlIGFuZCBtb2R1bGUgZXh0ZW5zaW9ucyB0byB0YWtlIGludG9cbiAgICAgKiBhY2NvdW50LlxuICAgICAqIEBwYXJhbSBjb250ZXh0IC0gRmlsZSBwYXRoIHRvIHJlc29sdmUgcmVsYXRpdmUgdG8uXG4gICAgICogQHBhcmFtIHJlZmVyZW5jZVBhdGggLSBQYXRoIHRvIHNlYXJjaCBmb3IgbG9jYWwgbW9kdWxlcy5cbiAgICAgKiBAcGFyYW0gcGF0aHNUb0lnbm9yZSAtIFBhdGhzIHdoaWNoIG1hcmtzIGxvY2F0aW9uIHRvIGlnbm9yZS5cbiAgICAgKiBAcGFyYW0gcmVsYXRpdmVNb2R1bGVGaWxlUGF0aHMgLSBMaXN0IG9mIHJlbGF0aXZlIGZpbGUgcGF0aCB0byBzZWFyY2hcbiAgICAgKiBmb3IgbW9kdWxlcyBpbi5cbiAgICAgKiBAcGFyYW0gcGFja2FnZUVudHJ5RmlsZU5hbWVzIC0gTGlzdCBvZiBwYWNrYWdlIGVudHJ5IGZpbGUgbmFtZXMgdG9cbiAgICAgKiBzZWFyY2ggZm9yLiBUaGUgbWFnaWMgbmFtZSBcIl9fcGFja2FnZV9fXCIgd2lsbCBzZWFyY2ggZm9yIGFuIGFwcHJlY2lhdGVcbiAgICAgKiBlbnRyeSBpbiBhIFwicGFja2FnZS5qc29uXCIgZmlsZS5cbiAgICAgKiBAcGFyYW0gcGFja2FnZU1haW5Qcm9wZXJ0eU5hbWVzIC0gTGlzdCBvZiBwYWNrYWdlIGZpbGUgbWFpbiBwcm9wZXJ0eVxuICAgICAqIG5hbWVzIHRvIHNlYXJjaCBmb3IgcGFja2FnZSByZXByZXNlbnRpbmcgZW50cnkgbW9kdWxlIGRlZmluaXRpb25zLlxuICAgICAqIEBwYXJhbSBwYWNrYWdlQWxpYXNQcm9wZXJ0eU5hbWVzIC0gTGlzdCBvZiBwYWNrYWdlIGZpbGUgYWxpYXMgcHJvcGVydHlcbiAgICAgKiBuYW1lcyB0byBzZWFyY2ggZm9yIHBhY2thZ2Ugc3BlY2lmaWMgbW9kdWxlIGFsaWFzZXMuXG4gICAgICogQHJldHVybnMgT2JqZWN0IHdpdGggYSBmaWxlIHBhdGggYW5kIGRpcmVjdG9yeSBwYXRoIGtleSBtYXBwaW5nIHRvXG4gICAgICogY29ycmVzcG9uZGluZyBsaXN0IG9mIHBhdGhzLlxuICAgICAqL1xuICAgIHN0YXRpYyBkZXRlcm1pbmVNb2R1bGVMb2NhdGlvbnMoXG4gICAgICAgIGludGVybmFsSW5qZWN0aW9uOkludGVybmFsSW5qZWN0aW9uLCBhbGlhc2VzOlBsYWluT2JqZWN0ID0ge30sXG4gICAgICAgIG1vZHVsZVJlcGxhY2VtZW50czpQbGFpbk9iamVjdCA9IHt9LCBleHRlbnNpb25zOkV4dGVuc2lvbnMgPSB7XG4gICAgICAgICAgICBmaWxlOiB7XG4gICAgICAgICAgICAgICAgZXh0ZXJuYWw6IFsnLmpzJ10sXG4gICAgICAgICAgICAgICAgaW50ZXJuYWw6IFtcbiAgICAgICAgICAgICAgICAgICAgJy5qcycsICcuanNvbicsICcuY3NzJywgJy5lb3QnLCAnLmdpZicsICcuaHRtbCcsICcuaWNvJyxcbiAgICAgICAgICAgICAgICAgICAgJy5qcGcnLCAnLnBuZycsICcucHVnJywgJy5zdmcnLCAnLnR0ZicsICcud29mZicsICcud29mZjInXG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfSwgbW9kdWxlOiBbXVxuICAgICAgICB9LCBjb250ZXh0OnN0cmluZyA9ICcuLycsIHJlZmVyZW5jZVBhdGg6c3RyaW5nID0gJycsXG4gICAgICAgIHBhdGhzVG9JZ25vcmU6QXJyYXk8c3RyaW5nPiA9IFsnLmdpdCddLFxuICAgICAgICByZWxhdGl2ZU1vZHVsZUZpbGVQYXRoczpBcnJheTxzdHJpbmc+ID0gWycnLCAnbm9kZV9tb2R1bGVzJywgJy4uLyddLFxuICAgICAgICBwYWNrYWdlRW50cnlGaWxlTmFtZXM6QXJyYXk8c3RyaW5nPiA9IFtcbiAgICAgICAgICAgICdfX3BhY2thZ2VfXycsICcnLCAnaW5kZXgnLCAnbWFpbiddLFxuICAgICAgICBwYWNrYWdlTWFpblByb3BlcnR5TmFtZXM6QXJyYXk8c3RyaW5nPiA9IFsnbWFpbicsICdtb2R1bGUnXSxcbiAgICAgICAgcGFja2FnZUFsaWFzUHJvcGVydHlOYW1lczpBcnJheTxzdHJpbmc+ID0gW11cbiAgICApOntmaWxlUGF0aHM6QXJyYXk8c3RyaW5nPjtkaXJlY3RvcnlQYXRoczpBcnJheTxzdHJpbmc+fSB7XG4gICAgICAgIGNvbnN0IGZpbGVQYXRoczpBcnJheTxzdHJpbmc+ID0gW11cbiAgICAgICAgY29uc3QgZGlyZWN0b3J5UGF0aHM6QXJyYXk8c3RyaW5nPiA9IFtdXG4gICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRJbnRlcm5hbEluamVjdGlvbjpOb3JtYWxpemVkSW50ZXJuYWxJbmplY3Rpb24gPVxuICAgICAgICAgICAgSGVscGVyLnJlc29sdmVNb2R1bGVzSW5Gb2xkZXJzKFxuICAgICAgICAgICAgICAgIEhlbHBlci5ub3JtYWxpemVJbnRlcm5hbEluamVjdGlvbihpbnRlcm5hbEluamVjdGlvbiksXG4gICAgICAgICAgICAgICAgYWxpYXNlcywgbW9kdWxlUmVwbGFjZW1lbnRzLCBleHRlbnNpb25zLCBjb250ZXh0LFxuICAgICAgICAgICAgICAgIHJlZmVyZW5jZVBhdGgsIHBhdGhzVG9JZ25vcmUsIHJlbGF0aXZlTW9kdWxlRmlsZVBhdGhzLFxuICAgICAgICAgICAgICAgIHBhY2thZ2VFbnRyeUZpbGVOYW1lcywgcGFja2FnZU1haW5Qcm9wZXJ0eU5hbWVzLFxuICAgICAgICAgICAgICAgIHBhY2thZ2VBbGlhc1Byb3BlcnR5TmFtZXMpXG4gICAgICAgIGZvciAoY29uc3QgY2h1bmtOYW1lOnN0cmluZyBpbiBub3JtYWxpemVkSW50ZXJuYWxJbmplY3Rpb24pXG4gICAgICAgICAgICBpZiAobm9ybWFsaXplZEludGVybmFsSW5qZWN0aW9uLmhhc093blByb3BlcnR5KGNodW5rTmFtZSkpXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBtb2R1bGVJRDpzdHJpbmcgb2Ygbm9ybWFsaXplZEludGVybmFsSW5qZWN0aW9uW1xuICAgICAgICAgICAgICAgICAgICBjaHVua05hbWVcbiAgICAgICAgICAgICAgICBdKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVQYXRoOj9zdHJpbmcgPSBIZWxwZXIuZGV0ZXJtaW5lTW9kdWxlRmlsZVBhdGgoXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGVJRCwgYWxpYXNlcywgbW9kdWxlUmVwbGFjZW1lbnRzLCBleHRlbnNpb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dCwgcmVmZXJlbmNlUGF0aCwgcGF0aHNUb0lnbm9yZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbGF0aXZlTW9kdWxlRmlsZVBhdGhzLCBwYWNrYWdlRW50cnlGaWxlTmFtZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICBwYWNrYWdlTWFpblByb3BlcnR5TmFtZXMsIHBhY2thZ2VBbGlhc1Byb3BlcnR5TmFtZXMpXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlUGF0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVBhdGhzLnB1c2goZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXJlY3RvcnlQYXRoOnN0cmluZyA9IHBhdGguZGlybmFtZShmaWxlUGF0aClcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZGlyZWN0b3J5UGF0aHMuaW5jbHVkZXMoZGlyZWN0b3J5UGF0aCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0b3J5UGF0aHMucHVzaChkaXJlY3RvcnlQYXRoKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICByZXR1cm4ge2ZpbGVQYXRocywgZGlyZWN0b3J5UGF0aHN9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgYSBsaXN0IG9mIGNvbmNyZXRlIGZpbGUgcGF0aHMgZm9yIGdpdmVuIG1vZHVsZSBpZCBwb2ludGluZyB0b1xuICAgICAqIGEgZm9sZGVyIHdoaWNoIGlzbid0IGEgcGFja2FnZS5cbiAgICAgKiBAcGFyYW0gbm9ybWFsaXplZEludGVybmFsSW5qZWN0aW9uIC0gSW5qZWN0aW9uIGRhdGEgc3RydWN0dXJlIG9mXG4gICAgICogbW9kdWxlcyB3aXRoIGZvbGRlciByZWZlcmVuY2VzIHRvIHJlc29sdmUuXG4gICAgICogQHBhcmFtIGFsaWFzZXMgLSBNYXBwaW5nIG9mIGFsaWFzZXMgdG8gdGFrZSBpbnRvIGFjY291bnQuXG4gICAgICogQHBhcmFtIG1vZHVsZVJlcGxhY2VtZW50cyAtIE1hcHBpbmcgb2YgcmVwbGFjZW1lbnRzIHRvIHRha2UgaW50b1xuICAgICAqIGFjY291bnQuXG4gICAgICogQHBhcmFtIGV4dGVuc2lvbnMgLSBMaXN0IG9mIGZpbGUgYW5kIG1vZHVsZSBleHRlbnNpb25zLlxuICAgICAqIEBwYXJhbSBjb250ZXh0IC0gRmlsZSBwYXRoIHRvIGRldGVybWluZSByZWxhdGl2ZSB0by5cbiAgICAgKiBAcGFyYW0gcmVmZXJlbmNlUGF0aCAtIFBhdGggdG8gcmVzb2x2ZSBsb2NhbCBtb2R1bGVzIHJlbGF0aXZlIHRvLlxuICAgICAqIEBwYXJhbSBwYXRoc1RvSWdub3JlIC0gUGF0aHMgd2hpY2ggbWFya3MgbG9jYXRpb24gdG8gaWdub3JlLlxuICAgICAqIEByZXR1cm5zIEdpdmVuIGluamVjdGlvbnMgd2l0aCByZXNvbHZlZCBmb2xkZXIgcG9pbnRpbmcgbW9kdWxlcy5cbiAgICAgKi9cbiAgICBzdGF0aWMgcmVzb2x2ZU1vZHVsZXNJbkZvbGRlcnMoXG4gICAgICAgIG5vcm1hbGl6ZWRJbnRlcm5hbEluamVjdGlvbjpOb3JtYWxpemVkSW50ZXJuYWxJbmplY3Rpb24sXG4gICAgICAgIGFsaWFzZXM6UGxhaW5PYmplY3QgPSB7fSwgbW9kdWxlUmVwbGFjZW1lbnRzOlBsYWluT2JqZWN0ID0ge30sXG4gICAgICAgIGV4dGVuc2lvbnM6RXh0ZW5zaW9ucyA9IHtcbiAgICAgICAgICAgIGZpbGU6IHtcbiAgICAgICAgICAgICAgICBleHRlcm5hbDogWycuanMnXSxcbiAgICAgICAgICAgICAgICBpbnRlcm5hbDogW1xuICAgICAgICAgICAgICAgICAgICAnLmpzJywgJy5qc29uJywgJy5jc3MnLCAnLmVvdCcsICcuZ2lmJywgJy5odG1sJywgJy5pY28nLFxuICAgICAgICAgICAgICAgICAgICAnLmpwZycsICcucG5nJywgJy5wdWcnLCAnLnN2ZycsICcudHRmJywgJy53b2ZmJywgJy53b2ZmMidcbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9LCBtb2R1bGU6IFtdXG4gICAgICAgIH0sIGNvbnRleHQ6c3RyaW5nID0gJy4vJywgcmVmZXJlbmNlUGF0aDpzdHJpbmcgPSAnJyxcbiAgICAgICAgcGF0aHNUb0lnbm9yZTpBcnJheTxzdHJpbmc+ID0gWycuZ2l0J11cbiAgICApOk5vcm1hbGl6ZWRJbnRlcm5hbEluamVjdGlvbiB7XG4gICAgICAgIGlmIChyZWZlcmVuY2VQYXRoLnN0YXJ0c1dpdGgoJy8nKSlcbiAgICAgICAgICAgIHJlZmVyZW5jZVBhdGggPSBwYXRoLnJlbGF0aXZlKGNvbnRleHQsIHJlZmVyZW5jZVBhdGgpXG4gICAgICAgIGZvciAoY29uc3QgY2h1bmtOYW1lOnN0cmluZyBpbiBub3JtYWxpemVkSW50ZXJuYWxJbmplY3Rpb24pXG4gICAgICAgICAgICBpZiAobm9ybWFsaXplZEludGVybmFsSW5qZWN0aW9uLmhhc093blByb3BlcnR5KGNodW5rTmFtZSkpIHtcbiAgICAgICAgICAgICAgICBsZXQgaW5kZXg6bnVtYmVyID0gMFxuICAgICAgICAgICAgICAgIGZvciAobGV0IG1vZHVsZUlEOnN0cmluZyBvZiBub3JtYWxpemVkSW50ZXJuYWxJbmplY3Rpb25bXG4gICAgICAgICAgICAgICAgICAgIGNodW5rTmFtZVxuICAgICAgICAgICAgICAgIF0pIHtcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlSUQgPSBIZWxwZXIuYXBwbHlNb2R1bGVSZXBsYWNlbWVudHMoXG4gICAgICAgICAgICAgICAgICAgICAgICBIZWxwZXIuYXBwbHlBbGlhc2VzKEhlbHBlci5zdHJpcExvYWRlcihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGVJRFxuICAgICAgICAgICAgICAgICAgICAgICAgKSwgYWxpYXNlcyksIG1vZHVsZVJlcGxhY2VtZW50cylcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzb2x2ZWRQYXRoOnN0cmluZyA9IHBhdGgucmVzb2x2ZShcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZVBhdGgsIG1vZHVsZUlEKVxuICAgICAgICAgICAgICAgICAgICBpZiAoVG9vbHMuaXNEaXJlY3RvcnlTeW5jKHJlc29sdmVkUGF0aCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vcm1hbGl6ZWRJbnRlcm5hbEluamVjdGlvbltjaHVua05hbWVdLnNwbGljZShpbmRleCwgMSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZTpGaWxlIG9mXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVG9vbHMud2Fsa0RpcmVjdG9yeVJlY3Vyc2l2ZWx5U3luYyhyZXNvbHZlZFBhdGgsIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZTpGaWxlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTo/ZmFsc2UgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSGVscGVyLmlzRmlsZVBhdGhJbkxvY2F0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5wYXRoLCBwYXRoc1RvSWdub3JlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWxlLnN0YXQuaXNGaWxlKCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vcm1hbGl6ZWRJbnRlcm5hbEluamVjdGlvbltjaHVua05hbWVdLnB1c2goXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnLi8nICsgcGF0aC5yZWxhdGl2ZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VQYXRoLCBwYXRoLnJlc29sdmUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmVkUGF0aCwgZmlsZS5wYXRoKSkpXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobW9kdWxlSUQuc3RhcnRzV2l0aChcbiAgICAgICAgICAgICAgICAgICAgICAgICcuLydcbiAgICAgICAgICAgICAgICAgICAgKSAmJiAhbW9kdWxlSUQuc3RhcnRzV2l0aCgnLi8nICsgcGF0aC5yZWxhdGl2ZShcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQsIHJlZmVyZW5jZVBhdGhcbiAgICAgICAgICAgICAgICAgICAgKSkpXG4gICAgICAgICAgICAgICAgICAgICAgICBub3JtYWxpemVkSW50ZXJuYWxJbmplY3Rpb25bY2h1bmtOYW1lXVtpbmRleF0gPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAuLyR7cGF0aC5yZWxhdGl2ZShjb250ZXh0LCByZXNvbHZlZFBhdGgpfWBcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggKz0gMVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZWRJbnRlcm5hbEluamVjdGlvblxuICAgIH1cbiAgICAvKipcbiAgICAgKiBFdmVyeSBpbmplY3Rpb24gZGVmaW5pdGlvbiB0eXBlIGNhbiBiZSByZXByZXNlbnRlZCBhcyBwbGFpbiBvYmplY3RcbiAgICAgKiAobWFwcGluZyBmcm9tIGNodW5rIG5hbWUgdG8gYXJyYXkgb2YgbW9kdWxlIGlkcykuIFRoaXMgbWV0aG9kIGNvbnZlcnRzXG4gICAgICogZWFjaCByZXByZXNlbnRhdGlvbiBpbnRvIHRoZSBub3JtYWxpemVkIHBsYWluIG9iamVjdCBub3RhdGlvbi5cbiAgICAgKiBAcGFyYW0gaW50ZXJuYWxJbmplY3Rpb24gLSBHaXZlbiBpbnRlcm5hbCBpbmplY3Rpb24gdG8gbm9ybWFsaXplLlxuICAgICAqIEByZXR1cm5zIE5vcm1hbGl6ZWQgcmVwcmVzZW50YXRpb24gb2YgZ2l2ZW4gaW50ZXJuYWwgaW5qZWN0aW9uLlxuICAgICAqL1xuICAgIHN0YXRpYyBub3JtYWxpemVJbnRlcm5hbEluamVjdGlvbihcbiAgICAgICAgaW50ZXJuYWxJbmplY3Rpb246SW50ZXJuYWxJbmplY3Rpb25cbiAgICApOk5vcm1hbGl6ZWRJbnRlcm5hbEluamVjdGlvbiB7XG4gICAgICAgIGxldCByZXN1bHQ6Tm9ybWFsaXplZEludGVybmFsSW5qZWN0aW9uID0ge31cbiAgICAgICAgaWYgKGludGVybmFsSW5qZWN0aW9uIGluc3RhbmNlb2YgT2JqZWN0ICYmIFRvb2xzLmlzUGxhaW5PYmplY3QoXG4gICAgICAgICAgICBpbnRlcm5hbEluamVjdGlvblxuICAgICAgICApKSB7XG4gICAgICAgICAgICBsZXQgaGFzQ29udGVudDpib29sZWFuID0gZmFsc2VcbiAgICAgICAgICAgIGNvbnN0IGNodW5rTmFtZXNUb0RlbGV0ZTpBcnJheTxzdHJpbmc+ID0gW11cbiAgICAgICAgICAgIGZvciAoY29uc3QgY2h1bmtOYW1lOnN0cmluZyBpbiBpbnRlcm5hbEluamVjdGlvbilcbiAgICAgICAgICAgICAgICBpZiAoaW50ZXJuYWxJbmplY3Rpb24uaGFzT3duUHJvcGVydHkoY2h1bmtOYW1lKSlcbiAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaW50ZXJuYWxJbmplY3Rpb25bY2h1bmtOYW1lXSkpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW50ZXJuYWxJbmplY3Rpb25bY2h1bmtOYW1lXS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzQ29udGVudCA9IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRbY2h1bmtOYW1lXSA9IGludGVybmFsSW5qZWN0aW9uW2NodW5rTmFtZV1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rTmFtZXNUb0RlbGV0ZS5wdXNoKGNodW5rTmFtZSlcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYXNDb250ZW50ID0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2NodW5rTmFtZV0gPSBbaW50ZXJuYWxJbmplY3Rpb25bY2h1bmtOYW1lXV1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGhhc0NvbnRlbnQpXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBjaHVua05hbWU6c3RyaW5nIG9mIGNodW5rTmFtZXNUb0RlbGV0ZSlcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHJlc3VsdFtjaHVua05hbWVdXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0ge2luZGV4OiBbXX1cbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgaW50ZXJuYWxJbmplY3Rpb24gPT09ICdzdHJpbmcnKVxuICAgICAgICAgICAgcmVzdWx0ID0ge2luZGV4OiBbaW50ZXJuYWxJbmplY3Rpb25dfVxuICAgICAgICBlbHNlIGlmIChBcnJheS5pc0FycmF5KGludGVybmFsSW5qZWN0aW9uKSlcbiAgICAgICAgICAgIHJlc3VsdCA9IHtpbmRleDogaW50ZXJuYWxJbmplY3Rpb259XG4gICAgICAgIHJldHVybiByZXN1bHRcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lcyBhbGwgY29uY3JldGUgZmlsZSBwYXRocyBmb3IgZ2l2ZW4gaW5qZWN0aW9uIHdoaWNoIGFyZSBtYXJrZWRcbiAgICAgKiB3aXRoIHRoZSBcIl9fYXV0b19fXCIgaW5kaWNhdG9yLlxuICAgICAqIEBwYXJhbSBnaXZlbkluamVjdGlvbiAtIEdpdmVuIGludGVybmFsIGFuZCBleHRlcm5hbCBpbmplY3Rpb24gdG8gdGFrZVxuICAgICAqIGludG8gYWNjb3VudC5cbiAgICAgKiBAcGFyYW0gYnVpbGRDb25maWd1cmF0aW9ucyAtIFJlc29sdmVkIGJ1aWxkIGNvbmZpZ3VyYXRpb24uXG4gICAgICogQHBhcmFtIG1vZHVsZXNUb0V4Y2x1ZGUgLSBBIGxpc3Qgb2YgbW9kdWxlcyB0byBleGNsdWRlIChzcGVjaWZpZWQgYnlcbiAgICAgKiBwYXRoIG9yIGlkKSBvciBhIG1hcHBpbmcgZnJvbSBjaHVuayBuYW1lcyB0byBtb2R1bGUgaWRzLlxuICAgICAqIEBwYXJhbSBhbGlhc2VzIC0gTWFwcGluZyBvZiBhbGlhc2VzIHRvIHRha2UgaW50byBhY2NvdW50LlxuICAgICAqIEBwYXJhbSBtb2R1bGVSZXBsYWNlbWVudHMgLSBNYXBwaW5nIG9mIHJlcGxhY2VtZW50cyB0byB0YWtlIGludG9cbiAgICAgKiBhY2NvdW50LlxuICAgICAqIEBwYXJhbSBleHRlbnNpb25zIC0gTGlzdCBvZiBmaWxlIGFuZCBtb2R1bGUgZXh0ZW5zaW9ucyB0byB0YWtlIGludG9cbiAgICAgKiBhY2NvdW50LlxuICAgICAqIEBwYXJhbSBjb250ZXh0IC0gRmlsZSBwYXRoIHRvIHVzZSBhcyBzdGFydGluZyBwb2ludC5cbiAgICAgKiBAcGFyYW0gcmVmZXJlbmNlUGF0aCAtIFJlZmVyZW5jZSBwYXRoIGZyb20gd2hlcmUgbG9jYWwgZmlsZXMgc2hvdWxkIGJlXG4gICAgICogcmVzb2x2ZWQuXG4gICAgICogQHBhcmFtIHBhdGhzVG9JZ25vcmUgLSBQYXRocyB3aGljaCBtYXJrcyBsb2NhdGlvbiB0byBpZ25vcmUuXG4gICAgICogQHJldHVybnMgR2l2ZW4gaW5qZWN0aW9uIHdpdGggcmVzb2x2ZWQgbWFya2VkIGluZGljYXRvcnMuXG4gICAgICovXG4gICAgc3RhdGljIHJlc29sdmVJbmplY3Rpb24oXG4gICAgICAgIGdpdmVuSW5qZWN0aW9uOkluamVjdGlvbixcbiAgICAgICAgYnVpbGRDb25maWd1cmF0aW9uczpSZXNvbHZlZEJ1aWxkQ29uZmlndXJhdGlvbixcbiAgICAgICAgbW9kdWxlc1RvRXhjbHVkZTpJbnRlcm5hbEluamVjdGlvbixcbiAgICAgICAgYWxpYXNlczpQbGFpbk9iamVjdCA9IHt9LCBtb2R1bGVSZXBsYWNlbWVudHM6UGxhaW5PYmplY3QgPSB7fSxcbiAgICAgICAgZXh0ZW5zaW9uczpFeHRlbnNpb25zID0ge1xuICAgICAgICAgICAgZmlsZToge1xuICAgICAgICAgICAgICAgIGV4dGVybmFsOiBbJy5qcyddLFxuICAgICAgICAgICAgICAgIGludGVybmFsOiBbXG4gICAgICAgICAgICAgICAgICAgICcuanMnLCAnLmpzb24nLCAnLmNzcycsICcuZW90JywgJy5naWYnLCAnLmh0bWwnLCAnLmljbycsXG4gICAgICAgICAgICAgICAgICAgICcuanBnJywgJy5wbmcnLCAnLnB1ZycsICcuc3ZnJywgJy50dGYnLCAnLndvZmYnLCAnLndvZmYyJ1xuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH0sIG1vZHVsZTogW11cbiAgICAgICAgfSwgY29udGV4dDpzdHJpbmcgPSAnLi8nLCByZWZlcmVuY2VQYXRoOnN0cmluZyA9ICcnLFxuICAgICAgICBwYXRoc1RvSWdub3JlOkFycmF5PHN0cmluZz4gPSBbJy5naXQnXVxuICAgICk6SW5qZWN0aW9uIHtcbiAgICAgICAgY29uc3QgaW5qZWN0aW9uOkluamVjdGlvbiA9IFRvb2xzLmV4dGVuZE9iamVjdChcbiAgICAgICAgICAgIHRydWUsIHt9LCBnaXZlbkluamVjdGlvbilcbiAgICAgICAgY29uc3QgbW9kdWxlRmlsZVBhdGhzVG9FeGNsdWRlOkFycmF5PHN0cmluZz4gPVxuICAgICAgICAgICAgSGVscGVyLmRldGVybWluZU1vZHVsZUxvY2F0aW9ucyhcbiAgICAgICAgICAgICAgICBtb2R1bGVzVG9FeGNsdWRlLCBhbGlhc2VzLCBtb2R1bGVSZXBsYWNlbWVudHMsIGV4dGVuc2lvbnMsXG4gICAgICAgICAgICAgICAgY29udGV4dCwgcmVmZXJlbmNlUGF0aCwgcGF0aHNUb0lnbm9yZVxuICAgICAgICAgICAgKS5maWxlUGF0aHNcbiAgICAgICAgZm9yIChjb25zdCB0eXBlOnN0cmluZyBvZiBbJ2ludGVybmFsJywgJ2V4dGVybmFsJ10pXG4gICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBjdXJseSAqL1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBpbmplY3Rpb25bdHlwZV0gPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBjaHVua05hbWU6c3RyaW5nIGluIGluamVjdGlvblt0eXBlXSlcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluamVjdGlvblt0eXBlXVtjaHVua05hbWVdID09PSAnX19hdXRvX18nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmplY3Rpb25bdHlwZV1bY2h1bmtOYW1lXSA9IFtdXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtb2R1bGVzOntcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBba2V5OnN0cmluZ106c3RyaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICB9ID0gSGVscGVyLmdldEF1dG9DaHVuayhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidWlsZENvbmZpZ3VyYXRpb25zLCBtb2R1bGVGaWxlUGF0aHNUb0V4Y2x1ZGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlUGF0aClcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgc3ViQ2h1bmtOYW1lOnN0cmluZyBpbiBtb2R1bGVzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb2R1bGVzLmhhc093blByb3BlcnR5KHN1YkNodW5rTmFtZSkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluamVjdGlvblt0eXBlXVtjaHVua05hbWVdLnB1c2goXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGVzW3N1YkNodW5rTmFtZV0pXG4gICAgICAgICAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJldmVyc2UgYXJyYXkgdG8gbGV0IGphdmFTY3JpcHQgYW5kIG1haW4gZmlsZXMgYmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgbGFzdCBvbmVzIHRvIGV4cG9ydCB0aGVtIHJhdGhlci5cbiAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmplY3Rpb25bdHlwZV1bY2h1bmtOYW1lXS5yZXZlcnNlKClcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChpbmplY3Rpb25bdHlwZV0gPT09ICdfX2F1dG9fXycpXG4gICAgICAgICAgICAvKiBlc2xpbnQtZW5hYmxlIGN1cmx5ICovXG4gICAgICAgICAgICAgICAgaW5qZWN0aW9uW3R5cGVdID0gSGVscGVyLmdldEF1dG9DaHVuayhcbiAgICAgICAgICAgICAgICAgICAgYnVpbGRDb25maWd1cmF0aW9ucywgbW9kdWxlRmlsZVBhdGhzVG9FeGNsdWRlLCBjb250ZXh0KVxuICAgICAgICByZXR1cm4gaW5qZWN0aW9uXG4gICAgfVxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgYWxsIG1vZHVsZSBmaWxlIHBhdGhzLlxuICAgICAqIEBwYXJhbSBidWlsZENvbmZpZ3VyYXRpb25zIC0gUmVzb2x2ZWQgYnVpbGQgY29uZmlndXJhdGlvbi5cbiAgICAgKiBAcGFyYW0gbW9kdWxlRmlsZVBhdGhzVG9FeGNsdWRlIC0gQSBsaXN0IG9mIG1vZHVsZXMgZmlsZSBwYXRocyB0b1xuICAgICAqIGV4Y2x1ZGUgKHNwZWNpZmllZCBieSBwYXRoIG9yIGlkKSBvciBhIG1hcHBpbmcgZnJvbSBjaHVuayBuYW1lcyB0b1xuICAgICAqIG1vZHVsZSBpZHMuXG4gICAgICogQHBhcmFtIGNvbnRleHQgLSBGaWxlIHBhdGggdG8gdXNlIGFzIHN0YXJ0aW5nIHBvaW50LlxuICAgICAqIEByZXR1cm5zIEFsbCBkZXRlcm1pbmVkIG1vZHVsZSBmaWxlIHBhdGhzLlxuICAgICAqL1xuICAgIHN0YXRpYyBnZXRBdXRvQ2h1bmsoXG4gICAgICAgIGJ1aWxkQ29uZmlndXJhdGlvbnM6UmVzb2x2ZWRCdWlsZENvbmZpZ3VyYXRpb24sXG4gICAgICAgIG1vZHVsZUZpbGVQYXRoc1RvRXhjbHVkZTpBcnJheTxzdHJpbmc+LCBjb250ZXh0OnN0cmluZ1xuICAgICk6e1trZXk6c3RyaW5nXTpzdHJpbmd9IHtcbiAgICAgICAgY29uc3QgcmVzdWx0Ontba2V5OnN0cmluZ106c3RyaW5nfSA9IHt9XG4gICAgICAgIGNvbnN0IGluamVjdGVkTW9kdWxlSURzOntba2V5OnN0cmluZ106QXJyYXk8c3RyaW5nPn0gPSB7fVxuICAgICAgICBmb3IgKFxuICAgICAgICAgICAgY29uc3QgYnVpbGRDb25maWd1cmF0aW9uOlJlc29sdmVkQnVpbGRDb25maWd1cmF0aW9uSXRlbSBvZlxuICAgICAgICAgICAgYnVpbGRDb25maWd1cmF0aW9uc1xuICAgICAgICApIHtcbiAgICAgICAgICAgIGlmICghaW5qZWN0ZWRNb2R1bGVJRHNbYnVpbGRDb25maWd1cmF0aW9uLm91dHB1dEV4dGVuc2lvbl0pXG4gICAgICAgICAgICAgICAgaW5qZWN0ZWRNb2R1bGVJRHNbYnVpbGRDb25maWd1cmF0aW9uLm91dHB1dEV4dGVuc2lvbl0gPSBbXVxuICAgICAgICAgICAgZm9yIChjb25zdCBtb2R1bGVGaWxlUGF0aDpzdHJpbmcgb2YgYnVpbGRDb25maWd1cmF0aW9uLmZpbGVQYXRocylcbiAgICAgICAgICAgICAgICBpZiAoIW1vZHVsZUZpbGVQYXRoc1RvRXhjbHVkZS5pbmNsdWRlcyhtb2R1bGVGaWxlUGF0aCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVsYXRpdmVNb2R1bGVGaWxlUGF0aDpzdHJpbmcgPSAnLi8nICsgcGF0aC5yZWxhdGl2ZShcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQsIG1vZHVsZUZpbGVQYXRoKVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXJlY3RvcnlQYXRoOnN0cmluZyA9IHBhdGguZGlybmFtZShcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbGF0aXZlTW9kdWxlRmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhc2VOYW1lOnN0cmluZyA9IHBhdGguYmFzZW5hbWUoXG4gICAgICAgICAgICAgICAgICAgICAgICByZWxhdGl2ZU1vZHVsZUZpbGVQYXRoLFxuICAgICAgICAgICAgICAgICAgICAgICAgYC4ke2J1aWxkQ29uZmlndXJhdGlvbi5leHRlbnNpb259YClcbiAgICAgICAgICAgICAgICAgICAgbGV0IG1vZHVsZUlEOnN0cmluZyA9IGJhc2VOYW1lXG4gICAgICAgICAgICAgICAgICAgIGlmIChkaXJlY3RvcnlQYXRoICE9PSAnLicpXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGVJRCA9IHBhdGguam9pbihkaXJlY3RvcnlQYXRoLCBiYXNlTmFtZSlcbiAgICAgICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgICAgICAgIEVuc3VyZSB0aGF0IGVhY2ggb3V0cHV0IHR5cGUgaGFzIG9ubHkgb25lIHNvdXJjZVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVwcmVzZW50YXRpb24uXG4gICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIGlmICghaW5qZWN0ZWRNb2R1bGVJRHNbXG4gICAgICAgICAgICAgICAgICAgICAgICBidWlsZENvbmZpZ3VyYXRpb24ub3V0cHV0RXh0ZW5zaW9uXG4gICAgICAgICAgICAgICAgICAgIF0uaW5jbHVkZXMobW9kdWxlSUQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVuc3VyZSB0aGF0IHNhbWUgbW9kdWxlIGlkcyBhbmQgZGlmZmVyZW50IG91dHB1dFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVzIGNhbiBiZSBkaXN0aW5ndWlzaGVkIGJ5IHRoZWlyIGV4dGVuc2lvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChKYXZhU2NyaXB0LU1vZHVsZXMgcmVtYWlucyB3aXRob3V0IGV4dGVuc2lvbiBzaW5jZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZXkgd2lsbCBiZSBoYW5kbGVkIGZpcnN0IGJlY2F1c2UgdGhlIGJ1aWxkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbnMgYXJlIGV4cGVjdGVkIHRvIGJlIHNvcnRlZCBpbiB0aGlzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dCkuXG4gICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5oYXNPd25Qcm9wZXJ0eShtb2R1bGVJRCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3JlbGF0aXZlTW9kdWxlRmlsZVBhdGhdID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRpdmVNb2R1bGVGaWxlUGF0aFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFttb2R1bGVJRF0gPSByZWxhdGl2ZU1vZHVsZUZpbGVQYXRoXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmplY3RlZE1vZHVsZUlEc1tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidWlsZENvbmZpZ3VyYXRpb24ub3V0cHV0RXh0ZW5zaW9uXG4gICAgICAgICAgICAgICAgICAgICAgICBdLnB1c2gobW9kdWxlSUQpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdFxuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmVzIGEgY29uY3JldGUgZmlsZSBwYXRoIGZvciBnaXZlbiBtb2R1bGUgaWQuXG4gICAgICogQHBhcmFtIG1vZHVsZUlEIC0gTW9kdWxlIGlkIHRvIGRldGVybWluZS5cbiAgICAgKiBAcGFyYW0gYWxpYXNlcyAtIE1hcHBpbmcgb2YgYWxpYXNlcyB0byB0YWtlIGludG8gYWNjb3VudC5cbiAgICAgKiBAcGFyYW0gbW9kdWxlUmVwbGFjZW1lbnRzIC0gTWFwcGluZyBvZiByZXBsYWNlbWVudHMgdG8gdGFrZSBpbnRvXG4gICAgICogYWNjb3VudC5cbiAgICAgKiBAcGFyYW0gZXh0ZW5zaW9ucyAtIExpc3Qgb2YgZmlsZSBhbmQgbW9kdWxlIGV4dGVuc2lvbnMgdG8gdGFrZSBpbnRvXG4gICAgICogYWNjb3VudC5cbiAgICAgKiBAcGFyYW0gY29udGV4dCAtIEZpbGUgcGF0aCB0byBkZXRlcm1pbmUgcmVsYXRpdmUgdG8uXG4gICAgICogQHBhcmFtIHJlZmVyZW5jZVBhdGggLSBQYXRoIHRvIHJlc29sdmUgbG9jYWwgbW9kdWxlcyByZWxhdGl2ZSB0by5cbiAgICAgKiBAcGFyYW0gcGF0aHNUb0lnbm9yZSAtIFBhdGhzIHdoaWNoIG1hcmtzIGxvY2F0aW9uIHRvIGlnbm9yZS5cbiAgICAgKiBAcGFyYW0gcmVsYXRpdmVNb2R1bGVGaWxlUGF0aHMgLSBMaXN0IG9mIHJlbGF0aXZlIGZpbGUgcGF0aCB0byBzZWFyY2hcbiAgICAgKiBmb3IgbW9kdWxlcyBpbi5cbiAgICAgKiBAcGFyYW0gcGFja2FnZUVudHJ5RmlsZU5hbWVzIC0gTGlzdCBvZiBwYWNrYWdlIGVudHJ5IGZpbGUgbmFtZXMgdG9cbiAgICAgKiBzZWFyY2ggZm9yLiBUaGUgbWFnaWMgbmFtZSBcIl9fcGFja2FnZV9fXCIgd2lsbCBzZWFyY2ggZm9yIGFuIGFwcHJlY2lhdGVcbiAgICAgKiBlbnRyeSBpbiBhIFwicGFja2FnZS5qc29uXCIgZmlsZS5cbiAgICAgKiBAcGFyYW0gcGFja2FnZU1haW5Qcm9wZXJ0eU5hbWVzIC0gTGlzdCBvZiBwYWNrYWdlIGZpbGUgbWFpbiBwcm9wZXJ0eVxuICAgICAqIG5hbWVzIHRvIHNlYXJjaCBmb3IgcGFja2FnZSByZXByZXNlbnRpbmcgZW50cnkgbW9kdWxlIGRlZmluaXRpb25zLlxuICAgICAqIEBwYXJhbSBwYWNrYWdlQWxpYXNQcm9wZXJ0eU5hbWVzIC0gTGlzdCBvZiBwYWNrYWdlIGZpbGUgYWxpYXMgcHJvcGVydHlcbiAgICAgKiBuYW1lcyB0byBzZWFyY2ggZm9yIHBhY2thZ2Ugc3BlY2lmaWMgbW9kdWxlIGFsaWFzZXMuXG4gICAgICogQHJldHVybnMgRmlsZSBwYXRoIG9yIGdpdmVuIG1vZHVsZSBpZCBpZiBkZXRlcm1pbmF0aW9ucyBoYXMgZmFpbGVkIG9yXG4gICAgICogd2Fzbid0IG5lY2Vzc2FyeS5cbiAgICAgKi9cbiAgICBzdGF0aWMgZGV0ZXJtaW5lTW9kdWxlRmlsZVBhdGgoXG4gICAgICAgIG1vZHVsZUlEOnN0cmluZywgYWxpYXNlczpQbGFpbk9iamVjdCA9IHt9LFxuICAgICAgICBtb2R1bGVSZXBsYWNlbWVudHM6UGxhaW5PYmplY3QgPSB7fSwgZXh0ZW5zaW9uczpFeHRlbnNpb25zID0ge1xuICAgICAgICAgICAgZmlsZToge1xuICAgICAgICAgICAgICAgIGV4dGVybmFsOiBbJy5qcyddLFxuICAgICAgICAgICAgICAgIGludGVybmFsOiBbXG4gICAgICAgICAgICAgICAgICAgICcuanMnLCAnLmpzb24nLCAnLmNzcycsICcuZW90JywgJy5naWYnLCAnLmh0bWwnLCAnLmljbycsXG4gICAgICAgICAgICAgICAgICAgICcuanBnJywgJy5wbmcnLCAnLnB1ZycsICcuc3ZnJywgJy50dGYnLCAnLndvZmYnLCAnLndvZmYyJ1xuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH0sIG1vZHVsZTogW11cbiAgICAgICAgfSwgY29udGV4dDpzdHJpbmcgPSAnLi8nLCByZWZlcmVuY2VQYXRoOnN0cmluZyA9ICcnLFxuICAgICAgICBwYXRoc1RvSWdub3JlOkFycmF5PHN0cmluZz4gPSBbJy5naXQnXSxcbiAgICAgICAgcmVsYXRpdmVNb2R1bGVGaWxlUGF0aHM6QXJyYXk8c3RyaW5nPiA9IFsnbm9kZV9tb2R1bGVzJ10sXG4gICAgICAgIHBhY2thZ2VFbnRyeUZpbGVOYW1lczpBcnJheTxzdHJpbmc+ID0gWydpbmRleCddLFxuICAgICAgICBwYWNrYWdlTWFpblByb3BlcnR5TmFtZXM6QXJyYXk8c3RyaW5nPiA9IFsnbWFpbiddLFxuICAgICAgICBwYWNrYWdlQWxpYXNQcm9wZXJ0eU5hbWVzOkFycmF5PHN0cmluZz4gPSBbXVxuICAgICk6P3N0cmluZyB7XG4gICAgICAgIG1vZHVsZUlEID0gSGVscGVyLmFwcGx5TW9kdWxlUmVwbGFjZW1lbnRzKEhlbHBlci5hcHBseUFsaWFzZXMoXG4gICAgICAgICAgICBIZWxwZXIuc3RyaXBMb2FkZXIobW9kdWxlSUQpLCBhbGlhc2VzXG4gICAgICAgICksIG1vZHVsZVJlcGxhY2VtZW50cylcbiAgICAgICAgaWYgKCFtb2R1bGVJRClcbiAgICAgICAgICAgIHJldHVybiBudWxsXG4gICAgICAgIGxldCBtb2R1bGVGaWxlUGF0aDpzdHJpbmcgPSBtb2R1bGVJRFxuICAgICAgICBpZiAobW9kdWxlRmlsZVBhdGguc3RhcnRzV2l0aCgnLi8nKSlcbiAgICAgICAgICAgIG1vZHVsZUZpbGVQYXRoID0gcGF0aC5qb2luKHJlZmVyZW5jZVBhdGgsIG1vZHVsZUZpbGVQYXRoKVxuICAgICAgICBmb3IgKGNvbnN0IG1vZHVsZUxvY2F0aW9uOnN0cmluZyBvZiBbcmVmZXJlbmNlUGF0aF0uY29uY2F0KFxuICAgICAgICAgICAgcmVsYXRpdmVNb2R1bGVGaWxlUGF0aHMubWFwKChmaWxlUGF0aDpzdHJpbmcpOnN0cmluZyA9PlxuICAgICAgICAgICAgICAgIHBhdGgucmVzb2x2ZShjb250ZXh0LCBmaWxlUGF0aCkpXG4gICAgICAgICkpXG4gICAgICAgICAgICBmb3IgKGxldCBmaWxlTmFtZTpzdHJpbmcgb2YgWycnLCAnX19wYWNrYWdlX18nXS5jb25jYXQoXG4gICAgICAgICAgICAgICAgcGFja2FnZUVudHJ5RmlsZU5hbWVzXG4gICAgICAgICAgICApKVxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbW9kdWxlRXh0ZW5zaW9uOnN0cmluZyBvZiBleHRlbnNpb25zLm1vZHVsZS5jb25jYXQoW1xuICAgICAgICAgICAgICAgICAgICAnJ1xuICAgICAgICAgICAgICAgIF0pKVxuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGZpbGVFeHRlbnNpb246c3RyaW5nIG9mIFsnJ10uY29uY2F0KFxuICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9ucy5maWxlLmludGVybmFsXG4gICAgICAgICAgICAgICAgICAgICkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjdXJyZW50TW9kdWxlRmlsZVBhdGg6c3RyaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobW9kdWxlRmlsZVBhdGguc3RhcnRzV2l0aCgnLycpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRNb2R1bGVGaWxlUGF0aCA9IHBhdGgucmVzb2x2ZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kdWxlRmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE1vZHVsZUZpbGVQYXRoID0gcGF0aC5yZXNvbHZlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGVMb2NhdGlvbiwgbW9kdWxlRmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGFja2FnZUFsaWFzZXM6UGxhaW5PYmplY3QgPSB7fVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVOYW1lID09PSAnX19wYWNrYWdlX18nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFRvb2xzLmlzRGlyZWN0b3J5U3luYyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE1vZHVsZUZpbGVQYXRoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXRoVG9QYWNrYWdlSlNPTjpzdHJpbmcgPSBwYXRoLnJlc29sdmUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TW9kdWxlRmlsZVBhdGgsICdwYWNrYWdlLmpzb24nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoVG9vbHMuaXNGaWxlU3luYyhwYXRoVG9QYWNrYWdlSlNPTikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBsb2NhbENvbmZpZ3VyYXRpb246UGxhaW5PYmplY3QgPSB7fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbENvbmZpZ3VyYXRpb24gPSBKU09OLnBhcnNlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlU3lzdGVtLnJlYWRGaWxlU3luYyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhUb1BhY2thZ2VKU09OLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2Rpbmc6ICd1dGYtOCd9KSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eU5hbWU6c3RyaW5nIG9mXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFja2FnZU1haW5Qcm9wZXJ0eU5hbWVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvY2FsQ29uZmlndXJhdGlvbi5oYXNPd25Qcm9wZXJ0eShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlOYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSAmJiB0eXBlb2YgbG9jYWxDb25maWd1cmF0aW9uW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eU5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdID09PSAnc3RyaW5nJyAmJiBsb2NhbENvbmZpZ3VyYXRpb25bXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5TmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZU5hbWUgPSBsb2NhbENvbmZpZ3VyYXRpb25bXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eU5hbWVdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eU5hbWU6c3RyaW5nIG9mXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFja2FnZUFsaWFzUHJvcGVydHlOYW1lc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2NhbENvbmZpZ3VyYXRpb24uaGFzT3duUHJvcGVydHkoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5TmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkgJiYgdHlwZW9mIGxvY2FsQ29uZmlndXJhdGlvbltcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlOYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFja2FnZUFsaWFzZXMgPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxDb25maWd1cmF0aW9uW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5TmFtZV1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVOYW1lID09PSAnX19wYWNrYWdlX18nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZU5hbWUgPSBIZWxwZXIuYXBwbHlNb2R1bGVSZXBsYWNlbWVudHMoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVscGVyLmFwcGx5QWxpYXNlcyhmaWxlTmFtZSwgcGFja2FnZUFsaWFzZXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZVJlcGxhY2VtZW50cylcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWxlTmFtZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TW9kdWxlRmlsZVBhdGggPSBwYXRoLnJlc29sdmUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRNb2R1bGVGaWxlUGF0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYCR7ZmlsZU5hbWV9JHttb2R1bGVFeHRlbnNpb259JHtmaWxlRXh0ZW5zaW9ufWBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE1vZHVsZUZpbGVQYXRoICs9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAke2ZpbGVOYW1lfSR7bW9kdWxlRXh0ZW5zaW9ufSR7ZmlsZUV4dGVuc2lvbn1gXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoSGVscGVyLmlzRmlsZVBhdGhJbkxvY2F0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRNb2R1bGVGaWxlUGF0aCwgcGF0aHNUb0lnbm9yZVxuICAgICAgICAgICAgICAgICAgICAgICAgKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFRvb2xzLmlzRmlsZVN5bmMoY3VycmVudE1vZHVsZUZpbGVQYXRoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudE1vZHVsZUZpbGVQYXRoXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG4gICAgLy8gZW5kcmVnaW9uXG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lcyBhIGNvbmNyZXRlIGZpbGUgcGF0aCBmb3IgZ2l2ZW4gbW9kdWxlIGlkLlxuICAgICAqIEBwYXJhbSBtb2R1bGVJRCAtIE1vZHVsZSBpZCB0byBkZXRlcm1pbmUuXG4gICAgICogQHBhcmFtIGFsaWFzZXMgLSBNYXBwaW5nIG9mIGFsaWFzZXMgdG8gdGFrZSBpbnRvIGFjY291bnQuXG4gICAgICogQHJldHVybnMgVGhlIGFsaWFzIGFwcGxpZWQgZ2l2ZW4gbW9kdWxlIGlkLlxuICAgICAqL1xuICAgIHN0YXRpYyBhcHBseUFsaWFzZXMobW9kdWxlSUQ6c3RyaW5nLCBhbGlhc2VzOlBsYWluT2JqZWN0KTpzdHJpbmcge1xuICAgICAgICBmb3IgKGNvbnN0IGFsaWFzOnN0cmluZyBpbiBhbGlhc2VzKVxuICAgICAgICAgICAgaWYgKGFsaWFzLmVuZHNXaXRoKCckJykpIHtcbiAgICAgICAgICAgICAgICBpZiAobW9kdWxlSUQgPT09IGFsaWFzLnN1YnN0cmluZygwLCBhbGlhcy5sZW5ndGggLSAxKSlcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlSUQgPSBhbGlhc2VzW2FsaWFzXVxuICAgICAgICAgICAgfSBlbHNlXG4gICAgICAgICAgICAgICAgbW9kdWxlSUQgPSBtb2R1bGVJRC5yZXBsYWNlKGFsaWFzLCBhbGlhc2VzW2FsaWFzXSlcbiAgICAgICAgcmV0dXJuIG1vZHVsZUlEXG4gICAgfVxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgYSBjb25jcmV0ZSBmaWxlIHBhdGggZm9yIGdpdmVuIG1vZHVsZSBpZC5cbiAgICAgKiBAcGFyYW0gbW9kdWxlSUQgLSBNb2R1bGUgaWQgdG8gZGV0ZXJtaW5lLlxuICAgICAqIEBwYXJhbSByZXBsYWNlbWVudHMgLSBNYXBwaW5nIG9mIHJlZ3VsYXIgZXhwcmVzc2lvbnMgdG8gdGhlaXJcbiAgICAgKiBjb3JyZXNwb25kaW5nIHJlcGxhY2VtZW50cy5cbiAgICAgKiBAcmV0dXJucyBUaGUgcmVwbGFjZW1lbnQgYXBwbGllZCBnaXZlbiBtb2R1bGUgaWQuXG4gICAgICovXG4gICAgc3RhdGljIGFwcGx5TW9kdWxlUmVwbGFjZW1lbnRzKFxuICAgICAgICBtb2R1bGVJRDpzdHJpbmcsIHJlcGxhY2VtZW50czpQbGFpbk9iamVjdFxuICAgICk6c3RyaW5nIHtcbiAgICAgICAgZm9yIChjb25zdCByZXBsYWNlbWVudDpzdHJpbmcgaW4gcmVwbGFjZW1lbnRzKVxuICAgICAgICAgICAgaWYgKHJlcGxhY2VtZW50cy5oYXNPd25Qcm9wZXJ0eShyZXBsYWNlbWVudCkpXG4gICAgICAgICAgICAgICAgbW9kdWxlSUQgPSBtb2R1bGVJRC5yZXBsYWNlKFxuICAgICAgICAgICAgICAgICAgICBuZXcgUmVnRXhwKHJlcGxhY2VtZW50KSwgcmVwbGFjZW1lbnRzW3JlcGxhY2VtZW50XSlcbiAgICAgICAgcmV0dXJuIG1vZHVsZUlEXG4gICAgfVxufVxuLy8gZW5kcmVnaW9uXG4vLyByZWdpb24gdmltIG1vZGxpbmVcbi8vIHZpbTogc2V0IHRhYnN0b3A9NCBzaGlmdHdpZHRoPTQgZXhwYW5kdGFiOlxuLy8gdmltOiBmb2xkbWV0aG9kPW1hcmtlciBmb2xkbWFya2VyPXJlZ2lvbixlbmRyZWdpb246XG4vLyBlbmRyZWdpb25cbiJdfQ==