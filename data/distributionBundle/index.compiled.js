#!/usr/bin/env node
'use strict';var _promise=require('babel-runtime/core-js/promise'),_promise2=_interopRequireDefault(_promise),_stringify=require('babel-runtime/core-js/json/stringify'),_stringify2=_interopRequireDefault(_stringify),_asyncToGenerator2=require('babel-runtime/helpers/asyncToGenerator'),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_child_process=require('child_process'),_clientnode=require('clientnode'),_clientnode2=_interopRequireDefault(_clientnode),_fs=require('fs'),fileSystem=_interopRequireWildcard(_fs),_path=require('path'),_path2=_interopRequireDefault(_path),_rimraf=require('rimraf'),_configurator=require('./configurator.compiled'),_configurator2=_interopRequireDefault(_configurator),_helper=require('./helper.compiled'),_helper2=_interopRequireDefault(_helper);Object.defineProperty(exports,'__esModule',{value:!0});function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}try{require('source-map-support/register')}catch(a){}const main=(()=>{var a=(0,_asyncToGenerator3.default)(function*(){try{const b={cwd:_configurator2.default.path.context,env:process.env,shell:!0,stdio:'inherit'},c=[],d=[],e=['build','buildDLL','clear','document','lint','preinstall','serve','test','testInBrowser','typeCheck'],f=[];if(2<_configurator2.default.givenCommandLineArguments.length){let i={givenCommandLineArguments:_configurator2.default.givenCommandLineArguments.slice()};3<_configurator2.default.givenCommandLineArguments.length&&_clientnode2.default.stringParseEncodedObject(_configurator2.default.givenCommandLineArguments[_configurator2.default.givenCommandLineArguments.length-1],_configurator2.default,'configuration')&&_configurator2.default.givenCommandLineArguments.pop();let j=0,k=`${_configurator2.default.path.context}.`+`dynamicConfiguration-${j}.json`;for(;k=`${_configurator2.default.path.context}.`+`dynamicConfiguration-${j}.json`,!!(yield _clientnode2.default.isFile(k));)j+=1;fileSystem.writeFileSync(k,(0,_stringify2.default)(i));const l=process.argv.splice(3);if(f.push(function(o){try{fileSystem.unlinkSync(k)}catch(p){}if(o)throw o;return o}),!['build','preinstall','serve','test','testInBrowser'].includes(_configurator2.default.givenCommandLineArguments[2])&&e.includes(_configurator2.default.givenCommandLineArguments[2])){if(_path2.default.resolve(_configurator2.default.path.target.base)===_path2.default.resolve(_configurator2.default.path.context)){yield _clientnode2.default.walkDirectoryRecursively(_configurator2.default.path.target.base,function(o){if(_helper2.default.isFilePathInLocation(o.path,_configurator2.default.path.ignore.concat(_configurator2.default.module.directoryNames,_configurator2.default.loader.directoryNames).map(function(p){return _path2.default.resolve(_configurator2.default.path.context,p)}).filter(function(p){return!_configurator2.default.path.context.startsWith(p)})))return!1;for(const p in _configurator2.default.build.types)if(new RegExp(_configurator2.default.build.types[p].filePathPattern).test(o.path)){if(o.stat.isDirectory())return(0,_rimraf.sync)(o.path,{glob:!1}),!1;fileSystem.unlinkSync(o.path);break}});for(const o of fileSystem.readdirSync(_configurator2.default.path.target.base))(o.length>'.dll-manifest.json'.length&&o.endsWith('.dll-manifest.json')||o.startsWith('npm-debug'))&&fileSystem.unlinkSync(_path2.default.resolve(_configurator2.default.path.target.base,o))}else(0,_rimraf.sync)(_configurator2.default.path.target.base,{glob:!1});try{(0,_rimraf.sync)(_configurator2.default.path.apiDocumentation,{glob:!1})}catch(o){}}const m=_helper2.default.resolveBuildConfigurationFilePaths(_configurator2.default.build.types,_configurator2.default.path.source.asset.base,_configurator2.default.path.ignore.concat(_configurator2.default.module.directoryNames,_configurator2.default.loader.directoryNames).map(function(o){return _path2.default.resolve(_configurator2.default.path.context,o)}).filter(function(o){return!_configurator2.default.path.context.startsWith(o)}),_configurator2.default.package.main.fileNames);if(['build','buildDLL','document','test'].includes(process.argv[2])){let o=!1;const p=(()=>{var q=(0,_asyncToGenerator3.default)(function*(){if(!o){for(const r in o=!0,_configurator2.default.injection.internal.normalized)if(_configurator2.default.injection.internal.normalized.hasOwnProperty(r))for(const s of _configurator2.default.injection.internal.normalized[r]){const t=_helper2.default.determineModuleFilePath(s,_configurator2.default.module.aliases,_configurator2.default.module.replacements.normal,_configurator2.default.extensions,_configurator2.default.path.context,_configurator2.default.path.source.asset.base,_configurator2.default.path.ignore,_configurator2.default.module.directoryNames,_configurator2.default.package.main.fileNames,_configurator2.default.package.main.propertyNames,_configurator2.default.package.aliasPropertyNames);let u;if(t&&(u=_helper2.default.determineAssetType(t,_configurator2.default.build.types,_configurator2.default.path)),'string'==typeof u&&_configurator2.default.build.types[u]){const v=_helper2.default.renderFilePathTemplate(_helper2.default.stripLoader(_configurator2.default.files.compose.javaScript),{'[name]':r});'js'===_configurator2.default.build.types[u].outputExtension&&(yield _clientnode2.default.isFile(v))&&fileSystem.chmodSync(v,'755')}}for(const r of _configurator2.default.path.tidyUp)if(r)try{fileSystem.unlinkSync(r)}catch(s){}}});return function tidyUp(){return q.apply(this,arguments)}})();f.push(p),d.push(new _promise2.default(function(q,r){const s=(_configurator2.default.commandLine.build.arguments||[]).concat(l);console.info('Running "'+(`${_configurator2.default.commandLine.build.command} `+s.join(' ')).trim()+'"');const t=(0,_child_process.spawn)(_configurator2.default.commandLine.build.command,s,b),u=(()=>{var w=(0,_asyncToGenerator3.default)(function*(){for(const x of _configurator2.default.files.additionalPaths){const y=_path2.default.join(_configurator2.default.path.source.base,x),z=_path2.default.join(_configurator2.default.path.target.base,x);(yield _clientnode2.default.isDirectory(y))?((yield _clientnode2.default.isDirectory(z))&&(0,_rimraf.sync)(z,{glob:!1}),yield _clientnode2.default.copyDirectoryRecursive(y,z)):(yield _clientnode2.default.isFile(y))&&(yield _clientnode2.default.copyFile(y,z))}p()});return function copyAdditionalFilesAndTidyUp(){return w.apply(this,arguments)}})(),v=_clientnode2.default.getProcessCloseHandler(q,r,null,'build'===process.argv[2]?u:p);for(const w of _clientnode2.default.closeEventNames)t.on(w,v);c.push(t)}))}else if(_configurator2.default.library&&'preinstall'===_configurator2.default.givenCommandLineArguments[2]){const o=_helper2.default.determineModuleLocations(_configurator2.default.testInBrowser.injection.internal,_configurator2.default.module.aliases,_configurator2.default.module.replacements.normal,_configurator2.default.extensions,_configurator2.default.path.context,_configurator2.default.path.source.asset.base,_configurator2.default.path.ignore).filePaths;for(const p of m)for(const q of p.filePaths)if(!o.includes(q)){const s=function(t,u,v,w,x,y){return new Function('global','self','buildConfiguration','path','additionalArguments','filePath','return `'+v[_configurator2.default.givenCommandLineArguments[2]].trim()+'`')(t,u,v,w,x,y)}(global,_configurator2.default,p,_path2.default,l,q);console.info(`Running "${s}"`),d.push(new _promise2.default(function(t,u){return _clientnode2.default.handleChildProcess((0,_child_process.exec)(s,b,function(v){return v?u(v):t()}))}))}}const n=function(o){let p=Array.isArray(_configurator2.default.commandLine[o])?_configurator2.default.commandLine[o]:[_configurator2.default.commandLine[o]];for(const q of p){(function(s,t,u){return new Function('global','self','path','return '+(q.hasOwnProperty('indicator')?q.indicator:'true'))(s,t,u)})(global,_configurator2.default,_path2.default)&&d.push(new _promise2.default(function(s,t){const u=(q.arguments||[]).concat(l);console.info('Running "'+(`${q.command} `+u.join(' ')).trim()+'"');const v=(0,_child_process.spawn)(q.command,u,b),w=_clientnode2.default.getProcessCloseHandler(s,t);for(const x of _clientnode2.default.closeEventNames)v.on(x,w);c.push(v)}))}};['document','test'].includes(_configurator2.default.givenCommandLineArguments[2])?(yield _promise2.default.all(d),n(_configurator2.default.givenCommandLineArguments[2])):['lint','testInBrowser','typeCheck','serve'].includes(_configurator2.default.givenCommandLineArguments[2])&&n(_configurator2.default.givenCommandLineArguments[2])}let g=!1;const h=function(...i){if(!g)for(const j of f)j(...i);g=!0};for(const i of _clientnode2.default.closeEventNames)process.on(i,h);require.main===module&&(3>_configurator2.default.givenCommandLineArguments.length||!e.includes(_configurator2.default.givenCommandLineArguments[2]))&&console.info(`Give one of "${e.join('", "')}" as command `+'line argument. You can provide a json string as second parameter to dynamically overwrite some configurations.\n');try{yield _promise2.default.all(d)}catch(i){process.exit(i.returnCode)}}catch(b){if(_configurator2.default.debug)throw b;else console.error(b)}});return function(){return a.apply(this,arguments)}})();require.main===module&&main().catch((a)=>{throw a}),exports.default=main;

//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VyxJIiwiZmlsZSI6ImluZGV4LmNvbXBpbGVkLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXG4vLyBAZmxvd1xuLy8gLSotIGNvZGluZzogdXRmLTggLSotXG4ndXNlIHN0cmljdCdcbi8qICFcbiAgICByZWdpb24gaGVhZGVyXG4gICAgQ29weXJpZ2h0IFRvcmJlbiBTaWNrZXJ0IChpbmZvW1wifmF0flwiXXRvcmJlbi53ZWJzaXRlKSAxNi4xMi4yMDEyXG5cbiAgICBMaWNlbnNlXG4gICAgLS0tLS0tLVxuXG4gICAgVGhpcyBsaWJyYXJ5IHdyaXR0ZW4gYnkgVG9yYmVuIFNpY2tlcnQgc3RhbmQgdW5kZXIgYSBjcmVhdGl2ZSBjb21tb25zIG5hbWluZ1xuICAgIDMuMCB1bnBvcnRlZCBsaWNlbnNlLiBzZWUgaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnkvMy4wL2RlZWQuZGVcbiAgICBlbmRyZWdpb25cbiovXG4vLyByZWdpb24gaW1wb3J0c1xuaW1wb3J0IHtcbiAgICBDaGlsZFByb2Nlc3MsIGV4ZWMgYXMgZXhlY0NoaWxkUHJvY2Vzcywgc3Bhd24gYXMgc3Bhd25DaGlsZFByb2Nlc3Ncbn0gZnJvbSAnY2hpbGRfcHJvY2VzcydcbmltcG9ydCBUb29scyBmcm9tICdjbGllbnRub2RlJ1xuaW1wb3J0IHR5cGUge0ZpbGUsIFBsYWluT2JqZWN0fSBmcm9tICdjbGllbnRub2RlJ1xuaW1wb3J0ICogYXMgZmlsZVN5c3RlbSBmcm9tICdmcydcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnXG5pbXBvcnQge3N5bmMgYXMgcmVtb3ZlRGlyZWN0b3J5UmVjdXJzaXZlbHlTeW5jfSBmcm9tICdyaW1yYWYnXG4vLyBOT1RFOiBPbmx5IG5lZWRlZCBmb3IgZGVidWdnaW5nIHRoaXMgZmlsZS5cbnRyeSB7XG4gICAgcmVxdWlyZSgnc291cmNlLW1hcC1zdXBwb3J0L3JlZ2lzdGVyJylcbn0gY2F0Y2ggKGVycm9yKSB7fVxuXG5pbXBvcnQgY29uZmlndXJhdGlvbiBmcm9tICcuL2NvbmZpZ3VyYXRvci5jb21waWxlZCdcbmltcG9ydCBIZWxwZXIgZnJvbSAnLi9oZWxwZXIuY29tcGlsZWQnXG5pbXBvcnQgdHlwZSB7UmVzb2x2ZWRCdWlsZENvbmZpZ3VyYXRpb259IGZyb20gJy4vdHlwZSdcbi8vIGVuZHJlZ2lvblxuY29uc3QgbWFpbiA9IGFzeW5jICgpOlByb21pc2U8YW55PiA9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgLy8gcmVnaW9uIGNvbnRyb2xsZXJcbiAgICAgICAgY29uc3QgY2hpbGRQcm9jZXNzT3B0aW9uczpPYmplY3QgPSB7XG4gICAgICAgICAgICBjd2Q6IGNvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0LFxuICAgICAgICAgICAgZW52OiBwcm9jZXNzLmVudixcbiAgICAgICAgICAgIHNoZWxsOiB0cnVlLFxuICAgICAgICAgICAgc3RkaW86ICdpbmhlcml0J1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNoaWxkUHJvY2Vzc2VzOkFycmF5PENoaWxkUHJvY2Vzcz4gPSBbXVxuICAgICAgICBjb25zdCBwcm9jZXNzUHJvbWlzZXM6QXJyYXk8UHJvbWlzZTxhbnk+PiA9IFtdXG4gICAgICAgIGNvbnN0IHBvc3NpYmxlQXJndW1lbnRzOkFycmF5PHN0cmluZz4gPSBbXG4gICAgICAgICAgICAnYnVpbGQnLCAnYnVpbGRETEwnLCAnY2xlYXInLCAnZG9jdW1lbnQnLCAnbGludCcsICdwcmVpbnN0YWxsJyxcbiAgICAgICAgICAgICdzZXJ2ZScsICd0ZXN0JywgJ3Rlc3RJbkJyb3dzZXInLCAndHlwZUNoZWNrJ11cbiAgICAgICAgY29uc3QgY2xvc2VFdmVudEhhbmRsZXJzOkFycmF5PEZ1bmN0aW9uPiA9IFtdXG4gICAgICAgIGlmIChjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHMubGVuZ3RoID4gMikge1xuICAgICAgICAgICAgLy8gcmVnaW9uIHRlbXBvcmFyeSBzYXZlIGR5bmFtaWNhbGx5IGdpdmVuIGNvbmZpZ3VyYXRpb25zXG4gICAgICAgICAgICAvLyBOT1RFOiBXZSBuZWVkIGEgY29weSBvZiBnaXZlbiBhcmd1bWVudHMgYXJyYXkuXG4gICAgICAgICAgICBsZXQgZHluYW1pY0NvbmZpZ3VyYXRpb246UGxhaW5PYmplY3QgPSB7Z2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50czpcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHMuc2xpY2UoKX1cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHMubGVuZ3RoID4gMyAmJlxuICAgICAgICAgICAgICAgIFRvb2xzLnN0cmluZ1BhcnNlRW5jb2RlZE9iamVjdChcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzW1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzLmxlbmd0aCAtIDFdLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLCAnY29uZmlndXJhdGlvbicpXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzLnBvcCgpXG4gICAgICAgICAgICBsZXQgY291bnQ6bnVtYmVyID0gMFxuICAgICAgICAgICAgbGV0IGZpbGVQYXRoOnN0cmluZyA9IGAke2NvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0fS5gICtcbiAgICAgICAgICAgICAgICBgZHluYW1pY0NvbmZpZ3VyYXRpb24tJHtjb3VudH0uanNvbmBcbiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICAgICAgZmlsZVBhdGggPSBgJHtjb25maWd1cmF0aW9uLnBhdGguY29udGV4dH0uYCArXG4gICAgICAgICAgICAgICAgICAgIGBkeW5hbWljQ29uZmlndXJhdGlvbi0ke2NvdW50fS5qc29uYFxuICAgICAgICAgICAgICAgIGlmICghKGF3YWl0IFRvb2xzLmlzRmlsZShmaWxlUGF0aCkpKVxuICAgICAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgICAgIGNvdW50ICs9IDFcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpbGVTeXN0ZW0ud3JpdGVGaWxlU3luYyhmaWxlUGF0aCwgSlNPTi5zdHJpbmdpZnkoXG4gICAgICAgICAgICAgICAgZHluYW1pY0NvbmZpZ3VyYXRpb24pKVxuICAgICAgICAgICAgY29uc3QgYWRkaXRpb25hbEFyZ3VtZW50czpBcnJheTxzdHJpbmc+ID0gcHJvY2Vzcy5hcmd2LnNwbGljZSgzKVxuICAgICAgICAgICAgLy8gLyByZWdpb24gcmVnaXN0ZXIgZXhpdCBoYW5kbGVyIHRvIHRpZHkgdXBcbiAgICAgICAgICAgIGNsb3NlRXZlbnRIYW5kbGVycy5wdXNoKGZ1bmN0aW9uKGVycm9yOj9FcnJvcik6P0Vycm9yIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBmaWxlU3lzdGVtLnVubGlua1N5bmMoZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHt9XG4gICAgICAgICAgICAgICAgaWYgKGVycm9yKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvclxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vIC8gZW5kcmVnaW9uXG4gICAgICAgICAgICAvLyBlbmRyZWdpb25cbiAgICAgICAgICAgIC8vIHJlZ2lvbiBoYW5kbGUgY2xlYXJcbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgICAgTk9URTogU29tZSB0YXNrcyBjb3VsZCBkZXBlbmQgb24gcHJldmlvdXNseSBjcmVhdGVkIGRsbFxuICAgICAgICAgICAgICAgIHBhY2thZ2VzIHNvIGEgY2xlYW4gc2hvdWxkIG5vdCBiZSBwZXJmb3JtZWQgaW4gdGhhdCBjYXNlLlxuICAgICAgICAgICAgICAgIE5PVEU6IElmIHdlIGhhdmUgYSBkZXBlbmRlbmN5IGN5Y2xlIHdlIG5lZWQgdG8gcHJlc2VydmUgZmlsZXNcbiAgICAgICAgICAgICAgICBkdXJpbmcgcHJlaW5zdGFsbCBwaGFzZS5cbiAgICAgICAgICAgICovXG4gICAgICAgICAgICBpZiAoIVtcbiAgICAgICAgICAgICAgICAnYnVpbGQnLCAncHJlaW5zdGFsbCcsICdzZXJ2ZScsICd0ZXN0JywgJ3Rlc3RJbkJyb3dzZXInXG4gICAgICAgICAgICBdLmluY2x1ZGVzKGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXSkgJiZcbiAgICAgICAgICAgIHBvc3NpYmxlQXJndW1lbnRzLmluY2x1ZGVzKFxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXVxuICAgICAgICAgICAgKSkge1xuICAgICAgICAgICAgICAgIGlmIChwYXRoLnJlc29sdmUoXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC50YXJnZXQuYmFzZVxuICAgICAgICAgICAgICAgICkgPT09IHBhdGgucmVzb2x2ZShjb25maWd1cmF0aW9uLnBhdGguY29udGV4dCkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlcyBhbGwgY29tcGlsZWQgZmlsZXMuXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IFRvb2xzLndhbGtEaXJlY3RvcnlSZWN1cnNpdmVseShcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC50YXJnZXQuYmFzZSwgKGZpbGU6RmlsZSk6P2ZhbHNlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSGVscGVyLmlzRmlsZVBhdGhJbkxvY2F0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLnBhdGgsIGNvbmZpZ3VyYXRpb24ucGF0aC5pZ25vcmUuY29uY2F0KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5tb2R1bGUuZGlyZWN0b3J5TmFtZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmxvYWRlci5kaXJlY3RvcnlOYW1lc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLm1hcCgoZmlsZVBhdGg6c3RyaW5nKTpzdHJpbmcgPT4gcGF0aC5yZXNvbHZlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQsIGZpbGVQYXRoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLmZpbHRlcigoZmlsZVBhdGg6c3RyaW5nKTpib29sZWFuID0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQuc3RhcnRzV2l0aChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlUGF0aCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHlwZTpzdHJpbmcgaW4gY29uZmlndXJhdGlvbi5idWlsZC50eXBlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5ldyBSZWdFeHAoY29uZmlndXJhdGlvbi5idWlsZC50eXBlc1tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXS5maWxlUGF0aFBhdHRlcm4pLnRlc3QoZmlsZS5wYXRoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUuc3RhdC5pc0RpcmVjdG9yeSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlRGlyZWN0b3J5UmVjdXJzaXZlbHlTeW5jKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLnBhdGgsIHtnbG9iOiBmYWxzZX0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlU3lzdGVtLnVubGlua1N5bmMoZmlsZS5wYXRoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBmaWxlTmFtZTpzdHJpbmcgb2YgZmlsZVN5c3RlbS5yZWFkZGlyU3luYyhcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC50YXJnZXQuYmFzZVxuICAgICAgICAgICAgICAgICAgICApKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVOYW1lLmxlbmd0aCA+ICcuZGxsLW1hbmlmZXN0Lmpzb24nLmxlbmd0aCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVOYW1lLmVuZHNXaXRoKCcuZGxsLW1hbmlmZXN0Lmpzb24nKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVOYW1lLnN0YXJ0c1dpdGgoJ25wbS1kZWJ1ZycpXG4gICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVN5c3RlbS51bmxpbmtTeW5jKHBhdGgucmVzb2x2ZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLnRhcmdldC5iYXNlLCBmaWxlTmFtZSkpXG4gICAgICAgICAgICAgICAgfSBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZURpcmVjdG9yeVJlY3Vyc2l2ZWx5U3luYyhcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC50YXJnZXQuYmFzZSwge2dsb2I6IGZhbHNlfSlcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICByZW1vdmVEaXJlY3RvcnlSZWN1cnNpdmVseVN5bmMoXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguYXBpRG9jdW1lbnRhdGlvbiwge2dsb2I6IGZhbHNlfSlcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge31cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGVuZHJlZ2lvblxuICAgICAgICAgICAgLy8gcmVnaW9uIGhhbmRsZSBidWlsZFxuICAgICAgICAgICAgY29uc3QgYnVpbGRDb25maWd1cmF0aW9uczpSZXNvbHZlZEJ1aWxkQ29uZmlndXJhdGlvbiA9XG4gICAgICAgICAgICAgICAgSGVscGVyLnJlc29sdmVCdWlsZENvbmZpZ3VyYXRpb25GaWxlUGF0aHMoXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uYnVpbGQudHlwZXMsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC5zb3VyY2UuYXNzZXQuYmFzZSxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLmlnbm9yZS5jb25jYXQoXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLm1vZHVsZS5kaXJlY3RvcnlOYW1lcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ubG9hZGVyLmRpcmVjdG9yeU5hbWVzXG4gICAgICAgICAgICAgICAgICAgICkubWFwKChmaWxlUGF0aDpzdHJpbmcpOnN0cmluZyA9PiBwYXRoLnJlc29sdmUoXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguY29udGV4dCwgZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICkuZmlsdGVyKChmaWxlUGF0aDpzdHJpbmcpOmJvb2xlYW4gPT5cbiAgICAgICAgICAgICAgICAgICAgICAgICFjb25maWd1cmF0aW9uLnBhdGguY29udGV4dC5zdGFydHNXaXRoKGZpbGVQYXRoKSksXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGFja2FnZS5tYWluLmZpbGVOYW1lcylcbiAgICAgICAgICAgIGlmIChbJ2J1aWxkJywgJ2J1aWxkRExMJywgJ2RvY3VtZW50JywgJ3Rlc3QnXS5pbmNsdWRlcyhcbiAgICAgICAgICAgICAgICBwcm9jZXNzLmFyZ3ZbMl1cbiAgICAgICAgICAgICkpIHtcbiAgICAgICAgICAgICAgICBsZXQgdGlkaWVkVXA6Ym9vbGVhbiA9IGZhbHNlXG4gICAgICAgICAgICAgICAgY29uc3QgdGlkeVVwOkZ1bmN0aW9uID0gYXN5bmMgKCk6UHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgICAgICAgICAgICBEZXRlcm1pbmVzIGFsbCBub25lIGphdmFTY3JpcHQgZW50aXRpZXMgd2hpY2ggaGF2ZSBiZWVuXG4gICAgICAgICAgICAgICAgICAgICAgICBlbWl0dGVkIGFzIHNpbmdsZSBqYXZhU2NyaXB0IG1vZHVsZSB0byByZW1vdmUuXG4gICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aWRpZWRVcClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgICAgICAgICB0aWRpZWRVcCA9IHRydWVcbiAgICAgICAgICAgICAgICAgICAgZm9yIChcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNodW5rTmFtZTpzdHJpbmcgaW5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uaW5qZWN0aW9uLmludGVybmFsLm5vcm1hbGl6ZWRcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uaW5qZWN0aW9uLmludGVybmFsLm5vcm1hbGl6ZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmhhc093blByb3BlcnR5KGNodW5rTmFtZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtb2R1bGVJRDpzdHJpbmcgb2YgY29uZmlndXJhdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmluamVjdGlvbi5pbnRlcm5hbC5ub3JtYWxpemVkW2NodW5rTmFtZV1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZVBhdGg6P3N0cmluZyA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWxwZXIuZGV0ZXJtaW5lTW9kdWxlRmlsZVBhdGgoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kdWxlSUQsIGNvbmZpZ3VyYXRpb24ubW9kdWxlLmFsaWFzZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5tb2R1bGUucmVwbGFjZW1lbnRzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5ub3JtYWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5leHRlbnNpb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC5zb3VyY2UuYXNzZXQuYmFzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguaWdub3JlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ubW9kdWxlLmRpcmVjdG9yeU5hbWVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGFja2FnZS5tYWluLmZpbGVOYW1lcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhY2thZ2UubWFpblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucHJvcGVydHlOYW1lcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhY2thZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFsaWFzUHJvcGVydHlOYW1lcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHR5cGU6P3N0cmluZ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlID0gSGVscGVyLmRldGVybWluZUFzc2V0VHlwZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlUGF0aCwgY29uZmlndXJhdGlvbi5idWlsZC50eXBlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVvZiB0eXBlID09PSAnc3RyaW5nJyAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5idWlsZC50eXBlc1t0eXBlXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVQYXRoOnN0cmluZyA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVscGVyLnJlbmRlckZpbGVQYXRoVGVtcGxhdGUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhlbHBlci5zdHJpcExvYWRlcihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZmlsZXMuY29tcG9zZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5qYXZhU2NyaXB0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICksIHsnW25hbWVdJzogY2h1bmtOYW1lfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maWd1cmF0aW9uLmJ1aWxkLnR5cGVzW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0ub3V0cHV0RXh0ZW5zaW9uID09PSAnanMnICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBUb29scy5pc0ZpbGUoZmlsZVBhdGgpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVTeXN0ZW0uY2htb2RTeW5jKGZpbGVQYXRoLCAnNzU1JylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBmaWxlUGF0aDo/c3RyaW5nIG9mIGNvbmZpZ3VyYXRpb24ucGF0aC50aWR5VXApXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVN5c3RlbS51bmxpbmtTeW5jKGZpbGVQYXRoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7fVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjbG9zZUV2ZW50SGFuZGxlcnMucHVzaCh0aWR5VXApXG4gICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgICAgVHJpZ2dlcnMgY29tcGxldGUgYXNzZXQgY29tcGlsaW5nIGFuZCBidW5kbGVzIHRoZW0gaW50byB0aGVcbiAgICAgICAgICAgICAgICAgICAgZmluYWwgcHJvZHVjdGl2ZSBvdXRwdXQuXG4gICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBwcm9jZXNzUHJvbWlzZXMucHVzaChuZXcgUHJvbWlzZSgoXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6RnVuY3Rpb24sIHJlamVjdDpGdW5jdGlvblxuICAgICAgICAgICAgICAgICk6dm9pZCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbW1hbmRMaW5lQXJndW1lbnRzOkFycmF5PHN0cmluZz4gPSAoXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmNvbW1hbmRMaW5lLmJ1aWxkLmFyZ3VtZW50cyB8fCBbXVxuICAgICAgICAgICAgICAgICAgICApLmNvbmNhdChhZGRpdGlvbmFsQXJndW1lbnRzKVxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oJ1J1bm5pbmcgXCInICsgKFxuICAgICAgICAgICAgICAgICAgICAgICAgYCR7Y29uZmlndXJhdGlvbi5jb21tYW5kTGluZS5idWlsZC5jb21tYW5kfSBgICtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRMaW5lQXJndW1lbnRzLmpvaW4oJyAnKVxuICAgICAgICAgICAgICAgICAgICApLnRyaW0oKSArICdcIicpXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkUHJvY2VzczpDaGlsZFByb2Nlc3MgPSBzcGF3bkNoaWxkUHJvY2VzcyhcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uY29tbWFuZExpbmUuYnVpbGQuY29tbWFuZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRMaW5lQXJndW1lbnRzLCBjaGlsZFByb2Nlc3NPcHRpb25zKVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3B5QWRkaXRpb25hbEZpbGVzQW5kVGlkeVVwOkZ1bmN0aW9uID0gYXN5bmMgKFxuICAgICAgICAgICAgICAgICAgICApOlByb21pc2U8dm9pZD4gPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlUGF0aDpzdHJpbmcgb2ZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmZpbGVzLmFkZGl0aW9uYWxQYXRoc1xuICAgICAgICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc291cmNlUGF0aDpzdHJpbmcgPSBwYXRoLmpvaW4oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC5zb3VyY2UuYmFzZSwgZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0UGF0aDpzdHJpbmcgPSBwYXRoLmpvaW4oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC50YXJnZXQuYmFzZSwgZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF3YWl0IFRvb2xzLmlzRGlyZWN0b3J5KHNvdXJjZVBhdGgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhd2FpdCBUb29scy5pc0RpcmVjdG9yeSh0YXJnZXRQYXRoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZURpcmVjdG9yeVJlY3Vyc2l2ZWx5U3luYyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRQYXRoLCB7Z2xvYjogZmFsc2V9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBUb29scy5jb3B5RGlyZWN0b3J5UmVjdXJzaXZlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlUGF0aCwgdGFyZ2V0UGF0aClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGF3YWl0IFRvb2xzLmlzRmlsZShzb3VyY2VQYXRoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgVG9vbHMuY29weUZpbGUoc291cmNlUGF0aCwgdGFyZ2V0UGF0aClcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRpZHlVcCgpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2xvc2VIYW5kbGVyOkZ1bmN0aW9uID0gVG9vbHMuZ2V0UHJvY2Vzc0Nsb3NlSGFuZGxlcihcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUsIHJlamVjdCwgbnVsbCwgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3MuYXJndlsyXSA9PT0gJ2J1aWxkJ1xuICAgICAgICAgICAgICAgICAgICAgICAgKSA/IGNvcHlBZGRpdGlvbmFsRmlsZXNBbmRUaWR5VXAgOiB0aWR5VXApXG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgY2xvc2VFdmVudE5hbWU6c3RyaW5nIG9mIFRvb2xzLmNsb3NlRXZlbnROYW1lcylcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkUHJvY2Vzcy5vbihjbG9zZUV2ZW50TmFtZSwgY2xvc2VIYW5kbGVyKVxuICAgICAgICAgICAgICAgICAgICBjaGlsZFByb2Nlc3Nlcy5wdXNoKGNoaWxkUHJvY2VzcylcbiAgICAgICAgICAgICAgICB9KSlcbiAgICAgICAgICAgIC8vIGVuZHJlZ2lvblxuICAgICAgICAgICAgLy8gcmVnaW9uIGhhbmRsZSBwcmVpbnN0YWxsXG4gICAgICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ubGlicmFyeSAmJlxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXSA9PT0gJ3ByZWluc3RhbGwnXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAvLyBQZXJmb3JtIGFsbCBmaWxlIHNwZWNpZmljIHByZXByb2Nlc3Npbmcgc3R1ZmYuXG4gICAgICAgICAgICAgICAgY29uc3QgdGVzdE1vZHVsZUZpbGVQYXRoczpBcnJheTxzdHJpbmc+ID1cbiAgICAgICAgICAgICAgICAgICAgSGVscGVyLmRldGVybWluZU1vZHVsZUxvY2F0aW9ucyhcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24udGVzdEluQnJvd3Nlci5pbmplY3Rpb24uaW50ZXJuYWwsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLm1vZHVsZS5hbGlhc2VzLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5tb2R1bGUucmVwbGFjZW1lbnRzLm5vcm1hbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZXh0ZW5zaW9ucywgY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguc291cmNlLmFzc2V0LmJhc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguaWdub3JlXG4gICAgICAgICAgICAgICAgICAgICkuZmlsZVBhdGhzXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBidWlsZENvbmZpZ3VyYXRpb24gb2YgYnVpbGRDb25maWd1cmF0aW9ucylcbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBmaWxlUGF0aDpzdHJpbmcgb2YgYnVpbGRDb25maWd1cmF0aW9uLmZpbGVQYXRocylcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGVzdE1vZHVsZUZpbGVQYXRocy5pbmNsdWRlcyhmaWxlUGF0aCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBldmFsdWF0aW9uRnVuY3Rpb24gPSAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbDpPYmplY3QsIHNlbGY6UGxhaW5PYmplY3QsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1aWxkQ29uZmlndXJhdGlvbjpQbGFpbk9iamVjdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDp0eXBlb2YgcGF0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkaXRpb25hbEFyZ3VtZW50czpBcnJheTxzdHJpbmc+LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlUGF0aDpzdHJpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOnN0cmluZyA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmVUeXBlQ2hlY2tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEZ1bmN0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2dsb2JhbCcsICdzZWxmJywgJ2J1aWxkQ29uZmlndXJhdGlvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGF0aCcsICdhZGRpdGlvbmFsQXJndW1lbnRzJywgJ2ZpbGVQYXRoJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZXR1cm4gYCcgKyBidWlsZENvbmZpZ3VyYXRpb25bXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXS50cmltKCkgKyAnYCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbCwgc2VsZiwgYnVpbGRDb25maWd1cmF0aW9uLCBwYXRoLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkaXRpb25hbEFyZ3VtZW50cywgZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tbWFuZDpzdHJpbmcgPSBldmFsdWF0aW9uRnVuY3Rpb24oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbCwgY29uZmlndXJhdGlvbiwgYnVpbGRDb25maWd1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoLCBhZGRpdGlvbmFsQXJndW1lbnRzLCBmaWxlUGF0aClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oYFJ1bm5pbmcgXCIke2NvbW1hbmR9XCJgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NQcm9taXNlcy5wdXNoKG5ldyBQcm9taXNlKChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZTpGdW5jdGlvbiwgcmVqZWN0OkZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTp2b2lkID0+IFRvb2xzLmhhbmRsZUNoaWxkUHJvY2VzcyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhlY0NoaWxkUHJvY2VzcyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQsIGNoaWxkUHJvY2Vzc09wdGlvbnMsIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjo/RXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk6dm9pZCA9PiBlcnJvciA/IHJlamVjdChlcnJvcikgOiByZXNvbHZlKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSkpKVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gZW5kcmVnaW9uXG4gICAgICAgICAgICAvLyByZWdpb24gaGFuZGxlIHJlbWFpbmluZyB0YXNrc1xuICAgICAgICAgICAgY29uc3QgaGFuZGxlVGFzayA9ICh0eXBlOnN0cmluZyk6dm9pZCA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IHRhc2tzOkFycmF5PE9iamVjdD5cbiAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjb25maWd1cmF0aW9uLmNvbW1hbmRMaW5lW3R5cGVdKSlcbiAgICAgICAgICAgICAgICAgICAgdGFza3MgPSBjb25maWd1cmF0aW9uLmNvbW1hbmRMaW5lW3R5cGVdXG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICB0YXNrcyA9IFtjb25maWd1cmF0aW9uLmNvbW1hbmRMaW5lW3R5cGVdXVxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdGFzazpPYmplY3Qgb2YgdGFza3MpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXZhbHVhdGlvbkZ1bmN0aW9uID0gKFxuICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsOk9iamVjdCwgc2VsZjpQbGFpbk9iamVjdCwgcGF0aDp0eXBlb2YgcGF0aFxuICAgICAgICAgICAgICAgICAgICApOmJvb2xlYW4gPT5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElnbm9yZVR5cGVDaGVja1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEZ1bmN0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdnbG9iYWwnLCAnc2VsZicsICdwYXRoJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmV0dXJuICcgKyAodGFzay5oYXNPd25Qcm9wZXJ0eShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2luZGljYXRvcidcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApID8gdGFzay5pbmRpY2F0b3IgOiAndHJ1ZScpXG4gICAgICAgICAgICAgICAgICAgICAgICApKGdsb2JhbCwgc2VsZiwgcGF0aClcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2YWx1YXRpb25GdW5jdGlvbihnbG9iYWwsIGNvbmZpZ3VyYXRpb24sIHBhdGgpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1Byb21pc2VzLnB1c2gobmV3IFByb21pc2UoKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6RnVuY3Rpb24sIHJlamVjdDpGdW5jdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgKTp2b2lkID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21tYW5kTGluZUFyZ3VtZW50czpBcnJheTxzdHJpbmc+ID0gKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLmFyZ3VtZW50cyB8fCBbXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICkuY29uY2F0KGFkZGl0aW9uYWxBcmd1bWVudHMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKCdSdW5uaW5nIFwiJyArIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYCR7dGFzay5jb21tYW5kfSBgICsgY29tbWFuZExpbmVBcmd1bWVudHMuam9pbihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApLnRyaW0oKSArICdcIicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGRQcm9jZXNzOkNoaWxkUHJvY2VzcyA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYXduQ2hpbGRQcm9jZXNzKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay5jb21tYW5kLCBjb21tYW5kTGluZUFyZ3VtZW50cyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkUHJvY2Vzc09wdGlvbnMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2xvc2VIYW5kbGVyOkZ1bmN0aW9uID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVG9vbHMuZ2V0UHJvY2Vzc0Nsb3NlSGFuZGxlcihyZXNvbHZlLCByZWplY3QpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2xvc2VFdmVudE5hbWU6c3RyaW5nIG9mXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRvb2xzLmNsb3NlRXZlbnROYW1lc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRQcm9jZXNzLm9uKGNsb3NlRXZlbnROYW1lLCBjbG9zZUhhbmRsZXIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRQcm9jZXNzZXMucHVzaChjaGlsZFByb2Nlc3MpXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyAvIHJlZ2lvbiBhLS9zeW5jaHJvbm91c1xuICAgICAgICAgICAgaWYgKFsnZG9jdW1lbnQnLCAndGVzdCddLmluY2x1ZGVzKFxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXVxuICAgICAgICAgICAgKSkge1xuICAgICAgICAgICAgICAgIGF3YWl0IFByb21pc2UuYWxsKHByb2Nlc3NQcm9taXNlcylcbiAgICAgICAgICAgICAgICBoYW5kbGVUYXNrKGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXSlcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoWydsaW50JywgJ3Rlc3RJbkJyb3dzZXInLCAndHlwZUNoZWNrJywgJ3NlcnZlJ10uaW5jbHVkZXMoXG4gICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzWzJdXG4gICAgICAgICAgICApKVxuICAgICAgICAgICAgICAgIGhhbmRsZVRhc2soY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzWzJdKVxuICAgICAgICAgICAgLy8gLyBlbmRyZWdpb25cbiAgICAgICAgICAgIC8vIGVuZHJlZ2lvblxuICAgICAgICB9XG4gICAgICAgIGxldCBmaW5pc2hlZDpib29sZWFuID0gZmFsc2VcbiAgICAgICAgY29uc3QgY2xvc2VIYW5kbGVyID0gKC4uLnBhcmFtZXRlcjpBcnJheTxhbnk+KTp2b2lkID0+IHtcbiAgICAgICAgICAgIGlmICghZmluaXNoZWQpXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBjbG9zZUV2ZW50SGFuZGxlcjpGdW5jdGlvbiBvZiBjbG9zZUV2ZW50SGFuZGxlcnMpXG4gICAgICAgICAgICAgICAgICAgIGNsb3NlRXZlbnRIYW5kbGVyKC4uLnBhcmFtZXRlcilcbiAgICAgICAgICAgIGZpbmlzaGVkID0gdHJ1ZVxuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgY2xvc2VFdmVudE5hbWU6c3RyaW5nIG9mIFRvb2xzLmNsb3NlRXZlbnROYW1lcylcbiAgICAgICAgICAgIHByb2Nlc3Mub24oY2xvc2VFdmVudE5hbWUsIGNsb3NlSGFuZGxlcilcbiAgICAgICAgaWYgKHJlcXVpcmUubWFpbiA9PT0gbW9kdWxlICYmIChcbiAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50cy5sZW5ndGggPCAzIHx8XG4gICAgICAgICAgICAhcG9zc2libGVBcmd1bWVudHMuaW5jbHVkZXMoY29uZmlndXJhdGlvblxuICAgICAgICAgICAgICAgIC5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzWzJdKVxuICAgICAgICApKVxuICAgICAgICAgICAgY29uc29sZS5pbmZvKFxuICAgICAgICAgICAgICAgIGBHaXZlIG9uZSBvZiBcIiR7cG9zc2libGVBcmd1bWVudHMuam9pbignXCIsIFwiJyl9XCIgYXMgY29tbWFuZCBgICtcbiAgICAgICAgICAgICAgICAnbGluZSBhcmd1bWVudC4gWW91IGNhbiBwcm92aWRlIGEganNvbiBzdHJpbmcgYXMgc2Vjb25kICcgK1xuICAgICAgICAgICAgICAgICdwYXJhbWV0ZXIgdG8gZHluYW1pY2FsbHkgb3ZlcndyaXRlIHNvbWUgY29uZmlndXJhdGlvbnMuXFxuJylcbiAgICAgICAgLy8gZW5kcmVnaW9uXG4gICAgICAgIC8vIHJlZ2lvbiBmb3J3YXJkIG5lc3RlZCByZXR1cm4gY29kZXNcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IFByb21pc2UuYWxsKHByb2Nlc3NQcm9taXNlcylcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdChlcnJvci5yZXR1cm5Db2RlKVxuICAgICAgICB9XG4gICAgICAgIC8vIGVuZHJlZ2lvblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGlmIChjb25maWd1cmF0aW9uLmRlYnVnKVxuICAgICAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcilcbiAgICB9XG59XG5pZiAocmVxdWlyZS5tYWluID09PSBtb2R1bGUpXG4gICAgbWFpbigpLmNhdGNoKChlcnJvcjpFcnJvcik6dm9pZCA9PiB7XG4gICAgICAgIHRocm93IGVycm9yXG4gICAgfSlcbmV4cG9ydCBkZWZhdWx0IG1haW5cbi8vIHJlZ2lvbiB2aW0gbW9kbGluZVxuLy8gdmltOiBzZXQgdGFic3RvcD00IHNoaWZ0d2lkdGg9NCBleHBhbmR0YWI6XG4vLyB2aW06IGZvbGRtZXRob2Q9bWFya2VyIGZvbGRtYXJrZXI9cmVnaW9uLGVuZHJlZ2lvbjpcbi8vIGVuZHJlZ2lvblxuIl19