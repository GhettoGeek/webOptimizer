#!/usr/bin/env node
'use strict';var _stringify=require('babel-runtime/core-js/json/stringify'),_stringify2=_interopRequireDefault(_stringify),_promise=require('babel-runtime/core-js/promise'),_promise2=_interopRequireDefault(_promise),_asyncToGenerator2=require('babel-runtime/helpers/asyncToGenerator'),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_child_process=require('child_process'),_clientnode=require('clientnode'),_clientnode2=_interopRequireDefault(_clientnode),_fs=require('fs'),fileSystem=_interopRequireWildcard(_fs),_path=require('path'),_path2=_interopRequireDefault(_path),_rimraf=require('rimraf'),_configurator=require('./configurator.compiled'),_configurator2=_interopRequireDefault(_configurator),_helper=require('./helper.compiled'),_helper2=_interopRequireDefault(_helper);Object.defineProperty(exports,'__esModule',{value:!0});function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}try{require('source-map-support/register')}catch(a){}const main=(()=>{var a=(0,_asyncToGenerator3.default)(function*(){try{const b={cwd:_configurator2.default.path.context,env:process.env,shell:!0,stdio:'inherit'},c=[],d=[],e=['build','buildDLL','clear','document','lint','preinstall','serve','test','testInBrowser','typeCheck'],f=[];if(2<_configurator2.default.givenCommandLineArguments.length){let i={givenCommandLineArguments:_configurator2.default.givenCommandLineArguments.slice()};3<_configurator2.default.givenCommandLineArguments.length&&_clientnode2.default.stringParseEncodedObject(_configurator2.default.givenCommandLineArguments[_configurator2.default.givenCommandLineArguments.length-1],_configurator2.default,'configuration')&&_configurator2.default.givenCommandLineArguments.pop();let j=0,k=`${_configurator2.default.path.context}.`+`dynamicConfiguration-${j}.json`;for(;k=`${_configurator2.default.path.context}.`+`dynamicConfiguration-${j}.json`,!!(yield _clientnode2.default.isFile(k));)j+=1;yield new _promise2.default(function(o,p){return fileSystem.writeFile(k,(0,_stringify2.default)(i),function(q){return q?p(q):o()})});const l=process.argv.splice(3);if(f.push((()=>{var o=(0,_asyncToGenerator3.default)(function*(p){try{yield new _promise2.default(function(q,r){return fileSystem.unlink(k,function(s){return s?r(s):q()})})}catch(q){}if(p)throw p});return function(){return o.apply(this,arguments)}})()),!['build','preinstall','serve','test','testInBrowser'].includes(_configurator2.default.givenCommandLineArguments[2])&&e.includes(_configurator2.default.givenCommandLineArguments[2])){if(_path2.default.resolve(_configurator2.default.path.target.base)===_path2.default.resolve(_configurator2.default.path.context)){yield _clientnode2.default.walkDirectoryRecursively(_configurator2.default.path.target.base,(()=>{var o=(0,_asyncToGenerator3.default)(function*(p){if(_helper2.default.isFilePathInLocation(p.path,_configurator2.default.path.ignore.concat(_configurator2.default.module.directoryNames,_configurator2.default.loader.directoryNames).map(function(q){return _path2.default.resolve(_configurator2.default.path.context,q)}).filter(function(q){return!_configurator2.default.path.context.startsWith(q)})))return!1;for(const q in _configurator2.default.build.types)if(new RegExp(_configurator2.default.build.types[q].filePathPattern).test(p.path)){if(p.stat.isDirectory())return yield new _promise2.default(function(r,s){return(0,_rimraf.sync)(p.path,{glob:!1},function(t){return t?s(t):r()})}),!1;yield new _promise2.default(function(r,s){return fileSystem.unlink(p.path,function(t){return t?s(t):r()})});break}});return function(){return o.apply(this,arguments)}})());for(const o of yield _clientnode2.default.walkDirectoryRecursively(_configurator2.default.path.target.base,function(){return!1},{encoding:_configurator2.default.encoding}))(o.length>'.dll-manifest.json'.length&&o.endsWith('.dll-manifest.json')||o.startsWith('npm-debug'))&&(yield new _promise2.default(function(p,q){return fileSystem.unlink(_path2.default.resolve(_configurator2.default.path.target.base,o),function(r){return r?q(r):p()})}))}else yield new _promise2.default(function(o,p){return(0,_rimraf.sync)(_configurator2.default.path.target.base,{glob:!1},function(q){return q?p(q):o()})});try{yield new _promise2.default(function(o,p){return(0,_rimraf.sync)(_configurator2.default.path.apiDocumentation,{glob:!1},function(q){return q?p(q):o()})})}catch(o){}}const m=_helper2.default.resolveBuildConfigurationFilePaths(_configurator2.default.build.types,_configurator2.default.path.source.asset.base,_configurator2.default.path.ignore.concat(_configurator2.default.module.directoryNames,_configurator2.default.loader.directoryNames).map(function(o){return _path2.default.resolve(_configurator2.default.path.context,o)}).filter(function(o){return!_configurator2.default.path.context.startsWith(o)}),_configurator2.default.package.main.fileNames);if(['build','buildDLL','document','test'].includes(process.argv[2])){let o=!1;const p=(()=>{var q=(0,_asyncToGenerator3.default)(function*(){if(!o){for(const r in o=!0,_configurator2.default.injection.internal.normalized)if(_configurator2.default.injection.internal.normalized.hasOwnProperty(r))for(const s of _configurator2.default.injection.internal.normalized[r]){const t=_helper2.default.determineModuleFilePath(s,_configurator2.default.module.aliases,_configurator2.default.module.replacements.normal,_configurator2.default.extensions,_configurator2.default.path.context,_configurator2.default.path.source.asset.base,_configurator2.default.path.ignore,_configurator2.default.module.directoryNames,_configurator2.default.package.main.fileNames,_configurator2.default.package.main.propertyNames,_configurator2.default.package.aliasPropertyNames,_configurator2.default.encoding);let u;if(t&&(u=_helper2.default.determineAssetType(t,_configurator2.default.build.types,_configurator2.default.path)),'string'==typeof u&&_configurator2.default.build.types[u]){const v=_helper2.default.renderFilePathTemplate(_helper2.default.stripLoader(_configurator2.default.files.compose.javaScript),{'[name]':r});'js'===_configurator2.default.build.types[u].outputExtension&&(yield _clientnode2.default.isFile(v))&&(yield new _promise2.default(function(w,x){return fileSystem.chmod(v,'755',function(y){return y?x(y):w()})}))}}for(const r of _configurator2.default.path.tidyUp)if(r)try{yield new _promise2.default(function(s,t){return fileSystem.unlink(r,function(u){return u?t(u):s()})})}catch(s){}}});return function tidyUp(){return q.apply(this,arguments)}})();f.push(p),d.push(new _promise2.default(function(q,r){const s=(_configurator2.default.commandLine.build.arguments||[]).concat(l);console.info('Running "'+(`${_configurator2.default.commandLine.build.command} `+s.join(' ')).trim()+'"');const t=(0,_child_process.spawn)(_configurator2.default.commandLine.build.command,s,b),u=(()=>{var w=(0,_asyncToGenerator3.default)(function*(){for(const x of _configurator2.default.files.additionalPaths){const y=_path2.default.join(_configurator2.default.path.source.base,x),z=_path2.default.join(_configurator2.default.path.target.base,x);(yield _clientnode2.default.isDirectory(y))?((yield _clientnode2.default.isDirectory(z))&&(yield new _promise2.default(function(A,B){return(0,_rimraf.sync)(z,{glob:!1},function(C){return C?B(C):A()})})),yield _clientnode2.default.copyDirectoryRecursive(y,z)):(yield _clientnode2.default.isFile(y))&&(yield _clientnode2.default.copyFile(y,z))}p()});return function copyAdditionalFilesAndTidyUp(){return w.apply(this,arguments)}})(),v=_clientnode2.default.getProcessCloseHandler(q,r,null,'build'===process.argv[2]?u:p);for(const w of _clientnode2.default.closeEventNames)t.on(w,v);c.push(t)}))}else if(_configurator2.default.library&&'preinstall'===_configurator2.default.givenCommandLineArguments[2]){const o=_helper2.default.determineModuleLocations(_configurator2.default.testInBrowser.injection.internal,_configurator2.default.module.aliases,_configurator2.default.module.replacements.normal,_configurator2.default.extensions,_configurator2.default.path.context,_configurator2.default.path.source.asset.base,_configurator2.default.path.ignore).filePaths;for(const p of m)for(const q of p.filePaths)if(!o.includes(q)){const s=function(t,u,v,w,x,y){return new Function('global','self','buildConfiguration','path','additionalArguments','filePath','return `'+v[_configurator2.default.givenCommandLineArguments[2]].trim()+'`')(t,u,v,w,x,y)}(global,_configurator2.default,p,_path2.default,l,q);console.info(`Running "${s}"`),d.push(new _promise2.default(function(t,u){return _clientnode2.default.handleChildProcess((0,_child_process.exec)(s,b,function(v){return v?u(v):t()}))}))}}const n=function(o){let p=Array.isArray(_configurator2.default.commandLine[o])?_configurator2.default.commandLine[o]:[_configurator2.default.commandLine[o]];for(const q of p){(function(s,t,u){return new Function('global','self','path','return '+(q.hasOwnProperty('indicator')?q.indicator:'true'))(s,t,u)})(global,_configurator2.default,_path2.default)&&d.push(new _promise2.default(function(s,t){const u=(q.arguments||[]).concat(l);console.info('Running "'+(`${q.command} `+u.join(' ')).trim()+'"');const v=(0,_child_process.spawn)(q.command,u,b),w=_clientnode2.default.getProcessCloseHandler(s,t);for(const x of _clientnode2.default.closeEventNames)v.on(x,w);c.push(v)}))}};['document','test'].includes(_configurator2.default.givenCommandLineArguments[2])?(yield _promise2.default.all(d),n(_configurator2.default.givenCommandLineArguments[2])):['lint','testInBrowser','typeCheck','serve'].includes(_configurator2.default.givenCommandLineArguments[2])&&n(_configurator2.default.givenCommandLineArguments[2])}let g=!1;const h=function(...i){if(!g)for(const j of f)j(...i);g=!0};for(const i of _clientnode2.default.closeEventNames)process.on(i,h);require.main===module&&(3>_configurator2.default.givenCommandLineArguments.length||!e.includes(_configurator2.default.givenCommandLineArguments[2]))&&console.info(`Give one of "${e.join('", "')}" as command `+'line argument. You can provide a json string as second parameter to dynamically overwrite some configurations.\n');try{yield _promise2.default.all(d)}catch(i){process.exit(i.returnCode)}}catch(b){if(_configurator2.default.debug)throw b;else console.error(b)}});return function(){return a.apply(this,arguments)}})();require.main===module&&main().catch((a)=>{throw a}),exports.default=main;

//# sourceMappingURL=data:application/json;charset=utf-8;base64,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b3dcbi8vIC0qLSBjb2Rpbmc6IHV0Zi04IC0qLVxuJ3VzZSBzdHJpY3QnXG4vKiAhXG4gICAgcmVnaW9uIGhlYWRlclxuICAgIENvcHlyaWdodCBUb3JiZW4gU2lja2VydCAoaW5mb1tcIn5hdH5cIl10b3JiZW4ud2Vic2l0ZSkgMTYuMTIuMjAxMlxuXG4gICAgTGljZW5zZVxuICAgIC0tLS0tLS1cblxuICAgIFRoaXMgbGlicmFyeSB3cml0dGVuIGJ5IFRvcmJlbiBTaWNrZXJ0IHN0YW5kIHVuZGVyIGEgY3JlYXRpdmUgY29tbW9ucyBuYW1pbmdcbiAgICAzLjAgdW5wb3J0ZWQgbGljZW5zZS4gc2VlIGh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LzMuMC9kZWVkLmRlXG4gICAgZW5kcmVnaW9uXG4qL1xuLy8gcmVnaW9uIGltcG9ydHNcbmltcG9ydCB7XG4gICAgQ2hpbGRQcm9jZXNzLCBleGVjIGFzIGV4ZWNDaGlsZFByb2Nlc3MsIHNwYXduIGFzIHNwYXduQ2hpbGRQcm9jZXNzXG59IGZyb20gJ2NoaWxkX3Byb2Nlc3MnXG5pbXBvcnQgVG9vbHMgZnJvbSAnY2xpZW50bm9kZSdcbmltcG9ydCB0eXBlIHtGaWxlLCBQbGFpbk9iamVjdH0gZnJvbSAnY2xpZW50bm9kZSdcbmltcG9ydCAqIGFzIGZpbGVTeXN0ZW0gZnJvbSAnZnMnXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJ1xuaW1wb3J0IHtzeW5jIGFzIHJlbW92ZURpcmVjdG9yeVJlY3Vyc2l2ZWx5fSBmcm9tICdyaW1yYWYnXG4vLyBOT1RFOiBPbmx5IG5lZWRlZCBmb3IgZGVidWdnaW5nIHRoaXMgZmlsZS5cbnRyeSB7XG4gICAgcmVxdWlyZSgnc291cmNlLW1hcC1zdXBwb3J0L3JlZ2lzdGVyJylcbn0gY2F0Y2ggKGVycm9yKSB7fVxuXG5pbXBvcnQgY29uZmlndXJhdGlvbiBmcm9tICcuL2NvbmZpZ3VyYXRvci5jb21waWxlZCdcbmltcG9ydCBIZWxwZXIgZnJvbSAnLi9oZWxwZXIuY29tcGlsZWQnXG5pbXBvcnQgdHlwZSB7UmVzb2x2ZWRCdWlsZENvbmZpZ3VyYXRpb259IGZyb20gJy4vdHlwZSdcbi8vIGVuZHJlZ2lvblxuY29uc3QgbWFpbiA9IGFzeW5jICgpOlByb21pc2U8YW55PiA9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgLy8gcmVnaW9uIGNvbnRyb2xsZXJcbiAgICAgICAgY29uc3QgY2hpbGRQcm9jZXNzT3B0aW9uczpPYmplY3QgPSB7XG4gICAgICAgICAgICBjd2Q6IGNvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0LFxuICAgICAgICAgICAgZW52OiBwcm9jZXNzLmVudixcbiAgICAgICAgICAgIHNoZWxsOiB0cnVlLFxuICAgICAgICAgICAgc3RkaW86ICdpbmhlcml0J1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNoaWxkUHJvY2Vzc2VzOkFycmF5PENoaWxkUHJvY2Vzcz4gPSBbXVxuICAgICAgICBjb25zdCBwcm9jZXNzUHJvbWlzZXM6QXJyYXk8UHJvbWlzZTxhbnk+PiA9IFtdXG4gICAgICAgIGNvbnN0IHBvc3NpYmxlQXJndW1lbnRzOkFycmF5PHN0cmluZz4gPSBbXG4gICAgICAgICAgICAnYnVpbGQnLCAnYnVpbGRETEwnLCAnY2xlYXInLCAnZG9jdW1lbnQnLCAnbGludCcsICdwcmVpbnN0YWxsJyxcbiAgICAgICAgICAgICdzZXJ2ZScsICd0ZXN0JywgJ3Rlc3RJbkJyb3dzZXInLCAndHlwZUNoZWNrJ11cbiAgICAgICAgY29uc3QgY2xvc2VFdmVudEhhbmRsZXJzOkFycmF5PEZ1bmN0aW9uPiA9IFtdXG4gICAgICAgIGlmIChjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHMubGVuZ3RoID4gMikge1xuICAgICAgICAgICAgLy8gcmVnaW9uIHRlbXBvcmFyeSBzYXZlIGR5bmFtaWNhbGx5IGdpdmVuIGNvbmZpZ3VyYXRpb25zXG4gICAgICAgICAgICAvLyBOT1RFOiBXZSBuZWVkIGEgY29weSBvZiBnaXZlbiBhcmd1bWVudHMgYXJyYXkuXG4gICAgICAgICAgICBsZXQgZHluYW1pY0NvbmZpZ3VyYXRpb246UGxhaW5PYmplY3QgPSB7Z2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50czpcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHMuc2xpY2UoKX1cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHMubGVuZ3RoID4gMyAmJlxuICAgICAgICAgICAgICAgIFRvb2xzLnN0cmluZ1BhcnNlRW5jb2RlZE9iamVjdChcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzW1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzLmxlbmd0aCAtIDFdLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLCAnY29uZmlndXJhdGlvbicpXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzLnBvcCgpXG4gICAgICAgICAgICBsZXQgY291bnQ6bnVtYmVyID0gMFxuICAgICAgICAgICAgbGV0IGZpbGVQYXRoOnN0cmluZyA9IGAke2NvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0fS5gICtcbiAgICAgICAgICAgICAgICBgZHluYW1pY0NvbmZpZ3VyYXRpb24tJHtjb3VudH0uanNvbmBcbiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICAgICAgZmlsZVBhdGggPSBgJHtjb25maWd1cmF0aW9uLnBhdGguY29udGV4dH0uYCArXG4gICAgICAgICAgICAgICAgICAgIGBkeW5hbWljQ29uZmlndXJhdGlvbi0ke2NvdW50fS5qc29uYFxuICAgICAgICAgICAgICAgIGlmICghKGF3YWl0IFRvb2xzLmlzRmlsZShmaWxlUGF0aCkpKVxuICAgICAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgICAgIGNvdW50ICs9IDFcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlOkZ1bmN0aW9uLCByZWplY3Q6RnVuY3Rpb24pOnZvaWQgPT5cbiAgICAgICAgICAgICAgICBmaWxlU3lzdGVtLndyaXRlRmlsZShmaWxlUGF0aCwgSlNPTi5zdHJpbmdpZnkoXG4gICAgICAgICAgICAgICAgICAgIGR5bmFtaWNDb25maWd1cmF0aW9uXG4gICAgICAgICAgICAgICAgKSwgKGVycm9yOj9FcnJvcik6dm9pZCA9PiBlcnJvciA/IHJlamVjdChlcnJvcikgOiByZXNvbHZlKCkpKVxuICAgICAgICAgICAgY29uc3QgYWRkaXRpb25hbEFyZ3VtZW50czpBcnJheTxzdHJpbmc+ID0gcHJvY2Vzcy5hcmd2LnNwbGljZSgzKVxuICAgICAgICAgICAgLy8gLyByZWdpb24gcmVnaXN0ZXIgZXhpdCBoYW5kbGVyIHRvIHRpZHkgdXBcbiAgICAgICAgICAgIGNsb3NlRXZlbnRIYW5kbGVycy5wdXNoKGFzeW5jIChlcnJvcjo/RXJyb3IpOlByb21pc2U8dm9pZD4gPT4ge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6RnVuY3Rpb24sIHJlamVjdDpGdW5jdGlvblxuICAgICAgICAgICAgICAgICAgICApOnZvaWQgPT4gZmlsZVN5c3RlbS51bmxpbmsoZmlsZVBhdGgsIChcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOj9FcnJvclxuICAgICAgICAgICAgICAgICAgICApOnZvaWQgPT4gZXJyb3IgPyByZWplY3QoZXJyb3IpIDogcmVzb2x2ZSgpKSlcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge31cbiAgICAgICAgICAgICAgICBpZiAoZXJyb3IpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IGVycm9yXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy8gLyBlbmRyZWdpb25cbiAgICAgICAgICAgIC8vIGVuZHJlZ2lvblxuICAgICAgICAgICAgLy8gcmVnaW9uIGhhbmRsZSBjbGVhclxuICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICBOT1RFOiBTb21lIHRhc2tzIGNvdWxkIGRlcGVuZCBvbiBwcmV2aW91c2x5IGNyZWF0ZWQgZGxsXG4gICAgICAgICAgICAgICAgcGFja2FnZXMgc28gYSBjbGVhbiBzaG91bGQgbm90IGJlIHBlcmZvcm1lZCBpbiB0aGF0IGNhc2UuXG4gICAgICAgICAgICAgICAgTk9URTogSWYgd2UgaGF2ZSBhIGRlcGVuZGVuY3kgY3ljbGUgd2UgbmVlZCB0byBwcmVzZXJ2ZSBmaWxlc1xuICAgICAgICAgICAgICAgIGR1cmluZyBwcmVpbnN0YWxsIHBoYXNlLlxuICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGlmICghW1xuICAgICAgICAgICAgICAgICdidWlsZCcsICdwcmVpbnN0YWxsJywgJ3NlcnZlJywgJ3Rlc3QnLCAndGVzdEluQnJvd3NlcidcbiAgICAgICAgICAgIF0uaW5jbHVkZXMoY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzWzJdKSAmJlxuICAgICAgICAgICAgcG9zc2libGVBcmd1bWVudHMuaW5jbHVkZXMoXG4gICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzWzJdXG4gICAgICAgICAgICApKSB7XG4gICAgICAgICAgICAgICAgaWYgKHBhdGgucmVzb2x2ZShcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLnRhcmdldC5iYXNlXG4gICAgICAgICAgICAgICAgKSA9PT0gcGF0aC5yZXNvbHZlKGNvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0KSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmVzIGFsbCBjb21waWxlZCBmaWxlcy5cbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgVG9vbHMud2Fsa0RpcmVjdG9yeVJlY3Vyc2l2ZWx5KFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLnRhcmdldC5iYXNlLCBhc3luYyAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZTpGaWxlXG4gICAgICAgICAgICAgICAgICAgICAgICApOlByb21pc2U8P2ZhbHNlPiA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEhlbHBlci5pc0ZpbGVQYXRoSW5Mb2NhdGlvbihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5wYXRoLCBjb25maWd1cmF0aW9uLnBhdGguaWdub3JlLmNvbmNhdChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ubW9kdWxlLmRpcmVjdG9yeU5hbWVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5sb2FkZXIuZGlyZWN0b3J5TmFtZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKS5tYXAoKGZpbGVQYXRoOnN0cmluZyk6c3RyaW5nID0+IHBhdGgucmVzb2x2ZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0LCBmaWxlUGF0aClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKS5maWx0ZXIoKGZpbGVQYXRoOnN0cmluZyk6Ym9vbGVhbiA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIWNvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0LnN0YXJ0c1dpdGgoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVBhdGgpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHR5cGU6c3RyaW5nIGluIGNvbmZpZ3VyYXRpb24uYnVpbGQudHlwZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXcgUmVnRXhwKGNvbmZpZ3VyYXRpb24uYnVpbGQudHlwZXNbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0uZmlsZVBhdGhQYXR0ZXJuKS50ZXN0KGZpbGUucGF0aCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWxlLnN0YXQuaXNEaXJlY3RvcnkoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZTpGdW5jdGlvbiwgcmVqZWN0OkZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTp2b2lkID0+IHJlbW92ZURpcmVjdG9yeVJlY3Vyc2l2ZWx5KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLnBhdGgsIHtnbG9iOiBmYWxzZX0sIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOj9FcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOnZvaWQgPT4gZXJyb3IgPyByZWplY3QoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApIDogcmVzb2x2ZSgpKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlOkZ1bmN0aW9uLCByZWplY3Q6RnVuY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk6dm9pZCA9PiBmaWxlU3lzdGVtLnVubGluayhmaWxlLnBhdGgsIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjo/RXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk6dm9pZCA9PiBlcnJvciA/IHJlamVjdChlcnJvcikgOiByZXNvbHZlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICBmb3IgKFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZU5hbWU6c3RyaW5nIG9mIGF3YWl0XG4gICAgICAgICAgICAgICAgICAgICAgICBUb29scy53YWxrRGlyZWN0b3J5UmVjdXJzaXZlbHkoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLnRhcmdldC5iYXNlLCAoKTpmYWxzZSA9PiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7ZW5jb2Rpbmc6IGNvbmZpZ3VyYXRpb24uZW5jb2Rpbmd9KVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZU5hbWUubGVuZ3RoID4gJy5kbGwtbWFuaWZlc3QuanNvbicubGVuZ3RoICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZU5hbWUuZW5kc1dpdGgoJy5kbGwtbWFuaWZlc3QuanNvbicpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZU5hbWUuc3RhcnRzV2l0aCgnbnBtLWRlYnVnJylcbiAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6RnVuY3Rpb24sIHJlamVjdDpGdW5jdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk6dm9pZCA9PiBmaWxlU3lzdGVtLnVubGluayhwYXRoLnJlc29sdmUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC50YXJnZXQuYmFzZSwgZmlsZU5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApLCAoZXJyb3I6P0Vycm9yKTp2b2lkID0+IGVycm9yID8gcmVqZWN0KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICkgOiByZXNvbHZlKCkpKVxuICAgICAgICAgICAgICAgIH0gZWxzZVxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgoXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlOkZ1bmN0aW9uLCByZWplY3Q6RnVuY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgKTp2b2lkID0+IHJlbW92ZURpcmVjdG9yeVJlY3Vyc2l2ZWx5KFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLnRhcmdldC5iYXNlLCB7Z2xvYjogZmFsc2V9LCAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6P0Vycm9yXG4gICAgICAgICAgICAgICAgICAgICAgICApOnZvaWQgPT4gZXJyb3IgPyByZWplY3QoZXJyb3IpIDogcmVzb2x2ZSgpKSlcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgoXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlOkZ1bmN0aW9uLCByZWplY3Q6RnVuY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgKTp2b2lkID0+IHJlbW92ZURpcmVjdG9yeVJlY3Vyc2l2ZWx5KFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLmFwaURvY3VtZW50YXRpb24sIHtnbG9iOiBmYWxzZX0sIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjo/RXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICk6dm9pZCA9PiBlcnJvciA/IHJlamVjdChlcnJvcikgOiByZXNvbHZlKCkpKVxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7fVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gZW5kcmVnaW9uXG4gICAgICAgICAgICAvLyByZWdpb24gaGFuZGxlIGJ1aWxkXG4gICAgICAgICAgICBjb25zdCBidWlsZENvbmZpZ3VyYXRpb25zOlJlc29sdmVkQnVpbGRDb25maWd1cmF0aW9uID1cbiAgICAgICAgICAgICAgICBIZWxwZXIucmVzb2x2ZUJ1aWxkQ29uZmlndXJhdGlvbkZpbGVQYXRocyhcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5idWlsZC50eXBlcyxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLnNvdXJjZS5hc3NldC5iYXNlLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguaWdub3JlLmNvbmNhdChcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ubW9kdWxlLmRpcmVjdG9yeU5hbWVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5sb2FkZXIuZGlyZWN0b3J5TmFtZXNcbiAgICAgICAgICAgICAgICAgICAgKS5tYXAoKGZpbGVQYXRoOnN0cmluZyk6c3RyaW5nID0+IHBhdGgucmVzb2x2ZShcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0LCBmaWxlUGF0aClcbiAgICAgICAgICAgICAgICAgICAgKS5maWx0ZXIoKGZpbGVQYXRoOnN0cmluZyk6Ym9vbGVhbiA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgIWNvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0LnN0YXJ0c1dpdGgoZmlsZVBhdGgpKSxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYWNrYWdlLm1haW4uZmlsZU5hbWVzKVxuICAgICAgICAgICAgaWYgKFsnYnVpbGQnLCAnYnVpbGRETEwnLCAnZG9jdW1lbnQnLCAndGVzdCddLmluY2x1ZGVzKFxuICAgICAgICAgICAgICAgIHByb2Nlc3MuYXJndlsyXVxuICAgICAgICAgICAgKSkge1xuICAgICAgICAgICAgICAgIGxldCB0aWRpZWRVcDpib29sZWFuID0gZmFsc2VcbiAgICAgICAgICAgICAgICBjb25zdCB0aWR5VXA6RnVuY3Rpb24gPSBhc3luYyAoKTpQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgICAgICAgIERldGVybWluZXMgYWxsIG5vbmUgamF2YVNjcmlwdCBlbnRpdGllcyB3aGljaCBoYXZlIGJlZW5cbiAgICAgICAgICAgICAgICAgICAgICAgIGVtaXR0ZWQgYXMgc2luZ2xlIGphdmFTY3JpcHQgbW9kdWxlIHRvIHJlbW92ZS5cbiAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRpZGllZFVwKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAgICAgICAgIHRpZGllZFVwID0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICBmb3IgKFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2h1bmtOYW1lOnN0cmluZyBpblxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5pbmplY3Rpb24uaW50ZXJuYWwubm9ybWFsaXplZFxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5pbmplY3Rpb24uaW50ZXJuYWwubm9ybWFsaXplZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuaGFzT3duUHJvcGVydHkoY2h1bmtOYW1lKVxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1vZHVsZUlEOnN0cmluZyBvZiBjb25maWd1cmF0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuaW5qZWN0aW9uLmludGVybmFsLm5vcm1hbGl6ZWRbY2h1bmtOYW1lXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlUGF0aDo/c3RyaW5nID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhlbHBlci5kZXRlcm1pbmVNb2R1bGVGaWxlUGF0aChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGVJRCwgY29uZmlndXJhdGlvbi5tb2R1bGUuYWxpYXNlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLm1vZHVsZS5yZXBsYWNlbWVudHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm5vcm1hbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmV4dGVuc2lvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLnNvdXJjZS5hc3NldC5iYXNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC5pZ25vcmUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5tb2R1bGUuZGlyZWN0b3J5TmFtZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYWNrYWdlLm1haW4uZmlsZU5hbWVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGFja2FnZS5tYWluXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5wcm9wZXJ0eU5hbWVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGFja2FnZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWxpYXNQcm9wZXJ0eU5hbWVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZW5jb2RpbmcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0eXBlOj9zdHJpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVQYXRoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9IEhlbHBlci5kZXRlcm1pbmVBc3NldFR5cGUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVBhdGgsIGNvbmZpZ3VyYXRpb24uYnVpbGQudHlwZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlb2YgdHlwZSA9PT0gJ3N0cmluZycgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uYnVpbGQudHlwZXNbdHlwZV1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlUGF0aDpzdHJpbmcgPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhlbHBlci5yZW5kZXJGaWxlUGF0aFRlbXBsYXRlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWxwZXIuc3RyaXBMb2FkZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmZpbGVzLmNvbXBvc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuamF2YVNjcmlwdFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLCB7J1tuYW1lXSc6IGNodW5rTmFtZX0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlndXJhdGlvbi5idWlsZC50eXBlc1tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLm91dHB1dEV4dGVuc2lvbiA9PT0gJ2pzJyAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgVG9vbHMuaXNGaWxlKGZpbGVQYXRoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6RnVuY3Rpb24sIHJlamVjdDpGdW5jdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk6dm9pZCA9PiBmaWxlU3lzdGVtLmNobW9kKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlUGF0aCwgJzc1NScsIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOj9FcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOnZvaWQgPT4gZXJyb3IgPyByZWplY3QoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApIDogcmVzb2x2ZSgpKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBmaWxlUGF0aDo/c3RyaW5nIG9mIGNvbmZpZ3VyYXRpb24ucGF0aC50aWR5VXApXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZTpGdW5jdGlvbiwgcmVqZWN0OkZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk6dm9pZCA9PiBmaWxlU3lzdGVtLnVubGluayhmaWxlUGF0aCwgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6P0Vycm9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk6dm9pZCA9PiBlcnJvciA/IHJlamVjdChlcnJvcikgOiByZXNvbHZlKCkpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7fVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjbG9zZUV2ZW50SGFuZGxlcnMucHVzaCh0aWR5VXApXG4gICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgICAgVHJpZ2dlcnMgY29tcGxldGUgYXNzZXQgY29tcGlsaW5nIGFuZCBidW5kbGVzIHRoZW0gaW50byB0aGVcbiAgICAgICAgICAgICAgICAgICAgZmluYWwgcHJvZHVjdGl2ZSBvdXRwdXQuXG4gICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBwcm9jZXNzUHJvbWlzZXMucHVzaChuZXcgUHJvbWlzZSgoXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6RnVuY3Rpb24sIHJlamVjdDpGdW5jdGlvblxuICAgICAgICAgICAgICAgICk6dm9pZCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbW1hbmRMaW5lQXJndW1lbnRzOkFycmF5PHN0cmluZz4gPSAoXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmNvbW1hbmRMaW5lLmJ1aWxkLmFyZ3VtZW50cyB8fCBbXVxuICAgICAgICAgICAgICAgICAgICApLmNvbmNhdChhZGRpdGlvbmFsQXJndW1lbnRzKVxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oJ1J1bm5pbmcgXCInICsgKFxuICAgICAgICAgICAgICAgICAgICAgICAgYCR7Y29uZmlndXJhdGlvbi5jb21tYW5kTGluZS5idWlsZC5jb21tYW5kfSBgICtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRMaW5lQXJndW1lbnRzLmpvaW4oJyAnKVxuICAgICAgICAgICAgICAgICAgICApLnRyaW0oKSArICdcIicpXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkUHJvY2VzczpDaGlsZFByb2Nlc3MgPSBzcGF3bkNoaWxkUHJvY2VzcyhcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uY29tbWFuZExpbmUuYnVpbGQuY29tbWFuZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRMaW5lQXJndW1lbnRzLCBjaGlsZFByb2Nlc3NPcHRpb25zKVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3B5QWRkaXRpb25hbEZpbGVzQW5kVGlkeVVwOkZ1bmN0aW9uID0gYXN5bmMgKFxuICAgICAgICAgICAgICAgICAgICApOlByb21pc2U8dm9pZD4gPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlUGF0aDpzdHJpbmcgb2ZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmZpbGVzLmFkZGl0aW9uYWxQYXRoc1xuICAgICAgICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc291cmNlUGF0aDpzdHJpbmcgPSBwYXRoLmpvaW4oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC5zb3VyY2UuYmFzZSwgZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0UGF0aDpzdHJpbmcgPSBwYXRoLmpvaW4oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC50YXJnZXQuYmFzZSwgZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF3YWl0IFRvb2xzLmlzRGlyZWN0b3J5KHNvdXJjZVBhdGgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhd2FpdCBUb29scy5pc0RpcmVjdG9yeSh0YXJnZXRQYXRoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlOkZ1bmN0aW9uLCByZWplY3Q6RnVuY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk6dm9pZCA9PiByZW1vdmVEaXJlY3RvcnlSZWN1cnNpdmVseShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRQYXRoLCB7Z2xvYjogZmFsc2V9LCAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOj9FcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk6dm9pZCA9PiBlcnJvciA/IHJlamVjdChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApIDogcmVzb2x2ZSgpKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgVG9vbHMuY29weURpcmVjdG9yeVJlY3Vyc2l2ZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZVBhdGgsIHRhcmdldFBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhd2FpdCBUb29scy5pc0ZpbGUoc291cmNlUGF0aCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IFRvb2xzLmNvcHlGaWxlKHNvdXJjZVBhdGgsIHRhcmdldFBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aWR5VXAoKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsb3NlSGFuZGxlcjpGdW5jdGlvbiA9IFRvb2xzLmdldFByb2Nlc3NDbG9zZUhhbmRsZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlLCByZWplY3QsIG51bGwsIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLmFyZ3ZbMl0gPT09ICdidWlsZCdcbiAgICAgICAgICAgICAgICAgICAgICAgICkgPyBjb3B5QWRkaXRpb25hbEZpbGVzQW5kVGlkeVVwIDogdGlkeVVwKVxuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGNsb3NlRXZlbnROYW1lOnN0cmluZyBvZiBUb29scy5jbG9zZUV2ZW50TmFtZXMpXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZFByb2Nlc3Mub24oY2xvc2VFdmVudE5hbWUsIGNsb3NlSGFuZGxlcilcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRQcm9jZXNzZXMucHVzaChjaGlsZFByb2Nlc3MpXG4gICAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAvLyBlbmRyZWdpb25cbiAgICAgICAgICAgIC8vIHJlZ2lvbiBoYW5kbGUgcHJlaW5zdGFsbFxuICAgICAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmxpYnJhcnkgJiZcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHNbMl0gPT09ICdwcmVpbnN0YWxsJ1xuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgLy8gUGVyZm9ybSBhbGwgZmlsZSBzcGVjaWZpYyBwcmVwcm9jZXNzaW5nIHN0dWZmLlxuICAgICAgICAgICAgICAgIGNvbnN0IHRlc3RNb2R1bGVGaWxlUGF0aHM6QXJyYXk8c3RyaW5nPiA9XG4gICAgICAgICAgICAgICAgICAgIEhlbHBlci5kZXRlcm1pbmVNb2R1bGVMb2NhdGlvbnMoXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnRlc3RJbkJyb3dzZXIuaW5qZWN0aW9uLmludGVybmFsLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5tb2R1bGUuYWxpYXNlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ubW9kdWxlLnJlcGxhY2VtZW50cy5ub3JtYWwsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmV4dGVuc2lvbnMsIGNvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0LFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLnNvdXJjZS5hc3NldC5iYXNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLmlnbm9yZVxuICAgICAgICAgICAgICAgICAgICApLmZpbGVQYXRoc1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgYnVpbGRDb25maWd1cmF0aW9uIG9mIGJ1aWxkQ29uZmlndXJhdGlvbnMpXG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZmlsZVBhdGg6c3RyaW5nIG9mIGJ1aWxkQ29uZmlndXJhdGlvbi5maWxlUGF0aHMpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRlc3RNb2R1bGVGaWxlUGF0aHMuaW5jbHVkZXMoZmlsZVBhdGgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZXZhbHVhdGlvbkZ1bmN0aW9uID0gKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWw6T2JqZWN0LCBzZWxmOlBsYWluT2JqZWN0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidWlsZENvbmZpZ3VyYXRpb246UGxhaW5PYmplY3QsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6dHlwZW9mIHBhdGgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZGl0aW9uYWxBcmd1bWVudHM6QXJyYXk8c3RyaW5nPixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVBhdGg6c3RyaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTpzdHJpbmcgPT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JlVHlwZUNoZWNrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBGdW5jdGlvbihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdnbG9iYWwnLCAnc2VsZicsICdidWlsZENvbmZpZ3VyYXRpb24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BhdGgnLCAnYWRkaXRpb25hbEFyZ3VtZW50cycsICdmaWxlUGF0aCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmV0dXJuIGAnICsgYnVpbGRDb25maWd1cmF0aW9uW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHNbMl1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0udHJpbSgpICsgJ2AnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWwsIHNlbGYsIGJ1aWxkQ29uZmlndXJhdGlvbiwgcGF0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZGl0aW9uYWxBcmd1bWVudHMsIGZpbGVQYXRoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbW1hbmQ6c3RyaW5nID0gZXZhbHVhdGlvbkZ1bmN0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWwsIGNvbmZpZ3VyYXRpb24sIGJ1aWxkQ29uZmlndXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCwgYWRkaXRpb25hbEFyZ3VtZW50cywgZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKGBSdW5uaW5nIFwiJHtjb21tYW5kfVwiYClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzUHJvbWlzZXMucHVzaChuZXcgUHJvbWlzZSgoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6RnVuY3Rpb24sIHJlamVjdDpGdW5jdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk6dm9pZCA9PiBUb29scy5oYW5kbGVDaGlsZFByb2Nlc3MoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4ZWNDaGlsZFByb2Nlc3MoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kLCBjaGlsZFByb2Nlc3NPcHRpb25zLCAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6P0Vycm9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOnZvaWQgPT4gZXJyb3IgPyByZWplY3QoZXJyb3IpIDogcmVzb2x2ZSgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkpKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGVuZHJlZ2lvblxuICAgICAgICAgICAgLy8gcmVnaW9uIGhhbmRsZSByZW1haW5pbmcgdGFza3NcbiAgICAgICAgICAgIGNvbnN0IGhhbmRsZVRhc2sgPSAodHlwZTpzdHJpbmcpOnZvaWQgPT4ge1xuICAgICAgICAgICAgICAgIGxldCB0YXNrczpBcnJheTxPYmplY3Q+XG4gICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY29uZmlndXJhdGlvbi5jb21tYW5kTGluZVt0eXBlXSkpXG4gICAgICAgICAgICAgICAgICAgIHRhc2tzID0gY29uZmlndXJhdGlvbi5jb21tYW5kTGluZVt0eXBlXVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgdGFza3MgPSBbY29uZmlndXJhdGlvbi5jb21tYW5kTGluZVt0eXBlXV1cbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHRhc2s6T2JqZWN0IG9mIHRhc2tzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV2YWx1YXRpb25GdW5jdGlvbiA9IChcbiAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbDpPYmplY3QsIHNlbGY6UGxhaW5PYmplY3QsIHBhdGg6dHlwZW9mIHBhdGhcbiAgICAgICAgICAgICAgICAgICAgKTpib29sZWFuID0+XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmVUeXBlQ2hlY2tcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBGdW5jdGlvbihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZ2xvYmFsJywgJ3NlbGYnLCAncGF0aCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JldHVybiAnICsgKHRhc2suaGFzT3duUHJvcGVydHkoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpbmRpY2F0b3InXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKSA/IHRhc2suaW5kaWNhdG9yIDogJ3RydWUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgKShnbG9iYWwsIHNlbGYsIHBhdGgpXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmFsdWF0aW9uRnVuY3Rpb24oZ2xvYmFsLCBjb25maWd1cmF0aW9uLCBwYXRoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NQcm9taXNlcy5wdXNoKG5ldyBQcm9taXNlKChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlOkZ1bmN0aW9uLCByZWplY3Q6RnVuY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICk6dm9pZCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tbWFuZExpbmVBcmd1bWVudHM6QXJyYXk8c3RyaW5nPiA9IChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay5hcmd1bWVudHMgfHwgW11cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApLmNvbmNhdChhZGRpdGlvbmFsQXJndW1lbnRzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbygnUnVubmluZyBcIicgKyAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAke3Rhc2suY29tbWFuZH0gYCArIGNvbW1hbmRMaW5lQXJndW1lbnRzLmpvaW4oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKS50cmltKCkgKyAnXCInKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkUHJvY2VzczpDaGlsZFByb2Nlc3MgPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGF3bkNoaWxkUHJvY2VzcyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2suY29tbWFuZCwgY29tbWFuZExpbmVBcmd1bWVudHMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZFByb2Nlc3NPcHRpb25zKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsb3NlSGFuZGxlcjpGdW5jdGlvbiA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRvb2xzLmdldFByb2Nlc3NDbG9zZUhhbmRsZXIocmVzb2x2ZSwgcmVqZWN0KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsb3NlRXZlbnROYW1lOnN0cmluZyBvZlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUb29scy5jbG9zZUV2ZW50TmFtZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkUHJvY2Vzcy5vbihjbG9zZUV2ZW50TmFtZSwgY2xvc2VIYW5kbGVyKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkUHJvY2Vzc2VzLnB1c2goY2hpbGRQcm9jZXNzKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gLyByZWdpb24gYS0vc3luY2hyb25vdXNcbiAgICAgICAgICAgIGlmIChbJ2RvY3VtZW50JywgJ3Rlc3QnXS5pbmNsdWRlcyhcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHNbMl1cbiAgICAgICAgICAgICkpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9jZXNzUHJvbWlzZXMpXG4gICAgICAgICAgICAgICAgaGFuZGxlVGFzayhjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHNbMl0pXG4gICAgICAgICAgICB9IGVsc2UgaWYgKFsnbGludCcsICd0ZXN0SW5Ccm93c2VyJywgJ3R5cGVDaGVjaycsICdzZXJ2ZSddLmluY2x1ZGVzKFxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXVxuICAgICAgICAgICAgKSlcbiAgICAgICAgICAgICAgICBoYW5kbGVUYXNrKGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXSlcbiAgICAgICAgICAgIC8vIC8gZW5kcmVnaW9uXG4gICAgICAgICAgICAvLyBlbmRyZWdpb25cbiAgICAgICAgfVxuICAgICAgICBsZXQgZmluaXNoZWQ6Ym9vbGVhbiA9IGZhbHNlXG4gICAgICAgIGNvbnN0IGNsb3NlSGFuZGxlciA9ICguLi5wYXJhbWV0ZXI6QXJyYXk8YW55Pik6dm9pZCA9PiB7XG4gICAgICAgICAgICBpZiAoIWZpbmlzaGVkKVxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgY2xvc2VFdmVudEhhbmRsZXI6RnVuY3Rpb24gb2YgY2xvc2VFdmVudEhhbmRsZXJzKVxuICAgICAgICAgICAgICAgICAgICBjbG9zZUV2ZW50SGFuZGxlciguLi5wYXJhbWV0ZXIpXG4gICAgICAgICAgICBmaW5pc2hlZCA9IHRydWVcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IGNsb3NlRXZlbnROYW1lOnN0cmluZyBvZiBUb29scy5jbG9zZUV2ZW50TmFtZXMpXG4gICAgICAgICAgICBwcm9jZXNzLm9uKGNsb3NlRXZlbnROYW1lLCBjbG9zZUhhbmRsZXIpXG4gICAgICAgIGlmIChyZXF1aXJlLm1haW4gPT09IG1vZHVsZSAmJiAoXG4gICAgICAgICAgICBjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHMubGVuZ3RoIDwgMyB8fFxuICAgICAgICAgICAgIXBvc3NpYmxlQXJndW1lbnRzLmluY2x1ZGVzKGNvbmZpZ3VyYXRpb25cbiAgICAgICAgICAgICAgICAuZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXSlcbiAgICAgICAgKSlcbiAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcbiAgICAgICAgICAgICAgICBgR2l2ZSBvbmUgb2YgXCIke3Bvc3NpYmxlQXJndW1lbnRzLmpvaW4oJ1wiLCBcIicpfVwiIGFzIGNvbW1hbmQgYCArXG4gICAgICAgICAgICAgICAgJ2xpbmUgYXJndW1lbnQuIFlvdSBjYW4gcHJvdmlkZSBhIGpzb24gc3RyaW5nIGFzIHNlY29uZCAnICtcbiAgICAgICAgICAgICAgICAncGFyYW1ldGVyIHRvIGR5bmFtaWNhbGx5IG92ZXJ3cml0ZSBzb21lIGNvbmZpZ3VyYXRpb25zLlxcbicpXG4gICAgICAgIC8vIGVuZHJlZ2lvblxuICAgICAgICAvLyByZWdpb24gZm9yd2FyZCBuZXN0ZWQgcmV0dXJuIGNvZGVzXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9jZXNzUHJvbWlzZXMpXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBwcm9jZXNzLmV4aXQoZXJyb3IucmV0dXJuQ29kZSlcbiAgICAgICAgfVxuICAgICAgICAvLyBlbmRyZWdpb25cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBpZiAoY29uZmlndXJhdGlvbi5kZWJ1ZylcbiAgICAgICAgICAgIHRocm93IGVycm9yXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpXG4gICAgfVxufVxuaWYgKHJlcXVpcmUubWFpbiA9PT0gbW9kdWxlKVxuICAgIG1haW4oKS5jYXRjaCgoZXJyb3I6RXJyb3IpOnZvaWQgPT4ge1xuICAgICAgICB0aHJvdyBlcnJvclxuICAgIH0pXG5leHBvcnQgZGVmYXVsdCBtYWluXG4vLyByZWdpb24gdmltIG1vZGxpbmVcbi8vIHZpbTogc2V0IHRhYnN0b3A9NCBzaGlmdHdpZHRoPTQgZXhwYW5kdGFiOlxuLy8gdmltOiBmb2xkbWV0aG9kPW1hcmtlciBmb2xkbWFya2VyPXJlZ2lvbixlbmRyZWdpb246XG4vLyBlbmRyZWdpb25cbiJdfQ==