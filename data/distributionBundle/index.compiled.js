#!/usr/bin/env node
'use strict';var _stringify=require('babel-runtime/core-js/json/stringify'),_stringify2=_interopRequireDefault(_stringify),_promise=require('babel-runtime/core-js/promise'),_promise2=_interopRequireDefault(_promise),_asyncToGenerator2=require('babel-runtime/helpers/asyncToGenerator'),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_child_process=require('child_process'),_clientnode=require('clientnode'),_clientnode2=_interopRequireDefault(_clientnode),_fs=require('fs'),fileSystem=_interopRequireWildcard(_fs),_path=require('path'),_path2=_interopRequireDefault(_path),_rimraf=require('rimraf'),_rimraf2=_interopRequireDefault(_rimraf),_configurator=require('./configurator.compiled'),_configurator2=_interopRequireDefault(_configurator),_helper=require('./helper.compiled'),_helper2=_interopRequireDefault(_helper);Object.defineProperty(exports,'__esModule',{value:!0});function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}try{require('source-map-support/register')}catch(a){}const main=(()=>{var a=(0,_asyncToGenerator3.default)(function*(){try{const b={cwd:_configurator2.default.path.context,env:process.env,shell:!0,stdio:'inherit'},c=[],d=[],e=['build','buildDLL','clear','document','lint','preinstall','serve','test','testInBrowser','typeCheck'],f=[];if(2<_configurator2.default.givenCommandLineArguments.length){let i={givenCommandLineArguments:_configurator2.default.givenCommandLineArguments.slice()};3<_configurator2.default.givenCommandLineArguments.length&&_clientnode2.default.stringParseEncodedObject(_configurator2.default.givenCommandLineArguments[_configurator2.default.givenCommandLineArguments.length-1],_configurator2.default,'configuration')&&_configurator2.default.givenCommandLineArguments.pop();let j=0,k=_path2.default.resolve(_configurator2.default.path.context,`.dynamicConfiguration-${j}.json`);for(;k=_path2.default.resolve(_configurator2.default.path.context,`.dynamicConfiguration-${j}.json`),!!(yield _clientnode2.default.isFile(k));)j+=1;yield new _promise2.default(function(o,p){return fileSystem.writeFile(k,(0,_stringify2.default)(i),function(q){return q?p(q):o()})});const l=process.argv.splice(3);if(f.push(function(o){if(_clientnode2.default.isFileSync(k)&&fileSystem.unlinkSync(k),o)throw o}),!['build','preinstall','serve','test','testInBrowser'].includes(_configurator2.default.givenCommandLineArguments[2])&&e.includes(_configurator2.default.givenCommandLineArguments[2])){if(_path2.default.resolve(_configurator2.default.path.target.base)===_path2.default.resolve(_configurator2.default.path.context)){yield _clientnode2.default.walkDirectoryRecursively(_configurator2.default.path.target.base,(()=>{var o=(0,_asyncToGenerator3.default)(function*(p){if(_helper2.default.isFilePathInLocation(p.path,_configurator2.default.path.ignore.concat(_configurator2.default.module.directoryNames,_configurator2.default.loader.directoryNames).map(function(q){return _path2.default.resolve(_configurator2.default.path.context,q)}).filter(function(q){return!_configurator2.default.path.context.startsWith(q)})))return!1;for(const q in _configurator2.default.build.types)if(new RegExp(_configurator2.default.build.types[q].filePathPattern).test(p.path)){if(p.stat.isDirectory())return yield new _promise2.default(function(r,s){return(0,_rimraf2.default)(p.path,{glob:!1},function(t){return t?s(t):r()})}),!1;yield new _promise2.default(function(r,s){return fileSystem.unlink(p.path,function(t){return t?s(t):r()})});break}});return function(){return o.apply(this,arguments)}})());for(const o of yield _clientnode2.default.walkDirectoryRecursively(_configurator2.default.path.target.base,function(){return!1},{encoding:_configurator2.default.encoding}))(o.name.length>'.dll-manifest.json'.length&&o.name.endsWith('.dll-manifest.json')||o.name.startsWith('npm-debug'))&&(yield new _promise2.default(function(p,q){return fileSystem.unlink(o.path,function(r){return r?q(r):p()})}))}else yield new _promise2.default(function(o,p){return(0,_rimraf2.default)(_configurator2.default.path.target.base,{glob:!1},function(q){return q?p(q):o()})});(yield _clientnode2.default.isDirectory(_configurator2.default.path.apiDocumentation))&&(yield new _promise2.default(function(o,p){return(0,_rimraf2.default)(_configurator2.default.path.apiDocumentation,{glob:!1},function(q){return q?p(q):o()})}))}const m=_helper2.default.resolveBuildConfigurationFilePaths(_configurator2.default.build.types,_configurator2.default.path.source.asset.base,_configurator2.default.path.ignore.concat(_configurator2.default.module.directoryNames,_configurator2.default.loader.directoryNames).map(function(o){return _path2.default.resolve(_configurator2.default.path.context,o)}).filter(function(o){return!_configurator2.default.path.context.startsWith(o)}),_configurator2.default.package.main.fileNames);if(['build','buildDLL','document','test'].includes(process.argv[2])){let o=!1;const p=function(){if(!o){for(const q in o=!0,_configurator2.default.injection.internal.normalized)if(_configurator2.default.injection.internal.normalized.hasOwnProperty(q))for(const r of _configurator2.default.injection.internal.normalized[q]){const s=_helper2.default.determineModuleFilePath(r,_configurator2.default.module.aliases,_configurator2.default.module.replacements.normal,_configurator2.default.extensions,_configurator2.default.path.context,_configurator2.default.path.source.asset.base,_configurator2.default.path.ignore,_configurator2.default.module.directoryNames,_configurator2.default.package.main.fileNames,_configurator2.default.package.main.propertyNames,_configurator2.default.package.aliasPropertyNames,_configurator2.default.encoding);let t;if(s&&(t=_helper2.default.determineAssetType(s,_configurator2.default.build.types,_configurator2.default.path)),'string'==typeof t&&_configurator2.default.build.types[t]){const u=_helper2.default.renderFilePathTemplate(_helper2.default.stripLoader(_configurator2.default.files.compose.javaScript),{'[name]':q});'js'===_configurator2.default.build.types[t].outputExtension&&_clientnode2.default.isFileSync(u)&&fileSystem.chmodSync(u,'755')}}for(const q of _configurator2.default.path.tidyUp)q&&_clientnode2.default.isFileSync(q)&&fileSystem.unlinkSync(q)}};f.push(p),d.push(new _promise2.default(function(q,r){const s=(_configurator2.default.commandLine.build.arguments||[]).concat(l);console.info('Running "'+(`${_configurator2.default.commandLine.build.command} `+s.join(' ')).trim()+'"');const t=(0,_child_process.spawn)(_configurator2.default.commandLine.build.command,s,b),u=(()=>{var w=(0,_asyncToGenerator3.default)(function*(){for(const x of _configurator2.default.files.additionalPaths){const y=_path2.default.join(_configurator2.default.path.source.base,x),z=_path2.default.join(_configurator2.default.path.target.base,x);(yield _clientnode2.default.isDirectory(y))?((yield _clientnode2.default.isDirectory(z))&&(yield new _promise2.default(function(A,B){return(0,_rimraf2.default)(z,{glob:!1},function(C){return C?B(C):A()})})),yield _clientnode2.default.copyDirectoryRecursive(y,z)):(yield _clientnode2.default.isFile(y))&&(yield _clientnode2.default.copyFile(y,z))}p()});return function copyAdditionalFilesAndTidyUp(){return w.apply(this,arguments)}})(),v=_clientnode2.default.getProcessCloseHandler(q,r,null,'build'===process.argv[2]?u:p);for(const w of _clientnode2.default.closeEventNames)t.on(w,v);c.push(t)}))}else if(_configurator2.default.library&&'preinstall'===_configurator2.default.givenCommandLineArguments[2]){const o=_helper2.default.determineModuleLocations(_configurator2.default.testInBrowser.injection.internal,_configurator2.default.module.aliases,_configurator2.default.module.replacements.normal,_configurator2.default.extensions,_configurator2.default.path.context,_configurator2.default.path.source.asset.base,_configurator2.default.path.ignore).filePaths;for(const p of m)for(const q of p.filePaths)if(!o.includes(q)){const s=function(t,u,v,w,x,y){return new Function('global','self','buildConfiguration','path','additionalArguments','filePath','return `'+v[_configurator2.default.givenCommandLineArguments[2]].trim()+'`')(t,u,v,w,x,y)}(global,_configurator2.default,p,_path2.default,l,q);console.info(`Running "${s}"`),d.push(new _promise2.default(function(t,u){return _clientnode2.default.handleChildProcess((0,_child_process.exec)(s,b,function(v){return v?u(v):t()}))}))}}const n=function(o){let p=Array.isArray(_configurator2.default.commandLine[o])?_configurator2.default.commandLine[o]:[_configurator2.default.commandLine[o]];for(const q of p){(function(s,t,u){return new Function('global','self','path','return '+(q.hasOwnProperty('indicator')?q.indicator:'true'))(s,t,u)})(global,_configurator2.default,_path2.default)&&d.push(new _promise2.default(function(s,t){const u=(q.arguments||[]).concat(l);console.info('Running "'+(`${q.command} `+u.join(' ')).trim()+'"');const v=(0,_child_process.spawn)(q.command,u,b),w=_clientnode2.default.getProcessCloseHandler(s,t);for(const x of _clientnode2.default.closeEventNames)v.on(x,w);c.push(v)}))}};['document','test'].includes(_configurator2.default.givenCommandLineArguments[2])?(yield _promise2.default.all(d),n(_configurator2.default.givenCommandLineArguments[2])):['lint','testInBrowser','typeCheck','serve'].includes(_configurator2.default.givenCommandLineArguments[2])&&n(_configurator2.default.givenCommandLineArguments[2])}let g=!1;const h=function(...i){if(!g)for(const j of f)j(...i);g=!0};for(const i of _clientnode2.default.closeEventNames)process.on(i,h);require.main===module&&(3>_configurator2.default.givenCommandLineArguments.length||!e.includes(_configurator2.default.givenCommandLineArguments[2]))&&console.info(`Give one of "${e.join('", "')}" as command `+'line argument. You can provide a json string as second parameter to dynamically overwrite some configurations.\n');try{yield _promise2.default.all(d)}catch(i){process.exit(i.returnCode)}}catch(b){if(_configurator2.default.debug)throw b;else console.error(b)}});return function(){return a.apply(this,arguments)}})();require.main===module&&main().catch((a)=>{throw a}),exports.default=main;

//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TCxDQUNJLElBQUssS0FBTSxFQUFYLEdBQXlDLEVBQXpDLENBQ0ksRUFBa0IsR0FBRyxDQUFyQixFQUNSLElBQ0gsQ0FMRCxDQU1BLElBQUssS0FBTSxFQUFYLEdBQW9DLHNCQUFNLGVBQTFDLENBQ0ksUUFBUSxFQUFSLENBQVcsQ0FBWCxDQUEyQixDQUEzQixFQUNBLFFBQVEsSUFBUixHQUFpQixNQUFqQixHQUNpRCxDQUFqRCx3QkFBYyx5QkFBZCxDQUF3QyxNQUF4QyxFQUNBLENBQUMsRUFBa0IsUUFBbEIsQ0FDRyx1QkFBYyx5QkFBZCxDQUF3QyxDQUF4QyxDQURILENBRkQsQ0FqWkosRUFzWkksUUFBUSxJQUFSLENBQ0ssZ0JBQWUsRUFBa0IsSUFBbEIsQ0FBdUIsTUFBdkIsQ0FBK0IsZUFBL0MsbUhBREosQ0F0WkosQ0E0WkEsR0FBSSxDQUNBLEtBQU0sbUJBQVEsR0FBUixDQUFZLENBQVosQ0FDVCxDQUFDLFFBQWMsQ0FDWixRQUFRLElBQVIsQ0FBYSxFQUFNLFVBQW5CLENBQ0gsQ0FFSixDQUFDLFFBQWMsQ0FDWixHQUFJLHVCQUFjLEtBQWxCLENBQ0ksS0FBTSxFQUFOLENBREosSUFHSSxTQUFRLEtBQVIsQ0FBYyxDQUFkLENBQ1AsQ0FDSixDQXphSyx1REFBTixDQTBhSSxRQUFRLElBQVIsR0FBaUIsTSxFQUNqQixPQUFPLEtBQVAsQ0FBYSxLQUFzQixDQUMvQixLQUFNLEVBQ1QsQ0FGRCxDLGlCQUdXLEkiLCJmaWxlIjoiaW5kZXguY29tcGlsZWQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbi8vIEBmbG93XG4vLyAtKi0gY29kaW5nOiB1dGYtOCAtKi1cbid1c2Ugc3RyaWN0J1xuLyogIVxuICAgIHJlZ2lvbiBoZWFkZXJcbiAgICBDb3B5cmlnaHQgVG9yYmVuIFNpY2tlcnQgKGluZm9bXCJ+YXR+XCJddG9yYmVuLndlYnNpdGUpIDE2LjEyLjIwMTJcblxuICAgIExpY2Vuc2VcbiAgICAtLS0tLS0tXG5cbiAgICBUaGlzIGxpYnJhcnkgd3JpdHRlbiBieSBUb3JiZW4gU2lja2VydCBzdGFuZCB1bmRlciBhIGNyZWF0aXZlIGNvbW1vbnMgbmFtaW5nXG4gICAgMy4wIHVucG9ydGVkIGxpY2Vuc2UuIHNlZSBodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS8zLjAvZGVlZC5kZVxuICAgIGVuZHJlZ2lvblxuKi9cbi8vIHJlZ2lvbiBpbXBvcnRzXG5pbXBvcnQge1xuICAgIENoaWxkUHJvY2VzcywgZXhlYyBhcyBleGVjQ2hpbGRQcm9jZXNzLCBzcGF3biBhcyBzcGF3bkNoaWxkUHJvY2Vzc1xufSBmcm9tICdjaGlsZF9wcm9jZXNzJ1xuaW1wb3J0IFRvb2xzIGZyb20gJ2NsaWVudG5vZGUnXG5pbXBvcnQgdHlwZSB7RmlsZSwgUGxhaW5PYmplY3R9IGZyb20gJ2NsaWVudG5vZGUnXG5pbXBvcnQgKiBhcyBmaWxlU3lzdGVtIGZyb20gJ2ZzJ1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCdcbmltcG9ydCByZW1vdmVEaXJlY3RvcnlSZWN1cnNpdmVseSBmcm9tICdyaW1yYWYnXG4vLyBOT1RFOiBPbmx5IG5lZWRlZCBmb3IgZGVidWdnaW5nIHRoaXMgZmlsZS5cbnRyeSB7XG4gICAgcmVxdWlyZSgnc291cmNlLW1hcC1zdXBwb3J0L3JlZ2lzdGVyJylcbn0gY2F0Y2ggKGVycm9yKSB7fVxuXG5pbXBvcnQgY29uZmlndXJhdGlvbiBmcm9tICcuL2NvbmZpZ3VyYXRvci5jb21waWxlZCdcbmltcG9ydCBIZWxwZXIgZnJvbSAnLi9oZWxwZXIuY29tcGlsZWQnXG5pbXBvcnQgdHlwZSB7UmVzb2x2ZWRCdWlsZENvbmZpZ3VyYXRpb259IGZyb20gJy4vdHlwZSdcbi8vIGVuZHJlZ2lvblxuY29uc3QgbWFpbiA9IGFzeW5jICgpOlByb21pc2U8YW55PiA9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgLy8gcmVnaW9uIGNvbnRyb2xsZXJcbiAgICAgICAgY29uc3QgY2hpbGRQcm9jZXNzT3B0aW9uczpPYmplY3QgPSB7XG4gICAgICAgICAgICBjd2Q6IGNvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0LFxuICAgICAgICAgICAgZW52OiBwcm9jZXNzLmVudixcbiAgICAgICAgICAgIHNoZWxsOiB0cnVlLFxuICAgICAgICAgICAgc3RkaW86ICdpbmhlcml0J1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNoaWxkUHJvY2Vzc2VzOkFycmF5PENoaWxkUHJvY2Vzcz4gPSBbXVxuICAgICAgICBjb25zdCBwcm9jZXNzUHJvbWlzZXM6QXJyYXk8UHJvbWlzZTxhbnk+PiA9IFtdXG4gICAgICAgIGNvbnN0IHBvc3NpYmxlQXJndW1lbnRzOkFycmF5PHN0cmluZz4gPSBbXG4gICAgICAgICAgICAnYnVpbGQnLCAnYnVpbGRETEwnLCAnY2xlYXInLCAnZG9jdW1lbnQnLCAnbGludCcsICdwcmVpbnN0YWxsJyxcbiAgICAgICAgICAgICdzZXJ2ZScsICd0ZXN0JywgJ3Rlc3RJbkJyb3dzZXInLCAndHlwZUNoZWNrJ11cbiAgICAgICAgY29uc3QgY2xvc2VFdmVudEhhbmRsZXJzOkFycmF5PEZ1bmN0aW9uPiA9IFtdXG4gICAgICAgIGlmIChjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHMubGVuZ3RoID4gMikge1xuICAgICAgICAgICAgLy8gcmVnaW9uIHRlbXBvcmFyeSBzYXZlIGR5bmFtaWNhbGx5IGdpdmVuIGNvbmZpZ3VyYXRpb25zXG4gICAgICAgICAgICAvLyBOT1RFOiBXZSBuZWVkIGEgY29weSBvZiBnaXZlbiBhcmd1bWVudHMgYXJyYXkuXG4gICAgICAgICAgICBsZXQgZHluYW1pY0NvbmZpZ3VyYXRpb246UGxhaW5PYmplY3QgPSB7Z2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50czpcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHMuc2xpY2UoKX1cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHMubGVuZ3RoID4gMyAmJlxuICAgICAgICAgICAgICAgIFRvb2xzLnN0cmluZ1BhcnNlRW5jb2RlZE9iamVjdChcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzW1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzLmxlbmd0aCAtIDFdLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLCAnY29uZmlndXJhdGlvbicpXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzLnBvcCgpXG4gICAgICAgICAgICBsZXQgY291bnQ6bnVtYmVyID0gMFxuICAgICAgICAgICAgbGV0IGZpbGVQYXRoOnN0cmluZyA9IHBhdGgucmVzb2x2ZShcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguY29udGV4dCxcbiAgICAgICAgICAgICAgICBgLmR5bmFtaWNDb25maWd1cmF0aW9uLSR7Y291bnR9Lmpzb25gKVxuICAgICAgICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgICAgICAgICBmaWxlUGF0aCA9IHBhdGgucmVzb2x2ZShcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQsXG4gICAgICAgICAgICAgICAgICAgIGAuZHluYW1pY0NvbmZpZ3VyYXRpb24tJHtjb3VudH0uanNvbmApXG4gICAgICAgICAgICAgICAgaWYgKCEoYXdhaXQgVG9vbHMuaXNGaWxlKGZpbGVQYXRoKSkpXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgY291bnQgKz0gMVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmU6RnVuY3Rpb24sIHJlamVjdDpGdW5jdGlvbik6dm9pZCA9PlxuICAgICAgICAgICAgICAgIGZpbGVTeXN0ZW0ud3JpdGVGaWxlKGZpbGVQYXRoLCBKU09OLnN0cmluZ2lmeShcbiAgICAgICAgICAgICAgICAgICAgZHluYW1pY0NvbmZpZ3VyYXRpb25cbiAgICAgICAgICAgICAgICApLCAoZXJyb3I6P0Vycm9yKTp2b2lkID0+IGVycm9yID8gcmVqZWN0KGVycm9yKSA6IHJlc29sdmUoKSkpXG4gICAgICAgICAgICBjb25zdCBhZGRpdGlvbmFsQXJndW1lbnRzOkFycmF5PHN0cmluZz4gPSBwcm9jZXNzLmFyZ3Yuc3BsaWNlKDMpXG4gICAgICAgICAgICAvLyAvIHJlZ2lvbiByZWdpc3RlciBleGl0IGhhbmRsZXIgdG8gdGlkeSB1cFxuICAgICAgICAgICAgY2xvc2VFdmVudEhhbmRsZXJzLnB1c2goKGVycm9yOj9FcnJvcik6dm9pZCA9PiB7XG4gICAgICAgICAgICAgICAgLy8gTk9URTogQ2xvc2UgaGFuZGxlciBoYXZlIHRvIGJlIHN5bmNocm9ub3VzLlxuICAgICAgICAgICAgICAgIGlmIChUb29scy5pc0ZpbGVTeW5jKGZpbGVQYXRoKSlcbiAgICAgICAgICAgICAgICAgICAgZmlsZVN5c3RlbS51bmxpbmtTeW5jKGZpbGVQYXRoKVxuICAgICAgICAgICAgICAgIGlmIChlcnJvcilcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAvLyAvIGVuZHJlZ2lvblxuICAgICAgICAgICAgLy8gZW5kcmVnaW9uXG4gICAgICAgICAgICAvLyByZWdpb24gaGFuZGxlIGNsZWFyXG4gICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgIE5PVEU6IFNvbWUgdGFza3MgY291bGQgZGVwZW5kIG9uIHByZXZpb3VzbHkgY3JlYXRlZCBkbGxcbiAgICAgICAgICAgICAgICBwYWNrYWdlcyBzbyBhIGNsZWFuIHNob3VsZCBub3QgYmUgcGVyZm9ybWVkIGluIHRoYXQgY2FzZS5cbiAgICAgICAgICAgICAgICBOT1RFOiBJZiB3ZSBoYXZlIGEgZGVwZW5kZW5jeSBjeWNsZSB3ZSBuZWVkIHRvIHByZXNlcnZlIGZpbGVzXG4gICAgICAgICAgICAgICAgZHVyaW5nIHByZWluc3RhbGwgcGhhc2UuXG4gICAgICAgICAgICAqL1xuICAgICAgICAgICAgaWYgKCFbXG4gICAgICAgICAgICAgICAgJ2J1aWxkJywgJ3ByZWluc3RhbGwnLCAnc2VydmUnLCAndGVzdCcsICd0ZXN0SW5Ccm93c2VyJ1xuICAgICAgICAgICAgXS5pbmNsdWRlcyhjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHNbMl0pICYmXG4gICAgICAgICAgICBwb3NzaWJsZUFyZ3VtZW50cy5pbmNsdWRlcyhcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHNbMl1cbiAgICAgICAgICAgICkpIHtcbiAgICAgICAgICAgICAgICBpZiAocGF0aC5yZXNvbHZlKFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGgudGFyZ2V0LmJhc2VcbiAgICAgICAgICAgICAgICApID09PSBwYXRoLnJlc29sdmUoY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZXMgYWxsIGNvbXBpbGVkIGZpbGVzLlxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBUb29scy53YWxrRGlyZWN0b3J5UmVjdXJzaXZlbHkoXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGgudGFyZ2V0LmJhc2UsIGFzeW5jIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlOkZpbGVcbiAgICAgICAgICAgICAgICAgICAgICAgICk6UHJvbWlzZTw/ZmFsc2U+ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSGVscGVyLmlzRmlsZVBhdGhJbkxvY2F0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLnBhdGgsIGNvbmZpZ3VyYXRpb24ucGF0aC5pZ25vcmUuY29uY2F0KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5tb2R1bGUuZGlyZWN0b3J5TmFtZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmxvYWRlci5kaXJlY3RvcnlOYW1lc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLm1hcCgoZmlsZVBhdGg6c3RyaW5nKTpzdHJpbmcgPT4gcGF0aC5yZXNvbHZlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQsIGZpbGVQYXRoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLmZpbHRlcigoZmlsZVBhdGg6c3RyaW5nKTpib29sZWFuID0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQuc3RhcnRzV2l0aChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlUGF0aCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHlwZTpzdHJpbmcgaW4gY29uZmlndXJhdGlvbi5idWlsZC50eXBlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5ldyBSZWdFeHAoY29uZmlndXJhdGlvbi5idWlsZC50eXBlc1tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXS5maWxlUGF0aFBhdHRlcm4pLnRlc3QoZmlsZS5wYXRoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUuc3RhdC5pc0RpcmVjdG9yeSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlOkZ1bmN0aW9uLCByZWplY3Q6RnVuY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOnZvaWQgPT4gcmVtb3ZlRGlyZWN0b3J5UmVjdXJzaXZlbHkoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUucGF0aCwge2dsb2I6IGZhbHNlfSwgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6P0Vycm9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk6dm9pZCA9PiBlcnJvciA/IHJlamVjdChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkgOiByZXNvbHZlKCkpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6RnVuY3Rpb24sIHJlamVjdDpGdW5jdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTp2b2lkID0+IGZpbGVTeXN0ZW0udW5saW5rKGZpbGUucGF0aCwgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOj9FcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTp2b2lkID0+IGVycm9yID8gcmVqZWN0KGVycm9yKSA6IHJlc29sdmUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIGZvciAoXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlOkZpbGUgb2YgKFxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgVG9vbHMud2Fsa0RpcmVjdG9yeVJlY3Vyc2l2ZWx5KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC50YXJnZXQuYmFzZSwgKCk6ZmFsc2UgPT4gZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge2VuY29kaW5nOiBjb25maWd1cmF0aW9uLmVuY29kaW5nfSkpXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLm5hbWUubGVuZ3RoID4gJy5kbGwtbWFuaWZlc3QuanNvbicubGVuZ3RoICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5uYW1lLmVuZHNXaXRoKCcuZGxsLW1hbmlmZXN0Lmpzb24nKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUubmFtZS5zdGFydHNXaXRoKCducG0tZGVidWcnKVxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZTpGdW5jdGlvbiwgcmVqZWN0OkZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTp2b2lkID0+IGZpbGVTeXN0ZW0udW5saW5rKGZpbGUucGF0aCwgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjo/RXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOnZvaWQgPT4gZXJyb3IgPyByZWplY3QoZXJyb3IpIDogcmVzb2x2ZSgpKSlcbiAgICAgICAgICAgICAgICB9IGVsc2VcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZTpGdW5jdGlvbiwgcmVqZWN0OkZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgICAgICk6dm9pZCA9PiByZW1vdmVEaXJlY3RvcnlSZWN1cnNpdmVseShcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC50YXJnZXQuYmFzZSwge2dsb2I6IGZhbHNlfSwgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOj9FcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgKTp2b2lkID0+IGVycm9yID8gcmVqZWN0KGVycm9yKSA6IHJlc29sdmUoKSkpXG4gICAgICAgICAgICAgICAgaWYgKGF3YWl0IFRvb2xzLmlzRGlyZWN0b3J5KFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguYXBpRG9jdW1lbnRhdGlvblxuICAgICAgICAgICAgICAgICkpXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6RnVuY3Rpb24sIHJlamVjdDpGdW5jdGlvblxuICAgICAgICAgICAgICAgICAgICApOnZvaWQgPT4gcmVtb3ZlRGlyZWN0b3J5UmVjdXJzaXZlbHkoXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguYXBpRG9jdW1lbnRhdGlvbiwge2dsb2I6IGZhbHNlfSwgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOj9FcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgKTp2b2lkID0+IGVycm9yID8gcmVqZWN0KGVycm9yKSA6IHJlc29sdmUoKSkpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBlbmRyZWdpb25cbiAgICAgICAgICAgIC8vIHJlZ2lvbiBoYW5kbGUgYnVpbGRcbiAgICAgICAgICAgIGNvbnN0IGJ1aWxkQ29uZmlndXJhdGlvbnM6UmVzb2x2ZWRCdWlsZENvbmZpZ3VyYXRpb24gPVxuICAgICAgICAgICAgICAgIEhlbHBlci5yZXNvbHZlQnVpbGRDb25maWd1cmF0aW9uRmlsZVBhdGhzKFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmJ1aWxkLnR5cGVzLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguc291cmNlLmFzc2V0LmJhc2UsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC5pZ25vcmUuY29uY2F0KFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5tb2R1bGUuZGlyZWN0b3J5TmFtZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmxvYWRlci5kaXJlY3RvcnlOYW1lc1xuICAgICAgICAgICAgICAgICAgICApLm1hcCgoZmlsZVBhdGg6c3RyaW5nKTpzdHJpbmcgPT4gcGF0aC5yZXNvbHZlKFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQsIGZpbGVQYXRoKVxuICAgICAgICAgICAgICAgICAgICApLmZpbHRlcigoZmlsZVBhdGg6c3RyaW5nKTpib29sZWFuID0+XG4gICAgICAgICAgICAgICAgICAgICAgICAhY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQuc3RhcnRzV2l0aChmaWxlUGF0aCkpLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhY2thZ2UubWFpbi5maWxlTmFtZXMpXG4gICAgICAgICAgICBpZiAoWydidWlsZCcsICdidWlsZERMTCcsICdkb2N1bWVudCcsICd0ZXN0J10uaW5jbHVkZXMoXG4gICAgICAgICAgICAgICAgcHJvY2Vzcy5hcmd2WzJdXG4gICAgICAgICAgICApKSB7XG4gICAgICAgICAgICAgICAgbGV0IHRpZGllZFVwOmJvb2xlYW4gPSBmYWxzZVxuICAgICAgICAgICAgICAgIGNvbnN0IHRpZHlVcDpGdW5jdGlvbiA9ICgpOnZvaWQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgICAgICAgRGV0ZXJtaW5lcyBhbGwgbm9uZSBqYXZhU2NyaXB0IGVudGl0aWVzIHdoaWNoIGhhdmUgYmVlblxuICAgICAgICAgICAgICAgICAgICAgICAgZW1pdHRlZCBhcyBzaW5nbGUgamF2YVNjcmlwdCBtb2R1bGUgdG8gcmVtb3ZlLlxuICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICBpZiAodGlkaWVkVXApXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgICAgICAgICAgdGlkaWVkVXAgPSB0cnVlXG4gICAgICAgICAgICAgICAgICAgIGZvciAoXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjaHVua05hbWU6c3RyaW5nIGluXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmluamVjdGlvbi5pbnRlcm5hbC5ub3JtYWxpemVkXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maWd1cmF0aW9uLmluamVjdGlvbi5pbnRlcm5hbC5ub3JtYWxpemVkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmhhc093blByb3BlcnR5KGNodW5rTmFtZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG1vZHVsZUlEOnN0cmluZyBvZiBjb25maWd1cmF0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5pbmplY3Rpb24uaW50ZXJuYWwubm9ybWFsaXplZFtjaHVua05hbWVdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVQYXRoOj9zdHJpbmcgPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVscGVyLmRldGVybWluZU1vZHVsZUZpbGVQYXRoKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZUlELCBjb25maWd1cmF0aW9uLm1vZHVsZS5hbGlhc2VzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ubW9kdWxlLnJlcGxhY2VtZW50c1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubm9ybWFsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZXh0ZW5zaW9ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguY29udGV4dCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguc291cmNlLmFzc2V0LmJhc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLmlnbm9yZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLm1vZHVsZS5kaXJlY3RvcnlOYW1lcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhY2thZ2UubWFpbi5maWxlTmFtZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYWNrYWdlLm1haW5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnByb3BlcnR5TmFtZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYWNrYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hbGlhc1Byb3BlcnR5TmFtZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5lbmNvZGluZylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHR5cGU6P3N0cmluZ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlID0gSGVscGVyLmRldGVybWluZUFzc2V0VHlwZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlUGF0aCwgY29uZmlndXJhdGlvbi5idWlsZC50eXBlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVvZiB0eXBlID09PSAnc3RyaW5nJyAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5idWlsZC50eXBlc1t0eXBlXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVQYXRoOnN0cmluZyA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVscGVyLnJlbmRlckZpbGVQYXRoVGVtcGxhdGUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhlbHBlci5zdHJpcExvYWRlcihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZmlsZXMuY29tcG9zZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5qYXZhU2NyaXB0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICksIHsnW25hbWVdJzogY2h1bmtOYW1lfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTk9URTogQ2xvc2UgaGFuZGxlciBoYXZlIHRvIGJlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3luY2hyb25vdXMuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uYnVpbGQudHlwZXNbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLm91dHB1dEV4dGVuc2lvbiA9PT0gJ2pzJyAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRvb2xzLmlzRmlsZVN5bmMoZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVN5c3RlbS5jaG1vZFN5bmMoZmlsZVBhdGgsICc3NTUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGZpbGVQYXRoOj9zdHJpbmcgb2YgY29uZmlndXJhdGlvbi5wYXRoLnRpZHlVcClcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWxlUGF0aCAmJiBUb29scy5pc0ZpbGVTeW5jKGZpbGVQYXRoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOT1RFOiBDbG9zZSBoYW5kbGVyIGhhdmUgdG8gYmUgc3luY2hyb25vdXMuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVN5c3RlbS51bmxpbmtTeW5jKGZpbGVQYXRoKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjbG9zZUV2ZW50SGFuZGxlcnMucHVzaCh0aWR5VXApXG4gICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgICAgVHJpZ2dlcnMgY29tcGxldGUgYXNzZXQgY29tcGlsaW5nIGFuZCBidW5kbGVzIHRoZW0gaW50byB0aGVcbiAgICAgICAgICAgICAgICAgICAgZmluYWwgcHJvZHVjdGl2ZSBvdXRwdXQuXG4gICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBwcm9jZXNzUHJvbWlzZXMucHVzaChuZXcgUHJvbWlzZSgoXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6RnVuY3Rpb24sIHJlamVjdDpGdW5jdGlvblxuICAgICAgICAgICAgICAgICk6dm9pZCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbW1hbmRMaW5lQXJndW1lbnRzOkFycmF5PHN0cmluZz4gPSAoXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmNvbW1hbmRMaW5lLmJ1aWxkLmFyZ3VtZW50cyB8fCBbXVxuICAgICAgICAgICAgICAgICAgICApLmNvbmNhdChhZGRpdGlvbmFsQXJndW1lbnRzKVxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oJ1J1bm5pbmcgXCInICsgKFxuICAgICAgICAgICAgICAgICAgICAgICAgYCR7Y29uZmlndXJhdGlvbi5jb21tYW5kTGluZS5idWlsZC5jb21tYW5kfSBgICtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRMaW5lQXJndW1lbnRzLmpvaW4oJyAnKVxuICAgICAgICAgICAgICAgICAgICApLnRyaW0oKSArICdcIicpXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkUHJvY2VzczpDaGlsZFByb2Nlc3MgPSBzcGF3bkNoaWxkUHJvY2VzcyhcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uY29tbWFuZExpbmUuYnVpbGQuY29tbWFuZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRMaW5lQXJndW1lbnRzLCBjaGlsZFByb2Nlc3NPcHRpb25zKVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3B5QWRkaXRpb25hbEZpbGVzQW5kVGlkeVVwOkZ1bmN0aW9uID0gYXN5bmMgKFxuICAgICAgICAgICAgICAgICAgICApOlByb21pc2U8dm9pZD4gPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlUGF0aDpzdHJpbmcgb2ZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmZpbGVzLmFkZGl0aW9uYWxQYXRoc1xuICAgICAgICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc291cmNlUGF0aDpzdHJpbmcgPSBwYXRoLmpvaW4oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC5zb3VyY2UuYmFzZSwgZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0UGF0aDpzdHJpbmcgPSBwYXRoLmpvaW4oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC50YXJnZXQuYmFzZSwgZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF3YWl0IFRvb2xzLmlzRGlyZWN0b3J5KHNvdXJjZVBhdGgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhd2FpdCBUb29scy5pc0RpcmVjdG9yeSh0YXJnZXRQYXRoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlOkZ1bmN0aW9uLCByZWplY3Q6RnVuY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk6dm9pZCA9PiByZW1vdmVEaXJlY3RvcnlSZWN1cnNpdmVseShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRQYXRoLCB7Z2xvYjogZmFsc2V9LCAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOj9FcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk6dm9pZCA9PiBlcnJvciA/IHJlamVjdChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApIDogcmVzb2x2ZSgpKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgVG9vbHMuY29weURpcmVjdG9yeVJlY3Vyc2l2ZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZVBhdGgsIHRhcmdldFBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhd2FpdCBUb29scy5pc0ZpbGUoc291cmNlUGF0aCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IFRvb2xzLmNvcHlGaWxlKHNvdXJjZVBhdGgsIHRhcmdldFBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aWR5VXAoKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsb3NlSGFuZGxlcjpGdW5jdGlvbiA9IFRvb2xzLmdldFByb2Nlc3NDbG9zZUhhbmRsZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlLCByZWplY3QsIG51bGwsIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLmFyZ3ZbMl0gPT09ICdidWlsZCdcbiAgICAgICAgICAgICAgICAgICAgICAgICkgPyBjb3B5QWRkaXRpb25hbEZpbGVzQW5kVGlkeVVwIDogdGlkeVVwKVxuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGNsb3NlRXZlbnROYW1lOnN0cmluZyBvZiBUb29scy5jbG9zZUV2ZW50TmFtZXMpXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZFByb2Nlc3Mub24oY2xvc2VFdmVudE5hbWUsIGNsb3NlSGFuZGxlcilcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRQcm9jZXNzZXMucHVzaChjaGlsZFByb2Nlc3MpXG4gICAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAvLyBlbmRyZWdpb25cbiAgICAgICAgICAgIC8vIHJlZ2lvbiBoYW5kbGUgcHJlaW5zdGFsbFxuICAgICAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmxpYnJhcnkgJiZcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHNbMl0gPT09ICdwcmVpbnN0YWxsJ1xuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgLy8gUGVyZm9ybSBhbGwgZmlsZSBzcGVjaWZpYyBwcmVwcm9jZXNzaW5nIHN0dWZmLlxuICAgICAgICAgICAgICAgIGNvbnN0IHRlc3RNb2R1bGVGaWxlUGF0aHM6QXJyYXk8c3RyaW5nPiA9XG4gICAgICAgICAgICAgICAgICAgIEhlbHBlci5kZXRlcm1pbmVNb2R1bGVMb2NhdGlvbnMoXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnRlc3RJbkJyb3dzZXIuaW5qZWN0aW9uLmludGVybmFsLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5tb2R1bGUuYWxpYXNlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ubW9kdWxlLnJlcGxhY2VtZW50cy5ub3JtYWwsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmV4dGVuc2lvbnMsIGNvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0LFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLnNvdXJjZS5hc3NldC5iYXNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLmlnbm9yZVxuICAgICAgICAgICAgICAgICAgICApLmZpbGVQYXRoc1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgYnVpbGRDb25maWd1cmF0aW9uIG9mIGJ1aWxkQ29uZmlndXJhdGlvbnMpXG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZmlsZVBhdGg6c3RyaW5nIG9mIGJ1aWxkQ29uZmlndXJhdGlvbi5maWxlUGF0aHMpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRlc3RNb2R1bGVGaWxlUGF0aHMuaW5jbHVkZXMoZmlsZVBhdGgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZXZhbHVhdGlvbkZ1bmN0aW9uID0gKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWw6T2JqZWN0LCBzZWxmOlBsYWluT2JqZWN0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidWlsZENvbmZpZ3VyYXRpb246UGxhaW5PYmplY3QsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6dHlwZW9mIHBhdGgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZGl0aW9uYWxBcmd1bWVudHM6QXJyYXk8c3RyaW5nPixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVBhdGg6c3RyaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTpzdHJpbmcgPT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JlVHlwZUNoZWNrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBGdW5jdGlvbihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdnbG9iYWwnLCAnc2VsZicsICdidWlsZENvbmZpZ3VyYXRpb24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BhdGgnLCAnYWRkaXRpb25hbEFyZ3VtZW50cycsICdmaWxlUGF0aCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmV0dXJuIGAnICsgYnVpbGRDb25maWd1cmF0aW9uW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHNbMl1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0udHJpbSgpICsgJ2AnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWwsIHNlbGYsIGJ1aWxkQ29uZmlndXJhdGlvbiwgcGF0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZGl0aW9uYWxBcmd1bWVudHMsIGZpbGVQYXRoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbW1hbmQ6c3RyaW5nID0gZXZhbHVhdGlvbkZ1bmN0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWwsIGNvbmZpZ3VyYXRpb24sIGJ1aWxkQ29uZmlndXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCwgYWRkaXRpb25hbEFyZ3VtZW50cywgZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKGBSdW5uaW5nIFwiJHtjb21tYW5kfVwiYClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzUHJvbWlzZXMucHVzaChuZXcgUHJvbWlzZSgoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6RnVuY3Rpb24sIHJlamVjdDpGdW5jdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk6dm9pZCA9PiBUb29scy5oYW5kbGVDaGlsZFByb2Nlc3MoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4ZWNDaGlsZFByb2Nlc3MoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kLCBjaGlsZFByb2Nlc3NPcHRpb25zLCAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6P0Vycm9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOnZvaWQgPT4gZXJyb3IgPyByZWplY3QoZXJyb3IpIDogcmVzb2x2ZSgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkpKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGVuZHJlZ2lvblxuICAgICAgICAgICAgLy8gcmVnaW9uIGhhbmRsZSByZW1haW5pbmcgdGFza3NcbiAgICAgICAgICAgIGNvbnN0IGhhbmRsZVRhc2sgPSAodHlwZTpzdHJpbmcpOnZvaWQgPT4ge1xuICAgICAgICAgICAgICAgIGxldCB0YXNrczpBcnJheTxPYmplY3Q+XG4gICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY29uZmlndXJhdGlvbi5jb21tYW5kTGluZVt0eXBlXSkpXG4gICAgICAgICAgICAgICAgICAgIHRhc2tzID0gY29uZmlndXJhdGlvbi5jb21tYW5kTGluZVt0eXBlXVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgdGFza3MgPSBbY29uZmlndXJhdGlvbi5jb21tYW5kTGluZVt0eXBlXV1cbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHRhc2s6T2JqZWN0IG9mIHRhc2tzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV2YWx1YXRpb25GdW5jdGlvbiA9IChcbiAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbDpPYmplY3QsIHNlbGY6UGxhaW5PYmplY3QsIHBhdGg6dHlwZW9mIHBhdGhcbiAgICAgICAgICAgICAgICAgICAgKTpib29sZWFuID0+XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmVUeXBlQ2hlY2tcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBGdW5jdGlvbihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZ2xvYmFsJywgJ3NlbGYnLCAncGF0aCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JldHVybiAnICsgKHRhc2suaGFzT3duUHJvcGVydHkoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpbmRpY2F0b3InXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKSA/IHRhc2suaW5kaWNhdG9yIDogJ3RydWUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgKShnbG9iYWwsIHNlbGYsIHBhdGgpXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmFsdWF0aW9uRnVuY3Rpb24oZ2xvYmFsLCBjb25maWd1cmF0aW9uLCBwYXRoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NQcm9taXNlcy5wdXNoKG5ldyBQcm9taXNlKChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlOkZ1bmN0aW9uLCByZWplY3Q6RnVuY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICk6dm9pZCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tbWFuZExpbmVBcmd1bWVudHM6QXJyYXk8c3RyaW5nPiA9IChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay5hcmd1bWVudHMgfHwgW11cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApLmNvbmNhdChhZGRpdGlvbmFsQXJndW1lbnRzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbygnUnVubmluZyBcIicgKyAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAke3Rhc2suY29tbWFuZH0gYCArIGNvbW1hbmRMaW5lQXJndW1lbnRzLmpvaW4oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKS50cmltKCkgKyAnXCInKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkUHJvY2VzczpDaGlsZFByb2Nlc3MgPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGF3bkNoaWxkUHJvY2VzcyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2suY29tbWFuZCwgY29tbWFuZExpbmVBcmd1bWVudHMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZFByb2Nlc3NPcHRpb25zKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsb3NlSGFuZGxlcjpGdW5jdGlvbiA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRvb2xzLmdldFByb2Nlc3NDbG9zZUhhbmRsZXIocmVzb2x2ZSwgcmVqZWN0KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsb3NlRXZlbnROYW1lOnN0cmluZyBvZlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUb29scy5jbG9zZUV2ZW50TmFtZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkUHJvY2Vzcy5vbihjbG9zZUV2ZW50TmFtZSwgY2xvc2VIYW5kbGVyKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkUHJvY2Vzc2VzLnB1c2goY2hpbGRQcm9jZXNzKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gLyByZWdpb24gYS0vc3luY2hyb25vdXNcbiAgICAgICAgICAgIGlmIChbJ2RvY3VtZW50JywgJ3Rlc3QnXS5pbmNsdWRlcyhcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHNbMl1cbiAgICAgICAgICAgICkpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9jZXNzUHJvbWlzZXMpXG4gICAgICAgICAgICAgICAgaGFuZGxlVGFzayhjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHNbMl0pXG4gICAgICAgICAgICB9IGVsc2UgaWYgKFsnbGludCcsICd0ZXN0SW5Ccm93c2VyJywgJ3R5cGVDaGVjaycsICdzZXJ2ZSddLmluY2x1ZGVzKFxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXVxuICAgICAgICAgICAgKSlcbiAgICAgICAgICAgICAgICBoYW5kbGVUYXNrKGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXSlcbiAgICAgICAgICAgIC8vIC8gZW5kcmVnaW9uXG4gICAgICAgICAgICAvLyBlbmRyZWdpb25cbiAgICAgICAgfVxuICAgICAgICBsZXQgZmluaXNoZWQ6Ym9vbGVhbiA9IGZhbHNlXG4gICAgICAgIGNvbnN0IGNsb3NlSGFuZGxlciA9ICguLi5wYXJhbWV0ZXI6QXJyYXk8YW55Pik6dm9pZCA9PiB7XG4gICAgICAgICAgICBpZiAoIWZpbmlzaGVkKVxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgY2xvc2VFdmVudEhhbmRsZXI6RnVuY3Rpb24gb2YgY2xvc2VFdmVudEhhbmRsZXJzKVxuICAgICAgICAgICAgICAgICAgICBjbG9zZUV2ZW50SGFuZGxlciguLi5wYXJhbWV0ZXIpXG4gICAgICAgICAgICBmaW5pc2hlZCA9IHRydWVcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IGNsb3NlRXZlbnROYW1lOnN0cmluZyBvZiBUb29scy5jbG9zZUV2ZW50TmFtZXMpXG4gICAgICAgICAgICBwcm9jZXNzLm9uKGNsb3NlRXZlbnROYW1lLCBjbG9zZUhhbmRsZXIpXG4gICAgICAgIGlmIChyZXF1aXJlLm1haW4gPT09IG1vZHVsZSAmJiAoXG4gICAgICAgICAgICBjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHMubGVuZ3RoIDwgMyB8fFxuICAgICAgICAgICAgIXBvc3NpYmxlQXJndW1lbnRzLmluY2x1ZGVzKFxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXSlcbiAgICAgICAgKSlcbiAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcbiAgICAgICAgICAgICAgICBgR2l2ZSBvbmUgb2YgXCIke3Bvc3NpYmxlQXJndW1lbnRzLmpvaW4oJ1wiLCBcIicpfVwiIGFzIGNvbW1hbmQgYCArXG4gICAgICAgICAgICAgICAgJ2xpbmUgYXJndW1lbnQuIFlvdSBjYW4gcHJvdmlkZSBhIGpzb24gc3RyaW5nIGFzIHNlY29uZCAnICtcbiAgICAgICAgICAgICAgICAncGFyYW1ldGVyIHRvIGR5bmFtaWNhbGx5IG92ZXJ3cml0ZSBzb21lIGNvbmZpZ3VyYXRpb25zLlxcbicpXG4gICAgICAgIC8vIGVuZHJlZ2lvblxuICAgICAgICAvLyByZWdpb24gZm9yd2FyZCBuZXN0ZWQgcmV0dXJuIGNvZGVzXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9jZXNzUHJvbWlzZXMpXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBwcm9jZXNzLmV4aXQoZXJyb3IucmV0dXJuQ29kZSlcbiAgICAgICAgfVxuICAgICAgICAvLyBlbmRyZWdpb25cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBpZiAoY29uZmlndXJhdGlvbi5kZWJ1ZylcbiAgICAgICAgICAgIHRocm93IGVycm9yXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpXG4gICAgfVxufVxuaWYgKHJlcXVpcmUubWFpbiA9PT0gbW9kdWxlKVxuICAgIG1haW4oKS5jYXRjaCgoZXJyb3I6RXJyb3IpOnZvaWQgPT4ge1xuICAgICAgICB0aHJvdyBlcnJvclxuICAgIH0pXG5leHBvcnQgZGVmYXVsdCBtYWluXG4vLyByZWdpb24gdmltIG1vZGxpbmVcbi8vIHZpbTogc2V0IHRhYnN0b3A9NCBzaGlmdHdpZHRoPTQgZXhwYW5kdGFiOlxuLy8gdmltOiBmb2xkbWV0aG9kPW1hcmtlciBmb2xkbWFya2VyPXJlZ2lvbixlbmRyZWdpb246XG4vLyBlbmRyZWdpb25cbiJdfQ==