#!/usr/bin/env node
'use strict';var _promise=require('babel-runtime/core-js/promise'),_promise2=_interopRequireDefault(_promise),_stringify=require('babel-runtime/core-js/json/stringify'),_stringify2=_interopRequireDefault(_stringify),_asyncToGenerator2=require('babel-runtime/helpers/asyncToGenerator'),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_child_process=require('child_process'),_clientnode=require('clientnode'),_clientnode2=_interopRequireDefault(_clientnode),_fs=require('fs'),fileSystem=_interopRequireWildcard(_fs),_path=require('path'),_path2=_interopRequireDefault(_path),_rimraf=require('rimraf'),_configurator=require('./configurator.compiled'),_configurator2=_interopRequireDefault(_configurator),_helper=require('./helper.compiled'),_helper2=_interopRequireDefault(_helper);Object.defineProperty(exports,'__esModule',{value:!0});function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}try{require('source-map-support/register')}catch(a){}const main=(()=>{var a=(0,_asyncToGenerator3.default)(function*(){try{const b={cwd:_configurator2.default.path.context,env:process.env,shell:!0,stdio:'inherit'},c=[],d=[],e=['build','buildDLL','clear','document','lint','preinstall','serve','test','testInBrowser','typeCheck'],f=[];if(2<_configurator2.default.givenCommandLineArguments.length){let i={givenCommandLineArguments:_configurator2.default.givenCommandLineArguments.slice()};3<_configurator2.default.givenCommandLineArguments.length&&_clientnode2.default.stringParseEncodedObject(_configurator2.default.givenCommandLineArguments[_configurator2.default.givenCommandLineArguments.length-1],_configurator2.default,'configuration')&&_configurator2.default.givenCommandLineArguments.pop();let j=0,k=`${_configurator2.default.path.context}.`+`dynamicConfiguration-${j}.json`;for(;k=`${_configurator2.default.path.context}.`+`dynamicConfiguration-${j}.json`,!!(yield _clientnode2.default.isFile(k));)j+=1;fileSystem.writeFileSync(k,(0,_stringify2.default)(i));const l=process.argv.splice(3);if(f.push(function(o){try{fileSystem.unlinkSync(k)}catch(p){}if(o)throw o;return o}),!['build','preinstall','serve','test','testInBrowser'].includes(_configurator2.default.givenCommandLineArguments[2])&&e.includes(_configurator2.default.givenCommandLineArguments[2])){if(_path2.default.resolve(_configurator2.default.path.target.base)===_path2.default.resolve(_configurator2.default.path.context)){yield _clientnode2.default.walkDirectoryRecursively(_configurator2.default.path.target.base,function(o){if(_helper2.default.isFilePathInLocation(o.path,_configurator2.default.path.ignore.concat(_configurator2.default.module.directoryNames,_configurator2.default.loader.directoryNames).map(function(p){return _path2.default.resolve(_configurator2.default.path.context,p)}).filter(function(p){return!_configurator2.default.path.context.startsWith(p)})))return!1;for(const p in _configurator2.default.build.types)if(new RegExp(_configurator2.default.build.types[p].filePathPattern).test(o.path)){if(o.stat.isDirectory())return(0,_rimraf.sync)(o.path,{glob:!1}),!1;fileSystem.unlinkSync(o.path);break}});for(const o of fileSystem.readdirSync(_configurator2.default.path.target.base))(o.length>'.dll-manifest.json'.length&&o.endsWith('.dll-manifest.json')||o.startsWith('npm-debug'))&&fileSystem.unlinkSync(_path2.default.resolve(_configurator2.default.path.target.base,o))}else(0,_rimraf.sync)(_configurator2.default.path.target.base,{glob:!1});try{(0,_rimraf.sync)(_configurator2.default.path.apiDocumentation,{glob:!1})}catch(o){}}const m=_helper2.default.resolveBuildConfigurationFilePaths(_configurator2.default.build.types,_configurator2.default.path.source.asset.base,_configurator2.default.path.ignore.concat(_configurator2.default.module.directoryNames,_configurator2.default.loader.directoryNames).map(function(o){return _path2.default.resolve(_configurator2.default.path.context,o)}).filter(function(o){return!_configurator2.default.path.context.startsWith(o)}),_configurator2.default.package.main.fileNames);if(['build','buildDLL','document','test'].includes(process.argv[2])){let o=!1;const p=(()=>{var q=(0,_asyncToGenerator3.default)(function*(){if(!o){for(const r in o=!0,_configurator2.default.injection.internal.normalized)if(_configurator2.default.injection.internal.normalized.hasOwnProperty(r))for(const s of _configurator2.default.injection.internal.normalized[r]){const t=_helper2.default.determineModuleFilePath(s,_configurator2.default.module.aliases,_configurator2.default.module.replacements.normal,_configurator2.default.extensions,_configurator2.default.path.context,_configurator2.default.path.source.asset.base,_configurator2.default.path.ignore,_configurator2.default.module.directoryNames,_configurator2.default.package.main.fileNames,_configurator2.default.package.main.propertyNames,_configurator2.default.package.aliasPropertyNames);let u;if(t&&(u=_helper2.default.determineAssetType(t,_configurator2.default.build.types,_configurator2.default.path)),'string'==typeof u&&_configurator2.default.build.types[u]){const v=_helper2.default.renderFilePathTemplate(_helper2.default.stripLoader(_configurator2.default.files.compose.javaScript),{'[name]':r});'js'===_configurator2.default.build.types[u].outputExtension&&(yield _clientnode2.default.isFile(v))&&fileSystem.chmodSync(v,'755')}}for(const r of _configurator2.default.path.tidyUp)if(r)try{fileSystem.unlinkSync(r)}catch(s){}}});return function tidyUp(){return q.apply(this,arguments)}})();f.push(p),d.push(new _promise2.default(function(q,r){const s=(_configurator2.default.commandLine.build.arguments||[]).concat(l);console.info('Running "'+(`${_configurator2.default.commandLine.build.command} `+s.join(' ')).trim()+'"');const t=(0,_child_process.spawn)(_configurator2.default.commandLine.build.command,s,b),u=(()=>{var v=(0,_asyncToGenerator3.default)(function*(){for(const w of _configurator2.default.files.additionalPaths){const x=_path2.default.join(_configurator2.default.path.source.base,w);(yield _clientnode2.default.isDirectory(x))?yield _clientnode2.default.copyDirectoryRecursive(x,_configurator2.default.path.target.base):(yield _clientnode2.default.isFile(x))&&(yield _clientnode2.default.copyFile(x,_configurator2.default.path.target.base))}p()});return function copyAdditionalFilesAndTidyUp(){return v.apply(this,arguments)}})();for(const v of _clientnode2.default.closeEventNames)t.on(v,_clientnode2.default.getProcessCloseHandler(q,r,v,'build'===process.argv[2]?u:p));c.push(t)}))}else if(_configurator2.default.library&&'preinstall'===_configurator2.default.givenCommandLineArguments[2]){const o=_helper2.default.determineModuleLocations(_configurator2.default.testInBrowser.injection.internal,_configurator2.default.module.aliases,_configurator2.default.module.replacements.normal,_configurator2.default.extensions,_configurator2.default.path.context,_configurator2.default.path.source.asset.base,_configurator2.default.path.ignore).filePaths;for(const p of m)for(const q of p.filePaths)if(!o.includes(q)){const s=function(t,u,v,w,x,y){return new Function('global','self','buildConfiguration','path','additionalArguments','filePath','return `'+v[_configurator2.default.givenCommandLineArguments[2]].trim()+'`')(t,u,v,w,x,y)}(global,_configurator2.default,p,_path2.default,l,q);console.info(`Running "${s}"`),d.push(new _promise2.default(function(t,u){return _clientnode2.default.handleChildProcess((0,_child_process.exec)(s,b,function(v){return v?u(v):t()}))}))}}const n=function(o){let p=Array.isArray(_configurator2.default.commandLine[o])?_configurator2.default.commandLine[o]:[_configurator2.default.commandLine[o]];for(const q of p){(function(s,t,u){return new Function('global','self','path','return '+(q.hasOwnProperty('indicator')?q.indicator:'true'))(s,t,u)})(global,_configurator2.default,_path2.default)&&d.push(new _promise2.default(function(s,t){const u=(q.arguments||[]).concat(l);console.info('Running "'+(`${q.command} `+u.join(' ')).trim()+'"');const v=(0,_child_process.spawn)(q.command,u,b);for(const w of _clientnode2.default.closeEventNames)v.on(w,_clientnode2.default.getProcessCloseHandler(s,t,w));c.push(v)}))}};['document','test'].includes(_configurator2.default.givenCommandLineArguments[2])?(yield _promise2.default.all(d),n(_configurator2.default.givenCommandLineArguments[2])):['lint','testInBrowser','typeCheck','serve'].includes(_configurator2.default.givenCommandLineArguments[2])&&n(_configurator2.default.givenCommandLineArguments[2])}let g=!1;const h=function(...i){if(!g)for(const j of f)j(...i);g=!0};for(const i of _clientnode2.default.closeEventNames)process.on(i,h);require.main===module&&(3>_configurator2.default.givenCommandLineArguments.length||!e.includes(_configurator2.default.givenCommandLineArguments[2]))&&console.info(`Give one of "${e.join('", "')}" as command `+'line argument. You can provide a json string as second parameter to dynamically overwrite some configurations.\n');try{yield _promise2.default.all(d)}catch(i){process.exit(i.returnCode)}}catch(b){if(_configurator2.default.debug)throw b;else console.error(b)}});return function(){return a.apply(this,arguments)}})();require.main===module&&main().catch((a)=>{throw a}),exports.default=main;

//# sourceMappingURL=data:application/json;base64,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LENBQXdDLENBQXhDLENBRE8sQ0F4VXlDLEVBMlVoRCxFQUFXLHVCQUFjLHlCQUFkLENBQXdDLENBQXhDLENBQVgsQ0FHUCxDQUNELEdBQUksS0FBSixDQUNBLEtBQU0sR0FBZSxTQUFDLElBQUQsQ0FBa0MsQ0FDbkQsR0FBSSxDQUFDLENBQUwsQ0FDSSxJQUFLLEtBQU0sRUFBWCxHQUF5QyxFQUF6QyxDQUNJLEVBQWtCLEdBQUcsQ0FBckIsRUFDUixJQUNILENBTEQsQ0FNQSxJQUFLLEtBQU0sRUFBWCxHQUFvQyxzQkFBTSxlQUExQyxDQUNJLFFBQVEsRUFBUixDQUFXLENBQVgsQ0FBMkIsQ0FBM0IsRUFDQSxRQUFRLElBQVIsR0FBaUIsTUFBakIsR0FDaUQsQ0FBakQsd0JBQWMseUJBQWQsQ0FBd0MsTUFBeEMsRUFDQSxDQUFDLEVBQWtCLFFBQWxCLENBQTJCLHVCQUN2Qix5QkFEdUIsQ0FDRyxDQURILENBQTNCLENBRkQsQ0F0V0osRUEyV0ksUUFBUSxJQUFSLENBQ0ssZ0JBQWUsRUFBa0IsSUFBbEIsQ0FBdUIsTUFBdkIsQ0FBK0IsZUFBL0MsbUhBREosQ0EzV0osQ0FpWEEsR0FBSSxDQUNBLEtBQU0sbUJBQVEsR0FBUixDQUFZLENBQVosQ0FDVCxDQUFDLFFBQWMsQ0FDWixRQUFRLElBQVIsQ0FBYSxFQUFNLFVBQW5CLENBQ0gsQ0FFSixDQUFDLFFBQWMsQ0FDWixHQUFJLHVCQUFjLEtBQWxCLENBQ0ksS0FBTSxFQUFOLENBREosSUFHSSxTQUFRLEtBQVIsQ0FBYyxDQUFkLENBQ1AsQ0FDSixDQTlYSyx1REFBTixDQStYSSxRQUFRLElBQVIsR0FBaUIsTSxFQUNqQixPQUFPLEtBQVAsQ0FBYSxLQUFzQixDQUMvQixLQUFNLEVBQ1QsQ0FGRCxDLGlCQUdXLEkiLCJmaWxlIjoiaW5kZXguY29tcGlsZWQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbi8vIEBmbG93XG4vLyAtKi0gY29kaW5nOiB1dGYtOCAtKi1cbid1c2Ugc3RyaWN0J1xuLyogIVxuICAgIHJlZ2lvbiBoZWFkZXJcbiAgICBDb3B5cmlnaHQgVG9yYmVuIFNpY2tlcnQgKGluZm9bXCJ+YXR+XCJddG9yYmVuLndlYnNpdGUpIDE2LjEyLjIwMTJcblxuICAgIExpY2Vuc2VcbiAgICAtLS0tLS0tXG5cbiAgICBUaGlzIGxpYnJhcnkgd3JpdHRlbiBieSBUb3JiZW4gU2lja2VydCBzdGFuZCB1bmRlciBhIGNyZWF0aXZlIGNvbW1vbnMgbmFtaW5nXG4gICAgMy4wIHVucG9ydGVkIGxpY2Vuc2UuIHNlZSBodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS8zLjAvZGVlZC5kZVxuICAgIGVuZHJlZ2lvblxuKi9cbi8vIHJlZ2lvbiBpbXBvcnRzXG5pbXBvcnQge1xuICAgIENoaWxkUHJvY2VzcywgZXhlYyBhcyBleGVjQ2hpbGRQcm9jZXNzLCBzcGF3biBhcyBzcGF3bkNoaWxkUHJvY2Vzc1xufSBmcm9tICdjaGlsZF9wcm9jZXNzJ1xuaW1wb3J0IFRvb2xzIGZyb20gJ2NsaWVudG5vZGUnXG5pbXBvcnQgdHlwZSB7RmlsZSwgUGxhaW5PYmplY3R9IGZyb20gJ2NsaWVudG5vZGUnXG5pbXBvcnQgKiBhcyBmaWxlU3lzdGVtIGZyb20gJ2ZzJ1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCdcbmltcG9ydCB7c3luYyBhcyByZW1vdmVEaXJlY3RvcnlSZWN1cnNpdmVseVN5bmN9IGZyb20gJ3JpbXJhZidcbi8vIE5PVEU6IE9ubHkgbmVlZGVkIGZvciBkZWJ1Z2dpbmcgdGhpcyBmaWxlLlxudHJ5IHtcbiAgICByZXF1aXJlKCdzb3VyY2UtbWFwLXN1cHBvcnQvcmVnaXN0ZXInKVxufSBjYXRjaCAoZXJyb3IpIHt9XG5cbmltcG9ydCBjb25maWd1cmF0aW9uIGZyb20gJy4vY29uZmlndXJhdG9yLmNvbXBpbGVkJ1xuaW1wb3J0IEhlbHBlciBmcm9tICcuL2hlbHBlci5jb21waWxlZCdcbmltcG9ydCB0eXBlIHtSZXNvbHZlZEJ1aWxkQ29uZmlndXJhdGlvbn0gZnJvbSAnLi90eXBlJ1xuLy8gZW5kcmVnaW9uXG5jb25zdCBtYWluID0gYXN5bmMgKCk6UHJvbWlzZTxhbnk+ID0+IHtcbiAgICB0cnkge1xuICAgICAgICAvLyByZWdpb24gY29udHJvbGxlclxuICAgICAgICBjb25zdCBjaGlsZFByb2Nlc3NPcHRpb25zOk9iamVjdCA9IHtcbiAgICAgICAgICAgIGN3ZDogY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQsXG4gICAgICAgICAgICBlbnY6IHByb2Nlc3MuZW52LFxuICAgICAgICAgICAgc2hlbGw6IHRydWUsXG4gICAgICAgICAgICBzdGRpbzogJ2luaGVyaXQnXG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hpbGRQcm9jZXNzZXM6QXJyYXk8Q2hpbGRQcm9jZXNzPiA9IFtdXG4gICAgICAgIGNvbnN0IHByb2Nlc3NQcm9taXNlczpBcnJheTxQcm9taXNlPGFueT4+ID0gW11cbiAgICAgICAgY29uc3QgcG9zc2libGVBcmd1bWVudHM6QXJyYXk8c3RyaW5nPiA9IFtcbiAgICAgICAgICAgICdidWlsZCcsICdidWlsZERMTCcsICdjbGVhcicsICdkb2N1bWVudCcsICdsaW50JywgJ3ByZWluc3RhbGwnLFxuICAgICAgICAgICAgJ3NlcnZlJywgJ3Rlc3QnLCAndGVzdEluQnJvd3NlcicsICd0eXBlQ2hlY2snXVxuICAgICAgICBjb25zdCBjbG9zZUV2ZW50SGFuZGxlcnM6QXJyYXk8RnVuY3Rpb24+ID0gW11cbiAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50cy5sZW5ndGggPiAyKSB7XG4gICAgICAgICAgICAvLyByZWdpb24gdGVtcG9yYXJ5IHNhdmUgZHluYW1pY2FsbHkgZ2l2ZW4gY29uZmlndXJhdGlvbnNcbiAgICAgICAgICAgIC8vIE5PVEU6IFdlIG5lZWQgYSBjb3B5IG9mIGdpdmVuIGFyZ3VtZW50cyBhcnJheS5cbiAgICAgICAgICAgIGxldCBkeW5hbWljQ29uZmlndXJhdGlvbjpQbGFpbk9iamVjdCA9IHtnaXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzOlxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50cy5zbGljZSgpfVxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50cy5sZW5ndGggPiAzICYmXG4gICAgICAgICAgICAgICAgVG9vbHMuc3RyaW5nUGFyc2VFbmNvZGVkT2JqZWN0KFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHNbXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHMubGVuZ3RoIC0gMV0sXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24sICdjb25maWd1cmF0aW9uJylcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHMucG9wKClcbiAgICAgICAgICAgIGxldCBjb3VudDpudW1iZXIgPSAwXG4gICAgICAgICAgICBsZXQgZmlsZVBhdGg6c3RyaW5nID0gYCR7Y29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHR9LmAgK1xuICAgICAgICAgICAgICAgIGBkeW5hbWljQ29uZmlndXJhdGlvbi0ke2NvdW50fS5qc29uYFxuICAgICAgICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgICAgICAgICBmaWxlUGF0aCA9IGAke2NvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0fS5gICtcbiAgICAgICAgICAgICAgICAgICAgYGR5bmFtaWNDb25maWd1cmF0aW9uLSR7Y291bnR9Lmpzb25gXG4gICAgICAgICAgICAgICAgaWYgKCEoYXdhaXQgVG9vbHMuaXNGaWxlKGZpbGVQYXRoKSkpXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgY291bnQgKz0gMVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZmlsZVN5c3RlbS53cml0ZUZpbGVTeW5jKGZpbGVQYXRoLCBKU09OLnN0cmluZ2lmeShcbiAgICAgICAgICAgICAgICBkeW5hbWljQ29uZmlndXJhdGlvbikpXG4gICAgICAgICAgICBjb25zdCBhZGRpdGlvbmFsQXJndW1lbnRzOkFycmF5PHN0cmluZz4gPSBwcm9jZXNzLmFyZ3Yuc3BsaWNlKDMpXG4gICAgICAgICAgICAvLyAvIHJlZ2lvbiByZWdpc3RlciBleGl0IGhhbmRsZXIgdG8gdGlkeSB1cFxuICAgICAgICAgICAgY2xvc2VFdmVudEhhbmRsZXJzLnB1c2goZnVuY3Rpb24oZXJyb3I6P0Vycm9yKTo/RXJyb3Ige1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVTeXN0ZW0udW5saW5rU3luYyhmaWxlUGF0aClcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge31cbiAgICAgICAgICAgICAgICBpZiAoZXJyb3IpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IGVycm9yXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy8gLyBlbmRyZWdpb25cbiAgICAgICAgICAgIC8vIGVuZHJlZ2lvblxuICAgICAgICAgICAgLy8gcmVnaW9uIGhhbmRsZSBjbGVhclxuICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICBOT1RFOiBBIGJ1aWxkLHNlcnZlIG9yIHRlc3QgaW4gYnJvd3NlciBjb3VsZCBkZXBlbmQgb25cbiAgICAgICAgICAgICAgICBwcmV2aW91c2x5IGNyZWF0ZWQgZGxsIHBhY2thZ2VzIHNvIGEgY2xlYW4gc2hvdWxkIG5vdCBiZVxuICAgICAgICAgICAgICAgIHBlcmZvcm1lZCBpbiB0aGF0IGNhc2UuXG4gICAgICAgICAgICAgICAgTk9URTogSWYgd2UgaGF2ZSBkZXBlbmRlbmN5IGN5Y2xlIGl0IG5lZWRlZCB0byBwcmVzZXJ2ZSBmaWxlc1xuICAgICAgICAgICAgICAgIGR1cmluZyBwcmVpbnN0YWxsIHBoYXNlLlxuICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGlmICghW1xuICAgICAgICAgICAgICAgICdidWlsZCcsICdwcmVpbnN0YWxsJywgJ3NlcnZlJywgJ3Rlc3QnLCAndGVzdEluQnJvd3NlcidcbiAgICAgICAgICAgIF0uaW5jbHVkZXMoY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzWzJdKSAmJlxuICAgICAgICAgICAgcG9zc2libGVBcmd1bWVudHMuaW5jbHVkZXMoXG4gICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzWzJdXG4gICAgICAgICAgICApKSB7XG4gICAgICAgICAgICAgICAgaWYgKHBhdGgucmVzb2x2ZShcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLnRhcmdldC5iYXNlXG4gICAgICAgICAgICAgICAgKSA9PT0gcGF0aC5yZXNvbHZlKGNvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0KSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmVzIGFsbCBjb21waWxlZCBmaWxlcy5cbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgVG9vbHMud2Fsa0RpcmVjdG9yeVJlY3Vyc2l2ZWx5KFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLnRhcmdldC5iYXNlLCAoZmlsZTpGaWxlKTo/ZmFsc2UgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChIZWxwZXIuaXNGaWxlUGF0aEluTG9jYXRpb24oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUucGF0aCwgY29uZmlndXJhdGlvbi5wYXRoLmlnbm9yZS5jb25jYXQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLm1vZHVsZS5kaXJlY3RvcnlOYW1lcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ubG9hZGVyLmRpcmVjdG9yeU5hbWVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkubWFwKChmaWxlUGF0aDpzdHJpbmcpOnN0cmluZyA9PiBwYXRoLnJlc29sdmUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguY29udGV4dCwgZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkuZmlsdGVyKChmaWxlUGF0aDpzdHJpbmcpOmJvb2xlYW4gPT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICFjb25maWd1cmF0aW9uLnBhdGguY29udGV4dC5zdGFydHNXaXRoKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVQYXRoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0eXBlOnN0cmluZyBpbiBjb25maWd1cmF0aW9uLmJ1aWxkLnR5cGVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3IFJlZ0V4cChjb25maWd1cmF0aW9uLmJ1aWxkLnR5cGVzW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLmZpbGVQYXRoUGF0dGVybikudGVzdChmaWxlLnBhdGgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZS5zdGF0LmlzRGlyZWN0b3J5KCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVEaXJlY3RvcnlSZWN1cnNpdmVseVN5bmMoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUucGF0aCwge2dsb2I6IGZhbHNlfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVTeXN0ZW0udW5saW5rU3luYyhmaWxlLnBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGZpbGVOYW1lOnN0cmluZyBvZiBmaWxlU3lzdGVtLnJlYWRkaXJTeW5jKFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLnRhcmdldC5iYXNlXG4gICAgICAgICAgICAgICAgICAgICkpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZU5hbWUubGVuZ3RoID4gJy5kbGwtbWFuaWZlc3QuanNvbicubGVuZ3RoICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZU5hbWUuZW5kc1dpdGgoJy5kbGwtbWFuaWZlc3QuanNvbicpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZU5hbWUuc3RhcnRzV2l0aCgnbnBtLWRlYnVnJylcbiAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlU3lzdGVtLnVubGlua1N5bmMocGF0aC5yZXNvbHZlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGgudGFyZ2V0LmJhc2UsIGZpbGVOYW1lKSlcbiAgICAgICAgICAgICAgICB9IGVsc2VcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlRGlyZWN0b3J5UmVjdXJzaXZlbHlTeW5jKFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLnRhcmdldC5iYXNlLCB7Z2xvYjogZmFsc2V9KVxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZURpcmVjdG9yeVJlY3Vyc2l2ZWx5U3luYyhcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC5hcGlEb2N1bWVudGF0aW9uLCB7Z2xvYjogZmFsc2V9KVxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7fVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gZW5kcmVnaW9uXG4gICAgICAgICAgICAvLyByZWdpb24gaGFuZGxlIGJ1aWxkXG4gICAgICAgICAgICBjb25zdCBidWlsZENvbmZpZ3VyYXRpb25zOlJlc29sdmVkQnVpbGRDb25maWd1cmF0aW9uID1cbiAgICAgICAgICAgICAgICBIZWxwZXIucmVzb2x2ZUJ1aWxkQ29uZmlndXJhdGlvbkZpbGVQYXRocyhcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5idWlsZC50eXBlcyxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLnNvdXJjZS5hc3NldC5iYXNlLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguaWdub3JlLmNvbmNhdChcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ubW9kdWxlLmRpcmVjdG9yeU5hbWVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5sb2FkZXIuZGlyZWN0b3J5TmFtZXNcbiAgICAgICAgICAgICAgICAgICAgKS5tYXAoKGZpbGVQYXRoOnN0cmluZyk6c3RyaW5nID0+IHBhdGgucmVzb2x2ZShcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0LCBmaWxlUGF0aClcbiAgICAgICAgICAgICAgICAgICAgKS5maWx0ZXIoKGZpbGVQYXRoOnN0cmluZyk6Ym9vbGVhbiA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgIWNvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0LnN0YXJ0c1dpdGgoZmlsZVBhdGgpKSxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYWNrYWdlLm1haW4uZmlsZU5hbWVzKVxuICAgICAgICAgICAgaWYgKFsnYnVpbGQnLCAnYnVpbGRETEwnLCAnZG9jdW1lbnQnLCAndGVzdCddLmluY2x1ZGVzKFxuICAgICAgICAgICAgICAgIHByb2Nlc3MuYXJndlsyXVxuICAgICAgICAgICAgKSkge1xuICAgICAgICAgICAgICAgIGxldCB0aWRpZWRVcDpib29sZWFuID0gZmFsc2VcbiAgICAgICAgICAgICAgICBjb25zdCB0aWR5VXA6RnVuY3Rpb24gPSBhc3luYyAoKTpQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgICAgICAgIERldGVybWluZXMgYWxsIG5vbmUgamF2YVNjcmlwdCBlbnRpdGllcyB3aGljaCBoYXZlIGJlZW5cbiAgICAgICAgICAgICAgICAgICAgICAgIGVtaXR0ZWQgYXMgc2luZ2xlIGphdmFTY3JpcHQgbW9kdWxlIHRvIHJlbW92ZS5cbiAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRpZGllZFVwKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAgICAgICAgIHRpZGllZFVwID0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICBmb3IgKFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2h1bmtOYW1lOnN0cmluZyBpblxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5pbmplY3Rpb24uaW50ZXJuYWwubm9ybWFsaXplZFxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5pbmplY3Rpb24uaW50ZXJuYWwubm9ybWFsaXplZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuaGFzT3duUHJvcGVydHkoY2h1bmtOYW1lKVxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1vZHVsZUlEOnN0cmluZyBvZiBjb25maWd1cmF0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuaW5qZWN0aW9uLmludGVybmFsLm5vcm1hbGl6ZWRbY2h1bmtOYW1lXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlUGF0aDo/c3RyaW5nID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhlbHBlci5kZXRlcm1pbmVNb2R1bGVGaWxlUGF0aChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGVJRCwgY29uZmlndXJhdGlvbi5tb2R1bGUuYWxpYXNlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLm1vZHVsZS5yZXBsYWNlbWVudHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm5vcm1hbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmV4dGVuc2lvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLnNvdXJjZS5hc3NldC5iYXNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC5pZ25vcmUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5tb2R1bGUuZGlyZWN0b3J5TmFtZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYWNrYWdlLm1haW4uZmlsZU5hbWVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGFja2FnZS5tYWluXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5wcm9wZXJ0eU5hbWVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGFja2FnZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWxpYXNQcm9wZXJ0eU5hbWVzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdHlwZTo/c3RyaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWxlUGF0aClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSBIZWxwZXIuZGV0ZXJtaW5lQXNzZXRUeXBlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVQYXRoLCBjb25maWd1cmF0aW9uLmJ1aWxkLnR5cGVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZW9mIHR5cGUgPT09ICdzdHJpbmcnICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmJ1aWxkLnR5cGVzW3R5cGVdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZVBhdGg6c3RyaW5nID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWxwZXIucmVuZGVyRmlsZVBhdGhUZW1wbGF0ZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVscGVyLnN0cmlwTG9hZGVyKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5maWxlcy5jb21wb3NlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmphdmFTY3JpcHRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSwgeydbbmFtZV0nOiBjaHVua05hbWV9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb24uYnVpbGQudHlwZXNbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXS5vdXRwdXRFeHRlbnNpb24gPT09ICdqcycgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IFRvb2xzLmlzRmlsZShmaWxlUGF0aCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVN5c3RlbS5jaG1vZFN5bmMoZmlsZVBhdGgsICc3NTUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGZpbGVQYXRoOj9zdHJpbmcgb2YgY29uZmlndXJhdGlvbi5wYXRoLnRpZHlVcClcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWxlUGF0aClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlU3lzdGVtLnVubGlua1N5bmMoZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHt9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNsb3NlRXZlbnRIYW5kbGVycy5wdXNoKHRpZHlVcClcbiAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgICBUcmlnZ2VycyBjb21wbGV0ZSBhc3NldCBjb21waWxpbmcgYW5kIGJ1bmRsZXMgdGhlbSBpbnRvIHRoZVxuICAgICAgICAgICAgICAgICAgICBmaW5hbCBwcm9kdWN0aXZlIG91dHB1dC5cbiAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIHByb2Nlc3NQcm9taXNlcy5wdXNoKG5ldyBQcm9taXNlKChcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZTpGdW5jdGlvbiwgcmVqZWN0OkZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgKTp2b2lkID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tbWFuZExpbmVBcmd1bWVudHM6QXJyYXk8c3RyaW5nPiA9IChcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uY29tbWFuZExpbmUuYnVpbGQuYXJndW1lbnRzIHx8IFtdXG4gICAgICAgICAgICAgICAgICAgICkuY29uY2F0KGFkZGl0aW9uYWxBcmd1bWVudHMpXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbygnUnVubmluZyBcIicgKyAoXG4gICAgICAgICAgICAgICAgICAgICAgICBgJHtjb25maWd1cmF0aW9uLmNvbW1hbmRMaW5lLmJ1aWxkLmNvbW1hbmR9IGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZExpbmVBcmd1bWVudHMuam9pbignICcpXG4gICAgICAgICAgICAgICAgICAgICkudHJpbSgpICsgJ1wiJylcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGRQcm9jZXNzOkNoaWxkUHJvY2VzcyA9IHNwYXduQ2hpbGRQcm9jZXNzKFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5jb21tYW5kTGluZS5idWlsZC5jb21tYW5kLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZExpbmVBcmd1bWVudHMsIGNoaWxkUHJvY2Vzc09wdGlvbnMpXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvcHlBZGRpdGlvbmFsRmlsZXNBbmRUaWR5VXA6RnVuY3Rpb24gPSBhc3luYyAoXG4gICAgICAgICAgICAgICAgICAgICk6UHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVQYXRoOnN0cmluZyBvZlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZmlsZXMuYWRkaXRpb25hbFBhdGhzXG4gICAgICAgICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2VQYXRoOnN0cmluZyA9IHBhdGguam9pbihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLnNvdXJjZS5iYXNlLCBmaWxlUGF0aClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXdhaXQgVG9vbHMuaXNEaXJlY3Rvcnkoc291cmNlUGF0aCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IFRvb2xzLmNvcHlEaXJlY3RvcnlSZWN1cnNpdmUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VQYXRoLCBjb25maWd1cmF0aW9uLnBhdGgudGFyZ2V0LmJhc2UpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoYXdhaXQgVG9vbHMuaXNGaWxlKHNvdXJjZVBhdGgpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBUb29scy5jb3B5RmlsZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZVBhdGgsIGNvbmZpZ3VyYXRpb24ucGF0aC50YXJnZXQuYmFzZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRpZHlVcCgpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBjbG9zZUV2ZW50TmFtZTpzdHJpbmcgb2YgVG9vbHMuY2xvc2VFdmVudE5hbWVzKVxuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRQcm9jZXNzLm9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlRXZlbnROYW1lLCBUb29scy5nZXRQcm9jZXNzQ2xvc2VIYW5kbGVyKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlLCByZWplY3QsIGNsb3NlRXZlbnROYW1lLCAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLmFyZ3ZbMl0gPT09ICdidWlsZCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSA/IGNvcHlBZGRpdGlvbmFsRmlsZXNBbmRUaWR5VXAgOiB0aWR5VXApKVxuICAgICAgICAgICAgICAgICAgICBjaGlsZFByb2Nlc3Nlcy5wdXNoKGNoaWxkUHJvY2VzcylcbiAgICAgICAgICAgICAgICB9KSlcbiAgICAgICAgICAgIC8vIGVuZHJlZ2lvblxuICAgICAgICAgICAgLy8gcmVnaW9uIGhhbmRsZSBwcmVpbnN0YWxsXG4gICAgICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ubGlicmFyeSAmJlxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXSA9PT0gJ3ByZWluc3RhbGwnXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAvLyBQZXJmb3JtIGFsbCBmaWxlIHNwZWNpZmljIHByZXByb2Nlc3Npbmcgc3R1ZmYuXG4gICAgICAgICAgICAgICAgY29uc3QgdGVzdE1vZHVsZUZpbGVQYXRoczpBcnJheTxzdHJpbmc+ID1cbiAgICAgICAgICAgICAgICAgICAgSGVscGVyLmRldGVybWluZU1vZHVsZUxvY2F0aW9ucyhcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24udGVzdEluQnJvd3Nlci5pbmplY3Rpb24uaW50ZXJuYWwsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLm1vZHVsZS5hbGlhc2VzLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5tb2R1bGUucmVwbGFjZW1lbnRzLm5vcm1hbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZXh0ZW5zaW9ucywgY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguc291cmNlLmFzc2V0LmJhc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguaWdub3JlXG4gICAgICAgICAgICAgICAgICAgICkuZmlsZVBhdGhzXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBidWlsZENvbmZpZ3VyYXRpb24gb2YgYnVpbGRDb25maWd1cmF0aW9ucylcbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBmaWxlUGF0aDpzdHJpbmcgb2YgYnVpbGRDb25maWd1cmF0aW9uLmZpbGVQYXRocylcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGVzdE1vZHVsZUZpbGVQYXRocy5pbmNsdWRlcyhmaWxlUGF0aCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBldmFsdWF0aW9uRnVuY3Rpb24gPSAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbDpPYmplY3QsIHNlbGY6UGxhaW5PYmplY3QsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1aWxkQ29uZmlndXJhdGlvbjpQbGFpbk9iamVjdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDp0eXBlb2YgcGF0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkaXRpb25hbEFyZ3VtZW50czpBcnJheTxzdHJpbmc+LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlUGF0aDpzdHJpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOnN0cmluZyA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmVUeXBlQ2hlY2tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEZ1bmN0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2dsb2JhbCcsICdzZWxmJywgJ2J1aWxkQ29uZmlndXJhdGlvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGF0aCcsICdhZGRpdGlvbmFsQXJndW1lbnRzJywgJ2ZpbGVQYXRoJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZXR1cm4gYCcgKyBidWlsZENvbmZpZ3VyYXRpb25bXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXS50cmltKCkgKyAnYCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbCwgc2VsZiwgYnVpbGRDb25maWd1cmF0aW9uLCBwYXRoLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkaXRpb25hbEFyZ3VtZW50cywgZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tbWFuZDpzdHJpbmcgPSBldmFsdWF0aW9uRnVuY3Rpb24oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbCwgY29uZmlndXJhdGlvbiwgYnVpbGRDb25maWd1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoLCBhZGRpdGlvbmFsQXJndW1lbnRzLCBmaWxlUGF0aClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oYFJ1bm5pbmcgXCIke2NvbW1hbmR9XCJgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NQcm9taXNlcy5wdXNoKG5ldyBQcm9taXNlKChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZTpGdW5jdGlvbiwgcmVqZWN0OkZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTp2b2lkID0+IFRvb2xzLmhhbmRsZUNoaWxkUHJvY2VzcyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhlY0NoaWxkUHJvY2VzcyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQsIGNoaWxkUHJvY2Vzc09wdGlvbnMsIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjo/RXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk6dm9pZCA9PiBlcnJvciA/IHJlamVjdChlcnJvcikgOiByZXNvbHZlKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSkpKVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gZW5kcmVnaW9uXG4gICAgICAgICAgICAvLyByZWdpb24gaGFuZGxlIHJlbWFpbmluZyB0YXNrc1xuICAgICAgICAgICAgY29uc3QgaGFuZGxlVGFzayA9ICh0eXBlOnN0cmluZyk6dm9pZCA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IHRhc2tzOkFycmF5PE9iamVjdD5cbiAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjb25maWd1cmF0aW9uLmNvbW1hbmRMaW5lW3R5cGVdKSlcbiAgICAgICAgICAgICAgICAgICAgdGFza3MgPSBjb25maWd1cmF0aW9uLmNvbW1hbmRMaW5lW3R5cGVdXG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICB0YXNrcyA9IFtjb25maWd1cmF0aW9uLmNvbW1hbmRMaW5lW3R5cGVdXVxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdGFzazpPYmplY3Qgb2YgdGFza3MpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXZhbHVhdGlvbkZ1bmN0aW9uID0gKFxuICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsOk9iamVjdCwgc2VsZjpQbGFpbk9iamVjdCwgcGF0aDp0eXBlb2YgcGF0aFxuICAgICAgICAgICAgICAgICAgICApOmJvb2xlYW4gPT5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElnbm9yZVR5cGVDaGVja1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEZ1bmN0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdnbG9iYWwnLCAnc2VsZicsICdwYXRoJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmV0dXJuICcgKyAodGFzay5oYXNPd25Qcm9wZXJ0eShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2luZGljYXRvcidcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApID8gdGFzay5pbmRpY2F0b3IgOiAndHJ1ZScpXG4gICAgICAgICAgICAgICAgICAgICAgICApKGdsb2JhbCwgc2VsZiwgcGF0aClcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2YWx1YXRpb25GdW5jdGlvbihnbG9iYWwsIGNvbmZpZ3VyYXRpb24sIHBhdGgpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1Byb21pc2VzLnB1c2gobmV3IFByb21pc2UoKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6RnVuY3Rpb24sIHJlamVjdDpGdW5jdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgKTp2b2lkID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21tYW5kTGluZUFyZ3VtZW50czpBcnJheTxzdHJpbmc+ID0gKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLmFyZ3VtZW50cyB8fCBbXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICkuY29uY2F0KGFkZGl0aW9uYWxBcmd1bWVudHMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKCdSdW5uaW5nIFwiJyArIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYCR7dGFzay5jb21tYW5kfSBgICsgY29tbWFuZExpbmVBcmd1bWVudHMuam9pbihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApLnRyaW0oKSArICdcIicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGRQcm9jZXNzOkNoaWxkUHJvY2VzcyA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYXduQ2hpbGRQcm9jZXNzKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay5jb21tYW5kLCBjb21tYW5kTGluZUFyZ3VtZW50cyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkUHJvY2Vzc09wdGlvbnMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2xvc2VFdmVudE5hbWU6c3RyaW5nIG9mXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRvb2xzLmNsb3NlRXZlbnROYW1lc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRQcm9jZXNzLm9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VFdmVudE5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUb29scy5nZXRQcm9jZXNzQ2xvc2VIYW5kbGVyKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUsIHJlamVjdCwgY2xvc2VFdmVudE5hbWUpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkUHJvY2Vzc2VzLnB1c2goY2hpbGRQcm9jZXNzKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gLyByZWdpb24gYS0vc3luY2hyb25vdXNcbiAgICAgICAgICAgIGlmIChbJ2RvY3VtZW50JywgJ3Rlc3QnXS5pbmNsdWRlcyhcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHNbMl1cbiAgICAgICAgICAgICkpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9jZXNzUHJvbWlzZXMpXG4gICAgICAgICAgICAgICAgaGFuZGxlVGFzayhjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHNbMl0pXG4gICAgICAgICAgICB9IGVsc2UgaWYgKFsnbGludCcsICd0ZXN0SW5Ccm93c2VyJywgJ3R5cGVDaGVjaycsICdzZXJ2ZSddLmluY2x1ZGVzKFxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXVxuICAgICAgICAgICAgKSlcbiAgICAgICAgICAgICAgICBoYW5kbGVUYXNrKGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXSlcbiAgICAgICAgICAgIC8vIC8gZW5kcmVnaW9uXG4gICAgICAgICAgICAvLyBlbmRyZWdpb25cbiAgICAgICAgfVxuICAgICAgICBsZXQgZmluaXNoZWQ6Ym9vbGVhbiA9IGZhbHNlXG4gICAgICAgIGNvbnN0IGNsb3NlSGFuZGxlciA9ICguLi5wYXJhbWV0ZXI6QXJyYXk8YW55Pik6dm9pZCA9PiB7XG4gICAgICAgICAgICBpZiAoIWZpbmlzaGVkKVxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgY2xvc2VFdmVudEhhbmRsZXI6RnVuY3Rpb24gb2YgY2xvc2VFdmVudEhhbmRsZXJzKVxuICAgICAgICAgICAgICAgICAgICBjbG9zZUV2ZW50SGFuZGxlciguLi5wYXJhbWV0ZXIpXG4gICAgICAgICAgICBmaW5pc2hlZCA9IHRydWVcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IGNsb3NlRXZlbnROYW1lOnN0cmluZyBvZiBUb29scy5jbG9zZUV2ZW50TmFtZXMpXG4gICAgICAgICAgICBwcm9jZXNzLm9uKGNsb3NlRXZlbnROYW1lLCBjbG9zZUhhbmRsZXIpXG4gICAgICAgIGlmIChyZXF1aXJlLm1haW4gPT09IG1vZHVsZSAmJiAoXG4gICAgICAgICAgICBjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHMubGVuZ3RoIDwgMyB8fFxuICAgICAgICAgICAgIXBvc3NpYmxlQXJndW1lbnRzLmluY2x1ZGVzKGNvbmZpZ3VyYXRpb25cbiAgICAgICAgICAgICAgICAuZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXSlcbiAgICAgICAgKSlcbiAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcbiAgICAgICAgICAgICAgICBgR2l2ZSBvbmUgb2YgXCIke3Bvc3NpYmxlQXJndW1lbnRzLmpvaW4oJ1wiLCBcIicpfVwiIGFzIGNvbW1hbmQgYCArXG4gICAgICAgICAgICAgICAgJ2xpbmUgYXJndW1lbnQuIFlvdSBjYW4gcHJvdmlkZSBhIGpzb24gc3RyaW5nIGFzIHNlY29uZCAnICtcbiAgICAgICAgICAgICAgICAncGFyYW1ldGVyIHRvIGR5bmFtaWNhbGx5IG92ZXJ3cml0ZSBzb21lIGNvbmZpZ3VyYXRpb25zLlxcbicpXG4gICAgICAgIC8vIGVuZHJlZ2lvblxuICAgICAgICAvLyByZWdpb24gZm9yd2FyZCBuZXN0ZWQgcmV0dXJuIGNvZGVzXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9jZXNzUHJvbWlzZXMpXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBwcm9jZXNzLmV4aXQoZXJyb3IucmV0dXJuQ29kZSlcbiAgICAgICAgfVxuICAgICAgICAvLyBlbmRyZWdpb25cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBpZiAoY29uZmlndXJhdGlvbi5kZWJ1ZylcbiAgICAgICAgICAgIHRocm93IGVycm9yXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpXG4gICAgfVxufVxuaWYgKHJlcXVpcmUubWFpbiA9PT0gbW9kdWxlKVxuICAgIG1haW4oKS5jYXRjaCgoZXJyb3I6RXJyb3IpOnZvaWQgPT4ge1xuICAgICAgICB0aHJvdyBlcnJvclxuICAgIH0pXG5leHBvcnQgZGVmYXVsdCBtYWluXG4vLyByZWdpb24gdmltIG1vZGxpbmVcbi8vIHZpbTogc2V0IHRhYnN0b3A9NCBzaGlmdHdpZHRoPTQgZXhwYW5kdGFiOlxuLy8gdmltOiBmb2xkbWV0aG9kPW1hcmtlciBmb2xkbWFya2VyPXJlZ2lvbixlbmRyZWdpb246XG4vLyBlbmRyZWdpb25cbiJdfQ==