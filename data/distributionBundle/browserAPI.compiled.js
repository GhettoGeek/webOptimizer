'use strict';Object.defineProperty(exports,'__esModule',{value:!0});const onCreatedListener=[];let browserAPI;if('undefined'==typeof TARGET_TECHNOLOGY||'node'===TARGET_TECHNOLOGY){const a=require('path'),b=require('jsdom'),c=b.createVirtualConsole().sendTo(console,{omitJsdomErrors:!0});c.on('jsdomError',function(e){!browserAPI.debug&&['XMLHttpRequest','resource loading'].includes(e.type)?console.warn(`Loading resource failed: ${e.toString()}.`):console.error(e.stack,e.detail)});const d=function render(e){return b.env({created:function created(f,g){if(browserAPI={debug:!1,domContentLoaded:!1,metaDOM:b,window:g,windowLoaded:!1},g.document.addEventListener('DOMContentLoaded',function(){browserAPI.domContentLoaded=!0}),f)throw f;else for(const h of onCreatedListener)h(browserAPI,!1)},features:{FetchExternalResources:['script','frame','iframe','link','img'],ProcessExternalResources:['script'],SkipExternalResources:!1},html:e,onload:function onload(){browserAPI.domContentLoaded=!0,browserAPI.windowLoaded=!0},resourceLoader:function resourceLoader(f,g){return'localhost'===f.url.hostname&&(f.url.host=f.url.hostname='',f.url.port=null,f.url.protocol='file:',f.url.href=f.url.href.replace(/^[a-zA-Z]+:\/\/localhost(?::[0-9]+)?/,`file://${process.cwd()}`),f.url.path=f.url.pathname=a.join(process.cwd(),f.url.path)),browserAPI.debug&&console.info(`Load resource "${f.url.href}".`),f.defaultFetch(function(h,...i){h||g(h,...i)})},url:'http://localhost',virtualConsole:c})};if('undefined'==typeof NAME||'webOptimizer'===NAME){const e=a.join(__dirname,'index.html.ejs');require('fs').readFile(e,{encoding:'utf-8'},function(f,g){if(f)throw f;d(require('./ejsLoader.compiled').bind({filename:e})(g))})}else d(require('webOptimizerDefaultTemplateFilePath'))}else browserAPI={debug:!1,domContentLoaded:!1,metaDOM:null,window,windowLoaded:!1},window.document.addEventListener('DOMContentLoaded',function(){browserAPI.domContentLoaded=!0;for(const a of onCreatedListener)a(browserAPI,!1)}),window.addEventListener('load',function(){browserAPI.windowLoaded=!0});exports.default=function(a,b=!0){const c=function wrappedCallback(...d){return b&&'undefined'!=typeof global&&global!==browserAPI.window&&(global.window=browserAPI.window),a(...d)};return'undefined'==typeof TARGET_TECHNOLOGY||'node'===TARGET_TECHNOLOGY?browserAPI?c(browserAPI,!0):onCreatedListener.push(c):browserAPI.domContentLoaded?c(browserAPI,!0):onCreatedListener.push(c)};

//# sourceMappingURL=data:application/json;charset=utf-8;base64,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IyEvdXNyL2Jpbi9lbnYgbm9kZVxuLy8gQGZsb3dcbi8vIC0qLSBjb2Rpbmc6IHV0Zi04IC0qLVxuJ3VzZSBzdHJpY3QnXG4vKiAhXG4gICAgcmVnaW9uIGhlYWRlclxuICAgIENvcHlyaWdodCBUb3JiZW4gU2lja2VydCAoaW5mb1tcIn5hdH5cIl10b3JiZW4ud2Vic2l0ZSkgMTYuMTIuMjAxMlxuXG4gICAgTGljZW5zZVxuICAgIC0tLS0tLS1cblxuICAgIFRoaXMgbGlicmFyeSB3cml0dGVuIGJ5IFRvcmJlbiBTaWNrZXJ0IHN0YW5kIHVuZGVyIGEgY3JlYXRpdmUgY29tbW9ucyBuYW1pbmdcbiAgICAzLjAgdW5wb3J0ZWQgbGljZW5zZS4gc2VlIGh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LzMuMC9kZWVkLmRlXG4gICAgZW5kcmVnaW9uXG4qL1xuLy8gcmVnaW9uIGltcG9ydHNcbmltcG9ydCB0eXBlIHtEb21Ob2RlLCBXaW5kb3d9IGZyb20gJ2NsaWVudG5vZGUnXG5pbXBvcnQgdHlwZSB7QnJvd3NlckFQSX0gZnJvbSAnLi90eXBlJ1xuLy8gZW5kcmVnaW9uXG4vLyByZWdpb24gZGVjbGFyYXRpb25cbi8vIE5PVEU6IFByb2R1Y2VzIGEgYmFiZWwgZXJyb3IgeWV0LlxuLy8gZGVjbGFyZSB2YXIgTkFNRTpzdHJpbmdcbi8vIGRlY2xhcmUgdmFyIFRBUkdFVF9URUNITk9MT0dZOnN0cmluZ1xuZGVjbGFyZSB2YXIgd2luZG93OldpbmRvd1xuLy8gZW5kcmVnaW9uXG4vLyByZWdpb24gdmFyaWFibGVzXG5jb25zdCBvbkNyZWF0ZWRMaXN0ZW5lcjpBcnJheTxGdW5jdGlvbj4gPSBbXVxubGV0IGJyb3dzZXJBUEk6QnJvd3NlckFQSVxuLy8gZW5kcmVnaW9uXG4vLyByZWdpb24gZW5zdXJlIHByZXNlbmNlIG9mIGNvbW1vbiBicm93c2VyIGVudmlyb25tZW50XG5pZiAodHlwZW9mIFRBUkdFVF9URUNITk9MT0dZID09PSAndW5kZWZpbmVkJyB8fCBUQVJHRVRfVEVDSE5PTE9HWSA9PT0gJ25vZGUnKSB7XG4gICAgLy8gcmVnaW9uIG1vY2sgYnJvd3NlciBlbnZpcm9ubWVudFxuICAgIGNvbnN0IHBhdGg6T2JqZWN0ID0gcmVxdWlyZSgncGF0aCcpXG4gICAgY29uc3QgbWV0YURPTTpPYmplY3QgPSByZXF1aXJlKCdqc2RvbScpXG4gICAgY29uc3QgdmlydHVhbENvbnNvbGU6T2JqZWN0ID0gbWV0YURPTS5jcmVhdGVWaXJ0dWFsQ29uc29sZSgpLnNlbmRUbyhcbiAgICAgICAgY29uc29sZSwge29taXRKc2RvbUVycm9yczogdHJ1ZX0pXG4gICAgdmlydHVhbENvbnNvbGUub24oJ2pzZG9tRXJyb3InLCAoZXJyb3I6RXJyb3IpOnZvaWQgPT4ge1xuICAgICAgICBpZiAoIWJyb3dzZXJBUEkuZGVidWcgJiYgW1xuICAgICAgICAgICAgJ1hNTEh0dHBSZXF1ZXN0JywgJ3Jlc291cmNlIGxvYWRpbmcnXG4gICAgICAgIC8vIElnbm9yZVR5cGVDaGVja1xuICAgICAgICBdLmluY2x1ZGVzKGVycm9yLnR5cGUpKVxuICAgICAgICAgICAgY29uc29sZS53YXJuKGBMb2FkaW5nIHJlc291cmNlIGZhaWxlZDogJHtlcnJvci50b1N0cmluZygpfS5gKVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICAvLyBJZ25vcmVUeXBlQ2hlY2tcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3Iuc3RhY2ssIGVycm9yLmRldGFpbClcbiAgICB9KVxuICAgIGNvbnN0IHJlbmRlcjpGdW5jdGlvbiA9ICh0ZW1wbGF0ZTpzdHJpbmcpOnZvaWQgPT4gbWV0YURPTS5lbnYoe1xuICAgICAgICBjcmVhdGVkOiAoZXJyb3I6P0Vycm9yLCB3aW5kb3c6V2luZG93KTp2b2lkID0+IHtcbiAgICAgICAgICAgIGJyb3dzZXJBUEkgPSB7XG4gICAgICAgICAgICAgICAgZGVidWc6IGZhbHNlLCBkb21Db250ZW50TG9hZGVkOiBmYWxzZSwgbWV0YURPTSwgd2luZG93LFxuICAgICAgICAgICAgICAgIHdpbmRvd0xvYWRlZDogZmFsc2V9XG4gICAgICAgICAgICB3aW5kb3cuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpOnZvaWQgPT4ge1xuICAgICAgICAgICAgICAgIGJyb3dzZXJBUEkuZG9tQ29udGVudExvYWRlZCA9IHRydWVcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICBpZiAoZXJyb3IpXG4gICAgICAgICAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGNhbGxiYWNrOkZ1bmN0aW9uIG9mIG9uQ3JlYXRlZExpc3RlbmVyKVxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhicm93c2VyQVBJLCBmYWxzZSlcbiAgICAgICAgfSxcbiAgICAgICAgZmVhdHVyZXM6IHtcbiAgICAgICAgICAgIEZldGNoRXh0ZXJuYWxSZXNvdXJjZXM6IFtcbiAgICAgICAgICAgICAgICAnc2NyaXB0JywgJ2ZyYW1lJywgJ2lmcmFtZScsICdsaW5rJywgJ2ltZydcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBQcm9jZXNzRXh0ZXJuYWxSZXNvdXJjZXM6IFsnc2NyaXB0J10sXG4gICAgICAgICAgICBTa2lwRXh0ZXJuYWxSZXNvdXJjZXM6IGZhbHNlXG4gICAgICAgIH0sXG4gICAgICAgIGh0bWw6IHRlbXBsYXRlLFxuICAgICAgICBvbmxvYWQ6ICgpOnZvaWQgPT4ge1xuICAgICAgICAgICAgYnJvd3NlckFQSS5kb21Db250ZW50TG9hZGVkID0gdHJ1ZVxuICAgICAgICAgICAgYnJvd3NlckFQSS53aW5kb3dMb2FkZWQgPSB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIHJlc291cmNlTG9hZGVyOiAoXG4gICAgICAgICAgICByZXNvdXJjZTp7XG4gICAgICAgICAgICAgICAgZWxlbWVudDpEb21Ob2RlO1xuICAgICAgICAgICAgICAgIHVybDp7XG4gICAgICAgICAgICAgICAgICAgIGhvc3RuYW1lOnN0cmluZztcbiAgICAgICAgICAgICAgICAgICAgaG9zdDpzdHJpbmc7XG4gICAgICAgICAgICAgICAgICAgIHBvcnQ6P3N0cmluZztcbiAgICAgICAgICAgICAgICAgICAgcHJvdG9jb2w6c3RyaW5nO1xuICAgICAgICAgICAgICAgICAgICBocmVmOnN0cmluZztcbiAgICAgICAgICAgICAgICAgICAgcGF0aDpzdHJpbmc7XG4gICAgICAgICAgICAgICAgICAgIHBhdGhuYW1lOnN0cmluZztcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNvb2tpZTpzdHJpbmc7XG4gICAgICAgICAgICAgICAgYmFzZVVybDpzdHJpbmc7XG4gICAgICAgICAgICAgICAgZGVmYXVsdEZldGNoOihjYWxsYmFjazooXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOj9FcnJvciwgYm9keTpzdHJpbmdcbiAgICAgICAgICAgICAgICApID0+IHZvaWQpID0+IHZvaWRcbiAgICAgICAgICAgIH0sIGNhbGxiYWNrOihlcnJvcjo/RXJyb3IsIGNvbnRlbnQ6YW55KSA9PiB2b2lkXG4gICAgICAgICk6dm9pZCA9PiB7XG4gICAgICAgICAgICBpZiAocmVzb3VyY2UudXJsLmhvc3RuYW1lID09PSAnbG9jYWxob3N0Jykge1xuICAgICAgICAgICAgICAgIHJlc291cmNlLnVybC5ob3N0ID0gcmVzb3VyY2UudXJsLmhvc3RuYW1lID0gJydcbiAgICAgICAgICAgICAgICByZXNvdXJjZS51cmwucG9ydCA9IG51bGxcbiAgICAgICAgICAgICAgICByZXNvdXJjZS51cmwucHJvdG9jb2wgPSAnZmlsZTonXG4gICAgICAgICAgICAgICAgcmVzb3VyY2UudXJsLmhyZWYgPSByZXNvdXJjZS51cmwuaHJlZi5yZXBsYWNlKFxuICAgICAgICAgICAgICAgICAgICAvXlthLXpBLVpdKzpcXC9cXC9sb2NhbGhvc3QoPzo6WzAtOV0rKT8vLFxuICAgICAgICAgICAgICAgICAgICBgZmlsZTovLyR7cHJvY2Vzcy5jd2QoKX1gKVxuICAgICAgICAgICAgICAgIHJlc291cmNlLnVybC5wYXRoID0gcmVzb3VyY2UudXJsLnBhdGhuYW1lID0gcGF0aC5qb2luKFxuICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLmN3ZCgpLCByZXNvdXJjZS51cmwucGF0aClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChicm93c2VyQVBJLmRlYnVnKVxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhgTG9hZCByZXNvdXJjZSBcIiR7cmVzb3VyY2UudXJsLmhyZWZ9XCIuYClcbiAgICAgICAgICAgIHJldHVybiByZXNvdXJjZS5kZWZhdWx0RmV0Y2goKFxuICAgICAgICAgICAgICAgIGVycm9yOj9FcnJvciwgLi4uYWRkaXRpb25hbFBhcmFtZXRlcjpBcnJheTxhbnk+XG4gICAgICAgICAgICApOnZvaWQgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghZXJyb3IpXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCAuLi5hZGRpdGlvbmFsUGFyYW1ldGVyKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSxcbiAgICAgICAgdXJsOiAnaHR0cDovL2xvY2FsaG9zdCcsXG4gICAgICAgIHZpcnR1YWxDb25zb2xlXG4gICAgfSlcbiAgICBpZiAodHlwZW9mIE5BTUUgPT09ICd1bmRlZmluZWQnIHx8IE5BTUUgPT09ICd3ZWJPcHRpbWl6ZXInKSB7XG4gICAgICAgIGNvbnN0IGZpbGVQYXRoOnN0cmluZyA9IHBhdGguam9pbihfX2Rpcm5hbWUsICdpbmRleC5odG1sLmVqcycpXG4gICAgICAgIHJlcXVpcmUoJ2ZzJykucmVhZEZpbGUoZmlsZVBhdGgsIHtlbmNvZGluZzogJ3V0Zi04J30sIChcbiAgICAgICAgICAgIGVycm9yOj9FcnJvciwgY29udGVudDpzdHJpbmdcbiAgICAgICAgKTp2b2lkID0+IHtcbiAgICAgICAgICAgIGlmIChlcnJvcilcbiAgICAgICAgICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgICAgICAgcmVuZGVyKHJlcXVpcmUoJy4vZWpzTG9hZGVyLmNvbXBpbGVkJykuYmluZCh7ZmlsZW5hbWU6IGZpbGVQYXRofSkoXG4gICAgICAgICAgICAgICAgY29udGVudCkpXG4gICAgICAgIH0pXG4gICAgfSBlbHNlXG4gICAgICAgIC8vIElnbm9yZVR5cGVDaGVja1xuICAgICAgICByZW5kZXIocmVxdWlyZSgnd2ViT3B0aW1pemVyRGVmYXVsdFRlbXBsYXRlRmlsZVBhdGgnKSlcbiAgICAvLyBlbmRyZWdpb25cbn0gZWxzZSB7XG4gICAgYnJvd3NlckFQSSA9IHtcbiAgICAgICAgZGVidWc6IGZhbHNlLCBkb21Db250ZW50TG9hZGVkOiBmYWxzZSwgbWV0YURPTTogbnVsbCwgd2luZG93LFxuICAgICAgICB3aW5kb3dMb2FkZWQ6IGZhbHNlfVxuICAgIHdpbmRvdy5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCk6dm9pZCA9PiB7XG4gICAgICAgIGJyb3dzZXJBUEkuZG9tQ29udGVudExvYWRlZCA9IHRydWVcbiAgICAgICAgZm9yIChjb25zdCBjYWxsYmFjazpGdW5jdGlvbiBvZiBvbkNyZWF0ZWRMaXN0ZW5lcilcbiAgICAgICAgICAgIGNhbGxiYWNrKGJyb3dzZXJBUEksIGZhbHNlKVxuICAgIH0pXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKTp2b2lkID0+IHtcbiAgICAgICAgYnJvd3NlckFQSS53aW5kb3dMb2FkZWQgPSB0cnVlXG4gICAgfSlcbn1cbi8vIGVuZHJlZ2lvblxuZXhwb3J0IGRlZmF1bHQgKGNhbGxiYWNrOkZ1bmN0aW9uLCBjbGVhcjpib29sZWFuID0gdHJ1ZSk6YW55ID0+IHtcbiAgICAvLyByZWdpb24gaW5pdGlhbGl6ZSBnbG9iYWwgY29udGV4dFxuICAgIC8qXG4gICAgICAgIE5PVEU6IFdlIGhhdmUgdG8gZGVmaW5lIHdpbmRvdyBnbG9iYWxseSBiZWZvcmUgYW55dGhpbmcgaXMgbG9hZGVkIHRvXG4gICAgICAgIGVuc3VyZSB0aGF0IGFsbCBmdXR1cmUgaW5zdGFuY2VzIHNoYXJlIHRoZSBzYW1lIHdpbmRvdyBvYmplY3QuXG4gICAgKi9cbiAgICBjb25zdCB3cmFwcGVkQ2FsbGJhY2s6RnVuY3Rpb24gPSAoLi4ucGFyYW1ldGVyOkFycmF5PGFueT4pOmFueSA9PiB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIGNsZWFyICYmIHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnICYmXG4gICAgICAgICAgICBnbG9iYWwgIT09IGJyb3dzZXJBUEkud2luZG93XG4gICAgICAgIClcbiAgICAgICAgICAgIGdsb2JhbC53aW5kb3cgPSBicm93c2VyQVBJLndpbmRvd1xuICAgICAgICByZXR1cm4gY2FsbGJhY2soLi4ucGFyYW1ldGVyKVxuICAgIH1cbiAgICAvLyBlbmRyZWdpb25cbiAgICBpZiAoXG4gICAgICAgIHR5cGVvZiBUQVJHRVRfVEVDSE5PTE9HWSA9PT0gJ3VuZGVmaW5lZCcgfHxcbiAgICAgICAgVEFSR0VUX1RFQ0hOT0xPR1kgPT09ICdub2RlJ1xuICAgIClcbiAgICAgICAgcmV0dXJuIChicm93c2VyQVBJKSA/IHdyYXBwZWRDYWxsYmFjayhcbiAgICAgICAgICAgIGJyb3dzZXJBUEksIHRydWVcbiAgICAgICAgKSA6IG9uQ3JlYXRlZExpc3RlbmVyLnB1c2god3JhcHBlZENhbGxiYWNrKVxuICAgIHJldHVybiAoYnJvd3NlckFQSS5kb21Db250ZW50TG9hZGVkKSA/IHdyYXBwZWRDYWxsYmFjayhcbiAgICAgICAgYnJvd3NlckFQSSwgdHJ1ZVxuICAgICkgOiBvbkNyZWF0ZWRMaXN0ZW5lci5wdXNoKHdyYXBwZWRDYWxsYmFjaylcbn1cbi8vIHJlZ2lvbiB2aW0gbW9kbGluZVxuLy8gdmltOiBzZXQgdGFic3RvcD00IHNoaWZ0d2lkdGg9NCBleHBhbmR0YWI6XG4vLyB2aW06IGZvbGRtZXRob2Q9bWFya2VyIGZvbGRtYXJrZXI9cmVnaW9uLGVuZHJlZ2lvbjpcbi8vIGVuZHJlZ2lvblxuIl19