'use strict';Object.defineProperty(exports,'__esModule',{value:!0});const onCreatedListener=[];let browserAPI;if('undefined'==typeof TARGET_TECHNOLOGY||'node'===TARGET_TECHNOLOGY){const a=require('path'),{JSDOM:b,VirtualConsole:c}=require('jsdom'),d=b,e=new c;for(const g of['assert','dir','info','log','time','timeEnd','trace','warn'])e.on(g,console[g].bind(console));e.on('error',function(g){!browserAPI.debug&&['XMLHttpRequest','resource loading'].includes(g.type)?console.warn(`Loading resource failed: ${g.toString()}.`):console.error(g.stack,g.detail)});const f=function render(g){let h=new d(g,{resources:'usable',runScripts:'dangerously',url:'http://localhost',virtualConsole:e}).window;browserAPI={debug:!1,domContentLoaded:!1,DOM:d,window:h,windowLoaded:!1},h.addEventListener('load',function(){browserAPI.domContentLoaded=!0,browserAPI.windowLoaded=!0}),h.document.addEventListener('DOMContentLoaded',function(){browserAPI.domContentLoaded=!0});for(const i of onCreatedListener)i(browserAPI,!1);return h};if('undefined'==typeof NAME||'webOptimizer'===NAME){const g=a.join(__dirname,'index.html.ejs');require('fs').readFile(g,{encoding:'utf-8'},function(h,i){if(h)throw h;f(require('./ejsLoader.compiled').bind({filename:g})(i))})}else f(require('webOptimizerDefaultTemplateFilePath'))}else browserAPI={debug:!1,domContentLoaded:!1,DOM:null,window,windowLoaded:!1},window.document.addEventListener('DOMContentLoaded',function(){browserAPI.domContentLoaded=!0;for(const a of onCreatedListener)a(browserAPI,!1)}),window.addEventListener('load',function(){browserAPI.windowLoaded=!0});exports.default=function(a,b=!0){const c=function wrappedCallback(...d){return b&&'undefined'!=typeof global&&global!==browserAPI.window&&(global.window=browserAPI.window),a(...d)};return'undefined'==typeof TARGET_TECHNOLOGY||'node'===TARGET_TECHNOLOGY?browserAPI?c(browserAPI,!0):onCreatedListener.push(c):browserAPI.domContentLoaded?c(browserAPI,!0):onCreatedListener.push(c)};

//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QTJCLFdBQWxCLFFBQU8sT0FBaEIsRUFDQSxTQUFXLFdBQVcsTUFHMUIsR0FESSxPQUFPLE1BQVAsQ0FBZ0IsV0FBVyxNQUMvQixFQUFPLEVBQVMsR0FBRyxDQUFaLENBQ1YsQ0FQRCxDQU40RCxNQWdCM0IsV0FBN0IsUUFBTyxrQkFBUCxFQUNzQixNQUF0QixvQkFqQndELENBbUJoRCxVQUFELENBQWUsRUFDbEIsVUFEa0IsSUFBZixDQUVILGtCQUFrQixJQUFsQixDQUF1QixDQUF2QixDQXJCb0QsQ0FzQnBELFdBQVcsZ0JBQVosQ0FBZ0MsRUFDbkMsVUFEbUMsSUFBaEMsQ0FFSCxrQkFBa0IsSUFBbEIsQ0FBdUIsQ0FBdkIsQ0FDUCxDIiwiZmlsZSI6ImJyb3dzZXJBUEkuY29tcGlsZWQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyAjIS91c3IvYmluL2VudiBub2RlXG4vLyBAZmxvd1xuLy8gLSotIGNvZGluZzogdXRmLTggLSotXG4ndXNlIHN0cmljdCdcbi8qICFcbiAgICByZWdpb24gaGVhZGVyXG4gICAgQ29weXJpZ2h0IFRvcmJlbiBTaWNrZXJ0IChpbmZvW1wifmF0flwiXXRvcmJlbi53ZWJzaXRlKSAxNi4xMi4yMDEyXG5cbiAgICBMaWNlbnNlXG4gICAgLS0tLS0tLVxuXG4gICAgVGhpcyBsaWJyYXJ5IHdyaXR0ZW4gYnkgVG9yYmVuIFNpY2tlcnQgc3RhbmQgdW5kZXIgYSBjcmVhdGl2ZSBjb21tb25zIG5hbWluZ1xuICAgIDMuMCB1bnBvcnRlZCBsaWNlbnNlLiBzZWUgaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnkvMy4wL2RlZWQuZGVcbiAgICBlbmRyZWdpb25cbiovXG4vLyByZWdpb24gaW1wb3J0c1xuaW1wb3J0IHR5cGUge1dpbmRvd30gZnJvbSAnY2xpZW50bm9kZSdcbmltcG9ydCB0eXBlIHtCcm93c2VyQVBJfSBmcm9tICcuL3R5cGUnXG4vLyBlbmRyZWdpb25cbi8vIHJlZ2lvbiBkZWNsYXJhdGlvblxuLy8gTk9URTogUHJvZHVjZXMgYSBiYWJlbCBlcnJvciB5ZXQuXG4vLyBkZWNsYXJlIHZhciBOQU1FOnN0cmluZ1xuLy8gZGVjbGFyZSB2YXIgVEFSR0VUX1RFQ0hOT0xPR1k6c3RyaW5nXG5kZWNsYXJlIHZhciB3aW5kb3c6V2luZG93XG4vLyBlbmRyZWdpb25cbi8vIHJlZ2lvbiB2YXJpYWJsZXNcbmNvbnN0IG9uQ3JlYXRlZExpc3RlbmVyOkFycmF5PEZ1bmN0aW9uPiA9IFtdXG5sZXQgYnJvd3NlckFQSTpCcm93c2VyQVBJXG4vLyBlbmRyZWdpb25cbi8vIHJlZ2lvbiBlbnN1cmUgcHJlc2VuY2Ugb2YgY29tbW9uIGJyb3dzZXIgZW52aXJvbm1lbnRcbmlmICh0eXBlb2YgVEFSR0VUX1RFQ0hOT0xPR1kgPT09ICd1bmRlZmluZWQnIHx8IFRBUkdFVF9URUNITk9MT0dZID09PSAnbm9kZScpIHtcbiAgICAvLyByZWdpb24gbW9jayBicm93c2VyIGVudmlyb25tZW50XG4gICAgY29uc3QgcGF0aDpPYmplY3QgPSByZXF1aXJlKCdwYXRoJylcbiAgICBjb25zdCB7SlNET00sIFZpcnR1YWxDb25zb2xlfSA9IHJlcXVpcmUoJ2pzZG9tJylcbiAgICBjb25zdCBET006dHlwZW9mIE9iamVjdCA9IEpTRE9NXG4gICAgY29uc3QgdmlydHVhbENvbnNvbGU6T2JqZWN0ID0gbmV3IFZpcnR1YWxDb25zb2xlKClcbiAgICBmb3IgKGNvbnN0IG5hbWU6c3RyaW5nIG9mIFtcbiAgICAgICAgJ2Fzc2VydCcsICdkaXInLCAnaW5mbycsICdsb2cnLCAndGltZScsICd0aW1lRW5kJywgJ3RyYWNlJywgJ3dhcm4nXG4gICAgXSlcbiAgICAgICAgdmlydHVhbENvbnNvbGUub24obmFtZSwgY29uc29sZVtuYW1lXS5iaW5kKGNvbnNvbGUpKVxuICAgIHZpcnR1YWxDb25zb2xlLm9uKCdlcnJvcicsIChlcnJvcjpFcnJvcik6dm9pZCA9PiB7XG4gICAgICAgIGlmICghYnJvd3NlckFQSS5kZWJ1ZyAmJiBbXG4gICAgICAgICAgICAnWE1MSHR0cFJlcXVlc3QnLCAncmVzb3VyY2UgbG9hZGluZydcbiAgICAgICAgLy8gSWdub3JlVHlwZUNoZWNrXG4gICAgICAgIF0uaW5jbHVkZXMoZXJyb3IudHlwZSkpXG4gICAgICAgICAgICBjb25zb2xlLndhcm4oYExvYWRpbmcgcmVzb3VyY2UgZmFpbGVkOiAke2Vycm9yLnRvU3RyaW5nKCl9LmApXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIC8vIElnbm9yZVR5cGVDaGVja1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvci5zdGFjaywgZXJyb3IuZGV0YWlsKVxuICAgIH0pXG4gICAgY29uc3QgcmVuZGVyOkZ1bmN0aW9uID0gKHRlbXBsYXRlOnN0cmluZyk6V2luZG93ID0+IHtcbiAgICAgICAgbGV0IHdpbmRvdzpXaW5kb3cgPSAobmV3IERPTSh0ZW1wbGF0ZSwge1xuICAgICAgICAgICAgcmVzb3VyY2VzOiAndXNhYmxlJyxcbiAgICAgICAgICAgIHJ1blNjcmlwdHM6ICdkYW5nZXJvdXNseScsXG4gICAgICAgICAgICB1cmw6ICdodHRwOi8vbG9jYWxob3N0JyxcbiAgICAgICAgICAgIHZpcnR1YWxDb25zb2xlXG4gICAgICAgIH0pKS53aW5kb3dcbiAgICAgICAgYnJvd3NlckFQSSA9IHtcbiAgICAgICAgICAgIGRlYnVnOiBmYWxzZSwgZG9tQ29udGVudExvYWRlZDogZmFsc2UsIERPTSwgd2luZG93LFxuICAgICAgICAgICAgd2luZG93TG9hZGVkOiBmYWxzZX1cbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKTp2b2lkID0+IHtcbiAgICAgICAgICAgIC8vIE5PVEU6IE1heWJlIHdlIGhhdmUgbWlzcyB0aGUgXCJET01Db250ZW50TG9hZGVkXCIgZXZlbnQuXG4gICAgICAgICAgICBicm93c2VyQVBJLmRvbUNvbnRlbnRMb2FkZWQgPSB0cnVlXG4gICAgICAgICAgICBicm93c2VyQVBJLndpbmRvd0xvYWRlZCA9IHRydWVcbiAgICAgICAgfSlcbiAgICAgICAgd2luZG93LmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKTp2b2lkID0+IHtcbiAgICAgICAgICAgIGJyb3dzZXJBUEkuZG9tQ29udGVudExvYWRlZCA9IHRydWVcbiAgICAgICAgfSlcbiAgICAgICAgZm9yIChjb25zdCBjYWxsYmFjazpGdW5jdGlvbiBvZiBvbkNyZWF0ZWRMaXN0ZW5lcilcbiAgICAgICAgICAgIGNhbGxiYWNrKGJyb3dzZXJBUEksIGZhbHNlKVxuICAgICAgICByZXR1cm4gd2luZG93XG4gICAgfVxuICAgIGlmICh0eXBlb2YgTkFNRSA9PT0gJ3VuZGVmaW5lZCcgfHwgTkFNRSA9PT0gJ3dlYk9wdGltaXplcicpIHtcbiAgICAgICAgY29uc3QgZmlsZVBhdGg6c3RyaW5nID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJ2luZGV4Lmh0bWwuZWpzJylcbiAgICAgICAgcmVxdWlyZSgnZnMnKS5yZWFkRmlsZShmaWxlUGF0aCwge2VuY29kaW5nOiAndXRmLTgnfSwgKFxuICAgICAgICAgICAgZXJyb3I6P0Vycm9yLCBjb250ZW50OnN0cmluZ1xuICAgICAgICApOnZvaWQgPT4ge1xuICAgICAgICAgICAgaWYgKGVycm9yKVxuICAgICAgICAgICAgICAgIHRocm93IGVycm9yXG4gICAgICAgICAgICByZW5kZXIocmVxdWlyZSgnLi9lanNMb2FkZXIuY29tcGlsZWQnKS5iaW5kKHtmaWxlbmFtZTogZmlsZVBhdGh9KShcbiAgICAgICAgICAgICAgICBjb250ZW50KSlcbiAgICAgICAgfSlcbiAgICB9IGVsc2VcbiAgICAgICAgLy8gSWdub3JlVHlwZUNoZWNrXG4gICAgICAgIHJlbmRlcihyZXF1aXJlKCd3ZWJPcHRpbWl6ZXJEZWZhdWx0VGVtcGxhdGVGaWxlUGF0aCcpKVxuICAgIC8vIGVuZHJlZ2lvblxufSBlbHNlIHtcbiAgICBicm93c2VyQVBJID0ge1xuICAgICAgICBkZWJ1ZzogZmFsc2UsIGRvbUNvbnRlbnRMb2FkZWQ6IGZhbHNlLCBET006IG51bGwsIHdpbmRvdyxcbiAgICAgICAgd2luZG93TG9hZGVkOiBmYWxzZX1cbiAgICB3aW5kb3cuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpOnZvaWQgPT4ge1xuICAgICAgICBicm93c2VyQVBJLmRvbUNvbnRlbnRMb2FkZWQgPSB0cnVlXG4gICAgICAgIGZvciAoY29uc3QgY2FsbGJhY2s6RnVuY3Rpb24gb2Ygb25DcmVhdGVkTGlzdGVuZXIpXG4gICAgICAgICAgICBjYWxsYmFjayhicm93c2VyQVBJLCBmYWxzZSlcbiAgICB9KVxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCk6dm9pZCA9PiB7XG4gICAgICAgIGJyb3dzZXJBUEkud2luZG93TG9hZGVkID0gdHJ1ZVxuICAgIH0pXG59XG4vLyBlbmRyZWdpb25cbmV4cG9ydCBkZWZhdWx0IChjYWxsYmFjazpGdW5jdGlvbiwgY2xlYXI6Ym9vbGVhbiA9IHRydWUpOmFueSA9PiB7XG4gICAgLy8gcmVnaW9uIGluaXRpYWxpemUgZ2xvYmFsIGNvbnRleHRcbiAgICAvKlxuICAgICAgICBOT1RFOiBXZSBoYXZlIHRvIGRlZmluZSB3aW5kb3cgZ2xvYmFsbHkgYmVmb3JlIGFueXRoaW5nIGlzIGxvYWRlZCB0b1xuICAgICAgICBlbnN1cmUgdGhhdCBhbGwgZnV0dXJlIGluc3RhbmNlcyBzaGFyZSB0aGUgc2FtZSB3aW5kb3cgb2JqZWN0LlxuICAgICovXG4gICAgY29uc3Qgd3JhcHBlZENhbGxiYWNrOkZ1bmN0aW9uID0gKC4uLnBhcmFtZXRlcjpBcnJheTxhbnk+KTphbnkgPT4ge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgICBjbGVhciAmJiB0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJyAmJlxuICAgICAgICAgICAgZ2xvYmFsICE9PSBicm93c2VyQVBJLndpbmRvd1xuICAgICAgICApXG4gICAgICAgICAgICBnbG9iYWwud2luZG93ID0gYnJvd3NlckFQSS53aW5kb3dcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKC4uLnBhcmFtZXRlcilcbiAgICB9XG4gICAgLy8gZW5kcmVnaW9uXG4gICAgaWYgKFxuICAgICAgICB0eXBlb2YgVEFSR0VUX1RFQ0hOT0xPR1kgPT09ICd1bmRlZmluZWQnIHx8XG4gICAgICAgIFRBUkdFVF9URUNITk9MT0dZID09PSAnbm9kZSdcbiAgICApXG4gICAgICAgIHJldHVybiAoYnJvd3NlckFQSSkgPyB3cmFwcGVkQ2FsbGJhY2soXG4gICAgICAgICAgICBicm93c2VyQVBJLCB0cnVlXG4gICAgICAgICkgOiBvbkNyZWF0ZWRMaXN0ZW5lci5wdXNoKHdyYXBwZWRDYWxsYmFjaylcbiAgICByZXR1cm4gKGJyb3dzZXJBUEkuZG9tQ29udGVudExvYWRlZCkgPyB3cmFwcGVkQ2FsbGJhY2soXG4gICAgICAgIGJyb3dzZXJBUEksIHRydWVcbiAgICApIDogb25DcmVhdGVkTGlzdGVuZXIucHVzaCh3cmFwcGVkQ2FsbGJhY2spXG59XG4vLyByZWdpb24gdmltIG1vZGxpbmVcbi8vIHZpbTogc2V0IHRhYnN0b3A9NCBzaGlmdHdpZHRoPTQgZXhwYW5kdGFiOlxuLy8gdmltOiBmb2xkbWV0aG9kPW1hcmtlciBmb2xkbWFya2VyPXJlZ2lvbixlbmRyZWdpb246XG4vLyBlbmRyZWdpb25cbiJdfQ==